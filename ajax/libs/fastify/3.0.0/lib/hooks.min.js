"use strict";const applicationHooks=["onRoute","onRegister","onReady","onClose"],lifecycleHooks=["onRequest","preParsing","preValidation","preSerialization","preHandler","onSend","onResponse","onError"],supportedHooks=lifecycleHooks.concat(applicationHooks),{FST_ERR_HOOK_INVALID_TYPE:FST_ERR_HOOK_INVALID_TYPE,FST_ERR_HOOK_INVALID_HANDLER:FST_ERR_HOOK_INVALID_HANDLER,FST_ERR_SEND_UNDEFINED_ERR:FST_ERR_SEND_UNDEFINED_ERR}=require("./errors"),{kReplyIsError:kReplyIsError,kChildren:kChildren,kHooks:kHooks}=require("./symbols");function Hooks(){this.onRequest=[],this.preParsing=[],this.preValidation=[],this.preSerialization=[],this.preHandler=[],this.onResponse=[],this.onSend=[],this.onError=[],this.onRoute=[],this.onRegister=[],this.onReady=[]}function buildHooks(o){const n=new Hooks;return n.onRequest=o.onRequest.slice(),n.preParsing=o.preParsing.slice(),n.preValidation=o.preValidation.slice(),n.preSerialization=o.preSerialization.slice(),n.preHandler=o.preHandler.slice(),n.onSend=o.onSend.slice(),n.onResponse=o.onResponse.slice(),n.onError=o.onError.slice(),n.onRoute=o.onRoute.slice(),n.onRegister=o.onRegister.slice(),n.onReady=[],n}function hookRunnerApplication(o,n,e,i){const t=e[kHooks][o];var r=0,s=0;function l(o){o?i(o):i()}!function i(u){if(u)return void l(u);if(r===t.length&&s===e[kChildren].length)return void(0===r&&0===s?l():n(function(o,n){l(o),n(o)}));if(r===t.length&&s<e[kChildren].length){const t=e[kChildren][s++];return void hookRunnerApplication(o,n,t,i)}n(function(o,n){return function(e,i){if(e)return void i(e);if(1===o.length){try{o.call(n,i)}catch(o){i(o)}return}const t=o.call(n);t&&"function"==typeof t.then?t.then(i,i):i(e)}}(t[r++],e));i()}()}function hookRunner(o,n,e,i,t){var r=0;function s(c){if(c||r===o.length)return void t(c,e,i);const R=n(o[r++],e,i,s);R&&"function"==typeof R.then&&R.then(l,u)}function l(){s()}function u(o){o?o instanceof Error||(i[kReplyIsError]=!0):o=new FST_ERR_SEND_UNDEFINED_ERR,t(o,e,i)}s()}function onSendHookRunner(o,n,e,i,t){var r=0;function s(c,R){if(c)return void t(c,n,e,i);if(void 0!==R&&(i=R),r===o.length)return void t(null,n,e,i);const p=o[r++](n,e,i,s);p&&"function"==typeof p.then&&p.then(l,u)}function l(o){s(null,o)}function u(o){t(o,n,e,i)}s()}function hookIterator(o,n,e,i){if(!0!==e.sent)return o(n,e,i)}Hooks.prototype.validate=function(o,n){if("string"!=typeof o)throw new FST_ERR_HOOK_INVALID_TYPE;if("function"!=typeof n)throw new FST_ERR_HOOK_INVALID_HANDLER;if(-1===supportedHooks.indexOf(o))throw new Error(`${o} hook not supported!`)},Hooks.prototype.add=function(o,n){this.validate(o,n),this[o].push(n)},module.exports={Hooks:Hooks,buildHooks:buildHooks,hookRunner:hookRunner,onSendHookRunner:onSendHookRunner,hookIterator:hookIterator,hookRunnerApplication:hookRunnerApplication,lifecycleHooks:lifecycleHooks};