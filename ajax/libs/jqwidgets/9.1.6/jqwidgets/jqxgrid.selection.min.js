!function(L){L.extend(L.jqx._jqxGrid.prototype,{selectallrows:function(){this._trigger=!1;var e=this.virtualmode?this.dataview.totalrecords:this.dataview.loadedrecords.length;this.selectedrowindexes=new Array;for(var t=this.dataview.loadedrecords,l=0;l<e;l++){var i,s=t[l];s?null!=(i=this.getboundindex(s))&&(this.selectedrowindexes[l]=i):this.selectedrowindexes[l]=l}"checkbox"!=this.selectionmode||this._checkboxcolumnupdating||this._checkboxcolumn&&this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!0}),this._renderrows(this.virtualsizeinfo),this._trigger=!0,"checkbox"==this.selectionmode&&this._raiseEvent(2,{rowindex:this.selectedrowindexes})},unselectallrows:function(){this._trigger=!1;this.virtualmode?this.dataview.totalrecords:this.dataview.loadedrecords.length;this.selectedrowindexes=new Array,"checkbox"!=this.selectionmode||this._checkboxcolumnupdating||this._checkboxcolumn&&this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!1}),this._renderrows(this.virtualsizeinfo),this._trigger=!0,"checkbox"==this.selectionmode&&this._raiseEvent(2,{rowindex:this.selectedrowindexes})},selectrow:function(e,t){"none"!==this.selectionmode&&(this._applyrowselection(e,!0,t),!1!==t&&this._updatecheckboxselection())},_updatecheckboxselection:function(){if("checkbox"==this.selectionmode){var e=this.getrows();if(e&&this._checkboxcolumn){if(0===e.length)return void this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!1});var t=e.length;this.groupable&&(t=this.dataview.loadedrecords.length),this.virtualmode&&(t=this.source._source.totalrecords);var l=this.selectedrowindexes.length;l===t?this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!0}):0===l?this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!1}):this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:null})}}},unselectrow:function(e,t){this._applyrowselection(e,!1,t),!1!==t&&this._updatecheckboxselection()},selectcell:function(e,t){this._applycellselection(e,t,!0)},unselectcell:function(e,t){this._applycellselection(e,t,!1)},clearselection:function(e,t){if(this._trigger=!1,this.selectedrowindex=-1,this._oldselectedcell=null,!1!==t)for(var l=0;l<this.selectedrowindexes.length;l++)this._raiseEvent(3,{rowindex:this.selectedrowindexes[l]});this.selectedrowindexes=new Array,this.selectedcells=new Array,this.selectedcell=null,"checkbox"!=this.selectionmode||this._checkboxcolumnupdating||this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!1});for(l=0;l<this.columns.records.length;l++)this.columns.records[l].selected=!1,this.columns.records[l]._applyStyle();!1!==e?(this._renderrows(this.virtualsizeinfo),this._trigger=!0,"checkbox"==this.selectionmode&&this._raiseEvent(3,{rowindex:this.selectedrowindexes})):this._trigger=!0},getselectedrowindex:function(){if(-1==this.selectedrowindex||null==this.selectedrowindex){var e=0;if(e<this.selectedrowindexes.length)return this.selectedrowindexes[e]}return this.selectedrowindex},getselectedrowindexes:function(){return this.selectedrowindexes},getselectedcell:function(){if(!this.selectedcell)return null;var e=this.selectedcell;return e.row=this.selectedcell.rowindex,e.column=this.selectedcell.datafield,e.value=this.getcellvalue(e.row,e.column),e},getselectedcells:function(){var e=new Array;for(var t in this.selectedcells)e[e.length]=this.selectedcells[t];return e},getselection:function(){return{cells:this.getselectedcells(),rows:this.getselectedrowindexes()}},_getcellsforcopypaste:function(){var e=new Array;if(-1==this.selectionmode.indexOf("cell"))for(var t=this.selectedrowindexes,l=0;l<t.length;l++)for(var i,s=t[l],o=0;o<this.columns.records.length;o++){"_checkboxcolumn"!==this.columns.records[o].datafield&&(this.columns.records[o].datafield,i={rowindex:s,datafield:this.columns.records[o].datafield},e.push(i))}return e},deleteselection:function(){var e=this,t=e.getselectedcells();if(-1==this.selectionmode.indexOf("cell")&&(t=this._getcellsforcopypaste()),null!=t&&0<t.length){for(var l=0;l<t.length;l++){var i,s=t[l],o=e.getcolumn(s.datafield),r=e.getcellvalue(s.rowindex,s.datafield);o&&""!==r&&(i=null,"checkbox"==o.columntype&&(o.threestatecheckbox||(i=!1)),e._raiseEvent(17,{rowindex:s.rowindex,datafield:s.datafield,value:r}),l==t.length-1?e.setcellvalue(s.rowindex,s.datafield,i,!0):e.setcellvalue(s.rowindex,s.datafield,i,!1),o.displayfield!=o.datafield&&e.setcellvalue(s.rowindex,o.displayfield,i,!0),e._raiseEvent(18,{rowindex:s.rowindex,datafield:s.datafield,oldvalue:r,value:i}))}this.dataview.updateview(),this._renderrows(this.virtualsizeinfo)}},copyselection:function(){var i="",s=this;this.clipboardselection={},this.logicalclipboardselection={},this._clipboardselection=[];var e=s.getselectedcells();-1==this.selectionmode.indexOf("cell")&&(e=this._getcellsforcopypaste());var t=new Array;if(null!=e&&0<e.length){for(var l=999999999999999,o=-1,r=0;r<e.length;r++){var a,n,c=e[r],d=s.getcolumn(c.datafield);null==d||!d.clipboard||d.hidden&&!this.copytoclipboardhiddencolumns||(-1==t.indexOf(d.text)&&t.push(d.text),a=s.getcelltext(c.rowindex,d.displayfield),n=this.getrowdisplayindex(c.rowindex),this.clipboardselection[n]||(this.clipboardselection[n]={}),this.clipboardselection[n][d.displayfield]=a,this.logicalclipboardselection[n]||(this.logicalclipboardselection[n]={}),this.logicalclipboardselection[n][d.displayfield]=a,d.displayfield!=d.datafield&&(this.logicalclipboardselection[n][d.datafield]=s.getcellvalue(c.rowindex,d.datafield)),l=Math.min(l,n),o=Math.max(o,n))}for(var h,u=new Array,f=l;f<=o;f++){this.logicalclipboardselection[f]&&(h=L.extend({},this.logicalclipboardselection[f]),u.push(h))}if(this.logicalclipboardselection=u,this.copytoclipboardwithheaders){for(var p=0;p<t.length;p++)0<p&&(i+="\t"),i+=t[p];i+="\r\n"}for(f=l;f<=o;f++){var g=0;this._clipboardselection[this._clipboardselection.length]=new Array,null!=this.clipboardselection[f]&&(L.each(this.clipboardselection[f],function(e,t){0<g&&(i+="\t");var l=null==t?"":t;s._clipboardselection[s._clipboardselection.length-1][g]=l,g++,i+=l}),f<o&&(i+="\r\n"))}}return this.clipboardselectedtext=i},pasteselection:function(){var e=this.getselectedcells();if(this._oldselectedcell=null,-1==this.selectionmode.indexOf("cell")&&(e=this._getcellsforcopypaste()),null!=e&&0<e.length){var t=e[0].rowindex,l=this.getrowdisplayindex(t),i=e[0].datafield,s=this._getcolumnindex(i);this.selectedrowindexes=new Array,this.selectedcells=new Array;e.length;var o=0,r=new Array;this.copytoclipboardwithheaders&&this._clipboardselection.splice(0,1);for(var a=0;a<this._clipboardselection.length;a++){o+=this._clipboardselection[a].length,r[a]=new Array;for(var n=0;n<this._clipboardselection[a].length;n++){var c=this._clipboardselection[a][n];r[a].push(c)}}if(o<e.length){for(var d=new Array,a=0;a<e.length;a++){d[(b=e[a]).rowindex]||(d[b.rowindex]=new Array),d[b.rowindex].push(b)}for(var h=0,u=0,a=0;a<d.length;a++)if(d[a]){for(n=0;n<d[a].length;n++){var f=(b=d[a][n]).rowindex;if("_checkboxcolumn"!==(w=this.getcolumn(b.datafield)).datafield&&!w.hidden){c="";if(null==r[h][u]&&(u=0),c=r[h][u],u++,w.cellsformat&&(-1!=w.cellsformat.indexOf("p")||-1!=w.cellsformat.indexOf("c")||-1!=w.cellsformat.indexOf("n")||-1!=w.cellsformat.indexOf("f"))){-1<c.indexOf(this.gridlocalization.currencysymbol)&&(c=c.replace(this.gridlocalization.currencysymbol,"")),-1<(c=(c=function(e,t,l){var i=e;if(t==l)return e;for(var s=i.indexOf(t);-1!=s;)s=(i=i.replace(t,l)).indexOf(t);return i}(c,this.gridlocalization.thousandsseparator,"")).replace(this.gridlocalization.decimalseparator,".")).indexOf(this.gridlocalization.percentsymbol)&&(c=c.replace(this.gridlocalization.percentsymbol,""));for(var p="",g=0;g<c.length;g++){"-"===(_=c.substring(g,g+1))&&(p+="-"),"."===_&&(p+="."),null!=_.match(/^[0-9]+$/)&&(p+=_)}c=(c=p).replace(/ /g,""),c=new Number(c),isNaN(c)&&(c="")}this._raiseEvent(17,{rowindex:f,datafield:b.datafield,value:c}),this.setcellvalue(f,w.displayfield,c,!1),w.displayfield!=w.datafield&&this.logicalclipboardselection&&this.logicalclipboardselection[f]&&null!=(x=this.logicalclipboardselection[f][w.datafield])&&this.setcellvalue(f,w.datafield,x,!1),this._raiseEvent(18,{rowindex:f,datafield:b.datafield,oldvalue:this.getcellvalue(b.rowindex,b.datafield),value:c}),this._applycellselection(f,b.datafield,!0,!1)}}u=0,r[++h]||(h=0)}}else{if(!this._clipboardselection)return;for(var v=0;v<this._clipboardselection.length;v++)for(var w,m=0;m<this._clipboardselection[v].length;m++){if((w=this.getcolumnat(s+m))&&("_checkboxcolumn"!==w.datafield&&!w.hidden)){var x,f=this.getrowboundindex(l+v),b=this.getcell(f,w.datafield),c=null;if(null!=(c=this._clipboardselection[v][m])){if(w.cellsformat&&(-1!=w.cellsformat.indexOf("p")||-1!=w.cellsformat.indexOf("c")||-1!=w.cellsformat.indexOf("n")||-1!=w.cellsformat.indexOf("f"))){-1<c.indexOf(this.gridlocalization.currencysymbol)&&(c=c.replace(this.gridlocalization.currencysymbol,"")),-1<(c=(c=function(e,t,l){var i=e;if(t==l)return e;for(var s=i.indexOf(t);-1!=s;)s=(i=i.replace(t,l)).indexOf(t);return i}(c,this.gridlocalization.thousandsseparator,"")).replace(this.gridlocalization.decimalseparator,".")).indexOf(this.gridlocalization.percentsymbol)&&(c=c.replace(this.gridlocalization.percentsymbol,""));for(var _,p="",g=0;g<c.length;g++){"-"===(_=c.substring(g,g+1))&&(p+="-"),"."===_&&(p+="."),null!=_.match(/^[0-9]+$/)&&(p+=_)}c=(c=p).replace(/ /g,""),c=new Number(c),isNaN(c)&&(c="")}this._raiseEvent(17,{rowindex:f,datafield:b.datafield,value:c}),this.setcellvalue(f,w.displayfield,c,!1),w.displayfield!=w.datafield&&this.logicalclipboardselection&&null!=(x=this.logicalclipboardselection[v][w.datafield])&&this.setcellvalue(f,w.datafield,x,!1),this._raiseEvent(18,{rowindex:f,datafield:b.datafield,oldvalue:this.getcellvalue(b.rowindex,b.datafield),value:c}),this._applycellselection(f,b.datafield,!0,!1)}}}}"checkbox"==this.selectionmode&&this._updatecheckboxselection(),this.dataview.updateview(),this._renderrows(this.virtualsizeinfo)}this.clipboardend&&this.clipboardend("paste")},_applyrowselection:function(e,t,l,i,s){if(null==e)return!1;var o,r=this.selectedrowindex;"singlerow"==this.selectionmode&&(t?this._raiseEvent(2,{rowindex:e,row:this.getrowdata(e)}):this._raiseEvent(3,{rowindex:e,row:this.getrowdata(e)}),this._raiseEvent(3,{rowindex:r}),this.selectedrowindexes=new Array,this.selectedcells=new Array),1==i&&(this.selectedrowindexes=new Array),0<this.dataview.filters.length&&((o=this.getrowdata(e))&&void 0!==o.dataindex?e=o.dataindex:o&&void 0===o.dataindex&&null!=o.uid&&(e=this.getrowboundindexbyid(o.uid)));var a,n=this.selectedrowindexes.indexOf(e);return t?(this.selectedrowindex=e,-1==n?(this.selectedrowindexes.push(e),"singlerow"!=this.selectionmode&&this._raiseEvent(2,{rowindex:e,row:this.getrowdata(e)})):"multiplerows"==this.selectionmode&&(this.selectedrowindexes.splice(n,1),this._raiseEvent(3,{rowindex:this.selectedrowindex,row:this.getrowdata(e)}),this.selectedrowindex=0<this.selectedrowindexes.length?this.selectedrowindexes[this.selectedrowindexes.length-1]:-1)):(0<=n||"singlerow"==this.selectionmode||"multiplerowsextended"==this.selectionmode||"multiplerowsadvanced"==this.selectionmode)&&(a=this.selectedrowindexes[n],this.selectedrowindexes.splice(n,1),this._raiseEvent(3,{rowindex:a,row:this.getrowdata(e)}),this.selectedrowindex=-1),null!=l&&!l||this._rendervisualrows(),!0},_applycellselection:function(e,t,l,i){if(null==e)return!1;if(null==t)return!1;var s;this.selectedrowindex;"singlecell"==this.selectionmode&&(null!=(s=this.selectedcell)&&this._raiseEvent(16,{rowindex:s.rowindex,datafield:s.datafield}),this.selectedcells=new Array),"multiplecellsextended"!=this.selectionmode&&"multiplecellsadvanced"!=this.selectionmode||null!=(s=this.selectedcell)&&this._raiseEvent(16,{rowindex:s.rowindex,datafield:s.datafield});var o,r=e+"_"+t;0<this.dataview.filters.length&&((o=this.getrowdata(e))&&void 0!==o.dataindex?r=(e=o.dataindex)+"_"+t:o&&void 0===o.dataindex&&o.uid&&(r=(e=this.getrowboundindexbyid(o.uid))+"_"+t));var a={rowindex:e,datafield:t};return l?(this.selectedcell=a,this.selectedcells[r]?"multiplecells"!=this.selectionmode&&"multiplecellsextended"!=this.selectionmode&&"multiplecellsadvanced"!=this.selectionmode||(delete this.selectedcells[r],0<this.selectedcells.length&&this.selectedcells.length--,this._raiseEvent(16,a)):(this.selectedcells[r]=a,this.selectedcells.length++,this._raiseEvent(15,a))):(delete this.selectedcells[r],0<this.selectedcells.length&&this.selectedcells.length--,this._raiseEvent(16,a)),null!=i&&!i||this._rendervisualrows(),!0},_getcellindex:function(e){var t=-1;return L.each(this.selectedcells,function(){if(t++,this[e])return!1}),t},_clearhoverstyle:function(){if(null!=this.hoveredrow&&-1!=this.hoveredrow&&!this.vScrollInstance.isScrolling()&&!this.hScrollInstance.isScrolling()){var e=this.table.find(".jqx-grid-cell-hover");0<e.length&&(e.removeClass(this.toTP("jqx-grid-cell-hover")),e.removeClass(this.toTP("jqx-fill-state-hover")));for(var t=0;t<e.length;t++){var l,i=e[t].getAttribute("columnindex");!i||(l=this.columns.records[parseInt(i)])&&l._applyCellStyle(e[t])}this.hoveredrow=-1}},_clearselectstyle:function(){for(var e=this.table[0].rows.length,t=this.table[0].rows,l=this.toTP("jqx-grid-cell-selected"),i=this.toTP("jqx-fill-state-pressed"),s=this.toTP("jqx-grid-cell-hover"),o=this.toTP("jqx-fill-state-hover"),r=0;r<e;r++)for(var a=t[r],n=a.cells.length,c=a.cells,d=0;d<n;d++){var h=c[d],u=L(h);-1!=h.className.indexOf("jqx-grid-cell-selected")&&(u.removeClass(l),u.removeClass(i)),-1!=h.className.indexOf("jqx-grid-cell-hover")&&(u.removeClass(s),u.removeClass(o));var f,p=h.getAttribute("columnindex");!p||(f=this.columns.records[parseInt(p)])&&f._applyCellStyle(h)}},_selectpath:function(e,t){var l=this._lastClickedCell?Math.min(this._lastClickedCell.row,e):0,i=this._lastClickedCell?Math.max(this._lastClickedCell.row,e):0;if(l<=i){var s=this._getcolumnindex(this._lastClickedCell.column),o=this._getcolumnindex(t),r=Math.min(s,o),a=Math.max(s,o);this.selectedcells=new Array;for(var n=this.dataview.loadedrecords,c=l;c<=i;c++)for(var d=r;d<=a;d++){e=n[c];this._applycellselection(this.getboundindex(e),this._getcolumnat(d).datafield,!0,!1)}this._rendervisualrows()}},_selectrowpath:function(e){if("multiplerowsextended"==this.selectionmode){var t=this._lastClickedCell?Math.min(this._lastClickedCell.row,e):0,l=this._lastClickedCell?Math.max(this._lastClickedCell.row,e):0,i=this.dataview.loadedrecords;if(t<=l){this.selectedrowindexes=new Array;for(var s=t;s<=l;s++){var e=i[s],o=this.getrowboundindex(s);this._applyrowselection(o,!0,!1)}this._rendervisualrows()}}},_selectrowwithmouse:function(e,t,l,i,s,o){if(null!=(w=t.row)){var r=t.index;if(null!=this.hittestinfo[r]){for(var a=0;a<this.columns.records.length;a++){var n=this.columns.records[a];n.selected=!1,n.element&&n.element.removeAttribute("selected"),n._applyStyle()}var c=this.hittestinfo[r].visualrow;if(!this.hittestinfo[r].details){c.cells[0].className;if(!w.group){if("multiplerows"==this.selectionmode||"multiplecells"==this.selectionmode||"checkbox"==this.selectionmode||-1!=this.selectionmode.indexOf("multiple")&&(1==o||1==s)){var d,h=this.getboundindex(w);0<this.dataview.filters.length&&((d=this.getrowdata(h))&&null==(h=d.dataindex)&&(h=this.getboundindex(w)));var u,f=-1!=l.indexOf(h),p=this.getboundindex(w)+"_"+i;if(-1!=this.selectionmode.indexOf("cell")){var g,v=null!=this.selectedcells[p];null!=this.selectedcells[p]&&v?this._selectcellwithstyle(e,!1,r,i,c):this._selectcellwithstyle(e,!0,r,i,c),!o||null!=this._lastClickedCell||(g=this.getselectedcells())&&0<g.length&&(this._lastClickedCell={row:g[0].rowindex,column:g[0].datafield}),o&&this._lastClickedCell&&(this._selectpath(w.visibleindex,i),this.mousecaptured=!1,"visible"==this.selectionarea.css("visibility")&&this.selectionarea.css("visibility","hidden"))}else{if(f?s?this._applyrowselection(this.getboundindex(w),!1):this._selectrowwithstyle(e,c,!1,i):this._selectrowwithstyle(e,c,!0,i),!o||null!=this._lastClickedCell||(u=this.getselectedrowindexes())&&0<u.length&&(this._lastClickedCell={row:u[0],column:i}),o&&this._lastClickedCell){this.selectedrowindexes=new Array;for(var w,m=this._lastClickedCell?Math.min(this._lastClickedCell.row,w.visibleindex):0,x=this._lastClickedCell?Math.max(this._lastClickedCell.row,w.visibleindex):0,b=this.dataview.loadedrecords,_=m;_<=x;_++){(w=b[_])&&this._applyrowselection(this.getboundindex(w),!0,!1,!1)}this._rendervisualrows()}}}else this._clearselectstyle(),this._selectrowwithstyle(e,c,!0,i),-1!=this.selectionmode.indexOf("cell")&&this._selectcellwithstyle(e,!0,r,i,c);o||(this._lastClickedCell={row:w.visibleindex,column:i})}}}}},_selectcellwithstyle:function(e,t,l,i,s){var o=L(s.cells[e._getcolumnindex(i)]);o.removeClass(this.toTP("jqx-grid-cell-hover")),o.removeClass(this.toTP("jqx-fill-state-hover")),t?(o.addClass(this.toTP("jqx-grid-cell-selected")),o.addClass(this.toTP("jqx-fill-state-pressed"))):(o.removeClass(this.toTP("jqx-grid-cell-selected")),o.removeClass(this.toTP("jqx-fill-state-pressed"))),this.getcolumn(i)._applyCellStyle(o)},_selectrowwithstyle:function(e,t,l,i){var s=t.cells.length,o=0;e.rowdetails&&e.showrowdetailscolumn?this.rtl?(--s,s-=this.groups.length):o=1+this.groups.length:this.groupable&&(this.rtl?s-=this.groups.length:o=this.groups.length);for(var r=o;r<s;r++){var a,n=t.cells[r];l?(L(n).removeClass(this.toTP("jqx-grid-cell-hover")),L(n).removeClass(this.toTP("jqx-fill-state-hover")),-1==e.selectionmode.indexOf("cell")&&(L(n).addClass(this.toTP("jqx-grid-cell-selected")),L(n).addClass(this.toTP("jqx-fill-state-pressed")))):(L(n).removeClass(this.toTP("jqx-grid-cell-hover")),L(n).removeClass(this.toTP("jqx-grid-cell-selected")),L(n).removeClass(this.toTP("jqx-fill-state-hover")),L(n).removeClass(this.toTP("jqx-fill-state-pressed"))),!(i=n.getAttribute("columnindex"))||(a=this.columns.records[parseInt(i)])&&a._applyCellStyle(n)}},_handlemousemoveselection:function(e,l){if(l.hScrollInstance.isScrolling()||l.vScrollInstance.isScrolling())return!1;if(("multiplerowsextended"==l.selectionmode||"multiplecellsextended"==l.selectionmode||"multiplecellsadvanced"==l.selectionmode)&&l.mousecaptured){if(l.multipleselectionbegins)if(!1===l.multipleselectionbegins(e))return!0;var t=this.showheader?this.columnsheader.height()+2:0,i=this._groupsheader()?this.groupsheader.height():0;i+=this.showtoolbar?this.toolbar.height():0;var s,o=this.host.coord();this.hasTransform&&(o=L.jqx.utilities.getOffset(this.host),s=this._getBodyOffset(),o.left-=s.left,o.top-=s.top),"0px"===this.host.css("border-top-width")&&(i-=2);var r=e.pageX,a=e.pageY-i;if(3<Math.abs(this.mousecaptureposition.left-r)||3<Math.abs(this.mousecaptureposition.top-a)){parseInt(this.columnsheader.coord().top);this.hasTransform&&L.jqx.utilities.getOffset(this.columnsheader).top,r<o.left&&(r=o.left),r>o.left+this.host.width()&&(r=o.left+this.host.width());var n=o.top+t;a<n&&(a=n+5);var c=parseInt(Math.min(l.mousecaptureposition.left,r)),d=-5+parseInt(Math.min(l.mousecaptureposition.top,a)),h=parseFloat(Math.abs(l.mousecaptureposition.left-r)),u=parseInt(Math.abs(l.mousecaptureposition.top-a));if(c-=o.left,d-=o.top,this.selectionarea.css("visibility","visible"),"multiplecellsadvanced"==l.selectionmode){var f=(r=c)+h,p=l.hScrollInstance,g=p.value;this.rtl&&("hidden"!=this.hScrollBar.css("visibility")&&(g=p.max-p.value),this.vScrollBar[0].style.visibility);var v=l.table[0].rows[0],w=0,m=S=l.mousecaptureposition.clickedcell,x=!1,b=0,_=v.cells.length;l.mousecaptureposition.left<=e.pageX&&(b=S);for(var y=!1,k=b;k<_;k++){var C=parseFloat(L(this.columnsrow[0].cells[k]).css("left")),q=C-g;if(!l.columns.records[k].pinned||l.columns.records[k].hidden){if(y){x=!0,m--;break}var j=this._getcolumnat(k);if(!(null!=j&&j.hidden||l.groupable&&0<l.groups.length&&k<l.groups.length)){O=q+L(this.columnsrow[0].cells[k]).width();if(l.mousecaptureposition.left>e.pageX){if(r<=O&&q<=r){m=k,x=!0;break}}else if(f<=O&&q<=f){m=k,x=!0;break}}}else{k==S&&(y=!0);var O=C+L(this.columnsrow[0].cells[k]).width();if(l.mousecaptureposition.left>e.pageX){if(r<=O&&q<=r){m=k,x=!0;break}}else if(f<=O&&q<=f){m=k,x=!0;break}}}x||(l.mousecaptureposition.left>e.pageX?L.each(this.columns.records,function(e,t){return!!(l.groupable&&0<l.groups.length&&e<l.groups.length)||(this.pinned||this.hidden?void 0:(m=e,!1))}):(!l.groupable||l.groupable&&0<!l.groups.length)&&(m=v.cells.length-1));var T=S,S=Math.min(S,m),m=Math.max(T,m);d+=5,d+=i;l.table[0].rows.indexOf(l.mousecaptureposition.clickedrow);for(var A=0,E=-1,I=-1,P=0,k=0;k<l.table[0].rows.length;k++){var z=L(l.table[0].rows[k]);0==k&&(P=z.coord().top);var M=z.height(),K=P-o.top;if(-1==E&&d<=K+M){for(var N=!1,B=0;B<l.groups.length;B++){if(-1!=(F=z[0].cells[B].className).indexOf("jqx-grid-group-collapse")||-1!=F.indexOf("jqx-grid-group-expand")){N=!0;break}}if(N)continue;E=k}if(P+=M,l.groupable&&0<l.groups.length){for(var F,N=!1,B=0;B<l.groups.length;B++){if(-1!=(F=z[0].cells[B].className).indexOf("jqx-grid-group-collapse")||-1!=F.indexOf("jqx-grid-group-expand")){N=!0;break}}if(N)continue;for(var w=0,X=l.groups.length;X<z[0].cells.length;X++){var D=z[0].cells[X];""==L(D).html()&&w++}if(w==z[0].cells.length-l.groups.length)continue}if(-1!=E&&(A+=M),d+u<K+M){I=k;break}}if(-1!=E){d=L(l.table[0].rows[E]).coord().top-o.top-i-2;var Y=0;this.filterable&&this.showfilterrow&&(Y=this.filterrowheight),parseFloat(l.table[0].style.top)<0&&d<this.rowsheight+Y&&(d-=parseFloat(l.table[0].style.top),A+=parseFloat(l.table[0].style.top)),u=A;var $=L(this.columnsrow[0].cells[S]),G=L(this.columnsrow[0].cells[m]),c=parseFloat($.css("left")),h=parseFloat(G.css("left"))-parseFloat(c)+G.width()-2;if(c-=g,y&&(c+=g),l.editcell&&l.editable&&l.endcelledit&&(S!=m||E!=I)){if(0==l.editcell.validated)return;l.endcelledit(l.editcell.row,l.editcell.column,!0,!0)}}}this.selectionarea.width(h),this.selectionarea.height(u),this.selectionarea.css("left",c),this.selectionarea.css("top",d)}}},_handlemouseupselection:function(t,l){if(this.selectionarea){if("visible"!=this.selectionarea[0].style.visibility)return!(l.mousecaptured=!1);if(l.mousecaptured&&("multiplerowsextended"==l.selectionmode||"multiplerowsadvanced"==l.selectionmode||"multiplecellsextended"==l.selectionmode||"multiplecellsadvanced"==l.selectionmode)&&(l.mousecaptured=!1,"visible"==this.selectionarea.css("visibility"))){this.selectionarea.css("visibility","hidden");var e=this.showheader?this.columnsheader.height()+2:0,i=this._groupsheader()?this.groupsheader.height():0;"0px"===this.host.css("border-top-width")&&(i-=2),i+=this.showtoolbar?this.toolbar.height():0;var s=this.selectionarea.coord(),o=this.host.coord();this.hasTransform&&(o=L.jqx.utilities.getOffset(this.host),s=L.jqx.utilities.getOffset(this.selectionarea)),"0px"===this.host.css("border-top-width")&&(i-=2);var r=s.left-o.left,a=s.top-e-o.top-i,n=a,c=r+this.selectionarea.width(),d=r,h=new Array,u=new Array;if("multiplerowsextended"==l.selectionmode){for(;a<n+this.selectionarea.height();){var f=(m=this._hittestrow(r,a)).row;-1!=(b=m.index)&&(u[b]||(u[b]=!0,h[h.length]=m)),a+=20}n=0;L.each(h,function(){var e=this.row;"none"!=l.selectionmode&&l._selectrowwithmouse&&(!t.ctrlKey&&!t.metaKey&&0==n?l._applyrowselection(l.getboundindex(e),!0,!1,!0):l._applyrowselection(l.getboundindex(e),!0,!1,!1),n++)})}else{"multiplecellsadvanced"==l.selectionmode&&(a+=2);var p=l.hScrollInstance,g=p.value;this.rtl&&("hidden"!=this.hScrollBar.css("visibility")&&(g=p.max-p.value),"hidden"!=this.vScrollBar[0].style.visibility&&(g-=this.scrollbarsize+4));var v=l.table[0].rows[0],w=l.selectionarea.height();!t.ctrlKey&&!t.metaKey&&0<w&&(l.selectedcells=new Array);for(var m,x=w;a<n+x;){if(m=l._hittestrow(r,a)){var b,f=m.row;if(-1!=(b=m.index)&&!u[b]){u[b]=!0;for(var _=0;_<v.cells.length;_++){var y=parseFloat(L(l.columnsrow[0].cells[_]).css("left"))-g,k=y+L(l.columnsrow[0].cells[_]).width();(y<=d&&d<=k||y<=c&&c<=k||d<=y&&y<=c)&&l._applycellselection(l.getboundindex(f),l._getcolumnat(_).datafield,!0,!1)}}a+=5}else a+=5}}l.autosavestate&&l.savestate&&l.savestate(),l._renderrows(l.virtualsizeinfo)}}},selectprevcell:function(e,t){var l=this._getcolumnindex(t),i=(this.columns.records.length,this._getprevvisiblecolumn(l));null!=i&&(this.clearselection(),this.selectcell(e,i.datafield))},selectnextcell:function(e,t){var l=this._getcolumnindex(t),i=(this.columns.records.length,this._getnextvisiblecolumn(l));null!=i&&(this.clearselection(),this.selectcell(e,i.datafield))},_getfirstvisiblecolumn:function(){for(var e=this.columns.records.length,t=0;t<e;t++){var l=this.columns.records[t];if(!l.hidden&&null!=l.datafield)return l}return null},_getlastvisiblecolumn:function(){for(var e=this.columns.records.length-1;0<=e;e--){var t=this.columns.records[e];if(!t.hidden&&null!=t.datafield)return t}return null},_handlekeydown:function(f,p){if(p.groupable&&p.groups.length,p.disabled)return!1;var l=f.charCode?f.charCode:f.keyCode?f.keyCode:0;if(p.editcell&&"multiplecellsadvanced"!=p.selectionmode)return!0;if(p.editcell&&"multiplecellsadvanced"==p.selectionmode){if(!(33<=l&&l<=40))return!0;if(f.altKey)return!(p._cancelkeydown=!1);if(null!=p._cancelkeydown&&0!=p._cancelkeydown)return!(p._cancelkeydown=!1);if("selectedrow"===p.editmode)return!0;if(p.endcelledit(p.editcell.row,p.editcell.column,!1,!0),p._cancelkeydown=!1,p.editcell&&!p.editcell.validated)return p._rendervisualrows(),p.endcelledit(p.editcell.row,p.editcell.column,!1,!0),!1}if("none"==p.selectionmode)return!0;if(p.showfilterrow&&p.filterable&&this.filterrow&&L(f.target).ischildof(p.filterrow))return!0;if(p.showeverpresentrow){if(p.addnewrowtop&&L(f.target).ischildof(p.addnewrowtop))return!0;if(p.addnewrowbottom&&L(f.target).ischildof(p.addnewrowbottom))return!0}if(f.target.className&&0<=f.target.className.indexOf("jqx-grid-widget"))return!0;if(p.pageable&&L(f.target).ischildof(this.pager))return!0;if(this.showtoolbar&&L(f.target).ischildof(this.toolbar))return!0;if(this.showstatusbar&&L(f.target).ischildof(this.statusbar))return!0;var g=!1;if(f.altKey)return!0;if((f.ctrlKey||f.metaKey)&&this.clipboard){var e=String.fromCharCode(l).toLowerCase();if(this.clipboardbegin){var t=null;if("c"==e?t=this.clipboardbegin("copy",this.copyselection()):"x"==e?t=this.clipboardbegin("cut",this.copyselection()):"v"==e&&(t=this.clipboardbegin("paste")),!1===t)return!1}if("c"==e||"x"==e){var i,s=this.copyselection();if("c"==e&&this.clipboardend&&this.clipboardend("copy"),"x"==e&&this.clipboardend&&this.clipboardend("cut"),window.clipboardData?window.clipboardData.setData("Text",s):((i=L('<textarea style="position: absolute; left: -1000px; top: -1000px;"/>')).val(s),L("body").append(i),i.select(),setTimeout(function(){document.designMode="off",i.select(),i.remove(),p.focus()},100)),"c"==e&&L.jqx.browser.msie)return!1;if("c"==e)return!0}else if("v"==e){var o=L('<textarea style="position: absolute; left: -1000px; top: -1000px;"/>');L("body").append(o),o.select();var r=this;return setTimeout(function(){r._clipboardselection=new Array;var e=o.val();0==e.length&&window.clipboardData&&(o.val(window.clipboardData.getData("Text")),e=o.val());for(var t=e.split("\n"),l=0;l<t.length;l++)if(0<t[l].split("\t").length){var i=t[l].split("\t");if(1==i.length&&l==t.length-1&&""==i[0])continue;0<i.length&&r._clipboardselection.push(i)}r.pasteselection(),o.remove(),r.focus()},100),!0}if("x"==e)return this.deleteselection(),this.host.focus(),!1}var a=Math.round(p._gettableheight()),n=Math.round(a/p.rowsheight),c=p.getdatainformation();switch(p.selectionmode){case"singlecell":case"multiplecells":case"multiplecellsextended":case"multiplecellsadvanced":var d=p.getselectedcell();if(null===d&&p.selectcell(0,p.columns.records[0].displayfield),null!=d){function h(e,t,h,u){function l(e,t){var l,i=p.dataview.loadedrecords[e];if(p.groupable&&0<p.groups.length){var s=e;"up"==u&&s++,"down"==u&&s--;for(var i=p.getdisplayrows()[s],o=1,r=!0;r&&o<300&&(r=!1,"down"==u?i=p.getdisplayrows()[s+o]:"up"==u&&(i=p.getdisplayrows()[s-o]),i);){i&&i.group&&(r=!0),i&&i.totalsrow&&(r=!0);for(var a=i.parentItem;a;)!a||(l=a).group&&p.expandedgroups[l.uniqueid]&&p.expandedgroups[l.uniqueid].expanded||(r=!0),a=a.parentItem;if(!r)break;o++}if(300==o&&(i=null),p.pageable){var n=!1;if(i){for(var c=0;c<p.dataview.rows.length;c++)p.dataview.rows[c].boundindex==i.boundindex&&(n=!0);n||(i=null)}}}else if(p.pageable){n=!1;if(i){for(c=0;c<p.dataview.rows.length;c++)p.dataview.rows[c].boundindex==i.boundindex&&(n=!0);n||(p.pagerpageinput&&9===f.keyCode&&i.boundindex>p.dataview.rows[p.dataview.rows.length-1].boundindex&&(p.pagerpageinput.focus(),f.preventDefault()),p.ensurerowvisible(i))}}if(null!=i&&null!=t&&!i.totalsrow){!h&&null!=h||p.clearselection();var d=p.getboundindex(i);return p.selectcell(d,t),p._oldselectedcell=p.selectedcell,g=!0,p.groupable?p.ensurecellvisible(d,t):p.ensurecellvisible(e,t),1}}if(l(e,t)||p.groupable||(p.ensurecellvisible(e,t),l(e,t),p.virtualmode&&p.host.focus()),!(p.groupable&&0<p.groups.length))if(f.shiftKey&&9!=f.keyCode){if(("multiplecellsextended"==p.selectionmode||"multiplecellsadvanced"==p.selectionmode)&&p._lastClickedCell){p._selectpath(e,t);var i=p.dataview.loadedrecords[e],s=p.getboundindex(i);return void(p.selectedcell={rowindex:s,datafield:t})}}else f.shiftKey||(p._lastClickedCell={row:e,column:t})}var u,v,w,m,x,b,_=this.getrowvisibleindex(d.rowindex),y=d.datafield,k=p._getcolumnindex(y),C=(p.columns.records.length,f.shiftKey&&"singlecell"!=p.selectionmode&&"multiplecells"!=p.selectionmode),q=function(){var e;p.pageable?(e=p.dataview.pagenum*p.dataview.pagesize,h(e,y,!C)):h(0,y,!C)},j=function(){var e=c.rowscount-1;p.pageable&&(e=p.dataview.pagenum*p.dataview.pagesize+p.dataview.rows.length-1),h(e,y,!C)},O=9==l&&!f.shiftKey,T=9==l&&f.shiftKey;if(p.rtl&&(u=O,O=T,T=u),(O||T)&&(C=!1),(O||T)&&document.activeElement&&document.activeElement.className&&0<=document.activeElement.className.indexOf("jqx-grid-cell-add-new-row"))return!0;(E=f.ctrlKey||f.metaKey)&&37==l?null!=(x=p._getfirstvisiblecolumn(k))&&h(_,x.datafield):E&&39==l?null!=(v=p._getlastvisiblecolumn(k))&&h(_,v.datafield):39==l||O?null!=(w=p._getnextvisiblecolumn(k))?h(_,w.datafield,!C):O?(m=p._getfirstvisiblecolumn(),l=40,y=m.displayfield):g=!0:37==l||T?null!=(x=p._getprevvisiblecolumn(k))?h(_,x.datafield,!C):T?(b=p._getlastvisiblecolumn(),l=38,y=b.displayfield):g=!0:36==l?q():35==l?j():33==l?0<=_-n?(h(A=_-n,y,!C),p.pageable&&p.virtualmode&&(p.gotoprevpage(),setTimeout(function(){h(A,y,!C)},25))):q():34==l&&(c.rowscount>_+n?(h(A=_+n,y,!C),p.pageable&&p.virtualmode&&(p.gotonextpage(),setTimeout(function(){h(A,y,!C)},25))):j()),38==l&&(E?q():0<_?h(_-1,y,!C,"up"):g=!1),40==l&&(E?j():c.rowscount>_+1||p.groupable&&0<p.groups.length?h(_+1,y,!C,"down"):g=!0)}break;case"singlerow":case"multiplerows":case"multiplerowsextended":case"multiplerowsadvanced":if(null==(_=p.getselectedrowindex())||-1==_)return!0;_=this.getrowvisibleindex(_);function S(e,d,h){function t(e){var t,l=p.dataview.loadedrecords[e];if(p.groupable&&0<p.groups.length){"up"==h&&e++,"down"==h&&e--;for(var l=p.getdisplayrows()[e],i=1,s=!0;s&&i<300&&(s=!1,"down"==h?l=p.getdisplayrows()[e+i]:"up"==h&&(l=p.getdisplayrows()[e-i]),l);){l&&l.group&&(s=!0),l&&l.totalsrow&&(s=!0);for(var o=l.parentItem;o;)!o||(t=o).group&&p.expandedgroups[t.uniqueid]&&p.expandedgroups[t.uniqueid].expanded||(s=!0),o=o.parentItem;if(!s)break;i++}if(300==i&&(l=null),p.pageable){var r=!1;if(l){for(var a=0;a<p.dataview.rows.length;a++)p.dataview.rows[a].boundindex==l.boundindex&&(r=!0);r||(l=null)}}}if(null!=l){var n=p.getboundindex(l),c=p.selectedrowindex;return!d&&null!=d||p.clearselection(),p.selectedrowindex=c,p.selectrow(n,!1),(p.groupable?p.ensurerowvisible(n):p.ensurerowvisible(e))&&!p.autoheight&&!p.groupable||p._rendervisualrows(),g=!0}}if(t(e)||p.groupable||(p.ensurerowvisible(e),t(e),p.virtualmode&&setTimeout(function(){t(e)},25),p.virtualmode&&p.host.focus()),!(p.groupable&&0<p.groups.length))if(f.shiftKey&&9!=l){if("multiplerowsextended"==p.selectionmode&&p._lastClickedCell)return p._selectrowpath(e),void(p.selectedrowindex=p.getrowboundindex(e))}else f.shiftKey||(p._lastClickedCell={row:e},p.selectedrowindex=p.getrowboundindex(e))}var A,C=f.shiftKey&&"singlerow"!=p.selectionmode&&"multiplerows"!=p.selectionmode,q=function(){var e;p.pageable?(e=p.dataview.pagenum*p.dataview.pagesize,S(e,!C)):S(0,!C)},j=function(){var e=c.rowscount-1;p.pageable&&(e=p.dataview.pagenum*p.dataview.pagesize+p.dataview.rows.length-1),S(e,!C)},E=f.ctrlKey||f.metaKey;36==l||E&&38==l?q():35==l||E&&40==l?j():33==l?0<=_-n?(S(A=_-n,!C,"up"),p.pageable&&p.virtualmode&&(p.gotoprevpage(),setTimeout(function(){S(A,!C)},25))):q():34==l?c.rowscount>_+n?(S(A=_+n,!C,"down"),p.pageable&&p.virtualmode&&(p.gotonextpage(),setTimeout(function(){S(A,!C)},25))):j():38==l?0<_?S(_-1,!C,"up"):g=!0:40==l&&(c.rowscount>_+1||p.groupable&&0<p.groups.length?S(_+1,!C,"down"):g=!0)}return!g||(p.autosavestate&&p.savestate&&p.savestate(),!1)},_handlemousemove:function(e,t){var l,i,s,o,r,a;if(!t.vScrollInstance.isScrolling()&&(!t.hScrollInstance.isScrolling()&&(!t.enablehover&&"multiplerows"!=t.selectionmode||(r=this.showheader?this.columnsheader.height()+2:0,a=this._groupsheader()?this.groupsheader.height():0,a+=this.showtoolbar?this.toolbarheight:0,l=this.host.coord(),this.hasTransform&&(l=L.jqx.utilities.getOffset(this.host),o=this._getBodyOffset(),l.left-=o.left,l.top-=o.top),i=e.pageX-l.left,s=e.pageY-r-l.top-a),"multiplerowsextended"!=t.selectionmode&&"multiplecellsextended"!=t.selectionmode&&"multiplecellsadvanced"!=t.selectionmode||1!=t.mousecaptured))){if(!t.enablehover)return!0;if(!t.disabled&&!this.vScrollInstance.isScrolling()&&!this.hScrollInstance.isScrolling()){var n=this._hittestrow(i,s);if(n){var c=n.row,d=n.index;if((-1==this.hoveredrow||-1==d||this.hoveredrow!=d||-1!=this.selectionmode.indexOf("cell")||"checkbox"==this.selectionmode)&&(this._clearhoverstyle(),-1!=d&&null!=c)){var h=this.hittestinfo[d].visualrow;if(null!=h&&!(this.hittestinfo[d].details||e.clientX>L(h).width()+L(h).coord().left)){var u=0,f=h.cells.length;if(t.rowdetails&&t.showrowdetailscolumn?this.rtl?(--f,f-=this.groups.length):u=1+this.groups.length:this.groupable&&(this.rtl?f-=this.groups.length:u=this.groups.length),0!=h.cells.length){var p=h.cells[u].className;if(!(c.group||0<=this.selectionmode.indexOf("row")&&-1!=p.indexOf("jqx-grid-cell-selected")))if(this.hoveredrow=d,-1==this.selectionmode.indexOf("cell")&&"checkbox"!=this.selectionmode)for(m=u;m<f;m++){_=h.cells[m];L(_).addClass(this.toTP("jqx-grid-cell-hover")),L(_).addClass(this.toTP("jqx-fill-state-hover")),this.cellhover&&this.cellhover(_,e.pageX,e.pageY),(b=this._getcolumnat(m))._applyCellStyle(_)}else{var g=-1,v=this.hScrollInstance,w=v.value;this.rtl&&"hidden"!=this.hScrollBar.css("visibility")&&(w=v.max-v.value);for(var m=u;m<f;m++){var x=parseInt(L(this.columnsrow[0].cells[m]).css("left"))-w;if(this.columns.records[m].pinned&&!this.rtl&&(x=parseInt(L(this.columnsrow[0].cells[m]).css("left"))),i<=x+L(this.columnsrow[0].cells[m]).width()&&x<=i){g=m;break}}if(-1!=g){var b,_=h.cells[g];if(this.cellhover&&this.cellhover(_,e.pageX,e.pageY),-1==_.className.indexOf("jqx-grid-cell-selected"))if(this.editcell)if((b=this._getcolumnat(g))&&this.editcell.row==d&&this.editcell.column==b.datafield)return;L(_).addClass(this.toTP("jqx-grid-cell-hover")),L(_).addClass(this.toTP("jqx-fill-state-hover")),(b=this._getcolumnat(g))._applyCellStyle(_)}}}}}}}}}})}(jqxBaseFramework);