!function(n,a){"use strict";var e,t;"function"==typeof define&&define.amd?define(["jquery","rx","svg","filesaver","css!idd-css","jquery-ui","jquery-mousewheel"],function(e,t,i,r){var o=a(n,e,t,i,r);return{InteractiveDataDisplay:o.InteractiveDataDisplay,Plot:o.Plot}}):"object"==typeof exports?(e=n.jQuery=require("jquery"),require("jquery-mousewheel")(e),require("jqueryui"),t=require("filesaver.js"),module.exports=a(n,e,require("rx"),require("svg.js"),t.saveAs)):console.error("idd.umd.js cannot be used without RequireJS or CommonJS")}("undefined"!=typeof window?window:this,function($,pe,w,ve,x){function h(e,t,i){for(var r=0,o=e.length;r<o;r++){var n=e[r];if(!(n.plot1!==t&&n.plot1!==i||n.plot2!==t&&n.plot2!==i))return r}return-1}function s(e,t){var i=[];t=t.slice(0);for(var r=[e];0<r.length;){var o=r.shift();o!=e&&i.indexOf(o)<0&&i.push(o);for(var n=t.length;0<=--n;){var a=t[n],s=null;a.plot1===o?s=a.plot2:a.plot2===o&&(s=a.plot1),s&&(r.push(s),t.splice(n,1))}}return i}function g(e,t){for(var i=[],r=0,o=e.length;r<o;r++){var n=e[r];i.indexOf(n.plot1)<0&&i.push(n.plot1),i.indexOf(n.plot2)<0&&i.push(n.plot2)}for(t.splice(0),r=0,o=i.length;r<o;r++){var a=s(i[r],e);t.push({plot:i[r],reachable:a})}}var c,u,f,p;(me=(me={MinSizeToShow:1,Padding:20,maxTickArrangeIterations:5,tickLength:10,minLabelSpace:60,minTickSpace:5,minLogOrder:4,minNumOrder:8,TooltipDelay:1,TooltipDuration:10,CssPrefix:"",ZIndexNavigationLayer:1e3,ZIndexDOMMarkers:1500,ZIndexTooltipLayer:2e3,MaxInteger:9007199254740991,HeatmapworkerPath:void 0,factory:{}})||{}).Utils={logE10neg:1/Math.log(10),log10:void 0!==Math.log10?Math.log10:function(e){return Math.log(e)*me.Utils.logE10neg},applyMask:function(e,t,i){for(var r=e.length,o=new Array(i),n=0,a=0;n<r;n++)0===e[n]&&(o[a++]=t[n]);return o},maskNaN:function(e,t){for(var i=e.length;0<=--i;){var r=t[i];r!=r&&(e[i]=1)}},isArray:function(e){return e instanceof Array||e instanceof Float64Array||e instanceof Float32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array},isOrderedArray:function(e){if(e.length<=1)return!0;if(isNaN(e[1]))return!1;if(isNaN(e[2]))return!1;for(var t=e[1]-e[0],i=2;i<e.length;i++){if(t*(e[i]-e[i-1])<0)return!1}return!0},cutArray:function(e,t){if(null==e)return e;if(e.length>t){for(var i=new Array(t),r=0;r<t;r++)i[r]=e[r];return i}return e},intersect:function(e,t){if(e&&t){var i=Math.max(e.x,t.x),r=Math.min(e.x+e.width,t.x+t.width),o=Math.max(e.y,t.y),n=Math.min(e.y+e.height,t.y+t.height);return i<=r&&o<=n?{x:i,y:o,width:r-i,height:n-o}:void 0}},includes:function(e,t){return!(!e||!t)&&(e.x<=t.x&&e.x+e.width>=t.x+t.width&&e.y<=t.y&&e.y+e.height>=t.y+t.height)},equalRect:function(e,t){return!(!e||!t)&&(e.x==t.x&&e.width==t.width&&e.y==t.y&&e.height==t.height)},calcCSWithPadding:function(e,t,i,r){var o={left:i.left,top:i.top,width:t.width-i.left-i.right,height:t.height-i.top-i.bottom};return new me.CoordinateTransform(e,o,r)},requestAnimationFrame:function(e,t){setTimeout(e,1e3/60,t)},range:function(e,t){var i=t-e+1;if(i<=0)return[];for(var r=new Array(i),o=0;o<i;o++)r[o]=o;return r},arrangeDiv:function(e,t){e.width(t.width),e.height(t.height)},unionRects:function(e,t){if(void 0===e)return void 0===t?void 0:{x:t.x,y:t.y,width:t.width,height:t.height};if(void 0===t)return void 0===e?void 0:{x:e.x,y:e.y,width:e.width,height:e.height};var i=0,r=0,r=isNaN(e.x)&&isNaN(t.x)?i=0:isNaN(e.x)?(i=t.x,t.x+t.width):isNaN(t.x)?(i=e.x,e.x+e.width):(i=Math.min(e.x,t.x),Math.max(e.x+e.width,t.x+t.width)),o=0,n=0,n=isNaN(e.y)&&isNaN(t.y)?o=0:isNaN(e.y)?(o=t.y,t.y+t.height):isNaN(t.y)?(o=e.y,e.y+e.height):(o=Math.min(e.y,t.y),Math.max(e.y+e.height,t.y+t.height));return{x:i,y:o,width:r-i,height:n-o}},readStyle:function(e,t){var i=e.attr("data-idd-style");if(i){for(var r=i.split(";"),o=r.length,n=0;n<o;n++){var a,s,l=r[n].split(":",2);l&&2===l.length&&(a=l[0].trim(),s=l[1].trim(),t[a]=s)}return t}},updateStyle:function(e,t,i,r){(t=(t=me.Utils.readStyle(e,t))||{})[i]=r;var o="";pe.each(t,function(e,t){o+=e+": "+t+"; "}),e.attr("data-idd-style",o)},getDataSourceFunction:function(e,t){var i=e.attr("data-idd-datasource");return"InteractiveDataDisplay.readTable"==i?me.readTable:"InteractiveDataDisplay.readCsv"==i?me.readCsv:"InteractiveDataDisplay.readCsv2d"==i?me.readCsv2d:"InteractiveDataDisplay.readBase64"==i?me.readBase64:i?function(){return JSON.parse(i,function(e,t){return null===t?NaN:t})}:t},makeNonEqual:function(e){return e.min==e.max?0==e.min?{min:-1,max:1}:0<e.min?{min:.9*e.min,max:1.1*e.min}:{min:1.1*e.min,max:.9*e.min}:e},getMinMax:function(e){if(e&&0!==e.length){for(var t,i,r,o=e.length,n=0;n<o;n++)if((r=e[n])==r){t=i=r;break}for(n++;n<o;n++)(r=e[n])==r&&(r<t?t=r:i<r&&(i=r));return{min:t,max:i}}},getMin:function(e){if(e&&0!==e.length){for(var t,i,r=e.length,o=0;o<r;o++)if((i=e[o])==i){t=i;break}for(o++;o<r;o++)(i=e[o])==i&&i<t&&(t=i);return t}},getMax:function(e){if(e&&0!==e.length){for(var t,i,r=e.length,o=0;o<r;o++)if((i=e[o])==i){t=i;break}for(o++;o<r;o++)(i=e[o])==i&&t<i&&(t=i);return t}},getMinMaxForPair:function(e,t){if(e&&0!==e.length){if(!t||e.length!==t.length)throw"Arrays should be equal";for(var i,r,o,n,a,s,l=e.length,d=0;d<l;d++)if(a=e[d],s=t[d],!isNaN(a)&&!isNaN(s)){i=r=a,o=n=s;break}for(d++;d<l;d++)a=e[d],s=t[d],isNaN(a)||isNaN(s)||(a<i?i=a:r<a&&(r=a),s<o?o=s:n<s&&(n=s));return{minx:i,maxx:r,miny:o,maxy:n}}},enumPlots:function(e){var t=[],i=function(e,t){t.push(e),e.children&&e.children.forEach(function(e){i(e,t)})};return i(e,t),t.sort(function(e,t){return t.order-e.order}),t},reorder:function(e,t,i){e.order=i?t.order:t.order+1;var r=function(e,t){e.order>=t.order&&e!=t&&e.order<me.MaxInteger&&(e.order+=1),e.children&&e.children.forEach(function(e){r(e,t)})};r(e.master,e)},getMaxOrder:function(e){var i=e&&e.order!=me.MaxInteger?e.order:0;return e&&e.children&&e.children.forEach(function(e){var t=me.Utils.getMaxOrder(e);t!=me.MaxInteger&&(i=Math.max(i,t))}),i},getBoundingBoxForArrays:function(e,t,i,r){var o,n,a,s=void 0;return e&&t&&((o=me.Utils.getMinMaxForPair(e,t))&&(i&&(o.minx=i(o.minx),o.maxx=i(o.maxx)),r&&(o.miny=r(o.miny),o.maxy=r(o.maxy)),n=Math.min(o.minx,o.maxx),a=Math.abs(o.maxx-o.minx),s={x:n,y:Math.min(o.miny,o.maxy),width:a,height:Math.abs(o.maxy-o.miny)})),s},getIEVersion:function(){var e=$.navigator.userAgent,t=e.indexOf("MSIE");return 0<t?parseInt(e.substring(t+5,e.indexOf(".",t))):navigator.userAgent.match(/Trident\/7\./)?11:0},lastUsedIntId:0,generateNextIntId:function(){return this.lastUsedIntId++},resetLastUsedIntId:function(){return this.lastUsedIntId=0,this.lastUsedIntId},base64toByteArray:function(e){for(var t=atob(e),i=new Array(t.length),r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return new Uint8Array(i)},byteArrayToTypedArray:function(e,t){var i,r=e.buffer;switch(t){case"uint8":return e;case"float32":i=new Float32Array(r);break;case"float64":i=new Float64Array(r);break;case"int16":i=new Int16Array(r);break;case"int32":i=new Int32Array(r);break;default:throw"Unexpected array type: "+t}return i},getArrayToSetLineDash:function(e,t){var i=t?t:1;switch(i=(i=parseInt(i))||1,e){case"dot":e=[i,2*i];break;case"dash":e=[3*i,2*i];break;case"dash dot":e=[3*i,2*i,i,2*i];break;case"long dash":e=[8*i,2*i];break;case"long dash dot":e=[8*i,2*i,i,2*i];break;case"long dash dot dot":e=[8*i,2*i,i,2*i,i,2*i]}for(var r=[],o=0;o<e.length;o+=2)"number"==typeof e[o]&&"number"==typeof e[o+1]&&(r.push(e[o]),r.push(e[o+1]));return r}},(me=me||{}).Binding=me.Binding||{},c=[],u=[],f=[],p=[],me.Binding.bindPlots=function(t,i,e){if(null==e||"vh"==e){var r=me.Binding.bindPlots(t,i,"v"),o=me.Binding.bindPlots(t,i,"h"),n=!1;return{destroy:function(){n||(r.destroy(),o.destroy(),n=!0)}}}if("v"!=e&&"h"!=e)throw"Parameter filter is incorrect";if(!t)throw"plot1 is incorrect";if(!i)throw"plot2 is incorrect";if(t=t.master,i=i.master,t===i)throw"plot1 equals plot2";var a="v"==e?u:c,s=h(a,t,i);if(0<=s)return a[s].binding;var l="v"==e?p:f,n=!1,d={plot1:t,plot2:i,binding:{destroy:function(){var e;n||((e=h(a,t,i))&&a.splice(e,1),g(a,l),n=!0)}}};return a.push(d),g(a,l),t.requestUpdateLayout(),d.binding},me.Binding.getBoundPlots=function(e){for(var t={h:[],v:[]},i=0,r=f.length;i<r;i++)if(f[i].plot===e){t.h=f[i].reachable;break}for(i=0,r=p.length;i<r;i++)if(p[i].plot===e){t.v=p[i].reachable;break}return t},me.AdaptiveFormatter=function(e,t){function h(e){if(0<=e){for(var t=1,i=0;i<e;i++)t*=10;return t}for(t=1,i=0;i<-e;i++)t*=.1;return t}var i,r,o,n,a,s,l,d,g=function(e){for(var t=0,i=0,r=0;r<e.length;r++)isNaN(e[r])||(t+=e[r],++i);return 0!=i?t/i:NaN};return this.getPrintFormat=function(e,t,i){var r=Math.max(Math.abs(e),Math.abs(t));if(r===1/0||i===1/0||i===-1/0||isNaN(r)||isNaN(i))return{toString:function(e){return e}};var o=Math.LN10,n=1e-12<r?Math.log(r)/o:0,a=1e-12<i?Math.floor(Math.log(i)/o)-2:Math.floor(n-2);if(a<0){var s=Math.floor(n);if(a<=-2&&s<=-4){var l=h(-s),d=s;return{toString:function(e){return 0<d?(e*l).toFixed(-a+s)+"e+"+d:(e*l).toFixed(-a+s)+"e"+d},exponent:s}}return{toString:function(e){return e.toFixed(-a)}}}if(2<=a&&5<n){l=h(-a-2),d=a+2;return{toString:function(e){return 0<d?(e*l).toFixed(2)+"e+"+d:(e*l).toFixed(2)+"e"+d},exponent:a+2}}return{toString:function(e){var t=e.toFixed();return e!=t&&(t+="."),t}}},void 0!==e&&void 0!==t?i=((n=t)-(o=e))/4:void 0!==e&&void 0===t&&(o=(r=me.Utils.getMinMax(e)).min,n=r.max,s=g(a=e),l=a.map(function(e){var t=e-s;return t*t}),d=g(l),i=Math.sqrt(d)),this.getPrintFormat(o,n,i)},me.register=function(e,t){if(!e)throw"key is undefined";if(!t)throw"factory is undefined";me.factory[e]=t};!function(){"use strict";var e=navigator.userAgent.toLowerCase();0<=e.indexOf("firefox")?me.CssPrefix="-moz":(0<=e.indexOf("chrome")||0<=e.indexOf("safari"))&&(me.CssPrefix="-webkit"),$.requestAnimationFrame?me.Utils.requestAnimationFrame=function(e){return $.requestAnimationFrame(e)}:$.msRequestAnimationFrame?me.Utils.requestAnimationFrame=function(e){return $.msRequestAnimationFrame(e)}:$.webkitRequestAnimationFrame?me.Utils.requestAnimationFrame=function(e){return $.webkitRequestAnimationFrame(e)}:$.mozRequestAnimationFrame?me.Utils.requestAnimationFrame=function(e){return $.mozRequestAnimationFrame(e)}:$.oRequestAnimationFrame&&(me.Utils.requestAnimationFrame=function(e){return $.oRequestAnimationFrame(e)});var ue=function(e,s){if("undefined"!=typeof Modernizr&&e&&(Modernizr.canvas?Modernizr.borderradius?Modernizr.boxshadow?Modernizr.csstransforms?Modernizr.hsla?Modernizr.rgba||e.replaceWith('<div">Browser does not support rgba colors</div>'):e.replaceWith('<div">Browser does not support hsla colors</div>'):e.replaceWith('<div">Browser does not support 2d css transformations</div>'):e.replaceWith('<div">Browser does not support "box-shadow" style property</div>'):e.replaceWith('<div">Browser does not support "border-radius" style property</div>'):e.replaceWith('<div">Browser does not support HTML5 canvas</div>')),e.hasClass("idd-plot-master")||e.hasClass("idd-plot-dependant"))throw"The div element already is initialized as a plot";var l=void 0,t=e.attr("data-idd-plot");switch(t){case"plot":(l=new me.Plot(e,s)).order=me.MaxInteger;break;case"polyline":l=new me.Polyline(e,s);break;case"dom":(l=new me.DOMPlot(e,s)).order=me.MaxInteger;break;case"label":(l=new me.LabelPlot(e,s)).order=me.MaxInteger;break;case"figure":l=new me.Figure(e,s);break;case"chart":l=new me.Chart(e,s);break;case"grid":l=new me.GridlinesPlot(e,s);break;case"markers":l=new me.Markers(e,s);break;case"area":l=new me.Area(e,s);break;case"bingMaps":l=new me.BingMapsPlot(e,s);break;case"boundaryLine":l=new me.BoundaryLinePlot(e,s)}var i=$.MutationObserver||$.WebKitMutationObserver;if(i?new i(function(e,t){e.forEach(function(e){var t=e.addedNodes,i=e.removedNodes;if(0<t.length)for(var r=0;r<t.length;r++){var o,n=pe(t[r]);n.attr("data-idd-plot")&&(n.removeClass("idd-plot-master").removeClass("idd-plot-dependant"),o=ue(n,s),l.addChild(o),l.assignChildOrder(o))}if(0<i.length)for(r=0;r<i.length;r++){var a=i[r];"function"==typeof a.getAttribute&&null!=a.getAttribute("data-idd-plot")&&l.removeChild(a.plot)}})}).observe(e[0],{subtree:!1,characterData:!1,attributes:!1,childList:!0,attributeOldValue:!1,characterDataOldValue:!1}):console.warn("MutationObservers are not supported by the browser. DOM changes are not tracked by IDD"),l)return l;var r=me.factory[t];if(r)return r(e,s);throw"Unknown plot type"};me.asPlot=function(e){if(!e)throw"Plot must be attached to div!";var t;if(void 0!==e.tagName&&"div"===e.tagName.toLowerCase())t=pe(e);else if("string"==typeof e){if(0===(t=pe("#"+e)).length)throw"There is no element with id "+e;e=t[0]}else{if(!(e instanceof jQuery&&e.is("div")))throw"Invalid input parameter! It should be div or id of div or jQuery of single div";e=(t=e)[0]}return void 0!==e.plot?e.plot:ue(t)},me.tryGetMasterPlot=function(e){if(e&&e.hasClass("idd-plot-master")){var t=e.get(0);return"plot"in t?t.plot:null}return null},me.updateLayouts=function(e){var t=me.tryGetMasterPlot(e);if(t)t.updateLayout();else for(var i=e.children(),r=0;r<i.length;r++)me.updateLayouts(i.eq(r))},me.Event=me.Event||{},me.Event.appearanceChanged=jQuery.Event("appearanceChanged"),me.Event.childrenChanged=jQuery.Event("childrenChanged"),me.Event.isAutoFitChanged=jQuery.Event("isAutoFitEnabledChanged"),me.Event.visibleRectChanged=jQuery.Event("visibleRectChanged"),me.Event.isVisibleChanged=jQuery.Event("visibleChanged"),me.Event.plotRemoved=jQuery.Event("plotRemoved"),me.Event.orderChanged=jQuery.Event("orderChanged"),me.Event.frameRendered=jQuery.Event("frameRendered");var fe=0;me.Plot=function(i,t,e){if(!i||!i.hasClass("idd-plot-master")&&!i.hasClass("idd-plot-dependant")){i&&(i[0].addEventListener("touchstart",function(e){e.preventDefault()},!1),i[0].addEventListener("touchmove",function(e){e.preventDefault()},!1));var r,o,n,d,h,g,a,s,u=void 0===t&&void 0!==i,f=t||this,p=i,l=e||p,c=u?new me.CoordinateTransform:void 0,v=[],m=!0,y=!1,C=!1,b=!1,I=!1,A=!0,w=!1,x=!1,T=!1,S=!0,P=!1,k="",M=0,D=me.Padding,G={},N=!1,R=void 0;i&&(k=i.attr("data-idd-name")||i.attr("id")||"",i.attr("data-idd-X-log")&&(i.removeAttr("data-idd-X-log"),r=me.logTransform),i.attr("data-idd-Y-log")&&(i.removeAttr("data-idd-Y-log"),o=me.logTransform),a={},me.Utils.readStyle(i,a),a.hasOwnProperty("padding")&&(D=Number(a.padding)),a.hasOwnProperty("suppress-tooltip-coords")&&((R=R||{}).showCursorCoordinates=Boolean(a["suppress-tooltip-coords"])),a.hasOwnProperty("ignored-by-fit-to-view")&&(C=Boolean(a["ignored-by-fit-to-view"])),a.hasOwnProperty("ignored-by-fit-to-view-x")&&(b=Boolean(a["ignored-by-fit-to-view-x"])),a.hasOwnProperty("ignored-by-fit-to-view-y")&&(I=Boolean(a["ignored-by-fit-to-view-y"])),R=R||{},a.hasOwnProperty("tooltipDelay")?R.tooltipDelay=1e3*Number(a.tooltipDelay):R.tooltipDelay=1e3*me.TooltipDelay,i[0].plot=this,i.attr("unselectable","on").addClass("unselectable").on("selectstart",!1)),u&&(this._sharedCanvas=void 0);var B=!1;this.requestsRender=!1,this.isInAnimation=!1;var V=this.isAnimationFrameRequested=!1;u&&(this.requestsUpdateLayout=!1);var F=void 0,Z=this,L=fe++,z=void 0;Object.defineProperty(this,"instanceId",{get:function(){return L},configurable:!1}),Object.defineProperty(this,"isMaster",{get:function(){return u},configurable:!1}),Object.defineProperty(this,"isRendered",{get:function(){return B},configurable:!1}),Object.defineProperty(this,"flatRendering",{get:function(){return u?P:t.flatRendering},set:function(e){u?P!==e&&(P=e,Z.requestUpdateLayout()):t.flatRendering=e}}),Object.defineProperty(this,"isIgnoredByFitToView",{get:function(){return C},set:function(e){C=e,A&&this.requestUpdateLayout()}}),Object.defineProperty(this,"isIgnoredByFitToViewX",{get:function(){return b},set:function(e){b=e,A&&this.requestUpdateLayout()}}),Object.defineProperty(this,"isIgnoredByFitToViewY",{get:function(){return I},set:function(e){I=e,A&&this.requestUpdateLayout()}}),Object.defineProperty(this,"master",{get:function(){return f},configurable:!1}),Object.defineProperty(this,"host",{get:function(){return p},configurable:!1}),Object.defineProperty(this,"centralPart",{get:function(){return l},configurable:!1}),Object.defineProperty(this,"name",{get:function(){return k},set:function(e){k!==e&&(k=e,this.fireAppearanceChanged("name"))},configurable:!1}),Object.defineProperty(this,"children",{get:function(){return v.slice(0)},configurable:!1}),Object.defineProperty(this,"screenSize",{get:function(){return u?{width:d,height:h}:f.screenSize},configurable:!1}),Object.defineProperty(this,"xDataTransform",{get:function(){return r},set:function(e){r=e,this.onDataTransformChanged("x")},configurable:!1}),Object.defineProperty(this,"yDataTransform",{get:function(){return o},set:function(e){o=e,this.onDataTransformChanged("y")},configurable:!1}),Object.defineProperty(this,"coordinateTransform",{get:function(){return u?c.clone():f.coordinateTransform},configurable:!1}),Object.defineProperty(this,"doFitOnDataTransformChanged",{get:function(){return u?S:f.doFitOnDataTransformChanged},set:function(e){u?S=e:f.doFitOnDataTransformChanged=e},configurable:!1}),Object.defineProperty(this,"aspectRatio",{get:function(){return u?n:f.aspectRatio},set:function(e){u?(n=e,this.updateLayout()):f.aspectRatio=e},configurable:!1}),Object.defineProperty(this,"isAutoFitEnabled",{get:function(){return u?A:f.isAutoFitEnabled},set:function(e){if(u){if(A===e)return;if(z=void 0,"boolean"==typeof e)A=e;else{if("object"!=typeof e)throw"value of the unknown type was assigned to the isAutoFitEnabled property";if(4!=e.length)throw"isAutoFitEnabled property can be assigned by boolean or 4-value object";e[0]=isNaN(Number(e[0]))?"auto":Number(e[0]),e[1]=isNaN(Number(e[1]))?"auto":Number(e[1]),e[2]=isNaN(Number(e[2]))?"auto":Number(e[2]),e[3]=isNaN(Number(e[3]))?"auto":Number(e[3]);for(var t=!0,i=0;i<4;i++)"auto"!=e[i]&&(t=!1);if(t)A=!0;else{for(var r,o=!1,i=0;i<4;i++)"auto"==e[i]&&(o=!0);A=!!o,e[0]>=e[1]&&"auto"!=e[0]&&"auto"!=e[1]&&(isNaN(e[0])?e[0]=e[1]-1:isNaN(e[1])||e[0]==e[1]?e[1]=e[0]+1:(r=e[0],e[0]=e[1],e[1]=r),console.log("data-idd-visible-region attribute: xmax is less or equal than xmin. It's ["+e[0]+".."+e[1]+"] on x axis now")),e[2]>=e[3]&&"auto"!=e[2]&&"auto"!=e[3]&&(isNaN(e[2])?e[2]=e[3]-1:isNaN(e[3])||e[2]==e[3]?e[3]=e[2]+1:(r=e[2],e[2]=e[3],e[3]=r),console.log("data-idd-visible-region attribute: ymax is less or equal than ymin. It's ["+e[2]+".."+e[3]+"] on y axis now")),z=e}}A||"boolean"!=typeof e?this.requestUpdateLayout():g=Z.visibleRect,this.host.trigger(me.Event.isAutoFitChanged)}else f.isAutoFitEnabled=e},configurable:!1}),Object.defineProperty(this,"isVisible",{get:function(){return m},set:function(e){m!==e&&(m=e,this.onIsVisibleChanged(),this.fireVisibleChanged(this))},configurable:!1}),Object.defineProperty(this,"isErrorVisible",{get:function(){return y},configurable:!0});var U=function(e){y!==e&&(y=e,this.onIsVisibleChanged(),this.fireVisibleChanged(this))};Object.defineProperty(this,"order",{get:function(){return M},set:function(e){M!==e&&(M=e,this.fireOrderChanged())},configurable:!1}),Object.defineProperty(this,"padding",{get:function(){return u?D:f.padding},set:function(e){u?(D=e,this.updateLayout()):f.padding=e},configurable:!1}),Object.defineProperty(this,"visibleRect",{get:function(){return u?c.getPlotRect({x:0,y:0,width:d,height:h}):f.visibleRect},configurable:!1});var Y=void 0;Object.defineProperty(this,"mapControl",{get:function(){return u?Y:f.mapControl},configurable:!1}),Object.defineProperty(this,"tooltipSettings",{get:function(){return u?R:f.tooltipSettings},set:function(e){u?R=e:f.tooltipSettings=e},configurable:!1});var O=!0;Object.defineProperty(this,"isToolTipEnabled",{get:function(){return u?O:f.isToolTipEnabled},set:function(e){u?O=e:f.isToolTipEnabled=e},configurable:!1}),Object.defineProperty(this,"titles",{get:function(){return pe.extend({},G)},set:function(e){this.setTitles(e,!1)}}),this.selfMapRefresh=function(){if(u){if(void 0!==this.map){if(void 0!==Y)throw"Plot composition can have only 1 map!";Y=this.map,this.requestUpdateLayout()}if(this.constraint){if(void 0!==F)throw"Plot composition can have only 1 constraint function!";F=this.constraint}}},this.getTitle=function(e){return void 0!==G&&void 0!==G[e]?G[e]:e},this.setTitles=function(e,t){G=e,t||this.fireAppearanceChanged()},this.destroy=function(){this.host.removeClass("idd-plot")},this.remove=function(){void 0!==this.map&&this.master.removeMap(),this.isMaster||this.master.removeChild(this),this.firePlotRemoved(this),this.host.remove()},this.removeMap=function(){u&&(F=Y=void 0,this.navigation.animation=new me.PanZoomAnimation,this.fitToView())},this.addChild=function(e){if(!e)throw"Child plot is undefined";if(e.master&&e.master!==e&&e.master!==this.master)throw"Given child plot already added to another plot";if(e.master!==this.master&&e.onAddedTo(this.master),v.push(e),this.master._sharedCanvas&&(this.master._sharedCanvas.remove(),this.master._sharedCanvas=void 0),e.constraint){if(void 0!==F)throw"Plot composition can have only 1 constraint function!";F=e.constraint}if(void 0!==e.map){if(void 0!==Y)throw"Plot composition can have only 1 map!";Y=e.map}this.fireChildrenChanged({type:"add",plot:e}),this.requestUpdateLayout()},this.assignChildOrder=function(e){void 0===e.host.attr("data-idd-plot-order")?e.order!=me.MaxInteger&&(e.order=me.Utils.getMaxOrder(this.master)+1):(e.order=e.host.attr("data-idd-plot-order"),e.host.removeAttr("data-idd-plot-order")),e.order<me.MaxInteger&&e.host.css("z-index",e.order)},this.onAddedTo=function(e){u=this===(f=e);for(var t=v.length;0<=--t;)v[t].onAddedTo(e);u?i.addClass("idd-plot-master").removeClass("idd-plot-dependant"):i.removeClass("idd-plot-master").addClass("idd-plot-dependant")},this.removeChild=function(e){if(!e)throw"plot is undefined";for(var t,i=v.length;0<=--i;)if((t=v[i])===e||t.name===e)return v.splice(i,1),t.onAddedTo(t),this.master._sharedCanvas&&(this.master._sharedCanvas.remove(),this.master._sharedCanvas=void 0),void 0!==t.constraint&&(F=void 0),void 0!==t.map&&(Y=void 0),this.fireChildrenChanged({type:"remove",plot:t}),this.requestUpdateLayout(),!0;for(i=v.length;0<=--i;)if((t=v[i]).removeChild(e))return!0;return!1},this.getPlotsSequence=function(){for(var t=[Z],e=v.length,i=0;i<e;i++){v[i].getPlotsSequence().forEach(function(e){t.push(e)})}return t},this.getLocalBounds=function(e,t){return s=s||this.computeLocalBounds(e,t)},this.computeLocalBounds=function(e,t){},this.invalidateLocalBounds=function(){var e=s;return s=void 0,e},this.aggregateBounds=function(){for(var e,t,i=Z.getPlotsSequence(),r=void 0,o=[],n=i.length,a=0;a<n;a++){(h=i[a]).isIgnoredByFitToView||(e=h.getLocalBounds(1),h.isVisible&&!h.isErrorVisible&&(void 0===e?o.push(h):(t={x:e.x,y:e.y,width:e.width,height:e.height},h.isIgnoredByFitToViewX&&(t.x=NaN,t.width=NaN),h.isIgnoredByFitToViewY&&(t.y=NaN,t.height=NaN),r=me.Utils.unionRects(r,t))))}n=o.length;for(var s,l,d=r,a=0;a<n;a++)var h=o[a],r=me.Utils.unionRects(r,h.getLocalBounds(2,d));void 0!==r&&(0===r.width&&(s=Math.max(.1,Math.abs(r.x)),r.x=r.x-s/200,r.width=s/100),0===r.height&&(l=Math.max(.1,Math.abs(r.y)),r.y=r.y-l/200,r.height=l/100));var g=u&&void 0===r;return g&&(r=void 0!==Y?{x:-180,y:-90,width:360,height:180}:{x:0,y:0,width:1,height:1}),{bounds:r,isDefault:g}},this.getLocalPadding=function(){return{left:0,right:0,top:0,bottom:0}},this.aggregatePadding=function(){for(var e=Z.getLocalPadding()||{left:0,right:0,top:0,bottom:0},t=v.length,i=0;i<t;i++)var r=v[i].aggregatePadding(),e={left:Math.max(e.left,r.left),right:Math.max(e.right,r.right),top:Math.max(e.top,r.top),bottom:Math.max(e.bottom,r.bottom)};return e.left=e.left+this.padding||this.padding,e.right=e.right+this.padding||this.padding,e.top=e.top+this.padding||this.padding,e.bottom=e.bottom+this.padding||this.padding,e};var W=function(){var e,t;f.flatRendering&&(V=!0,f._sharedCanvas&&(f._sharedCanvas._dirty=!0)),Z.requestsUpdateLayout?(Z.requestsUpdateLayout=!1,Z.isAnimationFrameRequested=!1,V=!0,Z.updateLayout()):(Z.isAnimationFrameRequested=!1,e=Z.screenSize,t=Z.coordinateTransform.getPlotRect({x:0,y:0,width:e.width,height:e.height}),X(V,f,t,e),Z.fireFrameRendered()),V=!1,ne&&ne()},X=function(e,t,i,r){if(t&&t.isVisible){(e||t.requestsRender)&&(t.requestsRender=!1,t.render(i,r));for(var o=t.children,n=o.length,a=0;a<n;a++){var s=o[a];X(e,s,i,r)}}};this.requestNextFrame=function(e){e=e||this,u?(e.requestsRender=!0,this.isAnimationFrameRequested||(this.isAnimationFrameRequested=!0,V=!1,me.Utils.requestAnimationFrame(W))):f.requestNextFrame(e)},this.requestUpdateLayout=function(e){u?(V=!0,N=e&&e.suppressNotifyBoundPlots,this.requestsUpdateLayout||(e&&e.forceOnlyUpdatePlotsOutput||(this.requestsUpdateLayout=!0),this.isAnimationFrameRequested||(this.isAnimationFrameRequested=!0,me.Utils.requestAnimationFrame(W)))):f.requestUpdateLayout(e)},this.onIsVisibleChanged=function(){this.updateLayout()},this.onDataTranformChangedCore=function(e){},this.onDataTransformChanged=function(e){s=void 0,this.onDataTranformChangedCore(e),this.isAutoFitEnabled?this.master.requestUpdateLayout():this.doFitOnDataTransformChanged&&this.master.fitToView()},this.render=function(e,t){var i=this.getLocalBounds(),r=!1;i?me.Utils.intersect(i,e)?(U.call(this,!1),this.renderCore(e,t),r=!0):i.width==i.width&&i.height==i.height&&i.x==i.x&&i.y==i.y&&isFinite(i.width)&&isFinite(i.height)&&isFinite(i.y)&&isFinite(i.x)||U.call(this,!0):(this.renderCore(e,t),r=!0),r!==B&&(B=r,this.onIsRenderedChanged())},this.renderCore=function(e,t){},this.exportToSvg=function(){if(!ve.supported)throw"SVG is not supported";var e=Z.screenSize,t=Z.coordinateTransform.getPlotRect({x:0,y:0,width:e.width,height:e.height}),i=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=ve(i).size(p.width(),p.height());return Z.exportContentToSvg(t,e,r),r},this.exportContentToSvg=function(e,t,i){for(var r=me.Utils.enumPlots(this),o=r.length-1;0<=o;o--)r[o].isVisible&&r[o].renderCoreSvg(e,t,i)},this.exportLegendToSvg=function(e){if(!ve.supported)throw"SVG is not supported";for(var t,i=Z.screenSize,r=(Z.coordinateTransform.getPlotRect({x:0,y:0,width:i.width,height:i.height}),document.createElementNS("http://www.w3.org/2000/svg","svg")),o=ve(r),n=o.group(),a=me.Utils.enumPlots(this),s={width:170,height:0},l=0,d=0;d<a.length;d++){var h,g={width:170,height:0};null!=a[d].getLegend()&&(a[d].isVisible?(h=n.group(),e&&(g.legendDiv=e.children[l],l++),a[d].buildSvgLegend(g,h),h.translate(5,s.height),n.clipWith(h.rect(g.width,s.height+30)),s.height+=g.height+10,t=o.line(15,s.height,s.width,s.height).stroke({width:.3,color:"gray"}).back(),s.height+=10):l++)}return null!=t&&t.remove(),o.size(200,s.height+10),n.clipWith(n.rect(180,s.height+10)),o},this.renderCoreSvg=function(e,t,i){},this.buildSvgLegend=function(e,t){},this.onIsRenderedChanged=function(){};var E=function(e,t){var i=e;return"auto"!=t[0]&&(i.width=i.x+i.width-parseFloat(t[0]),i.width<=0&&(i.width=1),i.x=parseFloat(t[0])),"auto"!=t[1]&&(i.width=parseFloat(t[1])-i.x),"auto"!=t[2]&&(i.height=i.y+i.height-parseFloat(t[2]),i.height<=0&&(i.height=1),i.y=parseFloat(t[2])),"auto"!=t[3]&&(i.height=parseFloat(t[3])-i.y),i};this.fit=function(e,t,i){d=e.width,h=e.height;var r,o,n=void 0,a=f.aggregateBounds(),s=a.bounds,l=a.isDefault?{left:0,top:0,bottom:0,right:0}:f.aggregatePadding();return A||w?(s.x!=s.x&&(s.x=0),s.y!=s.y&&(s.y=0),s.width!=s.width&&(s.width=1),s.height!=s.height&&(s.height=1),z&&(s=E(s,z)),g=s,n=(c=me.Utils.calcCSWithPadding(g,e,l,f.aspectRatio)).getPlotRect({x:0,y:0,width:e.width,height:e.height}),void 0!==F&&!0===t&&(n=F(n,e,!0),c=new me.CoordinateTransform(n,{left:0,top:0,width:d,height:h},f.aspectRatio))):g=(n=x||T?(o=r=void 0,z&&(g=E(g,z)),!0===x&&(g.width=s.width,g.x=s.x,r=a.isDefault?{left:0,top:0,right:0,bottom:0}:l),!0===T&&(g.height=s.height,g.y=s.y,o=a.isDefault?{left:0,top:0,right:0,bottom:0}:l),l=!z||"auto"==z[0]&&"auto"==z[1]&&"auto"==z[2]&&"auto"==z[3]?{left:r?r.left:0,top:o?o.top:0,right:r?r.right:0,bottom:o?o.bottom:0}:{left:r?r.left:l.left,top:o?o.top:l.top,right:r?r.right:l.right,bottom:o?o.bottom:l.bottom},(c=me.Utils.calcCSWithPadding(g,e,l,f.aspectRatio)).getPlotRect({x:0,y:0,width:e.width,height:e.height})):(s.x!=s.x&&(s.x=0),s.y!=s.y&&(s.y=0),s.width!=s.width&&(s.width=1),s.height!=s.height&&(s.height=1),z&&(g=E(g,z)),(c=0===l.left&&0===l.top&&0===l.right&&0===l.bottom||z?me.Utils.calcCSWithPadding(g,e,l,f.aspectRatio):new me.CoordinateTransform(g,{left:0,top:0,width:d,height:h},f.aspectRatio)).getPlotRect({x:0,y:0,width:e.width,height:e.height})),void 0!==F&&!0===t&&(n=F(n,e,i),c=new me.CoordinateTransform(n,{left:0,top:0,width:d,height:h},f.aspectRatio)),n),t&&(g=n),n},this.updateLayout=function(){if(Z.requestsUpdateLayout=!1,u){var e=Z.visibleRect,t={width:p.width(),height:p.height()};if(t.width<=1||t.height<=1){var i=Z.measure({width:1,height:1});return void Z.arrange(i)}var r=Z.screenSize.width!==t.width||Z.screenSize.height!==t.height,i=Z.measure(t,r);T=x=w=!1,Z.arrange(i);var o=Z.visibleRect;if(o.x===e.x&&o.y===e.y&&o.width===e.width&&o.height===e.height||(W(),Z.fireVisibleRectChanged({visibleRect:o})),V=!0,W(),!N){var n=me.Binding.getBoundPlots(Z),a=n.h.length,s=n.v.length;if(0<a||0<s){var l=Z.coordinateTransform.getPlotRect({x:0,y:0,width:i.width,height:i.height});n.v=n.v.slice(0);for(var d=0;d<a;d++){var h=n.h[d],g=n.v.indexOf(h);0<=g?(n.v[g]=null,h.navigation.setVisibleRect(l,!1,{suppressNotifyBoundPlots:!0})):((c=h.visibleRect).x=l.x,c.width=l.width,h.navigation.setVisibleRect(c,!1,{suppressNotifyBoundPlots:!0}))}for(var c,d=0;d<s;d++){null!=(h=n.v[d])&&((c=h.visibleRect).y=l.y,c.height=l.height,h.navigation.setVisibleRect(c,!1,{suppressNotifyBoundPlots:!0}))}}}N=!1}else f.updateLayout()},this.measure=function(e,t){return void 0!==this.mapControl&&this.mapControl.setOptions({width:e.width,height:e.height}),this.fit(e,!0,t),p&&p.children("div").each(function(){var e=pe(this);e.css("top",0),e.css("left",0)}),e},this.arrange=function(e){this.isMaster||me.Utils.arrangeDiv(this.host,e);for(var t=this.children,i=t.length,r=0;r<i;r++){t[r].arrange(e)}};var H=function(e,t){Z.isAutoFitEnabled&&(Z.isAutoFitEnabled=!1),g=e,(z=void 0)!==t&&void 0!==t.syncUpdate&&!0===t.syncUpdate?Z.updateLayout():Z.requestUpdateLayout(t)};if(i&&i.attr("data-idd-visible-region")){var j=i.attr("data-idd-visible-region").split(" ");if(4!=j.length)throw"data-idd-visible-region must contain exactly 4 numbers (xmin,xmax,ymin,ymax) separated by single space";var K=Number(j[0]),Q=Number(j[1]),J=Number(j[2]),q=Number(j[3]);if(Q<K)throw"data-idd-visible-region attribute: xmax is less than xmin";if(q<J)throw"data-idd-visible-region attribute: ymax is less than ymin";var _=this.xDataTransform&&this.xDataTransform.dataToPlot,$=this.yDataTransform&&this.yDataTransform.dataToPlot,ee=_?_(K):K,te=_?_(Q):Q,ie=$?$(J):J;H({x:ee,width:te-ee,y:ie,height:($?$(q):q)-ie})}this.fitToView=function(){u?(this.isAutoFitEnabled=!1,this.navigation.stop(),w=!0,z=void 0,this.requestUpdateLayout()):f.fitToView()},this.fitToViewX=function(){u?(this.navigation.stop(),x=!0,z?(z[0]="auto",z[1]="auto"):z=void 0,this.requestUpdateLayout()):f.fitToViewX()},this.fitToViewY=function(){u?(this.navigation.stop(),T=!0,z?(z[2]="auto",z[3]="auto"):z=void 0,this.requestUpdateLayout()):f.fitToViewY()},this.requestNextFrameOrUpdate=function(){this.isAutoFitEnabled?this.master.requestUpdateLayout():this.master.requestNextFrame(this)},this.getTooltip=function(e,t,i,r){};var re,oe,ne,ae,se,le,de,he=function(e,t){for(var i=e.children,r=i.length,o=0;o<r;o++){var n=i[o];he(n,t)}t(e)};u?(this.enumAll=function(e,t){he(e,t)},ae=function(e){e&&(e.fadeOutTimer&&(clearTimeout(e.fadeOutTimer),e.fadeOutTimer=void 0),e.remove(),e=void 0)},se=function(){re&&(clearTimeout(re),re=void 0),ne=void 0,ae(oe)},le=function(e,t){re=void 0,se();function i(){var a,s,l=[],d=t.x,h=t.y;return he(Z,function(e){var t,i,r=e.xDataTransform?e.xDataTransform.plotToData(d):d,o=e.yDataTransform?e.yDataTransform.plotToData(h):h,n=e.getTooltip(r,o,d,h);n&&(r===a&&o===s||(a=r,s=o,t=new me.AdaptiveFormatter(f.visibleRect.x,f.visibleRect.x+f.visibleRect.width),i=new me.AdaptiveFormatter(f.visibleRect.y,f.visibleRect.y+f.visibleRect.height),void 0!==R&&!1===R.showCursorCoordinates||l.push("<div class='idd-tooltip-coordinates'>"+t.toString(a)+", "+i.toString(s)+"</div>")),l.push(n))}),l}var r,o,n,a=i();function s(){ne=void 0,o.fadeOut("fast")}function l(){o.fadeOutTimer&&(clearTimeout(o.fadeOutTimer),o.fadeOutTimer=void 0),o.remove(),o=void 0}0!==a.length&&(oe=pe("<div></div>").addClass("idd-tooltip").hide().appendTo(Z.host).css("position","absolute").css("left",e.x+15).css("top",e.y+15).css("z-index",me.ZIndexTooltipLayer),(r=function(e){for(var t=e.length,i=0;i<t;i++)pe(e[i]).appendTo(oe).addClass("idd-tooltip-item")})(a),ne=function(){if(oe){oe.empty();var e=i();return r(e),e.length}},o=oe,n=function(){0===R.tooltipDelay?(o.show(),o.fadeOutTimer=setTimeout(l,1e3*me.TooltipDuration)):o.fadeOutTimer=setTimeout(s,1e3*me.TooltipDuration)},0===R.tooltipDelay?n():oe.fadeIn("fast",n))},l.mousemove(function(e){de=void 0;var t=me.Gestures.getXBrowserMouseOrigin(p,e),i=me.Gestures.getXBrowserMouseOrigin(l,e),r=Z.coordinateTransform,o={x:r.screenToPlotX(i.x),y:r.screenToPlotY(i.y)};re&&(clearTimeout(re),re=void 0);var n=oe;Z.master.isToolTipEnabled&&(0===R.tooltipDelay?le(t,o):re=setTimeout(function(){le(t,o)},R.tooltipDelay)),ae(n);var a=function(e,t,i){e.onMouseMove&&e.onMouseMove(t,i);for(var r=e.children,o=r.length,n=0;n<o;n++)a(r[n],t,i)};a(Z,i,o)}),l.mousedown(function(e){se(),de=me.Gestures.getXBrowserMouseOrigin(l,e)}),l.mouseup(function(e){se();var t,i,a,r=me.Gestures.getXBrowserMouseOrigin(l,e);de&&de.x==r.x&&de.y==r.y&&(i={x:(t=Z.coordinateTransform).screenToPlotX(r.x),y:t.screenToPlotY(r.y)},(a=function(e,t,i){e.onClick&&e.onClick(t,i);for(var r=e.children,o=r.length,n=0;n<o;n++)a(r[n],t,i)})(Z,r,i))}),l.mouseleave(function(e){se()})):this.enumAll=f.enumAll;var ge,ce=!(this.get=function(e){var a=function(e,t){if(t.name===e||t.host[0].id===e||t.host[0]===e)return t;for(var i=t.children,r=i.length,o=0;o<r;o++){var n=a(e,i[o]);if(n)return n}};return a(e,this.master)});this.fireAppearanceChanged=function(e){ce||(ce=!0,setTimeout(function(){Z.host.trigger(me.Event.appearanceChanged,e),ce=!1},20))},this.fireChildrenChanged=function(e){this.host.trigger(me.Event.childrenChanged,e)},this.fireFrameRendered=function(e){this.host.trigger(me.Event.frameRendered,e)},this.fireVisibleRectChanged=function(e){se(),this.master.host.trigger(me.Event.visibleRectChanged,e)},this.fireVisibleChanged=function(e){this.host.trigger(me.Event.isVisibleChanged,e)},this.firePlotRemoved=function(e){this.host.trigger(me.Event.plotRemoved,e),he(e,function(e){e.host.trigger(me.Event.plotRemoved,e)})},this.fireOrderChanged=function(e){this.host.trigger(me.Event.orderChanged,e)},this.polyline=function(e,t){var i,r=this.get(e);return r||(i=pe("<div></div>").attr("data-idd-name",e).appendTo(this.host),r=new me.Polyline(i,this.master),this.addChild(r),this.assignChildOrder(r)),void 0!==t&&r.draw(t),r},this.markers=function(e,t,i){var r,o=this.get(e);return o||(r=pe("<div></div>").attr("data-idd-name",e).appendTo(this.host),o=new me.Markers(r,this.master),this.addChild(o),this.assignChildOrder(o)),void 0!==t&&o.draw(t,i),o},this.area=function(e,t){var i,r=this.get(e);return r||(i=pe("<div></div>").attr("data-idd-name",e).appendTo(this.host),r=new me.Area(i,this.master),this.addChild(r),this.assignChildOrder(r)),void 0!==t&&r.draw(t),r},this.heatmap=function(e,t,i){var r,o=this.get(e);return o||(r=pe("<div></div>").attr("data-idd-name",e).appendTo(this.host),o=new me.Heatmap(r,this.master),this.addChild(o),this.assignChildOrder(o)),void 0!==t&&o.draw(t,i),o},this.labels=function(e,t){var i,r=this.get(e);return r||(i=pe("<div></div>").attr("data-idd-name",e).appendTo(this.host),r=new me.LabelPlot(i,this.master),this.addChild(r),this.assignChildOrder(r)),void 0!==t&&r.draw(t),r},this.boundaryLine=function(e,t){var i,r=this.get(e);return r||(i=pe("<div></div>").attr("data-idd-name",e).appendTo(this.host),r=new me.BoundaryLinePlot(i,this.master),this.addChild(r),this.assignChildOrder(r)),void 0!==t&&r.draw(t),r},u&&(ge=new me.Navigation(this,H)),Object.defineProperty(this,"navigation",{get:function(){return u?ge:f.navigation},configurable:!1}),p&&p.children("div").each(function(){var e,t=pe(this);t.hasClass("idd-plot-master")||t.hasClass("idd-plot-dependant")||void 0===t.attr("data-idd-plot")||"figure"===t.attr("data-idd-plot")||"chart"===t.attr("data-idd-plot")||(e=ue(t,f),Z.addChild(e),Z.assignChildOrder(e))}),this.getLegend=function(){},setTimeout(function(){var t,e;p&&p.attr("data-idd-legend")&&(t=pe("#"+p.attr("data-idd-legend")),e=new me.Legend(Z,t,!0),Object.defineProperty(Z,"legend",{get:function(){return e},configurable:!1}),me.Gestures.FullEventList.forEach(function(e){t[0].addEventListener(e,function(e){e.stopPropagation()},!1)}))},0),this.updateOrder=function(e,t){if(e&&me.Utils.reorder(this,e,t),!P)for(var i=me.Utils.enumPlots(f),r=0;r<i.length;r++)i[r].order<me.MaxInteger&&i[r].host.css("z-index",i[r].order)},i&&(u?("figure"!==i.attr("data-idd-plot")&&"chart"!==i.attr("data-idd-plot")&&this.updateLayout(),i.addClass("idd-plot-master")):i.addClass("idd-plot-dependant"))}};var I=[];me.Legend=function(n,s,l,d,e){var h=[],a=[],g=s[0].style,c=this;c.div=s;var o=!0;Object.defineProperty(this,"isVisible",{get:function(){return o},set:function(e){o=e,g.display=o?"block":"none"},configurable:!1}),Object.defineProperty(this,"Host",{get:function(){return s}});var t=void 0===l&&void 0===e||!1===l&&void 0===e?!0:e;l?s.addClass("idd-legend-compact"):s.addClass("idd-legend"),s.addClass("unselectable"),t&&(s.sortable({axis:"y"}),s.on("sortupdate",function(e,t){c.updateIsLegendInduced=!0;var i,r,o=t.item.data("plot");pe("li",s).each(function(e,t){if(o==pe(t).data("plot"))return r=pe(t).prev().data("plot"),i=pe(t).next().data("plot"),!1});for(var n=0;n<h.length;++n)if(h[n].plot==o){if(i){for(var a=0;a<h.length;++a)if(h[a].plot==i){o.updateOrder(h[a].plot);break}}else for(a=0;a<h.length;++a)if(h[a].plot==r){o.updateOrder(h[a].plot,!0);break}break}c.updateIsLegendInduced=!1}));function u(e){e.host.bind("visibleChanged",C),e.host.bind("childrenChanged",y),a.push(e)}function f(){for(var e=0;e<a.length;e++){var t=a[e];t.host.unbind("visibleChanged",C),t.host.unbind("childrenChanged",y)}a=[]}function p(){s.empty();for(var e=0,t=h.length;e<t;e++)m(h[e]);f(),h=[];for(var i=me.Utils.enumPlots(n),e=0;e<i.length;e++){var r=i[i.length-e-1];u(r),b(r)}s[0].hasChildNodes()&&o&&(g.display="block")}function r(e,t){c.updateIsLegendInduced||p()}function v(e,t){n==t&&s.remove()}var m=function(e){for(var t=0;t<I.length;t++)if(I[t]==e){I.splice(t,1);break}},y=function(e,t){if(void 0!==t)if("add"===t.type&&s[0].hasChildNodes()&&t.plot.master==n.master){if(function(e){for(var t=0,i=a.length;t<i;t++)if(a[t]===e)return!0;return!1}(t.plot))return;u(t.plot),b(t.plot)}else if("remove"===t.type){for(var r=function(e){var t=h[e];h.splice(e,1),m(t),t.onLegendRemove&&t.onLegendRemove(),t[0].innerHTML="",l?t.removeClass("idd-legend-item-compact"):t.removeClass("idd-legend-item"),s[0].removeChild(t[0]),t.plot.children.forEach(function(e){for(var t=0,i=h.length;t<i;t++)h[t].plot===e&&r(h[t])}),pe(t[0]).css("display","none"),0==h.length&&(g.display="none")},i=0,o=h.length;i<o;i++)if(h[i].plot===t.plot){r(i);break}!function(e){e.host.unbind("visibleChanged",C),e.host.unbind("childrenChanged",y);for(var t=0;t<a.length;t++)a[t]===e&&a.splice(t,1)}(t.plot)}else{for(s[0].innerHTML="",g.display="none",o=h.length,i=0;i<o;i++)m(h[i]),h[i].onLegendRemove&&h[i].onLegendRemove(),h[i][0].innerHTML="",l?h[i].removeClass("idd-legend-item-compact"):h[i].removeClass("idd-legend-item");f(),h=[],p()}},C=function(e,t){for(var i,r,o,n,a=0,s=I.length;a<s;a++)I[a].plot===t&&(i=a,r=t.isVisible,o=t.isErrorVisible,n=void 0,n=I[i],o?(n[0].firstElementChild.lastElementChild.setAttribute("class","idd-legend-isselected-error"),n[0].firstElementChild.lastElementChild.setAttribute("title","The data can not be displayed.")):(n[0].firstElementChild.lastElementChild.setAttribute("title",""),r?n[0].firstElementChild.lastElementChild.setAttribute("class","idd-legend-isselected-false"):n[0].firstElementChild.lastElementChild.setAttribute("class","idd-legend-isselected-true")))},b=function(e){var t,i,r,o,n,a=e.getLegend();a&&(t=pe(l?"<div class='idd-legend-item-compact'></div>":"<li class='idd-legend-item'></li>"),l||t.data("plot",e),i=pe(l?"<div class='idd-legend-item-title-compact'></div>":"<div class='idd-legend-item-title'></div>"),a.legend&&a.legend.thumbnail&&(l?a.legend.thumbnail.addClass("idd-legend-item-title-thumb-compact").appendTo(i):a.legend.thumbnail.addClass("idd-legend-item-title-thumb").appendTo(i)),l?a.name.addClass("idd-legend-item-title-name-compact").appendTo(i):a.name.addClass("idd-legend-item-title-name").appendTo(i),r=i,o=e,n=pe("<div></div>").addClass("idd-legend-isselected-false").appendTo(r),o.isErrorVisible?(n.attr("class","idd-legend-isselected-error"),n.attr("title","The data can not be displayed.")):(n.attr("title",""),o.isVisible?n.attr("class","idd-legend-isselected-false"):n.attr("class","idd-legend-isselected-true"),n.click(function(e){e.stopPropagation(),o.isErrorVisible||(o.isVisible?(n.attr("class","idd-legend-isselected-true"),o.isVisible=!1):(n.attr("class","idd-legend-isselected-false"),o.isVisible=!0))})),i.appendTo(t),a.legend&&a.legend.content&&(l?a.legend.content.addClass("idd-legend-item-info-compact").appendTo(t):a.legend.content.addClass("idd-legend-item-info").appendTo(t)),d&&pe(t).bind("mouseenter",function(){var e=pe(this),t=l?e.find(".idd-legend-item-title-name-compact"):e.find(".idd-legend-item-title-name");t[0].offsetWidth<t[0].scrollWidth&&void 0===e.attr("title")&&e.attr("title",t.text())}),t.prependTo(s),t.plot=e,h[h.length]=t,(I[I.length]=t).plot.updateOrder())};this.remove=function(){for(var e=0,t=h.length;e<t;e++)m(h[e]),h[e].onLegendRemove&&h[e].onLegendRemove(),h[e][0].innerHTML="",l?h[e].removeClass("idd-legend-item-compact"):h[e].removeClass("idd-legend-item");h=[],f();var i=function(e){e.host.unbind("visibleChanged",C),e.children.forEach(function(e){i(e)})};i(n),s[0].innerHTML="",l?s.removeClass("idd-legend-compact"):s.removeClass("idd-legend"),s.removeClass("unselectable"),n.host.unbind("plotRemoved",v),n.host.unbind("orderChanged",r)},n.host.bind("plotRemoved",v),n.host.bind("orderChanged",r),s[0].legend=c,p(),s.dblclick(function(e){e.stopImmediatePropagation()})},me.CoordinateTransform=function(e,t,i){var r=0,o=0,n=1,a=1;void 0!==e&&void 0!==t&&(n=t.width/e.width,a=t.height/e.height,void 0!==i&&0<i&&(i*a<n?n=i*a:a=n/i),r=t.left-n*e.x,o=t.height+t.top+a*e.y),this.plotToScreenX=function(e){return e*n+r},this.plotToScreenY=function(e){return o-e*a},this.screenToPlotX=function(e){return(e-r)/n},this.screenToPlotY=function(e){return(o-e)/a},this.plotToScreenWidth=function(e){return e*n},this.plotToScreenHeight=function(e){return e*a},this.screenToPlotWidth=function(e){return e/n},this.screenToPlotHeight=function(e){return e/a},this.getPlotRect=function(e){var t=this.screenToPlotX(e.x),i=this.screenToPlotY(e.height+e.y);return{x:t,y:i,width:this.screenToPlotX(e.x+e.width)-t,height:this.screenToPlotY(e.y)-i}},this.getScale=function(){return{x:n,y:a}},this.getOffset=function(){return{x:r,y:o}},this.clone=function(){var e=new me.CoordinateTransform;return e.plotToScreenX=this.plotToScreenX,e.plotToScreenY=this.plotToScreenY,e.screenToPlotX=this.screenToPlotX,e.screenToPlotY=this.screenToPlotY,e.plotToScreenWidth=this.plotToScreenWidth,e.plotToScreenHeight=this.plotToScreenHeight,e.screenToPlotWidth=this.screenToPlotWidth,e.screenToPlotHeight=this.screenToPlotHeight,e.getPlotRect=this.getPlotRect,e.getScale=this.getScale,e.getOffset=this.getOffset,e}},me.CanvasPlot=function(e,t){var n,o;this.base=me.Plot,this.base(e,t),e&&(o=function(){t._sharedCanvas&&(t._sharedCanvas.remove(),t._sharedCanvas=void 0)},this.getContext=function(e){var t,i=this.master;if(i.flatRendering?(t=i._sharedCanvas,e=i._sharedCanvas._dirty&&e,i._sharedCanvas._dirty=!1):t=n,void 0!==t){var r,o=t[0].getContext("2d");return e&&(r=this.screenSize,o.clearRect(0,0,r.width,r.height)),o}},this.destroy=function(){return me.CanvasPlot.prototype.destroy.call(this),this.host.children(".idd-plot-canvas").remove(),o(),this},this.arrange=function(e){var t;me.CanvasPlot.prototype.arrange.call(this,e);var i=this.master;i.flatRendering?(i._sharedCanvas?t=i._sharedCanvas:(n?(t=n,n=void 0):t=pe("<canvas></canvas>").prependTo(this.host).addClass("idd-plot-canvas"),i._sharedCanvas=t,i._sharedCanvas._dirty=!1),n&&(n.remove(),n=void 0)):(i._sharedCanvas&&o(),t=n=n||pe("<canvas></canvas>").prependTo(this.host).addClass("idd-plot-canvas"));var r=t[0];r.width=e.width,r.height=e.height},this.getTransform=function(){var e=this.coordinateTransform,t=e.plotToScreenX,i=e.plotToScreenY,r=this.xDataTransform&&this.xDataTransform.dataToPlot,o=this.yDataTransform&&this.yDataTransform.dataToPlot;return{dataToScreenX:r?function(e){return t(r(e))}:t,dataToScreenY:o?function(e){return i(o(e))}:i,dataToPlotX:r,dataToPlotY:o,plotToScreenX:t,plotToScreenY:i}},this.getScreenToDataTransform=function(){var e=this.coordinateTransform,t=e.screenToPlotX,i=e.screenToPlotY,r=this.xDataTransform&&this.xDataTransform.plotToData,o=this.yDataTransform&&this.yDataTransform.plotToData;return{screenToDataX:r?function(e){return r(t(e))}:t,screenToDataY:o?function(e){return o(i(e))}:i}})},me.CanvasPlot.prototype=new me.Plot,me.Polyline=function(e,t){var M,D,f,p,v,m,G=this,i=me.Utils.getDataSourceFunction(e,me.readCsv)(e);this.base=me.CanvasPlot,this.base(e,t);var y="blue",C="pink",N=1,R="#4169ed",B="butt",V="miter",F=[];i&&(N=void 0!==i.thickness?i.thickness:N,R=void 0!==i.stroke?i.stroke:R,B=void 0!==i.lineCap?i.lineCap:B,V=void 0!==i.lineJoin?i.lineJoin:V,y=void 0!==i.fill68?i.fill68:y,C=void 0!==i.fill95?i.fill95:C,F=void 0!==i.lineDash?i.lineDash:F),this.draw=function(e){if(!(h=e.y.median?e.y.median:e.y))throw"Data series y is undefined";var t=h.length;if(e.x||(e.x=me.Utils.range(0,t-1)),t!=e.x.length)throw"Data series x and y have different lengths";M=h,D=e.x;var i=e.y.upper68;if(i&&i.length!==t)throw"Data series y_u68 and y_median have different lengths";var r=e.y.lower68;if(r&&r.length!==t)throw"Data series y_l68 and y_median have different lengths";var o=e.y.upper95;if(o&&o.length!==t)throw"Data series y_u95 and y_median have different lengths";var n=e.y.lower95;if(n&&n.length!==t)throw"Data series y_l95 and y_median have different lengths";f=i,p=r,v=o,m=n;var a=e.treatAs&&"function"==e.treatAs&&!me.Utils.isOrderedArray(D);if(me.Utils.isArray(e.y)){if(M=h,a){var s=Math.min(D.length,h.length);if(M=me.Utils.cutArray(h,s),D=me.Utils.cutArray(D,s),a){for(var l=[],d=0;d<s;d++)isNaN(D[d])||l.push({x:D[d],y:M[d]});l.sort(function(e,t){return e.x-t.x}),M=[],D=[];for(d=0;d<l.length;d++)M.push(l[d].y),D.push(l[d].x)}}}else{var h=e.y,s=Math.min(D.length,h.median.length);if(h.upper68&&h.lower68&&(s=Math.min(s,Math.min(h.upper68.length,h.lower68.length))),h.upper95&&h.lower95&&(s=Math.min(s,Math.min(h.upper95.length,h.lower95.length))),M=me.Utils.cutArray(h.median,s),f=me.Utils.cutArray(h.upper68,s),p=me.Utils.cutArray(h.lower68,s),v=me.Utils.cutArray(h.upper95,s),m=me.Utils.cutArray(h.lower95,s),D=me.Utils.cutArray(D,s),a){for(l=[],d=0;d<s;d++)isNaN(D[d])||l.push({x:D[d],y:M[d],y_u68:f[d],y_l68:p[d],y_u95:v[d],y_l95:m[d]});l.sort(function(e,t){return e.x-t.x}),M=[],f=[],p=[],v=[],m=[],D=[];for(d=0;d<l.length;d++)M.push(l[d].y),f.push(l[d].y_u68),p.push(l[d].y_l68),v.push(l[d].y_u95),m.push(l[d].y_l95),D.push(l[d].x)}}"number"!=typeof(N=void 0!==e.thickness?e.thickness:N)&&(N=parseFloat(N)||1),R=void 0!==e.stroke?e.stroke:R,B=void 0!==e.lineCap?e.lineCap:B,V=void 0!==e.lineJoin?e.lineJoin:V,y=void 0!==e.fill68?e.fill68:y,C=void 0!==e.fill95?e.fill95:C,F=void 0!==e.lineDash?e.lineDash:F,this.invalidateLocalBounds(),this.requestNextFrameOrUpdate(),this.fireAppearanceChanged()},this.computeLocalBounds=function(e,t){var i=this.xDataTransform&&this.xDataTransform.dataToPlot,r=this.yDataTransform&&this.yDataTransform.dataToPlot,o=me.Utils.getBoundingBoxForArrays(D,M,i,r),n=me.Utils.getBoundingBoxForArrays(D,f,i,r),a=me.Utils.getBoundingBoxForArrays(D,p,i,r),s=me.Utils.getBoundingBoxForArrays(D,v,i,r),l=me.Utils.getBoundingBoxForArrays(D,m,i,r);return me.Utils.unionRects(o,me.Utils.unionRects(n,me.Utils.unionRects(a,me.Utils.unionRects(s,l))))},this.getLocalPadding=function(){return{left:0,right:0,top:0,bottom:0}},this.getTooltip=function(e,t,i,r){if(void 0!==D&&null!=M&&(0!=M.length&&this.isVisible)){var o=this.getContext(!1);if(void 0!==o){for(var n=this.getTransform(),a=n.dataToScreenX(e),s=n.dataToScreenY(t),l=o.getImageData(a-1,s-1,3,3),d=0,h=0;h<l.data.length;h++)0===l.data[h]&&d++;if(d!==l.data.length){var g=pe("<div></div>");return pe("<div></div>").addClass("idd-tooltip-name").text(this.name||"polyline").appendTo(g),g}}}};this.renderCore=function(e,t){me.Polyline.prototype.renderCore.call(this,e,t);var i=this.getContext(!0);me.Area.render.call(this,D,m,v,C,e,t,i,.5),me.Area.render.call(this,D,p,f,y,e,t,i,.5),function(e,t,i,r,o,n){if(void 0!==e&&null!=t){var a=t.length;if(0!=a){var s,l,d,h,g=G.getTransform(),c=g.dataToScreenX,u=g.dataToScreenY,f=o.width,p=o.height,v=f,m=p;n.globalAlpha=1,n.strokeStyle=i,n.fillStyle=i,n.lineWidth=r,n.lineCap=B,n.lineJoin=V,n.setLineDash(me.Utils.getArrayToSetLineDash(F,r)),n.beginPath();var y,C,b,I,A,w,x,T,S=0,P=function(){for(;S<a;S++)if(!isNaN(e[S])&&!isNaN(t[S])){s=c(e[S]),d=u(t[S]),y=Z(s,d,0,v,0,m);break}0==y&&n.moveTo(s,d)};P();var k=1;for(S++;S<a;S++){if(isNaN(e[S])||isNaN(t[S]))1==k?(n.stroke(),0==Z(s,d,0,v,0,m)&&(n.beginPath(),n.arc(s,d,r/2,0,2*Math.PI),n.fill())):n.stroke(),n.beginPath(),S++,P(),k=1;else if(x=l=c(e[S]),T=h=u(t[S]),!(Math.abs(s-l)<1&&Math.abs(d-h)<1)){for(b=y,I=C=Z(l,h,0,v,0,m);y|C&&!(y&C);)A=l-s,w=h-d,y?(s<0?(d+=w*(0-s)/A,s=0):v<s?(d+=w*(v-s)/A,s=v):d<0?(s+=A*(0-d)/w,d=0):m<d&&(s+=A*(m-d)/w,d=m),y=Z(s,d,0,v,0,m)):(l<0?(h+=w*(0-l)/A,l=0):v<l?(h+=w*(v-l)/A,l=v):h<0?(l+=A*(0-h)/w,h=0):m<h&&(l+=A*(m-h)/w,h=m),C=Z(l,h,0,v,0,m));y&C||(0!=b&&n.moveTo(s,d),n.lineTo(l,h),k++),s=x,d=T,y=I}}1==k?(n.stroke(),0==Z(s,d,0,v,0,m)&&(n.beginPath(),n.arc(s,d,r/2,0,2*Math.PI),n.fill())):n.stroke()}}}(D,M,R,N,t,i)};this.renderCoreSvg=function(e,t,i){me.Area.renderSvg.call(this,e,t,i,D,m,v,C),me.Area.renderSvg.call(this,e,t,i,D,p,f,y),function(e,t){if(void 0!==D&&null!=M){var i=M.length;if(0!=i){var r,o,n,a,s,l,d,h,g,c,u,f,p,v=G.getTransform(),m=v.dataToScreenX,y=v.dataToScreenY,C=e.width,b=e.height,I=C,A=b,w=0,x=me.ColorPalette.colorFromString(R),T="rgb("+x.r+","+x.g+","+x.b+")",S=function(){t.polyline(s).style({fill:"none",stroke:T,"stroke-width":N,"stroke-opacity":x.a,"stroke-linecap":B}).attr("stroke-dasharray",me.Utils.getArrayToSetLineDash(F,N)).attr("stroke-linejoin",V)},P=function(){for(s=new Array(0);w<i;w++)if(!isNaN(D[w])&&!isNaN(M[w])){r=m(D[w]),n=y(M[w]),l=Z(r,n,0,I,0,A);break}0==l&&s.push([r,n])};P();var k=1;for(w++;w<i;w++){if(isNaN(D[w])||isNaN(M[w]))1==k?(S(),0==Z(r,n,0,I,0,A)&&(context.beginPath(),context.arc(r,n,N/2,0,2*Math.PI),context.fill())):S(),w++,P(),k=1;else if(f=o=m(D[w]),p=a=y(M[w]),!(Math.abs(r-o)<1&&Math.abs(n-a)<1)){for(h=l,g=d=Z(o,a,0,I,0,A);l|d&&!(l&d);)c=o-r,u=a-n,l?(r<0?(n+=u*(0-r)/c,r=0):I<r?(n+=u*(I-r)/c,r=I):n<0?(r+=c*(0-n)/u,n=0):A<n&&(r+=c*(A-n)/u,n=A),l=Z(r,n,0,I,0,A)):(o<0?(a+=u*(0-o)/c,o=0):I<o?(a+=u*(I-o)/c,o=I):a<0?(o+=c*(0-a)/u,a=0):A<a&&(o+=c*(A-a)/u,a=A),d=Z(o,a,0,I,0,A));l&d||(0!=h&&(S(),(s=new Array(0)).push([r,n])),s.push([o,a]),k++),r=f,n=p,l=g}}1==k?(S(),0==Z(r,n,0,I,0,A)&&t.circle(N).translate(r,n).fill(T).opacity(x.a)):S()}}}(t,i)};var Z=function(e,t,i,r,o,n){return(e<i)<<3|(r<e)<<2|(t<o)<<1|n<t};this.onDataTransformChanged=function(e){this.invalidateLocalBounds(),me.Polyline.prototype.onDataTransformChanged.call(this,e)},Object.defineProperty(this,"thickness",{get:function(){return N},set:function(e){if(e!=N){if(e<=0)throw"Polyline thickness must be positive";N=e,this.fireAppearanceChanged("thickness"),this.requestNextFrameOrUpdate()}},configurable:!1}),Object.defineProperty(this,"stroke",{get:function(){return R},set:function(e){e!=R&&(R=e,this.fireAppearanceChanged("stroke"),this.requestNextFrameOrUpdate())},configurable:!1}),Object.defineProperty(this,"lineCap",{get:function(){return B},set:function(e){e!=B&&(B=e,this.fireAppearanceChanged("lineCap"),this.requestNextFrameOrUpdate())},configurable:!1}),Object.defineProperty(this,"lineJoin",{get:function(){return V},set:function(e){e!=V&&(V=e,this.fireAppearanceChanged("lineJoin"),this.requestNextFrameOrUpdate())},configurable:!1}),Object.defineProperty(this,"fill68",{get:function(){return y},set:function(e){e!=y&&(y=e,this.fireAppearanceChanged("fill68"),this.requestNextFrameOrUpdate())},configurable:!1}),Object.defineProperty(this,"fill95",{get:function(){return C},set:function(e){e!=C&&(C=e,this.fireAppearanceChanged("fill95"),this.requestNextFrameOrUpdate())},configurable:!1}),Object.defineProperty(this,"lineDash",{get:function(){return F},set:function(e){e!=F&&(F=e,this.fireAppearanceChanged("lineDash"),this.requestNextFrameOrUpdate())},configurable:!1}),this.getLegend=function(){var r=pe("<canvas></canvas>");r[0].width=40,r[0].height=40;var o=r.get(0).getContext("2d"),e=null!=f&&null!=p;null!=v&&null!=m&&(o.globalAlpha=.5,o.strokeStyle=C,o.fillStyle=C,o.beginPath(),o.moveTo(0,0),o.lineTo(0,20),o.lineTo(20,40),o.lineTo(40,40),o.lineTo(40,20),o.lineTo(20,0),o.lineTo(0,0),o.fill(),o.stroke(),o.closePath()),e&&(o.globalAlpha=.5,o.strokeStyle=y,o.fillStyle=y,o.beginPath(),o.moveTo(0,0),o.lineTo(0,10),o.lineTo(30,40),o.lineTo(40,40),o.lineTo(40,30),o.lineTo(10,0),o.lineTo(0,0),o.fill(),o.stroke(),o.closePath()),o.strokeStyle=R,o.lineWidth=N,o.setLineDash(me.Utils.getArrayToSetLineDash(F,N)),o.moveTo(0,0),o.lineTo(40,40),o.stroke();function n(){i.text(t.name)}var t=this,i=pe("<span></span>");n(),this.host.bind("appearanceChanged",function(e,t){t&&"name"!=t||n(),o.clearRect(0,0,r[0].width,r[0].height);var i=null!=f&&null!=p;null!=v&&null!=m&&(o.globalAlpha=.5,o.strokeStyle=C,o.fillStyle=C,o.beginPath(),o.moveTo(0,0),o.lineTo(0,20),o.lineTo(20,40),o.lineTo(40,40),o.lineTo(40,20),o.lineTo(20,0),o.lineTo(0,0),o.fill(),o.stroke(),o.closePath()),i&&(o.globalAlpha=.5,o.strokeStyle=y,o.fillStyle=y,o.beginPath(),o.moveTo(0,0),o.lineTo(0,10),o.lineTo(30,40),o.lineTo(40,40),o.lineTo(40,30),o.lineTo(10,0),o.lineTo(0,0),o.fill(),o.stroke(),o.closePath()),o.setLineDash(me.Utils.getArrayToSetLineDash(F,N)),o.strokeStyle=R,o.lineWidth=N,o.moveTo(0,0),o.lineTo(40,40),o.stroke()});t=this;return{name:i,legend:{thumbnail:r,content:void 0},onLegendRemove:function(){t.host.unbind("appearanceChanged")}}},this.buildSvgLegend=function(e,t){e.height=30,t.add(t.rect(e.width,e.height).fill("white").opacity(.5));var i=null!=v&&null!=m,r=null!=f&&null!=p,o=me.ColorPalette.colorFromString(R),n="rgb("+o.r+","+o.g+","+o.b+")",a=me.ColorPalette.colorFromString(C),s="rgb("+a.r+","+a.g+","+a.b+")",l=me.ColorPalette.colorFromString(y),d="rgb("+l.r+","+l.g+","+l.b+")";i&&t.add(t.polyline([[0,0],[0,9],[9,18],[18,18],[18,9],[9,0],[0,0]]).fill(s).opacity(a.a).translate(5,5)),r&&t.add(t.polyline([[0,0],[0,4.5],[13.5,18],[18,18],[18,13.5],[4.5,0],[0,0]]).fill(d).opacity(l.a).translate(5,5)),t.add(t.line(0,0,18,18).stroke({width:N,color:n}).translate(5,5).attr("stroke-dasharray",me.Utils.getArrayToSetLineDash(F,N)));var h=$.getComputedStyle(e.legendDiv.children[0].children[1],null),g=parseFloat(h.getPropertyValue("font-size")),c=h.getPropertyValue("font-family"),u=h?h.getPropertyValue("font-weight"):void 0;t.add(t.text(this.name).font({family:c,size:g,weight:u}).translate(40,0)),t.front()},i&&void 0!==i.y&&this.draw(i)},me.Polyline.prototype=new me.CanvasPlot;var h=jQuery.Event("plotClick");me.DOMPlot=function(e,t){this.base=me.Plot,this.base(e,t);function u(i,e,t,r,o,n,a,s){if("div"!==i[0].tagName.toLowerCase())throw"DOMPlot supports only DIV elements";function l(e){var t=d.coordinateTransform.screenToPlotX,i=d.coordinateTransform.screenToPlotY,r=d.xDataTransform&&d.xDataTransform.plotToData,o=d.yDataTransform&&d.yDataTransform.plotToData,n=r?function(e){return r(t(e))}:t,a=o?function(e){return o(i(e))}:i,s=e.position();e._left=s.left+e._originX*e.width(),e._top=s.top+e._originY*e.height(),e._x=n(s.left+e._originX*e.width()),e._y=a(s.top+e._originY*e.height())}i._x=t,i._y=r,i._width=o&&0<o?o:1,i._height=n&&0<n?n:1,i._originX=a||0,i._originY=s||0,i._scale=e||"element",i.on("drag",function(e,t){l(i)}),i.on("dragstop",function(e,t){l(i),d.invalidateLocalBounds(),d.requestUpdateLayout()}),i.addClass("idd-dom-marker"),i.css("display","none").css("z-index",me.ZIndexDOMMarkers),T.push(i)}var T=[],d=this;e.children("div[data-idd-position]").each(function(){var e=pe(this),t=e.attr("data-idd-position").split(/\s+/g);if(t.length<2)throw"Position of the DOM marker should define x and y";var i,r,o,n,a,s=parseFloat(t[0]),l=parseFloat(t[1]),d=e.attr("data-idd-size");!d||2<=(o=d.split(/\s+/g)).length&&(i=parseFloat(o[0]),r=parseFloat(o[1]));var h,g=e.attr("data-idd-origin");!g||2<=(h=g.split(/\s+/g)).length&&(n=parseFloat(h[0]),a=parseFloat(h[1]));var c=e.attr("data-idd-scale");u(e,c,s,l,i,r,n,a)});function S(e){return{left:e._x-e._originX*e._width,top:e._y+e._originY*e._height}}this.computeLocalBounds=function(){var e;if(T){var t=T.length;if(0<t){for(var i=[],r=[],o=0,n=0;o<t;o++,n++){var a,s=T[o];"none"!=s._scale&&(a=S(s),i[n]=a.left,r[n]=a.top,i[++n]=a.left+s._width,r[n]=a.top-s._height)}var l,d,h=me.Utils.getMinMax(i),g=me.Utils.getMinMax(r);h&&g&&(l=this.xDataTransform&&this.xDataTransform.dataToPlot,d=this.yDataTransform&&this.yDataTransform.dataToPlot,l&&(h.min=l(h.min),h.max=l(h.max)),d&&(g.min=d(g.min),g.max=d(g.max)),e={x:h.min,y:g.min,width:h.max-h.min,height:g.max-g.min})}}return e},this.getLocalPadding=function(){return{left:0,right:0,top:0,bottom:0}},this.arrange=function(e){me.CanvasPlot.prototype.arrange.call(this,e);var t=e.width,i=e.height;this.host.css("clip","rect(0px,"+t+"px,"+i+"px,0px)")},this.renderCore=function(e,t){me.DOMPlot.prototype.renderCore.call(this,e,t);var i=T.length;if(0<i)for(var r=t.height,o=t.width,n=this.coordinateTransform.plotToScreenX,a=this.coordinateTransform.plotToScreenY,s=this.xDataTransform&&this.xDataTransform.dataToPlot,l=this.yDataTransform&&this.yDataTransform.dataToPlot,d=s?function(e){return n(s(e))}:n,h=l?function(e){return a(l(e))}:a,g=0;g<i;g++){var c,u,f,p=T[g];"none"==p._scale?(c={x:p.width(),y:p.height()},u={x:(u={x:d(p._x),y:h(p._y)}).x-p._originX*c.x,y:u.y-p._originY*c.y}):(u={x:d((f=S(p)).left),y:h(f.top)},c={x:d(f.left+p._width)-u.x,y:h(f.top-p._height)-u.y});c.y,c.x;var v,m,y,C=0,b=r,I=u.y,A=u.y+c.y,w=Math.max(C,I),x=Math.min(b,A);(y=w<x)&&(u.y,u.y,C=0,b=o,I=u.x,A=u.x+c.x,(y=(w=Math.max(C,I))<(x=Math.min(b,A)))&&(u.x,u.x,p.css("left",u.x+"px"),p.css("top",u.y+"px"),p.css("display","block"),"content"===p._scale?(v=c.x/p.width(),m=c.y/p.height(),p.css(me.CssPrefix+"-transform-origin","0% 0%"),p.css(me.CssPrefix+"-transform","scale("+v+","+m+")")):"element"===p._scale&&(p.css("width",c.x+"px"),p.css("height",c.y+"px")))),y||p.css("display","none")}},this.onIsRenderedChanged=function(){if(this.isRendered)for(e=T.length,t=0;t<e;t++){T[t].css("z-index",me.ZIndexDOMMarkers)}else for(var e=T.length,t=0;t<e;t++){T[t].css("display","none")}},this.clear=function(){for(var e=T.length,t=0;t<e;t++){T[t].remove()}T=[],this.invalidateLocalBounds(),this.requestUpdateLayout()},this.add=function(e,t,i,r,o,n,a,s){var l=pe(e);return this.host[0].contains(l[0])||l.appendTo(this.host),u(l,t,i,r,o,n,a,s),this.invalidateLocalBounds(),this.requestUpdateLayout(),l.get(0)};function l(t){var e=jQuery.grep(T,function(e){return e[0]===t});if(e&&0<e.length)return e[0]}this.remove=function(e){function t(e){var t=l(e[0]);t&&T.splice(T.indexOf(t),1),e.remove()}e.jquery?t(e):t(pe(e)),this.invalidateLocalBounds(),this.requestUpdateLayout()},this.set=function(e,t,i,r,o,n,a){var s=l(e);if(!s)throw"Element is not found in the plot";s._x=t,s._y=i,"none"!=s.scale&&(r&&0<r&&(s._width=r),o&&0<o&&(s._height=o)),s._originX=n||s._originX,s._originY=a||s._originY,this.invalidateLocalBounds(),this.requestUpdateLayout()},this.enableClickablePanel=!1,d.master.centralPart.click(function(e){var t,i,r,o,n,a,s,l;d.enableClickablePanel&&(t=d.coordinateTransform.screenToPlotX,i=d.coordinateTransform.screenToPlotY,r=d.xDataTransform&&d.xDataTransform.plotToData,n=(o=d.yDataTransform&&d.yDataTransform.plotToData)?function(e){return o(i(e))}:i,s=(r?function(e){return r(t(e))}:t)((a=me.Gestures.getXBrowserMouseOrigin(d.master.centralPart,e)).x),l=n(a.y),d.host.trigger(h,{x:s,y:l}))}),Object.defineProperty(this,"domElements",{get:function(){return T.slice(0)},configurable:!1})},me.DOMPlot.prototype=new me.Plot,me.GridlinesPlot=function(e,t){var l,d;this.base=me.CanvasPlot,this.base(e,t);var h="1px",g="LightGray",i={};me.Utils.readStyle(this.host,i),g=void 0!==i.stroke?i.stroke:g,h=void 0!==i.thickness?i.thickness:h,Object.defineProperty(this,"xAxis",{get:function(){return l},set:function(e){e!=l&&(l=e,this.requestUpdateLayout())},configurable:!1}),Object.defineProperty(this,"yAxis",{get:function(){return d},set:function(e){e!=d&&(d=e,this.requestUpdateLayout())},configurable:!1}),Object.defineProperty(this,"thickness",{get:function(){return h},set:function(e){if(e!=h){if(e<=0)throw"GridLines thickness must be positive";h=e,this.requestNextFrameOrUpdate()}},configurable:!1}),Object.defineProperty(this,"stroke",{get:function(){return g},set:function(e){e!=g&&(g=e,this.requestNextFrameOrUpdate())},configurable:!1});function c(){var e,t;l||(e=this.host.attr("data-idd-xaxis"))&&(t=this.master.get(e))&&(l=t),d||(e=this.host.attr("data-idd-yaxis"))&&(t=this.master.get(e))&&(d=t)}this.renderCore=function(e,t){me.GridlinesPlot.prototype.renderCore.call(this,e,t),c.call(this);var i=this.getContext(!0);i.strokeStyle=g,i.fillStyle=g,i.lineWidth=1;var r,o=parseInt(h.slice(0,-2)),n=[];l&&(n=l.ticks);for(var a=0,s=n.length;a<s;a++)n[a].invisible||(r=l.getCoordinateFromTick(n[a].position),i.fillRect(r,0,o,t.height));n=[],d&&(n=d.ticks);for(a=0,s=n.length;a<s;a++)n[a].invisible||(r=t.height-1-d.getCoordinateFromTick(n[a].position),i.fillRect(0,r,t.width,o))},this.renderCoreSvg=function(e,t,i){c.call(this);var r,o={width:parseInt(h.slice(0,-2)),color:g},n=[];l&&(n=l.ticks);for(var a=0,s=n.length;a<s;a++)if(!n[a].invisible){if((r=l.getCoordinateFromTick(n[a].position))<0||r>t.width)continue;i.polyline([[r,0],[r,t.height-1]]).stroke(o).fill("none")}n=[],d&&(n=d.ticks);for(a=0,s=n.length;a<s;a++)if(!n[a].invisible){if((r=t.height-1-d.getCoordinateFromTick(n[a].position))<0||r>t.height)continue;i.polyline([[0,r],[t.width-1,r]]).stroke(o).fill("none")}}},me.GridlinesPlot.prototype=new me.CanvasPlot,me.BoundaryLinePlot=function(e,t){var d,h,g=this;this.base=me.CanvasPlot,this.base(e,t);var i,c="1px",u="Gray",f="";void 0!==d||void 0!==h||(i=me.Utils.getDataSourceFunction(e,me.readCsv)(e))&&(i.x?d=i.x:i.y&&(h=i.y),i.thickness&&(c=i.thickness),i.stroke&&(u=i.stroke),i.lineDash&&(f=i.lineDash));var r={};me.Utils.readStyle(this.host,r),u=void 0!==r.stroke?r.stroke:u,c=void 0!==r.thickness?r.thickness:c,Object.defineProperty(this,"x",{get:function(){return d},set:function(e){e!=d&&(d=e,this.requestUpdateLayout())},configurable:!1}),Object.defineProperty(this,"y",{get:function(){return h},set:function(e){e!=h&&(h=e,this.requestUpdateLayout())},configurable:!1}),Object.defineProperty(this,"thickness",{get:function(){return c},set:function(e){if(e!=c){if(e<=0)throw"Boundary line thickness must be positive";c=e,this.requestNextFrameOrUpdate()}},configurable:!1}),Object.defineProperty(this,"stroke",{get:function(){return u},set:function(e){e!=u&&(u=e,this.requestNextFrameOrUpdate())},configurable:!1}),Object.defineProperty(this,"lineDash",{get:function(){return f},set:function(e){e!=f&&(f=e,this.requestNextFrameOrUpdate())},configurable:!1}),this.renderCore=function(e,t){me.BoundaryLinePlot.prototype.renderCore.call(this,e,t);var i=this.getContext(!0);i.strokeStyle=u,i.fillStyle=u,i.setLineDash(me.Utils.getArrayToSetLineDash(f,c)),i.lineWidth=parseInt(c);var r,o,n=g.getTransform(),a=n.dataToScreenX,s=n.dataToScreenY;i.font="10px serif",void 0!==d&&(r=a(d),parseInt(c)%2&&(r+=.5),i.beginPath(),i.moveTo(r,0),i.lineTo(r,t.height),i.stroke(),i.translate(r-3,t.height-10),i.rotate(-Math.PI/2),this.name?i.fillText(this.name,0,0):i.fillText("x = "+d,0,0),i.rotate(Math.PI/2),i.translate(3-r,10-t.height)),void 0!==h&&(o=s(h),parseInt(c)%2&&(o+=.5),i.beginPath(),i.moveTo(0,o),i.lineTo(t.width,o),i.stroke(),this.name?i.fillText(this.name,10,o-3):i.fillText("y = "+h,10,o-3))},this.renderCoreSvg=function(e,t,i){var r,o,n=g.getTransform(),a=n.dataToScreenX,s=n.dataToScreenY,l={width:parseInt(c),color:u};void 0===d||0<(r=a(d))&&r<t.width&&(i.polyline([[r,0],[r,t.height-1]]).stroke(l).attr("stroke-dasharray",me.Utils.getArrayToSetLineDash(f,parseInt(c))).fill("none"),this.name?i.text(this.name,0,0).rotate(-90,0,0).translate(r-16,t.height-10).font({family:"serif",size:10,fill:u}):i.text("x = "+d,0,0).rotate(-90,0,0).translate(r-16,t.height-10).font({family:"serif",size:10,fill:u})),void 0===h||0<(o=s(h))&&o<t.height&&(i.polyline([[0,o],[t.width-1,o]]).stroke(l).attr("stroke-dasharray",me.Utils.getArrayToSetLineDash(f,parseInt(c))).fill("none"),this.name?i.text(this.name).transform({x:10}).transform({y:o-18},!0).font({family:"serif",size:10,fill:u}):i.text("y = "+h).transform({x:10}).transform({y:o-18},!0).font({family:"serif",size:10,fill:u}))},this.draw=function(e){void 0!==e.x&&(this.x=e.x),void 0!==e.y&&(this.y=e.y),void 0!==e.thickness&&(this.thickness=e.thickness),void 0!==e.stroke&&(this.stroke=e.stroke),this.invalidateLocalBounds(),this.requestNextFrameOrUpdate(),this.fireAppearanceChanged()}},me.BoundaryLinePlot.prototype=new me.CanvasPlot}();(me=me||{}).SubplotsTrapPlot=function(e,t){this.base=me.Plot,this.base(e,t),e&&(this.renderCallback=function(e){},this.suppressRenderCallback=!1,this.renderCore=function(e,t){var i,r,o,n,a,s,l;me.SubplotsTrapPlot.prototype.renderCore.call(this,e,t),this.suppressRenderCallback||(i=this.xDataTransform&&this.xDataTransform.plotToData?this.xDataTransform.plotToData:function(e){return e},r=this.yDataTransform&&this.yDataTransform.plotToData?this.yDataTransform.plotToData:function(e){return e},o=i(e.x),n=i(e.x+e.width),a=r(e.y),l={x_min:n<o?n:o,x_max:n<o?o:n,y_min:(s=r(e.y+e.height))<a?s:a,y_max:s<a?a:s},this.renderCallback(l))},this.renderCoreSvg=function(e,t,i){})},me.factory["subplots-trap"]=function(e,t){return new me.SubplotsTrapPlot(e,t)},me.SubplotsTrapPlot.prototype=new me.Plot,me.SubPlots=function(e){if(!e)throw"SubPlots must be applied to <div> element";if(1!==e.children.length&&2!==e.children.length)throw"SubPlots div must contain one or two child elements: optional element div (subplots title) and mandatory element table";var t=pe(e).children().last()[0];if(!t)throw"SubPlots div should contain at least one <div> element";if(1!==t.children.length)throw"SubPlots child div must contain exactly one child element which is a <table>";var i=t.children[0];if(!i||"TABLE"!=i.nodeName)throw"SubPlots child div must contain exactly one child element which is a <table>";var r,R=t,B=i,V=e;pe(V).css("flex-direction","column"),pe(R).addClass("idd-subplots-legendholder"),2===e.children.length&&(r=pe(e).children()[0],pe(r).addClass("idd-subplots-title"));var F=0,Z=[],L=[],z=[],U=[],Y=[],O=[],W=[],X=void 0,E=void 0,H=pe(R).attr("data-idd-horizontal-binding"),j=pe(R).attr("data-idd-vertical-binding"),H=void 0!==H&&("true"===H||"enabled"===H),j=void 0!==j&&("true"===j||"enabled"===j),K=this;this.renderSVG=function(){for(var e="div[data-idd-plot='plot']",t="div[data-idd-axis]",i="div.idd-subplot-title",r="div.idd-horizontalTitle",o="div.idd-verticalTitle",n="div.idd-legend",a="div.idd-subplots-title",s=pe(V).find(e+", "+t+", "+i+", "+r+", "+o+", "+n+", "+a),l=[],d=document.createElementNS("http://www.w3.org/2000/svg","svg"),h=ve(d).size(pe(V).width(),pe(V).height()),g=h.nested(),c=[],u=[],f=pe(V).offset(),p=0;p<s.length;p++){c[p]=pe(s[p]).offset().left-f.left,u[p]=pe(s[p]).offset().top-f.top+1;var v=pe(s[p]);if(v.is(i+", "+r+", "+o+", "+a)){var m=h.text(s[p].innerText);if(l[p]=m.font({family:pe(s[p]).css("font-family"),size:pe(s[p]).css("font-size"),weight:pe(s[p]).css("font-weight")}),v.is(o))switch(pe(s[p]).css("vertical-align")){case"top":l[p].move(c[p],u[p]);break;case"bottom":l[p].move(c[p],u[p]+pe(s[p]).height()-l[p].bbox().w),l[p].rotate(-90,c[p],u[p]+pe(s[p]).height()-l[p].bbox().w);break;default:l[p].move(c[p],u[p]+pe(s[p]).height()/2+l[p].bbox().w/2),l[p].rotate(-90,c[p],u[p]+pe(s[p]).height()/2+l[p].bbox().w/2)}else switch(pe(s[p]).css("text-align")){case"left":l[p].move(c[p],u[p]);break;case"right":l[p].move(c[p]+pe(s[p]).width()-l[p].bbox().w,u[p]);break;default:l[p].move(c[p]+pe(s[p]).width()/2-l[p].bbox().w/2,u[p])}}else{if(v.is(e)){var y=pe(s[p]).parent().width(),C=pe(s[p]).parent().height(),b=h.polyline("0,0 "+y+",0 "+y+","+C+" 0,"+C+" 0,0").fill("none");b.stroke({color:"#808080",width:1}).move(c[p],u[p]),b.attr("shape-rendering","crispEdges"),g.add(b);var I=me.asPlot(v);l[p]=I.exportToSvg(),c[p]+=parseFloat(pe(s[p]).css("border-left-width").replace("px","")),u[p]+=parseFloat(pe(s[p]).css("border-top-width").replace("px",""))}else if(v.is(t))l[p]=v[0].axis.exportToSvg();else{if(!v.is(n))throw"Unexpected element type. SVG export failure";l[p]=Z[X][E].exportLegendToSvg(v[0])}l[p].move(c[p],u[p])}g.add(l[p])}return h},function(){var e=pe("tr",B);F=e.length,Z=new Array(F/3),L=new Array(F/3),W=new Array(F/3),O=new Array(F/3);function l(e,t,i){var r,o,n,a,s=pe("div[data-idd-axis]",i),l=s.length;0<l&&(1<l?console.warn("subplots: work with multiple axes in a single slot is not implemented"):(r=me.InitializeAxis(s),z.push(r),Y.push([e,t]),o=e%3==1,U.push(o),n=Math.floor(e/3),a=Math.floor(t/3),r.associatedPlotRow=n,r.associatedPlotCol=a,o?W[n][a]=r:O[n][a]=r))}e.each(function(a){var s,e=pe("td",this);_NCol=e.length,(a-1)%3==0?(s=Math.floor(a/3),Z[s]=new Array(_NCol/3),L[s]=new Array(_NCol/3),W[s]=new Array(_NCol/3),O[s]=new Array(_NCol/3),e.each(function(e){var t,i,r,o,n;(e-1)%3==0?0<(t=pe("div[data-idd-plot='plot']",this)).length&&(i=Math.floor(e/3),r=me.asPlot(t),(Z[s][i]=r).subplotRowIdx=s,r.subplotColIdx=i,L[s][i]=me.asPlot(pe("div[data-idd-plot='subplots-trap']",this)),o={},me.Utils.readStyle(t,o),"true"===(void 0!==o.isLegendVisible?o.isLegendVisible:"true")&&(n=pe("<div style='z-index: 10;'></div>").appendTo(t),new me.Legend(r,n,!0),n.css("float","right"),me.Gestures.FullEventList.forEach(function(e){n[0].addEventListener(e,function(e){e.stopPropagation()},!1)}))):l(a,e,this)})):e.each(function(e){l(a,e,this)})});var t={},i=void 0;(t=me.Utils.readStyle(pe(R),t))&&t["subplots-margin"]?(i=t["subplots-margin"],pe(R).find("td div.idd-subplots-margin-left").css("padding-left",i),pe(R).find("tr").find("td div.idd-subplots-margin-left:first").css("padding-left",""),pe(R).find("td div.idd-subplots-margin-bottom").css("padding-bottom",i),pe(R).find("tr").last().find("td div.idd-subplots-margin-bottom").css("padding-bottom","")):i=pe(R).find("td div.idd-axis").parent().css("padding-left");var r=R.getAttribute("data-idd-ext-legend");if(r){var o=r.split(" ");if(3!==o.length)throw"data-idd-ext-legend attribute bust contain string in format 'placement plotRowIdx plotColIdx'";var n=o[0];X=parseInt(o[1]),E=parseInt(o[2]);var a=Z[X][E],s=pe("<div></div>");switch(n.trim().toLowerCase()){case"left":case"top":s.prependTo(R);break;case"right":case"bottom":s.appendTo(R);break;default:throw"Unexpected external legend placement"}switch(n.trim().toLowerCase()){case"left":pe(R).css("flex-direction","row"),i&&s.css("margin-right",i);break;case"right":pe(R).css("flex-direction","row"),i&&s.css("margin-left",i);break;case"top":pe(R).css("flex-direction","column"),i&&s.css("margin-bottom",i);break;case"bottom":pe(R).css("flex-direction","column"),i&&s.css("margin-top",i);break;default:throw"Unexpected external legend placement"}new me.Legend(a,s,!1,void 0,!0)}for(var d=0;d<z.length;d++){var h=z[d],g=Y[d][0],c=Y[d][1],u=Math.floor(g/3),f=Math.floor(c/3),p=Z[u][f];h.dataTransform=g%3==1?p.yDataTransform:p.xDataTransform}pe("div[data-idd-plot='grid']",B).each(function(e){var t,i=this.plot,r=i.master,o=r.subplotRowIdx,n=r.subplotColIdx,a=O[o][n];a?i.xAxis=a:!H||-1!==(t=function(e,t){for(var i=0;i<e.length;i++)if(e[i]&&e[i][t])return i;return-1}(O,n))&&(i.xAxis=O[t][n]);var s,l=W[o][n];l?i.yAxis=l:!j||-1!==(s=function(e){for(var t=0;t<e.length;t++)if(e[t])return t;return-1}(W[o]))&&(i.yAxis=W[o][s])});for(d=0;d<Z.length;d++)for(var v,m,y,C,b,I,A,w,x,T,S=Z[d],P=0;P<S.length;P++){!(p=S[P])||(v=pe(p.host).attr("data-idd-navigation-enabled"))&&"true"===v&&((m=pe(p.host)).dblclick(function(){this.plot.master.fitToView()}),y=p.master.subplotRowIdx,C=p.master.subplotColIdx,A=me.Gestures.getGesturesStream(m),(b=O[y][C])&&(x=b.host,I=me.Gestures.applyHorizontalBehavior(me.Gestures.getGesturesStream(x)),A=A.merge(I),x.dblclick(function(){var e=this.axis;Z[e.associatedPlotRow][e.associatedPlotCol].fitToViewX()})),(w=W[y][C])&&(x=w.host,T=me.Gestures.applyVerticalBehavior(me.Gestures.getGesturesStream(x)),A=A.merge(T),x.dblclick(function(){var e=this.axis;Z[e.associatedPlotRow][e.associatedPlotCol].fitToViewY()})),p.navigation.gestureSource=A)}function k(e){if(!M){M=!0,yRange={min:e.y_min,max:e.y_max},xRange={min:e.x_min,max:e.x_max};var t,i,r=this.master,o=r.subplotRowIdx,n=r.subplotColIdx;H||(t=O[o][n])&&t.update(xRange),j||(i=W[o][n])&&i.update(yRange);for(var a=0;a<z.length;a++){var s=z[a];U[a]&&j?s.update(yRange):!U[a]&&H&&s.update(xRange)}if(H||j)for(a=0;a<Z.length;a++)for(var l=Z[a],d=0;d<l.length;d++){var h,g=l[d];g!==this.master&&(h=g.visibleRect,H&&(h.x=e.x_min,h.width=e.x_max-e.x_min),j&&(h.y=e.y_min,h.height=e.y_max-e.y_min),g.navigation.setVisibleRect(h,!1,{suppressNotifyBoundPlots:!0,forceOnlyUpdatePlotsOutput:!0,syncUpdate:!0}))}M=!1}}for(var M=!1,d=0;d<L.length;d++)for(S=L[d],P=0;P<S.length;P++){var D=S[P];D&&(D.renderCallback=k)}function G(e,t){for(var i=0;i<Z.length;i++)for(var r=0;r<Z[i].length;r++)for(var o=Z[i][r].getPlotsSequence(),n=0;n<o.length;n++)0<t.name.length&&o[n].name===t.name&&o[n].isVisible!==t.isVisible&&(o[n].isVisible=t.isVisible)}var N=pe(R).attr("data-idd-common-visibility");if(N&&("true"===N||"enabled"===N))for(d=0;d<Z.length;d++)for(P=0;P<Z[d].length;P++)Z[d][P]&&Z[d][P].host.bind("visibleChanged",G);V.subplots=K}()},me.asSubPlots=function(e){return e&&void 0!==e.subplots?e.subplots:new me.SubPlots(e)},me.readTable=function(e){var i={};me.Utils.readStyle(e,i);var t=e.children("table:first-child");if(t&&0<t.length){t.toggle();var r=t.children("tbody").children("tr");if(r&&0<r.length){var o=r.first(),n=[];o.children("th").each(function(e){var t=pe(this).text();n[e]=t,i[t]=[]});var a=r.toArray();if(a)for(var s=a.length,l=n.length,d=1;d<s;d++)for(var h=pe(a[d]).children("td").toArray(),g=0;g<l;g++)i[n[g]][d-1]=parseFloat(pe(h[g]).text())}}return i},me.Utils.getAndClearTextContent=function(e){e[0].normalize();var t=e.contents().filter(function(){return 3==this.nodeType&&!(!this.data||""==this.data.trim())})[0];if(t&&t.data){var i=t.wholeText;return void 0!==t.replaceWholeText?t.replaceWholeText(""):t.data="",i}},me.readCsv=function(e){var t={};me.Utils.readStyle(e,t);var i=me.Utils.getAndClearTextContent(e);if(i){function r(e){return e.split(/\s+/g)}var o=(i=i.trim()).split(/\n/g),n=o.length-1;if(0<n){for(var a=r(o[0]),s=a[0]?0:1,l=s;l<a.length;l++)t[a[l-s]]=[];for(var d=0;d<n;d++)for(var h=r(o[d+1]),l=s=h[0]?0:1;l<h.length;l++){var g=parseFloat(h[l]);isNaN(g)?t[a[l-s]][d]=h[l]:t[a[l-s]][d]=g}for(l=0;l<a.length;l++){var c=a[l].split(".");1<c.length&&(t[c[0]]||(t[c[0]]={}),t[c[0]][c[1]]=t[a[l]],delete t[a[l]])}}}return t},me.readCsv2d=function(e){var t={};me.Utils.readStyle(e,t);var i=me.Utils.getAndClearTextContent(e);if(i){function r(e){return e.trim().split(/\s+/g)}var o=(i=i.trim()).split(/\n/g),n=o.length-1;if(0<n){var a=r(o[0]),s=a.length-1;if(0<s){for(var l=new Array(s),d=new Array(n),h=new Array(s),g=1;g<=s;g++)h[g-1]=new Array(n),l[g-1]=parseFloat(a[g]);for(var c=1;c<=n;c++){var u=r(o[c]);d[c-1]=parseFloat(u[0]);for(g=1;g<=s;g++)h[g-1][c-1]=parseFloat(u[g])}t.x=l,t.y=d,t.values=h}}}return t},me.readBase64=function(e){function t(e){var t=e[0].split("."),i=t[0];switch(t[1]){case"1D":if("string"==i)return s=e[1].split(",").map(atob);var r=me.Utils.base64toByteArray(e[1]);return s=me.Utils.byteArrayToTypedArray(r,i);case"2D":var o=parseInt(e[1]),r=me.Utils.base64toByteArray(e[2]),n=me.Utils.byteArrayToTypedArray(r,i);if(n.length%o!=0)throw"InnerDimLen is not divisor of decoded flattened array len";for(var a=n.length/o,s=new Array(a),l=0;l<a;l++)s[l]=n.slice(l*o,(l+1)*o);return s;default:throw"Unexpected dimensionality specified ("+e[0]+")"}}var i={};me.Utils.readStyle(e,i);var r=me.Utils.getAndClearTextContent(e);if(r)for(var o=(r=r.trim()).split(/\n/g),n=o.length,a=0;a<n;a++){var s=o[a].trim().split(/\s+/g),l=s[0];s.splice(0,1);var d=t(s);i[l]=d}return i},me.InitializeAxis=function(e,t){if(e.hasClass("idd-axis"))throw"The div element already is initialized as an axis";switch(e.attr("data-idd-axis")){case"numeric":return e.axis=new me.NumericAxis(e),e.axis;case"log":return e.axis=new me.LogarithmicAxis(e),e.axis;case"labels":return void 0===t&&(t=me.Utils.getDataSourceFunction(e,me.readCsv)(e)),e.axis=new me.LabelledAxis(e,t),e.axis}},me.TicksRenderer=function(r,e){var S,P,k,M,D,G,N,t,R,B,V,F,Z,L,o,z,U,Y,O,W,x,T,i,X,E,H,j,n,K;"undefined"!=typeof Modernizr&&r&&(Modernizr.canvas||r.replaceWith('<div">Browser does not support HTML5 canvas</div>')),r&&r.hasClass("idd-axis")||(r&&(r[0].axis=this),S=this,k="",(P=r)&&(k=r.attr("data-idd-placement")),M="top"==k||"bottom"==k,D={min:0,max:1},G=e,N=[],t=me.Utils.generateNextIntId(),R=pe("<canvas id='canvas_"+t+"' style='position:relative; float:left'></canvas>"),B=pe("<div id='labelsDiv_"+t+"' style='position:relative; float:left'></div>"),r&&("bottom"==k||"right"==k?(r[0].appendChild(R[0]),r[0].appendChild(B[0])):(r[0].appendChild(B[0]),r[0].appendChild(R[0])),V=me.tickLength+1,M?R[0].height=V:(R[0].width=V,"right"==k?B.css("left",3):R.css("left",3))),this.updateSize=function(){var e,t,i=L;r&&(e=r.outerWidth(!1),t=r.outerHeight(!1),M?(L=F=e)!=i&&(R[0].width=L,B.css("width",F)):(L=Z=t)!=i&&(R[0].height=L,B.css("height",Z))),o=(L-1)/(D.max-D.min),R[0].height},U=-1,Y=me.tickLength/3,O=P?P.css("color"):"Black",(W=R.get(0).getContext("2d")).strokeStyle=O,W.fillStyle=O,W.lineWidth=1,T=!(x=12),i="",P&&(P[0].currentStyle?(x=P[0].currentStyle["font-size"],i=P[0].currentStyle["font-family"]):document.defaultView&&document.defaultView.getComputedStyle?(x=document.defaultView.getComputedStyle(P[0],null).getPropertyValue("font-size"),i=document.defaultView.getComputedStyle(P[0],null).getPropertyValue("font-family")):P[0].style&&(x=P[0].style["font-size"],i=P[0].style["font-family"]),W.font=x+i),Object.defineProperty(this,"host",{get:function(){return P},configurable:!1}),Object.defineProperty(this,"mode",{get:function(){return k},configurable:!1}),Object.defineProperty(this,"tickSource",{get:function(){return G},set:function(e){G=e,B.empty(),n()},configurable:!1}),Object.defineProperty(this,"range",{get:function(){return D},configurable:!1}),Object.defineProperty(this,"ticks",{get:function(){return N},configurable:!1}),Object.defineProperty(this,"DesiredSize",{get:function(){return{width:F,height:Z}},configurable:!1}),Object.defineProperty(this,"axisSize",{get:function(){return L},configurable:!1}),Object.defineProperty(this,"deltaRange",{get:function(){return o},configurable:!1}),Object.defineProperty(this,"FontSize",{get:function(){return _defaultFontSize},set:function(e){T=!0,x=e+"px",W.font=x+i,G.invalidate(),S.update()},configurable:!1}),Object.defineProperty(this,"rotateAngle",{get:function(){return z/Math.PI*180},set:function(e){z=e*Math.PI/180,G.invalidate(),S.update()},configurable:!1}),this.sizeChanged=!0,X=void 0,Object.defineProperty(this,"dataTransform",{get:function(){return X},set:function(e){X=e,n()},configurable:!1}),E=[],H=function(e){var t=e.length;E=new Array(t);for(var i=0;i<t;i++){var r,o,n,a,s,l,d,h,g=e[i];g.label?(n=(l=g.label._size).width,a=l.height,0!=n&&0!=a||("string"==typeof(r=G.getInner(g.position))?(n=(o=W.measureText(r)).width,a=o.height):(n=(s=pe("<div></div>").append(pe(r)).css({display:"block",visibility:"hidden",position:"absolute"}).appendTo(pe("body"))).width(),a=s.height(),s.remove())),d=z?n*Math.abs(Math.cos(z))+a*Math.abs(Math.sin(z)):n,h=z?n*Math.abs(Math.sin(z))+a*Math.abs(Math.cos(z)):a,E[i]={position:S.getCoordinateFromTick(g.position),width:d,height:h,hasLabel:!0}):E[i]={position:S.getCoordinateFromTick(g.position),width:0,height:0,hasLabel:!1}}},j=function(e){var t,i,r=e.length-1;if(K(e),H(e),-1==r)return 1;for(var o=0,n=0;n<r;){for(o=n,n++;n<1+r&&!E[n].hasLabel;)n++;if(r<n)break;if(E[o].hasLabel){if((t=Math.abs(E[n].position-E[o].position))<me.minTickSpace)return-1;if(M?(i=(E[o].width+E[n].width)/2,0==o&&E[o].position-E[o].width/2<0?i-=E[o].width/2:n==r-1&&E[n].position-E[n].width/2>L&&(i-=E[n].width/2)):(i=(E[o].height+E[n].height)/2,0==o&&E[o].position-E[o].height/2<0?i-=E[o].height/2:n==r-1&&E[n].position-E[n].height/2>L&&(i-=E[n].height/2)),t-i<me.minLabelSpace)return-1}}for(var a=1,o=n=0;n<r;){for(o=n,n++;n<1+r&&!E[n].hasLabel;)n++;if(r<n)break;if(E[o].hasLabel&&(t=Math.abs(E[n].position-E[o].position),M?(i=(E[o].width+E[n].width)/2,0==o&&E[o].position-E[o].width/2<0?i-=E[o].width/2:n==r-1&&E[n].position-E[n].width/2>L&&(i-=E[n].width/2)):(i=(E[o].height+E[n].height)/2,0==o&&E[o].position-E[o].height/2<0?i-=E[o].height/2:n==r-1&&E[n].position-E[n].height/2>L&&(i-=E[n].height/2)),t-i<me.minLabelSpace)){a=0;break}}return a},this.getCoordinateFromTick||(this.getCoordinateFromTick=function(e){return e}),n=function(){var e,t;S.updateSize(),N=X?(e=X.plotToData(D.min),t=X.plotToData(D.max),G.getTicks({min:Math.min(e,t),max:Math.max(e,t)})):G.getTicks(D);var i,r,o=j(N),n=0;if(-1==o)for(;n++<me.maxTickArrangeIterations&&(i=G.decreaseTickCount(),r=j(i),N=i,-1==r););if(1==o)for(;n++<me.maxTickArrangeIterations;){if(i=G.increaseTickCount(),-1==(r=j(i))){N=G.decreaseTickCount(),H(N),K(N);break}if(N=i,0==r)break}z&&(N=G.updateTransform(o,z,M)),G.getMinTicks&&(-1==r&&n>me.maxTickArrangeIterations||N.length<2)&&0<(i=G.getMinTicks()).length&&(K(N=i),H(N)),2==N.length&&(K(N),H(N),2!=N.length||E[1].position-E[0].position-(M?(E[0].width+E[1].width)/2:(E[0].height+E[1].height)/2)<me.minLabelSpace&&0);var a=N.length,s=U;if(U=0,this.sizeChanged=!1,M){for(var l=0;l<a;l++)U=Math.max(U,E[l].height);U!=s&&0!=U&&(B.css("height",U),R[0].height=V,Z=U+V,P.css("height",Z),this.sizeChanged=!0)}else{for(l=0;l<a;l++)U=Math.max(U,E[l].width);U!=s&&0!=U&&(B.css("width",U),R[0].width=V,F=U+V+3,P.css("width",F),this.sizeChanged=!0)}W.strokeStyle=O,W.fillStyle=O,M?(W.clearRect(0,0,L,V),"bottom"==k?W.fillRect(0,0,L,1):W.fillRect(0,me.tickLength,L,1)):(W.clearRect(0,0,V,L),"right"==k?W.fillRect(0,0,1,L):W.fillRect(me.tickLength,0,1,L));for(l=0;l<a;l++){var d=N[l],h=E[l];I=h.position;var g=void 0,c=void 0;0<l&&(c=E[l-1]),l<a-1&&(g=E[l+1]);var u,f,p,v,m,y,C,b,I,A=c&&g&&!c.hasLabel&&!g.hasClass&&h.hasLabel&&d.invisible;M?(d.invisible||W.fillRect(I,1,1,me.tickLength),d.label&&(p=void 0,u=h.width,f=d.label._size.width,p=A?c.position<0?g.position>=u?(y=.5*(0+g.position))-.5*f:g.position-.5*(u+f):g.position>L?L-c.position>=u?(y=.5*(c.position+L))-.5*f:c.position-.5*(f-u):I-f/2:I-f/2,d.label.css("left",p))):(I=L-1-I,N[l].invisible||W.fillRect(1,I,me.tickLength,1),d.label&&(v=h.height,m=d.label._size.height,A?c.position<0?(b=g.position>=v?(y=.5*(0+g.position),L-1-(C=y+.5*m)):(C=g.position-.5*(v-m),L-1-C),d.label.css("top",b)):g.position>L?(b=L-c.position>=v?(y=.5*(c.position+L),L-1-(C=y+.5*m)):(C=c.position+.5*(v+m),L-1-C),d.label.css("top",b)):d.label.css("top",I-m/2):d.label.css("top",I-m/2)))}var w=G.getSmallTicks(N);if(0<w.length){for(var x=Math.abs(S.getCoordinateFromTick(w[1])-S.getCoordinateFromTick(w[0])),T=1;T<w.length-1;T++)x=Math.min(x,Math.abs(S.getCoordinateFromTick(w[T+1])-S.getCoordinateFromTick(w[T])));if(x>=me.minTickSpace)for(l=0,a=w.length;l<a;l++)I=S.getCoordinateFromTick(w[l]),"bottom"==k?W.fillRect(I,1,1,Y):"top"==k?W.fillRect(I,me.tickLength-Y,1,Y):"left"==k?W.fillRect(me.tickLength-Y,L-1-I,Y,1):"right"==k&&W.fillRect(1,L-1-I,Y,1)}},this.renderToSvg=function(e){function t(e,t,i){a+="M"+e+" "+t+"h"+i}function i(e,t,i){a+="M"+e+" "+t+"v"+i}var r,o=S.host.height(),n=S.host.width(),a="";M?(r=Z-1,"bottom"==k?(t(0,0,L),me.tickLength):t(0,r,L)):(r=F-1,"right"==k?(i(0,0,L),me.tickLength):i(r,0,L));if(e.size(n,o),0<(w=N.length)){var s=void 0;for(C=0;C<N.length;C++)if(N[C]&&N[C].label){s=N[C].label[0];break}var l=(h=$.getComputedStyle(s,null))?h.getPropertyValue("font-family"):void 0,d=T?x:h?parseFloat(h.getPropertyValue("font-size")):void 0}for(var h,g,c,u,f,p=S.host.offset(),v=B.offset(),m=v.left-p.left,y=v.top-p.top,C=0;C<w;C++){f=E[C].position,!N[C].label&&(f<0||L<f)||(E[C].width,M?(N[C].invisible||("top"==k?i(f,r,-me.tickLength):i(f,0,me.tickLength)),N[C].label&&(h=N[C].label instanceof jQuery?$.getComputedStyle(N[C].label[0],null):$.getComputedStyle(N[C].label,null),g=parseFloat(h.getPropertyValue("Left")),c=0,N[C].label.normalShift&&(c=N[C].label.normalShift),(u=G.renderToSvg(N[C],e).font({family:l,size:d})).transform({x:g+m}),u.transform({y:c+y-1},!0),z&&u.transform({rotation:S.rotateAngle},!0))):(f=L-1-f,N[C].invisible||("left"==k?t(r,f,-me.tickLength):t(0,f,me.tickLength)),N[C].label&&(h=N[C].label instanceof jQuery?$.getComputedStyle(N[C].label[0],null):$.getComputedStyle(N[C].label,null),g=0,N[C].label.normalShift&&(g=N[C].label.normalShift),c=parseFloat(h.getPropertyValue("Top")),(u=G.renderToSvg(N[C],e).font({family:l,size:d})).transform({x:g+m}),u.transform({y:c+y},!0),z&&u.transform({rotation:S.rotateAngle},!0))))}var b=G.getSmallTicks(N);if(0<b.length){for(var I=Math.abs(S.getCoordinateFromTick(b[1])-S.getCoordinateFromTick(b[0])),A=1;A<b.length-1;A++)I=Math.min(I,Math.abs(S.getCoordinateFromTick(b[A+1])-S.getCoordinateFromTick(b[A])));if(I>=me.minTickSpace)for(var C=0,w=b.length;C<w;C++)f=S.getCoordinateFromTick(b[C]),"bottom"==k?i(f,0,Y):"top"==k?i(f,r,-Y):"left"==k?t(r,L-f,-Y):"right"==k&&t(.5,L-f,Y)}e.path(a).stroke(O).fill("none")},this.exportToSvg=function(){if(!ve.supported)throw"SVG is not supported";var e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=ve(e).size(P.width(),P.height());return S.renderToSvg(t),t},K=function(e){for(var t,i,r=0,o=e.length;r<o;r++){(i=e[r].label)&&!i.hasClass("idd-axis-label")&&(t=i[0],B[0].appendChild(t),i.addClass("idd-axis-label"),i._size={width:t.offsetWidth,height:t.offsetHeight},T&&i.css("fontSize",x))}},this.update=function(e){e&&(D=e),n()},this.destroy=function(){P[0].innerHTML="",P.removeClass("idd-axis"),P.removeClass("unselectable")},this.remove=function(){var e,t=P[0].parentElement;t&&(t.removeChild(P[0]),(e=t.parentElement)&&("idd-plot-master"==e.className||e.classList&&e.classList.contains("idd-plot-master"))&&e.plot.removeDiv(t)),this.destroy()},r&&(n(),r.addClass("idd-axis"),r.addClass("unselectable")))},me.NumericAxis=function(e){this.base=me.TicksRenderer;e[0].axis=this;var t=!0;this.getCoordinateFromTick=function(e){var t=this.deltaRange;if(isFinite(t)){var i=e,r=this.dataTransform;return r&&(i=r.dataToPlot(e)),(i-this.range.min)*t}return this.axisSize/2};var i=e.attr("data-idd-scientific-notation");void 0!==i&&"false"!=i&&"disable"!=i&&"disabled"!=i||(t=!1),this.base(e,new me.NumericTickSource(t))},me.NumericAxis.prototype=new me.TicksRenderer,me.LogarithmicAxis=function(e){this.base=me.TicksRenderer,this.getCoordinateFromTick=function(e){var t=this.deltaRange;return isFinite(t)?(me.Utils.log10(e)-this.range.min)*t:this.axisSize/2},this.base(e,new me.LogarithmicTickSource)},me.LogarithmicAxis.prototype=new me.TicksRenderer,me.LabelledAxis=function(e,t){this.base=me.TicksRenderer;var l=this,i=!0;this.getCoordinateFromTick=function(e){var t=this.deltaRange;if(isFinite(t)){var i=e;return this.dataTransform&&(i=this.dataTransform.dataToPlot(e)),(i-this.range.min)*t}return this.axisSize/2},this.updateLabels=function(e){this.tickSource=new me.LabelledTickSource(e),this.rotateAngle=e&&e.rotateAngle?e.rotateAngle:0};var r=e.attr("data-idd-force-labels-visibility");return void 0!==r&&"false"!=r&&"disable"!=r&&"disabled"!=r||(i=!1),void 0===t&&(t={}),t.forceLabelsVisibility=i,this.base(e,new me.LabelledTickSource(t)),this.rotateAngle=t&&t.rotateAngle?t.rotateAngle:0,this.getToolTip=function(e){function t(e){return l.dataTransform?l.dataTransform(e):e}for(var i=t(e),r=void 0,o=void 0,n=0;n<l.ticks.length;n++){var a,s=l.ticks[n];s.text||(i<(a=t(s.position))&&!o&&(o=n),a<i&&(r=n))}if(o&&!r){if(l.ticks[o-1]&&l.ticks[o-1].text)return l.ticks[o-1].text}else if(r&&!o){if(l.ticks[r+1]&&l.ticks[r+1].text)return l.ticks[r+1].text}else if(r&&o&&o-r==2)return l.ticks[r+1].text},this},me.LabelledAxis.prototype=new me.TicksRenderer,me.TickSource=function(){var s=[],l=[],d=[],h=[],g=0;this.start,this.finish,this.precision=3,this.insertNumericTick=function(e,t,i){var r;e.empty(),"string"==typeof t&&i?(r=parseFloat(t),isNaN(r)?e.text(t):Math.abs(r)<Math.pow(10,-2)||Math.abs(r)>=Math.pow(10,3)?e.append(me.Utils.getInScientificNotation(r)):e.text(r)):e.append(t)},this.getDiv=function(e,t){var i=void 0!==t&&t,r=this.getInner(e),o=d.indexOf(r);if(-1!=o){l[o]=!0,h[o].display="block";var n=s[o][0];return s[o]._size={width:n.offsetWidth,height:n.offsetHeight},s[o]}if(-1!=(o=l.indexOf(!1))){l[o]=!0,h[o].display="block",d[o]=r;var a=s[o];this.insertNumericTick(a,r,i);n=a[0];return a._size={width:n.offsetWidth,height:n.offsetHeight},s[o]}a=pe("<div></div>");return this.insertNumericTick(a,r,i),l[g]=!0,s[g]=a,d[g]=r,h[g]=a[0].style,a._size=void 0,g++,a},this.getInner=function(e){if(e)return e.toString()},this.invalidate=function(){for(var e=0;e<s.length;e++)s[e].remove();l=[],s=[],d=[],h=[],g=0},this.refreshDivs=function(){for(var e=0;e<g;e++)l[e]?l[e]=!1:h[e].display="none"},this.getTicks=function(e){this.start=e.min,this.finish=e.max},this.decreaseTickCount=function(){},this.increaseTickCount=function(){}},me.Utils.round=function(e,t){if(t<=0)return 15<-t?parseFloat(e.toFixed(15)):parseFloat(e.toFixed(-t));var i=Math.pow(10,t-1);return Math.round(e/i)*i},me.Utils.getInScientificNotation=function(e,t,i){var r=0,o=Math.abs(e),n=e<0?-1:1,a=void 0===t?3:t,s=void 0!==i&&i;if(1<o){for(var l=o;10<=l&&l%10==0;)r++,l/=10;r<a?r=0:(r=Math.floor(Math.log10(o)),o/=Math.pow(10,Math.floor(Math.log10(o))))}else{o<=1&&0<o&&(-1*a<(r=Math.floor(Math.log10(o)))?r=0:(r=Math.floor(Math.log10(o)),o/=Math.pow(10,Math.floor(Math.log10(o))),o=Math.round(1e6*o)/1e6))}var d="";return 0!=o?d+=n*o:d="0",0!=r&&(d+="&#215;10<sup>"+r+"</sup>"),s?{m:n*o,pow:r}:d},me.NumericTickSource=function(e){var d,h;this.base=me.TickSource,this.base(),this.isScientific=void 0!==e&&e;var g=this;this.getInner=function(e,t){var i=void 0===t?me.minNumOrder:t;return 0==e?e.toString():i<=h?me.Utils.round(e/Math.pow(10,h),-1)+"e+"+h:me.Utils.round(e,h).toString()},this.getMPow=function(e,t){return 0==e?{m:e,pow:0}:(void 0===t?3:t)<=h?{m:me.Utils.round(e/Math.pow(10,h),-1),pow:h}:{m:me.Utils.round(e,h),pow:0}},this.getTicks=function(e){return me.NumericTickSource.prototype.getTicks.call(this,e),d=1,h=Math.floor(me.Utils.log10(this.finish-this.start)),t()},this.renderToSvg=function(e,t){if(g.isScientific){var i=me.Utils.getInScientificNotation(e.position,3,!0);return t.text(function(e){e.tspan(i.m).dy(18),0!=i.pow&&(e.tspan(""),e.tspan("10"),e.tspan(i.pow).style("font-size","0.8em").dy(-10))})}return t.text(g.getInner(e.position))};var t=function(){var e=[];if(g.start>g.finish)return e;if(isFinite(h))for(var t,i=d*Math.pow(10,h),r=Math.floor(g.start/i),o=Math.floor(g.finish/i)-r+2,n=0,a=r*i,s=0;s<o;s++)(t=a+s*i)>=g.start&&t<=g.finish&&(e[n]={position:t,label:g.getDiv(t,g.isScientific)},n++);else e[0]={position:g.start,label:g.getDiv(g.start,g.isScientific),invisible:!0};return g.refreshDivs(),e};this.decreaseTickCount=function(){return 1==d?d=2:2==d?d=5:5==d&&(d=1,h++),t()},this.increaseTickCount=function(){return 1==d?(d=5,h--):2==d?d=1:5==d&&(d=2),t()},this.getSmallTicks=function(e){var t=[],i=0;if(1<e.length){var r=e[0].position,o=Math.abs(e[1].position-r)/10;for(r-=o;r>this.start&&i<10;)t[i]=r,i++,r-=o;for(var n=e.length,a=0;a<n-1;a++){r=e[a].position+o;for(var s=0;s<9;s++)t[i]=r,i++,r+=o}r=e[n-1].position+o;for(var l=0;r<this.finish&&l<10;)t[i]=r,i++,r+=o,l++}return t},this.getMinTicks=function(){var e=[];if(h=Math.floor(me.Utils.log10(this.finish-this.start)),isFinite(h)){var t=Math.pow(10,h),i=Math.floor(g.start/t)*t;i<g.start&&(i+=t);var r=Math.floor(g.finish/t)*t;if(r>g.finish&&(r-=t),i!=r)e[0]={position:i,label:g.getDiv(me.Utils.round(i,h))},e[1]={position:r,label:g.getDiv(me.Utils.round(r,h))};else{h--,t=(d=5)*Math.pow(10,h),i=Math.floor(g.start/t);for(var o,n=Math.floor(g.finish/t)-i+2,a=0,s=i*t,l=0;l<n;l++)(o=s+l*t)>=g.start&&o<=g.finish&&(e[a]={position:o,label:g.getDiv(me.Utils.round(o,h))},a++)}}else e[0]={position:g.start,label:g.getDiv(g.start),invisible:!0};return this.refreshDivs(),e}},me.NumericTickSource.prototype=new me.TickSource,me.LogarithmicTickSource=function(){this.base=me.TickSource,this.base();var d,h,g=this,c=1,s=10;this.getInner=function(e){if(Math.abs(e)<me.minLogOrder)return Math.pow(10,e).toString();var t="10<sup>"+e+"</sup>",i=document.createElement("span");return i.innerHTML=t,i},this.renderToSvg=function(e,t){var i=e.position;return t.text(i.toString())},this.getTicks=function(e){return me.LogarithmicTickSource.prototype.getTicks.call(this,e),d=Math.pow(10,this.start),h=Math.pow(10,this.finish),t()};var t=function(){var e=[];if(isFinite(Math.pow(10,-g.start))&&isFinite(h))if(d==h)e[0]={position:g.start,label:g.getDiv(g.start),invisible:!0};else for(var t=g.start/c|0,i=(g.finish/c|0)-t+3,r=(t-1)*c,o=Math.pow(10,r),n=0,a=0;a<i;a++)d<=o&&o<=h&&(e[n]={position:o,label:g.getDiv(r)},n++),r+=c,o*=s;return g.refreshDivs(),e};this.decreaseTickCount=function(){return c*=2,s=Math.pow(10,c),t()},this.increaseTickCount=function(){return 1<c&&(c/=2,s=Math.pow(10,c)),t()},this.getSmallTicks=function(e){var t=[],i=isFinite(Math.pow(10,-g.start))&&isFinite(h),r=0;if(0<e.length&&1==c&&i){var o=e[0].position,n=o/10;for(o-=n;d<o&&r<10;)t[r]=o,r++,o-=n;for(var a=e.length,s=0;s<a-1;s++){o=e[s].position,o+=n=(e[s+1].position-o)/10;for(var l=0;l<9;l++)t[r]=o,r++,o+=n}for(o=e[a-1].position,o+=n=o;o<h;)t[r]=o,r++,o+=n}return t},this.getMinTicks=function(){var e=[];return isFinite(Math.pow(10,-g.start))&&isFinite(h)?d==h&&(e[0]={position:g.start,label:g.getDiv(g.start),invisible:!0},this.refreshDivs()):(e[0]={position:1,label:g.getDiv(0)},this.refreshDivs()),e}},me.LogarithmicTickSource.prototype=new me.TickSource,me.LabelledTickSource=function(e){this.base=me.TickSource,this.base();var c=this,u=[],f=[],p=!1;if(e&&e.forceLabelsVisibility&&(p=e.forceLabelsVisibility),e&&e.labels){for(var t=e.labels.length,i=0;i<t;i++)u[i]=e.labels[i].toString();if(e.ticks)f=e.ticks;else for(i=0;i<t;i++)f[i]=i}var v,m,y=1,C=0<f.length-u.length;this.getInner=function(e){if("string"!=typeof e||-1===e.indexOf("\n"))return e.toString();var t=document.createElement("span");return t.title=e,t.innerText=e,pe(t).css("white-space","pre"),t},this.renderToSvg=function(e,t){var i=e.text?e.text:"";return t.text(i)},this.getTicks=function(e){if(me.LabelledTickSource.prototype.getTicks.call(this,e),y=1,!C){var t=0,i=f.length-1,r=0|this.start;if(r>f[t])for(;1<i-t;){var o=Math.round((t+i)/2);f[o]<r?t=o:i=o}if(v=t,t=0,i=f.length-1,(r=1|this.finish)<f[i])for(;1<i-t;){o=Math.round((t+i)/2);f[o]<r?t=o:i=o}if(v<(m=i))for(var n=(f.length-1)/(m-v);y<n;)y*=2}return b()};var b=function(){var e=[];if(C){for(var t=0;f[t]<c.start;)t++;0<t&&t--;for(var i=f.length-1;f[i]>c.finish;)i--;i<f.length-1&&i++;for(var r=i-t+1,o=0,n=f[t],a=0;a<r;a++){boundPos=n,e[o]={position:boundPos},o++;var s,n=f[++t];a!=r-1&&(s=(boundPos+n)/2,g=c.getDiv(u[t-1]),e[o]={position:s,label:g,invisible:!0,text:u[t-1]},o++)}}else{var l=Math.floor((f.length-1)/y);p&&(l=1),l>f.length-1?l=f.length-1:l<1&&(l=1);for(var d=0,h=0|c.start;f[d]<h;)d+=l;0<=d-l&&f[d]>h&&(d-=l);for(var g,r=m-v+1,o=0,a=0;a<r;a++){(h=f[d])>=c.start&&h<=c.finish&&(g=c.getDiv(u[d]),e[o]={position:h,label:g,text:u[d]},o++),d+=l}}return c.refreshDivs(),e};this.decreaseTickCount=function(){return C?y++:y/=2,b()},this.increaseTickCount=function(){return C?y--:y*=2,b()},this.updateTransform=function(e,t,i){for(var r,o,n,a,s,l,d,h,g,c,u=b(),f=0;f<u.length;f++){u[f].label&&(r=u[f].label,o=t/Math.PI*180,n=r._size.width,a=r._size.height,s=Math.abs(t),l=Math.sin(s),d=Math.cos(s),c="rotate("+o+"deg)",i?(c="translateY("+(h=.5*(n*l+a*d-a))+"px)"+c,r.normalShift=h):(c="translateX("+(g=-.5*(n-(n*d+a*l)))+"px)"+c,r.normalShift=g),r.css("-webkit-transform",c),r.css("-moz-transform",c),r.css("-ms-transform",c),r.css("-o-transform",c),r.css("transform",c))}return u},this.getSmallTicks=function(e){var t=[];if(!C)for(var i=0,r=0,o=0;o<f.length;o++)e.length>r&&f[o]==e[r].position?r++:(t[i]=f[o],i++);return t},this.getMinTicks=function(){var e,t=[];return p?b():(!C&&0<u.length&&(e=c.getDiv(u[0]),t[0]={position:f[0],label:e,text:u[0]},e=c.getDiv(u[u.length-1]),t[1]={position:f[f.length-1],label:e,text:u[u.length-1]},c.refreshDivs()),t)}},me.LabelledTickSource.prototype=new me.TickSource,me.TicksRenderer.getAxisType=function(e){return void 0!==e&&e.type&&"log10"==e.type?"log":"numeric"},(me=me||{}).ColorPalette=function(e,t,i){var f,p,u,r=this;if(Object.defineProperty(this,"isNormalized",{get:function(){return f},configurable:!1}),Object.defineProperty(this,"range",{get:function(){return p},configurable:!1}),Object.defineProperty(this,"points",{get:function(){return u},configurable:!1}),(p=(f=e)?{min:0,max:1}:{min:t.min,max:t.max}).min>=p.max)throw"range is incorrect (min >= max)";if(null==i)throw"points are undefined";if(i.length<2)throw"Palette should have at least two points";u=i.slice(0),this.getRgba=function(e){var t=r.getHsla(e);return me.ColorPalette.HSLtoRGB(t)},this.getHsla=function(e){var t=u.length;if(e<=u[0].x)return u[0].leftColor;if(e>=u[t-1].x)return u[t-1].rightColor;for(var i=0,r=t-1;1<r-i;){var o=Math.round((i+r)/2);u[o].x<e?i=o:r=o}var n=u[i];n.x==e&&(r=i);var a=u[r],s=(e-n.x)/(a.x-n.x),l=n.rightColor,d=a.leftColor;0==l.h&&0==l.s&&(l.h=d.h),0==d.h&&0==d.s&&(d.h=l.h);var h=l.h,g=d.h;3<Math.abs(g-h)&&(h<g?h+=6:g+=6);var c={h:h+(g-h)*s,s:l.s+(d.s-l.s)*s,l:l.l+(d.l-l.l)*s,a:l.a+(d.a-l.a)*s};return 6<=c.h&&(c.h-=6),c},this.absolute=function(e,t){for(var i=u.length,r=(t-e)/(p.max-p.min),o=new Array(i),n=0;n<i;n++){var a=u[n];o[n]={x:r*(a.x-p.min)+e,rightColor:a.rightColor,leftColor:a.leftColor}}return new me.ColorPalette(!1,{min:e,max:t},o)},this.relative=function(){if(f)return this;for(var e=u.length,t=1/(p.max-p.min),i=new Array(e),r=0;r<e;r++){var o=u[r];i[r]={x:t*(o.x-p.min),rightColor:o.rightColor,leftColor:o.leftColor}}return new me.ColorPalette(!0,{min:0,max:1},i)},this.banded=function(e){if(!e)throw"bands is undefined";var t=!1;if("number"==typeof e){if(e<1)throw new"number of bands is less than 1";t=!0;var i=e-1,r=(p.max-p.min)/e;e=new Array(i);for(var o=0;o<i;o++)e[o]=(o+1)*r+p.min}var n=e.length+2,a=e.length+1;if(n<2)throw"number of bands is less than 1";for(var s,l,d=new Array(n),h=this.getHsla(p.min),g=1<a?(p.max-p.min)/(a-1):.5*(p.max-p.min),o=0;o<n-1;o++){if(0==o)s=p.min,l=p.min;else{if(s=o==n-2?p.max:t?p.min+o*g:(e[o-1]+e[o])/2,l>=e[o-1])throw"bands points are incorrect";l=e[o-1]}var c=this.getHsla(s),u={x:l,rightColor:c,leftColor:h};d[o]=u,h=c}if(l>=p.max)throw"bands points are incorrect";return d[n-1]={x:p.max,rightColor:h,leftColor:h},new me.ColorPalette(f,p,d)},this.gradientString=function(){function e(e){function t(e){for(var t=e.toString(16);t.length<2;)t="0"+t;return t}for(var i=me.ColorPalette.HSLtoRGB(e),r="#"+t(i.r)+t(i.g)+t(i.b),o=Object.keys(s),n=0;n<o.length;n++){var a=o[n];if(s[a]==r){r=a;break}}return r}var s=me.ColorPalette.getColorNames(),t="",i=u.length;f||(t=u[0].x+"=");for(var r=1;r<i;r++){var o=u[r-1],n=u[r];o.rightColor===n.leftColor?t+=e(o.rightColor):t+=e(o.rightColor)+","+e(n.leftColor),r<i-1&&(t+="="+n.x+"=")}return f||(t+="="+u[i-1].x),t}},me.ColorPalette.getColorNames=function(){return{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",transparent:"#00000000",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}},me.ColorPalette.toArray=function(e,t){var i,r,o,n=new Uint8Array(t<<2),a=e.getRgba;e.isNormalized?(i=1/(t-1),r=0):(r=e.range.min,i=(e.range.max-e.range.min)/(t-1));for(var s=0,l=0;s<t;s++)o=a(s*i+r),n[l++]=o.r,n[l++]=o.g,n[l++]=o.b,n[l++]=255*o.a;return n},me.ColorPalette.create=function(){var e=arguments;if(!e||0==e.length)throw"colors is undefined or empty";var t=e.length;1==t&&(t++,e=[e[0],e[0]]);for(var i=new Array(t),r=1/(t-1),o=0;o<t;o++){var n=e[o],a="number"==typeof n.r?me.ColorPalette.RGBtoHSL(n):n;i[o]={x:o*r,rightColor:a,leftColor:a}}return new me.ColorPalette(!0,{min:0,max:1},i)},me.ColorPalette.parse=function(e){var t,i=!0,r=[];if(null==e&&(e=""),""==e)return me.palettes.grayscale;var o,n=new me.Lexer(e),a=-1;if(n.readNext()){if(r.push({x:0,rightColor:{h:0,s:0,l:0,a:1},leftColor:{h:0,s:0,l:1,a:1}}),"number"==n.currentLexeme){if(r[r.length-1].x=n.currentNumber,i=!1,n.readNext()&&("separator"!=n.currentLexeme||"equal"!=n.currentSeparator))throw n.position+": separator '=' expected";if(n.readNext()&&"color"!=n.currentLexeme)throw n.position+": color expected"}if("color"!=n.currentLexeme)throw n.position+": wrong lexeme";r[r.length-1].rightColor=n.currentColor,r[r.length-1].leftColor=n.currentColor,r.push({x:r[0].x,rightColor:n.currentColor,leftColor:n.currentColor})}for(o=r[0].x;n.readNext();){if("separator"!=n.currentLexeme)throw n.position+": separator expected";if("equal"==n.currentSeparator){if(n.readNext())if("number"==n.currentLexeme){if(n.currentNumber<o)throw n.position+": number is less than previous";if(o=n.currentNumber,-1==a)r[r.length-1].x=n.currentNumber,a=1;else{if(0!=a)throw n.position+": wrong lexeme";r[r.length-1].x=n.currentNumber,a=2}}else{if("color"!=n.currentLexeme)throw n.position+": wrong lexeme";if(1==a||2==a)r[r.length-1].rightColor=n.currentColor,a=-1;else{if(0!=a&&-1!=a)throw n.position+": wrong lexeme";r[r.length-1].x=r[0].x-1,r[r.length-1].rightColor=n.currentColor,a=-1}}}else if("comma"==n.currentSeparator&&n.readNext())if(1==a||-1==a||2==a)if("number"==n.currentLexeme){if(n.currentNumber<=o)throw n.position+": number is less than previous";if(o=n.currentNumber,!n.readNext()||"separator"!=n.currentLexeme||"equal"!=n.currentSeparator)throw n.position+": wrong lexeme";if(!n.readNext()||"color"!=n.currentLexeme)throw n.position+": color expected";-1!=a?r.push({x:n.currentNumber,rightColor:n.currentColor,leftColor:n.currentColor}):(r[r.length-1].x=n.currentNumber,r[r.length-1].rightColor=n.currentColor,r[r.length-1].leftColor=n.currentColor),a=-1}else{if("color"!=n.currentLexeme)throw n.position+": wrong lexeme";-1==a&&r.pop(),a=0}else if(0==a)if("number"==n.currentLexeme){if(n.currentNumber<=o)throw n.position+": number is less than previous";if(o=n.currentNumber,r[r.length-1].x=r[0].x-1,!n.readNext()||"separator"!=n.currentLexeme||"equal"!=n.currentSeparator)throw n.position+": wrong lexeme";if(!n.readNext()||"color"!=n.currentLexeme)throw n.position+": color expected";r.push({x:n.currentNumber,rightColor:n.currentColor,leftColor:n.currentColor}),a=-1}else{if("color"!=n.currentLexeme)throw n.position+": wrong lexeme";r[r.length-1].x=r[0].x-1,a=0}-1!=a&&0!=a||r.push({x:r[0].x,rightColor:n.currentColor,leftColor:n.currentColor})}if("separator"==n.currentLexeme)throw n.position+": wrong lexeme";if("number"==n.currentLexeme&&i||"color"==n.currentLexeme&&!i)throw n.position+": wrong ending";if(i&&(r[r.length-1].x=1,r[r.length-1].x<r[r.length-2].x))throw n.position+": number is less than previous";if(r[r.length-1].rightColor=r[r.length-1].leftColor,r[0].x>=r[r.length-1].x)throw n.position+": wrong range of palette";t={min:r[0].x,max:r[r.length-1].x};for(var s=1,l=0,d=1,h=r.length;d<h;d++)if(r[d].x==r[0].x-1)0==l&&(s=d),l++;else if(0!=l){for(var g=(r[s+l].x-r[s-1].x)/(l+1),c=0;c<l;c++)r[s+c].x=r[s-1].x+g*(c+1);l=0,s=1}return new me.ColorPalette(i,t,r)},me.Lexer=function(e){if("string"!=typeof e)throw"wrong definition of palette: must be a string";var o,n,a,s,l=e,d=0;Object.defineProperty(this,"position",{get:function(){return d},configurable:!1}),Object.defineProperty(this,"paletteString",{get:function(){return l},configurable:!1}),Object.defineProperty(this,"currentSeparator",{get:function(){return s},configurable:!1}),Object.defineProperty(this,"currentLexeme",{get:function(){return a},configurable:!1}),Object.defineProperty(this,"currentNumber",{get:function(){return n},configurable:!1}),Object.defineProperty(this,"currentColor",{get:function(){return o},configurable:!1}),this.readNext=function(){if(d>=l.length)return!1;for(;" "===l[d];)d++;if("#"===l[d]||/^[a-z]/.test(l[d].toLowerCase())){a="color";for(var e=d;d<l.length&&" "!=l[d]&&"="!=l[d]&&","!=l[d];)d++;var t=me.ColorPalette.colorFromString(l.substring(e,d));o=me.ColorPalette.RGBtoHSL(t)}else if("="===l[d]||","===l[d])a="separator",s="="==l[d]?"equal":"comma",d++;else{a="number";for(e=d;d<l.length&&" "!=l[d]&&"="!=l[d]&&","!=l[d];)d++;var i=l.substring(e,d),r=i.replace(/[^0-9+-Ee.]/g,"");if(i!=r)throw"wrong number value";n=parseFloat(l.substring(e,d))}return!0}},me.ColorPalette.colorFromString=function(e){var t,i,r,o,n=me.ColorPalette.getColorNames();if("string"!=typeof e)throw"wrong definition of color: must be a string";var a,s=!1;if(n[e.toLowerCase()]&&(e=n[e.toLowerCase()]),"#"==e.charAt(0)){if(7==e.length)o=1,t=parseInt(e.substring(1,3),16),i=parseInt(e.substring(3,5),16),r=parseInt(e.substring(5,7),16);else{if(9!=e.length)throw"wrong definition of hex color";t=parseInt(e.substring(1,3),16),i=parseInt(e.substring(3,5),16),r=parseInt(e.substring(5,7),16),o=parseInt(e.substring(7,9),16)/255}s=!0}if(s||(null!==(a=/rgb\(\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\s*\)/.exec(e))&&(o=1,t=parseInt(a[1]),i=parseInt(a[2]),r=parseInt(a[3]),s=!0),s||null!==(a=/rgb\(\s*([0-9]|[1-8][0-9]|9[0-9]|100)%,\s*([0-9]|[1-8][0-9]|9[0-9]|100)%,\s*([0-9]|[1-8][0-9]|9[0-9]|100)%\s*\)/.exec(e))&&(o=1,t=Math.round(2.55*parseInt(a[1])),i=Math.round(2.55*parseInt(a[2])),r=Math.round(2.55*parseInt(a[3])),s=!0)),s||null!==(a=/rgba\(\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*([0|1]\.?\d+)\)/.exec(e))&&(t=parseInt(a[1]),i=parseInt(a[2]),r=parseInt(a[3]),o=parseFloat(a[4]),s=!0),!s)throw"Unsupported color definition";if(isNaN(t)||isNaN(i)||isNaN(r)||isNaN(o))throw"wrong definition of hex color";return{r:t,g:i,b:r,a:o}},me.ColorPalette.RGBtoHSL=function(e){var t,i=e.a,r=e.r/255,o=e.g/255,n=e.b/255,a=Math.max(r,o),a=Math.max(a,n),s=Math.min(r,o),l=(a+(s=Math.min(s,n)))/2,d=a==s?0:l<.5?(a-s)/(a+s):(a-s)/(2-a-s);return a==s?t=0:a==r?t=n<=o?(o-n)/(a-s):(o-n)/(a-s)+6:a==o?t=2+(n-r)/(a-s):a==n&&(t=4+(r-o)/(a-s)),{h:t,s:d,l:l,a:i}},me.ColorPalette.HSLtoRGB=function(e){var t,i=e.a,r=e.h,o=e.s,n=e.l,a=(1-Math.abs(2*n-1))*o,s=a*(1-Math.abs(r%2-1));r<2?(t=0,d=r<1?(l=Math.round(255*a),Math.round(255*s)):(l=Math.round(255*s),Math.round(255*a))):r<4?(l=0,t=r<3?(d=Math.round(255*a),Math.round(255*s)):(d=Math.round(255*s),Math.round(255*a))):r<6&&(d=0,t=r<5?(l=Math.round(255*s),Math.round(255*a)):(l=Math.round(255*a),Math.round(255*s)));var l,d,h=255*(n-a/2),g=l+h;return{r:l=255<g?255:g<0?0:Math.round(g),g:d=255<(g=d+h)?255:g<0?0:Math.round(g),b:t=255<(g=t+h)?255:g<0?0:Math.round(g),a:i}},me.ColorPaletteViewer=function(e,t,i){var r=e,n=r.width(),a=20,o=!0,s=!1,l=t,d=void 0;void 0!==i&&(void 0!==i.height&&(a=i.height),void 0!==i.width&&(n=i.width),void 0!==i.axisVisible&&(o=i.axisVisible),void 0!==i.logAxis&&(s=i.logAxis));var h=pe("<canvas height='"+a+"px'width='"+n+"px' style='display: block'></canvas>");r[0].appendChild(h[0]);var g=h.get(0).getContext("2d"),c=null,u=null;function f(e){return s?{min:me.Utils.log10(e.min),max:me.Utils.log10(e.max)}:e}function p(){c=pe("<div data-idd-placement='bottom' style='width: "+n+"px; color: rgb(0,0,0)'></div>"),r[0].appendChild(c[0]),u=s?new me.LogarithmicAxis(c):new me.NumericAxis(c),l&&!l.isNormalized?u.update(f({min:l.range.min,max:l.range.max})):d&&u.update(f({min:d.min,max:d.max}))}o&&p(),Object.defineProperty(this,"axisVisible",{get:function(){return o},set:function(e){o!=(e=!!e)&&((o=e)?p():(r[0].removeChild(c[0]),u=c=null))},configurable:!1}),Object.defineProperty(this,"palette",{get:function(){return l},set:function(e){e&&(l=e,!o||l.isNormalized&&d||u.update(f({min:l.range.min,max:l.range.max})),v())},configurable:!1}),Object.defineProperty(this,"dataRange",{get:function(){return d},set:function(e){e&&(d=e,!o||l&&!l.isNormalized||u.update(f({min:d.min,max:d.max})))},configurable:!1});var v=function(){for(var e,t=(l.range.max-l.range.min)/n,i=g.createLinearGradient(0,0,n,0),r=l.range.min,o=0;o<n;o++)e=l.getRgba(r),i.addColorStop(o/n,"rgba("+e.r+","+e.g+","+e.b+","+e.a+")"),r+=t;g.fillStyle=i,g.fillRect(0,0,n,a)};l&&v()},me.SvgColorPaletteViewer=function(e,t,i,r){var o=170,n=20,a=!0,s=t;void 0!==r&&(void 0!==r.height&&(n=r.height),void 0!==r.width&&(o=r.width),void 0!==r.axisVisible&&(a=r.axisVisible));var l=e.group();a&&(i.children[1].axis.renderToSvg(l),l.translate(0,n+.5));var d,h,g;s&&(h=(s.range.max-s.range.min)/o,g=e.gradient("linear",function(e){for(var t=s.range.min,i=0;i<o;i++)d=s.getRgba(t),e.at(i/o,"rgba("+d.r+","+d.g+","+d.b+","+d.a+")"),t+=h}),e.rect(o,n).fill(g))},me.SizePalette=function(e,t,i){var r,o,n;if(Object.defineProperty(this,"isNormalized",{get:function(){return r},configurable:!1}),Object.defineProperty(this,"range",{get:function(){return o},configurable:!1}),Object.defineProperty(this,"sizeRange",{get:function(){return n},configurable:!1}),o=(r=e)?{min:0,max:1}:{min:i.min,max:i.max},n={min:t.min,max:t.max},o.min>o.max)throw"valueRange is incorrect (min >= max)";var a=(n.max-n.min)/(o.max-o.min);this.getSize=function(e){return e<=o.min?n.min:e>=o.max?n.max:a*(e-o.min)+n.min}},me.SizePalette.Create=function(e){if(e instanceof me.SizePalette)return e;var t=e.sizeRange,i=e.valueRange;return new me.SizePalette(void 0===i,t,i)},me.SizePaletteViewer=function(e,t,i){var r=e,o=r.width(),n=35,a=!0,s=t;void 0!==i&&(void 0!==i.axisVisible&&(a=i.axisVisible),void 0!==i.width&&(o=i.width),void 0!==i.height&&(n=i.height));var l=pe("<canvas height='"+n+"px'width='"+o+"px' style='display: block'></canvas>");r[0].appendChild(l[0]);var d=null,h=null;function g(){h=pe("<div data-idd-placement='bottom' style='width: "+o+"px; margin-top: -1px; color: rgb(0,0,0)'></div>"),d=new me.NumericAxis(h),r[0].appendChild(h[0]),s?s.isNormalized||d.update({min:s.range.min,max:s.range.max}):c&&d.update({min:c.min,max:c.max})}a&&g(),Object.defineProperty(this,"axisVisible",{get:function(){return a},set:function(e){a!=(e=!!e)&&((a=e)?g():(r[0].removeChild(h[0]),d=h=null))},configurable:!1}),Object.defineProperty(this,"palette",{get:function(){return s},set:function(e){e&&(s=e,a&&!s.isNormalized&&d.update({min:s.range.min,max:s.range.max}),f())},configurable:!1});var c=void 0;Object.defineProperty(this,"dataRange",{get:function(){return c},set:function(e){e&&(c=e,!a||s&&!s.isNormalized||d.update({min:c.min,max:c.max}))},configurable:!1});var u=l.get(0).getContext("2d"),f=function(){u.clearRect(0,0,o,n),u.fillStyle="lightgray",u.strokeStyle="black";var e=0,t=n;s&&s.sizeRange&&(e=s.sizeRange.min,t=s.sizeRange.max);var i=n*o/Math.max(t,e);u.beginPath(),u.moveTo(0,n),0!=e&&u.lineTo(0,Math.max(0,n-e)),i<o?(u.lineTo(i,0),e<=t?u.lineTo(o,0):u.lineTo(o,Math.max(0,n-t))):u.lineTo(o,Math.max(0,n-t)),u.lineTo(o,n),u.lineTo(0,n),u.closePath(),u.fill(),u.stroke()};f()},me.SvgSizePaletteViewer=function(o,e,t,i){var n=170,a=75,r=!0,s=e;void 0!==i&&(void 0!==i.axisVisible&&(r=i.axisVisible),void 0!==i.width&&(n=i.width),void 0!==i.height&&(a=i.height));var l,d;r&&(l=t.children[1],d=o.group(),l.axis.renderToSvg(d),d.translate(0,a));!function(){var e=0,t=a;s.sizeRange&&(e=s.sizeRange.min,t=s.sizeRange.max);var i=a*n/Math.max(t,e),r=[];0!=e?r.push([0,Math.max(0,a-e)]):r.push([0,a]),i<n?(r.push([i,0]),e<=t?r.push([n,0]):r.push([n,Math.max(0,a-t)])):(r.push([n,Math.max(0,a-t)]),r.push([n,Math.max(0,a-t)])),o.polyline([[0,a],r[0],r[1],r[2],[n,a],[0,a]]).fill("lightgray").stroke("black")}()},me.UncertaintySizePaletteViewer=function(e,t){var i=e;i.width();void 0!==t&&(void 0!==t.width&&t.width,void 0!==t.height&&t.height);var r=void 0;Object.defineProperty(this,"maxDelta",{get:function(){return r},set:function(e){e&&(r=e,s())}});var o=pe("<canvas height='50px'></canvas>");i[0].appendChild(o[0]);var n=o[0].getContext("2d"),a=[{x:25,y:20,min:16,max:16},{x:75,y:20,min:10,max:16},{x:125,y:20,min:0,max:16}],s=function(){for(var e=0;e<a.length;e++)me.Petal.drawSample(n,a[e].x,a[e].y,a[e].min,a[e].max,"#484848");n.lineWidth=1,n.beginPath(),n.moveTo(20,45.5),n.lineTo(118,45.5),n.stroke(),n.closePath(),n.beginPath(),n.moveTo(118,45.5),n.lineTo(103.5,40.5),n.lineTo(103.5,49.5),n.lineTo(118,45.5),n.stroke(),n.closePath(),n.fill(),n.strokeStyle="black",n.fillStyle="black",n.lineWidth=1,r&&(n.fillText("X",9,49),n.fillText("X",122,49),n.beginPath(),n.moveTo(134,44.5),n.lineTo(141,44.5),n.stroke(),n.closePath(),n.beginPath(),n.moveTo(134,48.5),n.lineTo(141,48.5),n.stroke(),n.closePath(),n.beginPath(),n.moveTo(137.5,41),n.lineTo(137.5,48),n.stroke(),n.closePath(),n.fillText("",round(r,{min:0,max:r},!1),145,49))};s(),pe("<div style='margin-left: 30px; margin-top: -10px'>uncertainty</div>").appendTo(i)},me.palettes={grayscale:new me.ColorPalette(!0,{min:0,max:1},[{x:0,rightColor:{h:0,s:0,l:0,a:1},leftColor:{h:0,s:0,l:0,a:1}},{x:1,rightColor:{h:0,s:0,l:1,a:1},leftColor:{h:0,s:0,l:1,a:1}}])},(me=me||{}).ColorPaletteEditor=function(u,e){var f,p,v,m,a,y,C,t,i,b,I,A,s,w,x,T,S,P,o,k;u.hasClass("idd-colorPaletteEditor")||(u.addClass("idd-colorPaletteEditor"),u[0].editor=this,f="rgba(100,100,100,0.3)",p=e,Object.defineProperty(this,"palette",{get:function(){return p},set:function(e){p=e,b.palette=p,k()},configurable:!1}),a=m=!(v=function(e){u.trigger("paletteChanged",[e])}),y=u.width(),C=pe("<div></div>").height(10).width(y).addClass("idd-colorPaletteEditor-bar").appendTo(u),t=pe("<div></div>").height(20).width(y).addClass("idd-colorPaletteEditor-viewer").appendTo(u),i={height:20,axisVisible:!1},b=new me.ColorPaletteViewer(t,p,i),I=10+t.height(),u.height(I),A=function(e){var t=me.ColorPalette.HSLtoRGB(e);return"rgba("+t.r+","+t.g+","+t.b+","+t.a+")"},s=function(e){function t(e){for(var t=e.toString(16);t.length<2;)t="0"+t;return t}var i=me.ColorPalette.HSLtoRGB(e);return"#"+t(i.r)+t(i.g)+t(i.b)},w=function(e,t,i,r,o,n){o&&(e.fillStyle=o,e.beginPath(),e.moveTo(t,i),e.lineTo(t+5,i),e.lineTo(t+5,i+10),e.fill()),n&&(e.fillStyle=n,e.beginPath(),e.moveTo(t+5,i),e.lineTo(t+10,i),e.lineTo(t+5,i+10),e.fill()),e.strokeStyle=r,e.beginPath(),e.moveTo(t,i),e.lineTo(t+10,i),e.lineTo(t+5,i+10),e.closePath(),e.stroke()},x=pe("<canvas height='10px'width='"+y+"px' style='display: block'></canvas>").css("position","absolute").appendTo(C),T=function(){x[0].getContext("2d").clearRect(0,0,y,10)},S=function(){var e,t;a&&(0<(e=pe(".idd-colorPaletteEditor-colorPicker",C)).length&&((t=pe.data(e[0],"onClick"))&&pe($).off("click",t),pe(".idd-colorPaletteEditor-colorPicker",C).remove()),a=!1)},P=function(e,t,r){S(),a=!0;var i=pe("<div></div>").addClass("idd-colorPaletteEditor-colorPicker").css({position:"absolute",left:e-30,top:10}).appendTo(C);pe("<span>Color:</span>").css("margin-right",10).appendTo(i);function o(e){pe(e.target).hasClass("idd-colorPaletteEditor-colorPicker")||0<i.has(pe(e.target)).length||(S(),e.stopPropagation())}var n=pe("<input type=color></input>").width(60).height(20).val(s(t)).change(function(){var e=n.val(),t=me.ColorPalette.colorFromString(e),i=me.ColorPalette.RGBtoHSL(t);r(i),S()}).appendTo(i);pe($).click(o),pe.data(i[0],"onClick",o)},o=function(l,e,t,i){var r,o,n=y/(p.range.max-p.range.min),a=n*(l.x-p.range.min),s=n*(e-p.range.min),d=n*(t-p.range.min),h=pe("<div style='position:absolute;'></div>").addClass("idd-colorPaletteEditor-marker").width(10).height(10).appendTo(C),g=pe("<canvas height='10px'width='10px' style='display: block'></canvas>").appendTo(h);h.css("left",a-5),i&&(r=x.offset(),o=!1,h.draggable({axis:"x",containment:[r.left+s-5,r.top,r.left+d-5,r.top+10],start:function(e){o=!(m=!0),S(),T();var t=x.offset();pe(e.target).draggable("option","containment",[t.left+s-5,t.top,t.left+d-5,t.top+10])},drag:function(e){var t,i=u.offset(),r=e.pageY-i.top;r<0||I<r?o||((t=g[0].getContext("2d")).clearRect(0,0,10,10),w(t,0,0,"gray",f,f),o=!0):o&&((t=g[0].getContext("2d")).clearRect(0,0,10,10),w(t,0,0,"black",l.leftColor&&A(l.leftColor),l.rightColor&&A(l.rightColor)),o=!1)},stop:function(e){m=!1;var t,i,r,o=u.offset(),n=e.pageY-o.top;if(n<0||I<n){for(var a=0;a<p.points.length;a++)if(p.points[a].x==l.x){p.points.splice(a,1),v(p),b.palette=p;break}}else{var s=(t=h,i=x.offset(),r=t.offset().left+t.width()/2-i.left,(p.range.max-p.range.min)/y*r+p.range.min);s>p.range.min&&s<p.range.max&&(l.x=s,v(p),b.palette=p)}k()}})),h.click(function(e){P(a,l.rightColor?l.rightColor:l.leftColor,function(e){l.leftColor&&(l.leftColor=e),l.rightColor&&(l.rightColor=e),b.palette=p,v(p),k()}),e.stopPropagation()});var c=g[0].getContext("2d");w(c,0,0,"black",l.leftColor&&A(l.leftColor),l.rightColor&&A(l.rightColor))},k=function(){m=!1,S();var e=pe(".idd-colorPaletteEditor-marker",C);e.filter(".ui-draggable").each(function(){pe(this).draggable("destroy")}),e.remove(),0<p.points.length&&(i=p.range.min,r=p.points[1].x,o(p.points[0],i,r,!1)),1<p.points.length&&(i=p.points[p.points.length-2].x,r=p.range.max,o(p.points[p.points.length-1],i,r,!1));for(var t=1;t<p.points.length-1;t++){var i=p.points[t-1].x,r=p.points[t+1].x;o(p.points[t],i,r,!0)}},x.mousemove(function(e){var t,i,r;m||a||(t=x.offset(),i=e.pageX-t.left,(r=x[0].getContext("2d")).clearRect(0,0,y,10),w(r,i-5,0,"gray",f,f))}),x.mouseleave(function(){T()}),x.click(function(e){var t,i,r,o;m||a||(t=x.offset(),i=e.pageX-t.left,function(e){var t=p.points;if(!(t[0].x>=e.x||t[t.length-1].x<=e.x)){for(var i,r=1;r<t.length;r++){if(e.x==t[r].x)return;if(e.x<t[r].x){(i=t.slice()).splice(r,0,e);break}}p=new me.ColorPalette(p.isNormalized,p.range,i),b.palette=p,v(p),k()}}({x:r=(p.range.max-p.range.min)/y*i+p.range.min,leftColor:o=p.getHsla(r),rightColor:o}))}),k())},me.Gestures={},me.Gestures.FullEventList=["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","touchcancel","gesturestart","gesturechange","gestureend","MSGestureStart","MSGestureChange","MSGestureEnd","MSGestureCancel","MSPointerDown"],me.Gestures.zoomLevelFactor=1.4,me.Gestures.getXBrowserMouseOrigin=function(e,t){var i=function(e){for(var t=0,i=0;e;)t+=e.offsetLeft,i+=e.offsetTop,e=e.offsetParent;return{left:t,top:i}}(e[0]);return{x:t.pageX-i.left,y:t.pageY-i.top}},me.Gestures.PanGesture=function(e,t,i){this.Type="Pan",this.Source=i,this.xOffset=e,this.yOffset=t},me.Gestures.ZoomGesture=function(e,t,i,r){this.Type="Zoom",this.Source=r,this.xOrigin=e,this.yOrigin=t,this.scaleFactor=i},me.Gestures.PinGesture=function(e){this.Type="Pin",this.Source=e},me.Gestures.createPanSubject=function(e){var t=pe(document),i=w.Observable.fromEvent(e,"mousedown"),r=w.Observable.fromEvent(e,"mousemove"),o=w.Observable.fromEvent(t,"mouseup"),n=r.skip(1).zip(r,function(e,t){return new me.Gestures.PanGesture(e.clientX-t.clientX,e.clientY-t.clientY,"Mouse")}),a=o;return i.selectMany(function(e){return n.takeUntil(a)})},me.Gestures.createPinSubject=function(e){return w.Observable.fromEvent(e,"mousedown").select(function(e){return new me.Gestures.PinGesture("Mouse")})},me.Gestures.createZoomSubject=function(r){r.unbind("mousewheel"),r.mousewheel(function(e,t){e.preventDefault();var i=jQuery.Event("xbrowserwheel");i.delta=t,i.origin=me.Gestures.getXBrowserMouseOrigin(r,e),r.trigger(i)});var e=w.Observable.fromEvent(r,"xbrowserwheel"),t=e.zip(e,function(e){return new me.Gestures.ZoomGesture(e.origin.x,e.origin.y,0<e.delta?1/me.Gestures.zoomLevelFactor:+me.Gestures.zoomLevelFactor,"Mouse")}),i=w.Observable.fromEvent(r,"dblclick");i.zip(i,function(e){var t=me.Gestures.getXBrowserMouseOrigin(r,e);return new me.Gestures.ZoomGesture(t.x,t.y,1/me.Gestures.zoomLevelFactor,"Mouse")});return t},me.Gestures.createTouchPanSubject=function(e){var t=pe(document),i=w.Observable.fromEvent(e,"touchstart"),r=w.Observable.fromEvent(e,"touchmove"),o=w.Observable.fromEvent(t,"touchend"),n=w.Observable.fromEvent(t,"touchcancel");return i.selectMany(function(e){return r.takeUntil(o.merge(n)).skip(1).zip(r,function(e,t){return{left:e.originalEvent,right:t.originalEvent}}).where(function(e){return 1==e.left.targetTouches.length&&1==e.right.targetTouches.length&&1==e.left.changedTouches.length&&1==e.right.changedTouches.length}).select(function(e){return new me.Gestures.PanGesture(e.left.targetTouches[0].pageX-e.right.targetTouches[0].pageX,e.left.targetTouches[0].pageY-e.right.targetTouches[0].pageY,"Touch")})})},me.Gestures.createTouchPinSubject=function(e){return w.Observable.fromEvent(e,"touchstart").select(function(e){return new me.Gestures.PinGesture("Touch")})},me.Gestures.createTouchZoomSubject=function(e){var t=pe(document),i=w.Observable.fromEvent(e,"touchstart"),r=w.Observable.fromEvent(e,"touchmove"),o=w.Observable.fromEvent(t,"touchend"),n=w.Observable.fromEvent(t,"touchcancel");return i.selectMany(function(e){return r.takeUntil(o.merge(n)).skip(1).zip(r,function(e,t){return{left:e.originalEvent,right:t.originalEvent}}).where(function(e){return 2==e.left.targetTouches.length&&2==e.right.targetTouches.length}).select(function(e){var t=Math.sqrt((e.left.targetTouches[0].pageX-e.left.targetTouches[1].pageX)*(e.left.targetTouches[0].pageX-e.left.targetTouches[1].pageX)+(e.left.targetTouches[0].pageY-e.left.targetTouches[1].pageY)*(e.left.targetTouches[0].pageY-e.left.targetTouches[1].pageY))/Math.sqrt((e.right.targetTouches[0].pageX-e.right.targetTouches[1].pageX)*(e.right.targetTouches[0].pageX-e.right.targetTouches[1].pageX)+(e.right.targetTouches[0].pageY-e.right.targetTouches[1].pageY)*(e.right.targetTouches[0].pageY-e.right.targetTouches[1].pageY)),i={x:Math.abs(e.right.targetTouches[1].pageX-e.right.targetTouches[0].pageX),y:Math.abs(e.right.targetTouches[1].pageY-e.right.targetTouches[0].pageY)};return new me.Gestures.ZoomGesture(i.x,i.y,1/t,"Touch")})})},me.Gestures.createTouchPanSubjectWin8=function(e){var t=w.Observable.fromEvent(e,"MSGestureStart"),i=w.Observable.fromEvent(e,"MSGestureChange"),r=w.Observable.fromEvent(pe(document),"MSGestureEnd");return t.selectMany(function(e){var t=i.startWith({originalEvent:{offsetX:e.originalEvent.offsetX,offsetY:e.originalEvent.offsetY}});return t.takeUntil(r).skip(1).zip(t,function(e,t){return{left:e.originalEvent,right:t.originalEvent}}).where(function(e){return e.left.scale===e.right.scale&&e.left.detail!=e.left.MSGESTURE_FLAG_INERTIA&&e.right.detail!=e.right.MSGESTURE_FLAG_INERTIA}).select(function(e){return new me.Gestures.PanGesture(e.left.offsetX-e.right.offsetX,e.left.offsetY-e.right.offsetY,"Touch")})})},me.Gestures.createTouchPinSubjectWin8=function(e){return w.Observable.fromEvent(e,"MSPointerDown").select(function(e){return new me.Gestures.PinGesture("Touch")})},me.Gestures.createTouchZoomSubjectWin8=function(e){var t=w.Observable.fromEvent(e,"MSGestureStart"),i=w.Observable.fromEvent(e,"MSGestureChange"),r=w.Observable.fromEvent(e,"MSGestureEnd");return t.selectMany(function(t){return i.takeUntil(r).where(function(e){return 1!==e.originalEvent.scale&&0!==e.originalEvent.scale&&e.originalEvent.detail!=e.originalEvent.MSGESTURE_FLAG_INERTIA}).select(function(e){return new me.Gestures.ZoomGesture(t.originalEvent.offsetX,t.originalEvent.offsetY,1/e.originalEvent.scale,"Touch")})})},me.Gestures.GesturesPool=function(){var e=[];this.addMSGestureSource=function(i){e.forEach(function(e){}),e.push(i),i.addEventListener("MSPointerDown",function(e){var t;void 0===i.gesture&&(((t=new MSGesture).target=i).gesture=t),i.gesture.addPointer(e.pointerId)},!1)}},me.Gestures.GesturesPool=new me.Gestures.GesturesPool,me.Gestures.getGesturesStream=function(e){var t,i,r,o,n,a,s=(a=$.navigator.msPointerEnabled&&"undefined"!=typeof MSGesture?(i=e[0],me.Gestures.GesturesPool.addMSGestureSource(i),t=me.Gestures.createTouchPanSubjectWin8(e),r=me.Gestures.createTouchZoomSubjectWin8(e),o=me.Gestures.createZoomSubject(e),n=r.merge(o),me.Gestures.createTouchPinSubjectWin8(e)):(t=me.Gestures.createPanSubject(e),n=me.Gestures.createZoomSubject(e),me.Gestures.createPinSubject(e))).merge(t.merge(n));return"ontouchstart"in document.documentElement&&(t=me.Gestures.createTouchPanSubject(e),n=me.Gestures.createTouchZoomSubject(e),a=me.Gestures.createTouchPinSubject(e),s=s.merge(a.merge(t.merge(n)))),s},me.Gestures.applyHorizontalBehavior=function(e){return e.select(function(e){return"Pan"==e.Type?e.yOffset=0:"Zoom"==e.Type&&(e.preventVertical=!0),e})},me.Gestures.applyVerticalBehavior=function(e){return e.select(function(e){return"Pan"==e.Type?e.xOffset=0:"Zoom"==e.Type&&(e.preventHorizontal=!0),e})},(me=void 0===me?{}:me).DataTransform=function(e,t,i,r){this.dataToPlot=e,this.plotToData=t,this.domain=i||{isInDomain:function(e){return!0}},this.type=r};var e,T,l,v,t,m,y,i,C,n,a,r,d,b,me,I,o,A,S,P,k,M=85.05112878,D=M/Math.log(Math.tan(M*Math.PI/360+Math.PI/4));function G(e,i,t,r){e.empty();var o=void 0!==r?r:1,n=pe("<canvas width='"+40*o+"' height='"+40*o+"'></canvas>").appendTo(e).get(0).getContext("2d");n.globalAlpha=.9;var a=new Image;a.onload=function(){var e,t;n.drawImage(a,0,0,40*o,40*o),void 0!==i&&(n.fillStyle="white",e=(i<10?14:11)*o,n.font=e+"px Arial",t=(i<10?16:13)*o,n.fillText(i,t,20*o))},a.src=t?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOwgAADsIBFShKgAAAABh0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMC45bDN+TgAAApdJREFUaEPtWc1KW0EUDrjL+9RVN2ZVNC1SaBdREewmYkW00NI+QVEkxJ+2/iBq1KX2CVrJM3Tj1ifIG9yebzhnvFxO4iR3Zm4C94Nvk8yc7zs/czOXVEower3eFLHqyCneVjxghk11iYkjsbbYRCDOJqzxfw+Pyf5NdyCxRtbz3viJQJDFrfG9624yv36STC8eDiTWYK2SSJwkIMSCxkSrc5/MrOyrZgextnKQtK/u04mETwICLGSEl75equaG4fK3TpwkEJgFjGB97ZdqaBS++XgcNgkE5MDezQuDJkHB8KQwAj7Gph8z41Rl+XxAJYim+jiwmrBP4mBzAn66QEFs9Ud52gzL2ocDf11ABYim+nh2a4IhCC1OIF8XaLOtvsuPlOXCnttnffh249RPFyQBXAE0oZCEZvwEHKr8wrETxSTgkWUCQJlADhaTQHmIn+g1Afyo4LaoCWnUquxaeTBzM82VgL1K7F78UcVCsHX5V8znv9BRgOhj5GV8BJIAWvpu60wV9EloeBkfAQWxYxSjC6nq5x8fAQWyXXjV/KEK+yBie62+AJUgmi6EfC/w9h6ggQLaLsyu+n+pR8wg1RegIsRgZyHI7GdBgW0XGp/PVSOjsPHlImz1BagM0XsXolRfQAK2C5vbd6qhYYgYUaovQIWIpgsQrq8dqcZciL0p8+GrL4AQC+YapaijkwUJ2lHa2vmtGhxE7Ik6OlmgYkQ7Su8/ud+TsLaQ0ckCwmzAGHq5/PydH2vGwrwABtiI0zWj0LnvBzJiz8PG91vVOIjvUtWPP/f9gEoS7Shp/yHgs7EanSxgiI0Zo3OrP615/KMz1uYFMMYGjeHXzbbhRJgXwCAbFdOTY14Ao0Qc7DQnw3yJoVCp/AcXkU+yAO498gAAAABJRU5ErkJggg==":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOwgAADsIBFShKgAAAABh0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMC45bDN+TgAAAylJREFUaEPVmdtOMjEUhX0Wn9CHwkPQeIxwwQ0SD1eaqIkHghEidxD1Dfrvb0KT+ScLpu0UEy6+xL1ou9fedGbKuNVqtTYaKW4SUkzl9/d329ipYVvNTUWKsWBqYW5guBoYk60QKYaCiYWZwc/PjxuNRu729tZdXl66drvtdnd3C/gbjc8+Pj4cY5mzmNuoECmGQGJv/PHx0R0fHzvTg2Ds09NTuZDkIqRYhzf/9fXlzs/PpckQLi4u3HQ6bVSEFFfhzb+/v7v9/X1pLAbWGA6HyUVIcRll8+xt07LAWqlFSFHhzbNtcnS+CmumbCcpKmzRHS66Jnu+Dq6JxYW9Y7H0UUWKVegIneFuY/FaeX5+jvoWpFiFjtCZmFtlKicnJ1HfghTL0Ak6wkPK4iAODg6CtGXwsCMnuS2WvjxSLEMnjOIpavGfcHd3RwFB34IUy/gCOApYvJKQLoeM6XQ6+QvgPGPxn3B4eJi/gJwPrjrIlb2Avb09mWwdkCt7AUdHRzLZOiBX9gK63a5MVibXRUyu7AVwa7P4T8h9Gy0eZJwWLQ5CdTmk856Yk6kUq9CJ7+/vKBOpkINc5LRY+ikjxSosZrh+vy+T5oQc5MpdQLGNPj8/ZdKckINc5LRY+ikjRQUdMYozu8VrgbXJQS6LpY8qUlTQEWPw8vIik+fg9fU1qvsgxWXQGc7qp6en0kATzs7Oon+NgRSXQWfo0NvbmzTRBF4UsDY5LJb5FVJcBR0yiiOvxVmIOT5XkeIq6JAxmEwm0kwKrMWarG2xzLsMKdZBpwx3fX0tDcVwc3OT3H2QYh10yhjM5/NGp1TmsgZrsaZpMt8qpBiCLyLmjFSlyStFjxRDscTFVrq6upIGV8Ec5rKGxXL9EKQYCp0ziq0U+3q96dbxSDEGXwRnmJDfzYwZj8dZzIMUY/FF3N/fS9NlGJPLPEgxBTNUHDN6vZ40Dnxm4xrv+zJSTIGOGoPZbFa83zTtP9D4jDGMZU4OpJiKL6L6PwT+RsttHqTYBF8EhzOLC1IPaiFIsSm+iIeHBwfrMg9SzMGiCB50sBbzIMVNQoqbhBQ3h9bWP/HfsYvIwP9AAAAAAElFTkSuQmCC"}function N(e,t,s,i){this.currentPlots={},this.div=e;var o=this,r=this.iddDiv=pe("<div data-idd-plot='chart'></div>").appendTo(e);r.width(e.width()),r.height(e.height());var d=this.iddChart=v.asPlot(r);d.legend.isVisible=!1,d.isToolTipEnabled=!0,d.doFitOnDataTransformChanged=!1;var n=pe("<div></div>").addClass("dsv-onscreennavigationcontainer").attr("data-idd-placement","center").appendTo(t),a=pe("<div></div>").addClass("dsv-onscreennavigation").appendTo(n),l=(new v.OnScreenNavigation(a,d,s),pe("<div></div>").attr("data-idd-name","draggableMarkers").appendTo(d.host)),h=new v.DOMPlot(l,d);h.order=9007199254740991,d.addChild(h),this.persistentViewState=s,d.navigation.setVisibleRect(this.persistentViewState.plotRect,!1,{suppressNotifyBoundPlots:!0}),d.isAutoFitEnabled=this.persistentViewState.isAutoFit,s.probesViewModel.getProbeContent=function(e){for(var t,i,r,o=d.children,n=[],a=0;a<o.length;a++){o[a].isVisible&&(t=o[a].xDataTransform&&o[a].xDataTransform.domain&&o[a].xDataTransform.domain.isInDomain&&o[a].xDataTransform.domain.isInDomain(e.location.x)?o[a].xDataTransform.dataToPlot(e.location.x):e.location.x,i=o[a].yDataTransform&&o[a].yDataTransform.domain&&o[a].yDataTransform.domain.isInDomain&&o[a].yDataTransform.domain.isInDomain(e.location.y)?o[a].yDataTransform.dataToPlot(e.location.y):e.location.y,void 0!==(r=o[a].getTooltip(e.location.x,e.location.y,t,i,!0))&&n.push(r))}return 0<n.length?n:void 0};function g(e){var r=e.id,t=e.location.x,i=e.location.y,o=pe("<div></div>");o.addClass("dragPoint"),h.add(o[0],"none",t,i,void 0,void 0,.5,.92);var n=h.domElements,a=n[n.length-1];a.id=r,o.draggable({containment:h.master.centralPart[0],scroll:!1,opacity:.9,stop:function(e,t){var i={x:a._x,y:a._y};s.probesViewModel.updateProbe(r,i)}}),e.selected?v.createSmallProbe(o,r,"#365C95"):v.createSmallProbe(o,r)}h.host.droppable({accept:".probe",tolerance:"fit",drop:function(e,t){pe(this).offset();var i={x:t.position.left+t.draggable.width()/2,y:t.position.top+t.draggable.height()},r=h.coordinateTransform,o=d.xDataTransform?d.xDataTransform.plotToData(r.screenToPlotX(i.x)):r.screenToPlotX(i.x),n=d.yDataTransform?d.yDataTransform.plotToData(r.screenToPlotY(i.y)):r.screenToPlotY(i.y),a=s.probesViewModel.addProbe({x:o,y:n});g({id:a,location:{x:o,y:n}})}}),s.probesViewModel.subscribe(function(e){var t=e.probe;switch(e.status){case"fit":for(var i=h.domElements,r=0;r<i.length;r++){if((s=i[r]).id===t.id){var o=d.visibleRect,n=d.xDataTransform?d.xDataTransform.dataToPlot(s._x):s._x,a=d.yDataTransform?d.yDataTransform.dataToPlot(s._y):s._y;(1e-7<Math.abs(n-o.x-o.width/2)||1e-7<Math.abs(a-o.y-o.height/2))&&d.navigation.setVisibleRect({x:n-o.width/2,y:a-o.height/2,width:o.width,height:o.height},!0);break}}break;case"remove":for(var s,i=h.domElements,r=0;r<i.length;r++){if((s=i[r]).id===t.id){h.remove(s);break}}break;case"unselected":for(i=h.domElements,r=0;r<i.length;r++){var l=i[r];v.createSmallProbe(l,l.id)}break;case"selected":for(i=h.domElements,r=0;r<i.length;r++){(l=i[r]).id===t.id?v.createSmallProbe(l,l.id,"#365C95"):v.createSmallProbe(l,l.id)}}});for(var c=s.probesViewModel.getProbes(),u=0;u<c.length;u++)g(c[u]);r.on("visibleChanged",function(){var e=[];for(var t in o.currentPlots){var i=o.currentPlots[t],r=i.Plots;r&&0<r.length&&(r[0].isVisible||e.push(i.Id))}o.persistentViewState.selectedPlots=e}),r.on("isAutoFitEnabledChanged",function(){s.isAutoFit=d.isAutoFitEnabled}),r.on("visibleRectChanged",function(){var e=d.visibleRect;i.plotXFormatter=new v.AdaptiveFormatter(e.x,e.x+e.width),i.plotYFormatter=new v.AdaptiveFormatter(e.y,e.y+e.height),s.plotRect=e,void 0!==s.probesViewModel&&s.probesViewModel.refresh()})}function R(e){this.rightPanelExtraShift=3,this.navigationPanelShift=65,this.minWidthToShowLeftPanel=540,this.plotList=void 0,this.viewState=void 0;var t=this,i=this.controlDiv=pe(e);this.persistentViewState=this.viewState=new y.PersistentViewState,this.transientViewState=new y.TransientViewState;var r=i.width(),o=i.height();0===r&&i.width(400),0===o&&i.height(400);var n=pe("<div class='dsv-visualizaition-control'></div>");i.append(n);var a=pe("<div class='dsv-leftpanelcontainer'></div>");n.append(a);var s=pe("<div class='dsv-rightpanel'></div>");n.append(s);var l=pe("<div class='dsv-leftpanel'></div>");a.append(l),l.append(pe("<div class='plotlist'></div>")),s.append(pe("<div class='dsv-visualization-preview'></div>"));var d=pe("<div class='dsv-navigation-container'></div>").appendTo(n);d.addClass("no-print");var h=this.rightpanel=i.find(".dsv-rightpanel"),g=i.find(".dsv-leftpanel"),c=this.leftPanelContainer=i.find(".dsv-leftpanelcontainer"),u=this.persistentViewState.isLegendShown;this.plotViewer=new y.PlotViewer(i.find(".dsv-visualization-preview"),d,this.persistentViewState,this.transientViewState);var f=i.find(".plotlist");this.plotList=new y.PlotList(f,this.plotViewer,this.persistentViewState,this.transientViewState),this.plotList.isEditable=!1,this.plotViewer.iddChart.exportToSvg=function(e,t,i){if(!ve.supported)throw"SVG is not supported";var t=this.screenSize,e=this.coordinateTransform.getPlotRect({x:0,y:0,width:t.width,height:t.height}),r=document.createElementNS("http://www.w3.org/2000/svg","svg"),o=(i=ve(r).size(this.host.width(),this.host.height())).group();this.exportContentToSvg(e,t,o);var n=i.group(),a=this.host.width();return u&&(n.add(this.exportLegendToSvg(this.legend.div[0])).translate(a,30),i.size(200+a,this.host.height())),i};var p=d[0].children[0].firstChild.firstChild;pe(p).click(function(){u?(u=!1,t.persistentViewState.isLegendShown=!1,g.hide(),pe(p).removeClass("idd-onscreennavigation-showlegend").addClass("idd-onscreennavigation-hidelegend")):(u=!0,t.persistentViewState.isLegendShown=!0,g.show(),pe(p).removeClass("idd-onscreennavigation-hidelegend").addClass("idd-onscreennavigation-showlegend")),h.width(i.width()-c.width()-t.rightPanelExtraShift-t.navigationPanelShift),t.plotViewer.updateLayout(),t.persistentViewState.probesViewModel.refresh()}),u?(g.show(),pe(p).removeClass("idd-onscreennavigation-hidelegend").addClass("idd-onscreennavigation-showlegend")):g.hide(),h.width(i.width()-c.width()-this.rightPanelExtraShift-this.navigationPanelShift),pe($).resize(function(){t.updateLayout()}),this.updateLayout()}function B(e,t,i){return t[e]===i[e]||(t[e]=i[e],!1)}function V(e){return!isNaN(parseFloat(e))&&isFinite(e)}function F(e){return e===e+""}function Z(e){return V(e)||F(e)}function L(e){if("object"!=typeof e||null==e)return e;if(n.Utils.isArray(e)){for(var t=[],i=0;i<e.length;i++)t.push(L(e[i]));return t}var r={};for(var o in e)r[o]=L(e[o]);return r}function z(n,e){var a,s,t=r.Utils.getDataSourceFunction(n,r.readCsv)(n);this.base=r.CanvasPlot,this.base(n,e),t&&(a=t.kind),this.draw=function(e){a=e.kind,s=e.error,this.fireAppearanceChanged("error")},Object.defineProperty(this,"isErrorVisible",{get:function(){return!0},configurable:!0}),this.getLocalPadding=function(){return{left:0,right:0,top:0,bottom:0}},this.renderCore=function(e,t){},this.getLegend=function(){function i(){t.text(e.name)}var e=this,t=pe("<span></span>"),r=pe("<div class='plotcard-error'></div>");i();function o(){var e="",e=s||(a?'kind "'+a+'" is unknown':"Error plot definition!");r.text(e)}o(),this.host.bind("appearanceChanged",function(e,t){t&&"error"!=t||o(),t&&"name"!=t||i()});e=this;return{name:t,legend:{thumbnail:void 0,content:r},onLegendRemove:function(){e.host.unbind("appearanceChanged"),n[0].innerHTML="",n.removeClass("idd-legend-item")}}}}return me.mercatorTransform=new me.DataTransform(function(e){return-M<=e&&e<=M?D*Math.log(Math.tan(Math.PI*(e+90)/360)):e},function(e){return-M<=e&&e<=M?360*Math.atan(Math.exp(e/D))/Math.PI-90:e},void 0,"mercator"),Math.LOGE10=Math.log(10),me.logTransform=new me.DataTransform(function(e){return Math.log(e)/Math.LOGE10},function(e){return Math.pow(10,e)},{isInDomain:function(e){return 1e-8<e}},"log10"),me.identityTransform=new me.DataTransform(function(e){return e},function(e){return e},{isInDomain:function(e){return!0}},"identity"),me.AnimationBase=function(){var t=void 0,e=this;this.isInAnimation=!1;var i=w.Observable.create(function(e){return t=e,function(){}});Object.defineProperty(this,"currentObserver",{get:function(){return t},configurable:!1}),Object.defineProperty(this,"currentObservable",{get:function(){return i},configurable:!1}),this.targetPlotRect=void 0,this.getCurrentPlotRect=function(){},this.stop=function(){e.isInAnimation&&(e.isInAnimation=!1),t&&(t.onNext({plotRect:e.getCurrentPlotRect(),isLast:!0}),t.onCompleted(),t=void 0),this.additionalStopRutines()},this.additionalStopRutines=function(){},this.animate=function(e,t){}},me.PanZoomAnimation=function(){this.base=me.AnimationBase,this.base();var f=this,p=void 0,v=void 0,m=new Date,y=void 0,r=void 0,C=void 0,b=0,I=void 0,A=void 0,w=0,x=0;this.getCurrentPlotRect=function(){return y},Object.defineProperty(this,"previousEstimatedPlotRect",{get:function(){return r},configurable:!1});var T=function(){var e,t,i,r,o,n,a,s,l,d,h,g,c,u;(u=f.currentObserver)&&(t=(e=new Date).getTime()-m.getTime(),i=A*t,r=v.x-y.x,o=v.y-y.y,n=Math.max(v.width/1e3,Math.sqrt(r*r+o*o)),a=y.x+n*i*C.x,s=y.y+n*i*C.y,l=(v.width-y.width)*i+y.width,d=(v.height-y.height)*i+y.height,m=e,r=a-p.x,o=s-p.y,h=Math.sqrt(r*r+o*o),g=l-p.width,c=d-p.height,b<=h||Math.abs(g)>Math.abs(w)||Math.abs(c)>Math.abs(x)?(f.isInAnimation=!1,y=v,f.stop()):(y={x:a,y:s,width:l,height:d},f.currentPlotRect=y,u.onNext({plotRect:y,isLast:!1}))),f.isInAnimation&&(I=setTimeout(function(){T()},1e3/60))};this.animate=function(e,t){1.2!=me.Gestures.zoomLevelFactor&&(me.Gestures.zoomLevelFactor=1.2),void 0!==I&&(clearTimeout(I),I=void 0),r=t;var i=e();p=void 0===y?i.plotRect:y,y=p,C={x:(v=t).x-p.x,y:v.y-p.y},b=Math.sqrt(C.x*C.x+C.y*C.y),C=1e-10<b?{x:C.x/b,y:C.y/b}:{x:0,y:0},w=t.width-p.width,x=t.height-p.height,A=0!=w||0!=x?.008:.009,f.isInAnimation=!0,T()},this.additionalStopRutines=function(){void 0!==I&&(clearTimeout(I),I=void 0),f.isInAnimation=!1,startCS=p=void 0,v=void 0,m=new Date,startScreenCenter=void(b=0),previousFrameScreenCenter=C=r=y=void 0,endScreenCenter=void 0,I=void 0,x=w=0}},me.PanZoomAnimation.prototype=new me.AnimationBase,me.Utils.getPlotRectForMap=function(e,t){var i=85.05112878,r=void 0===t?{width:e.getWidth(),height:e.getHeight()}:t,o=e.getCenter(),n=r.width,a=r.height,s=e.tryLocationToPixel({latitude:0,longitude:o.longitude},Microsoft.Maps.PixelReference.control),l=e.tryLocationToPixel({latitude:0,longitude:o.longitude+30},Microsoft.Maps.PixelReference.control).x-s.x;l<0&&(l=s.x-e.tryLocationToPixel({latitude:0,longitude:o.longitude-30},Microsoft.Maps.PixelReference.control).x);var d=l/30,h=o.longitude-s.x/d,g=o.longitude+(n-s.x)/d,c=e.getBounds(),u=c.getNorth(),f=c.getSouth(),p=0;i<=u&&(u=i,p=e.tryLocationToPixel({latitude:u,longitude:o.longitude},Microsoft.Maps.PixelReference.control).y);var v=0;f<=-i&&(f=-i,v=a-e.tryLocationToPixel({latitude:f,longitude:o.longitude},Microsoft.Maps.PixelReference.control).y);var m=g-h;m<0&&(m=c.width);var y,C,b,I,A,w,x={y:f,x:h,width:m,height:u-f},T=me.mercatorTransform.dataToPlot(x.y),S=me.mercatorTransform.dataToPlot(x.y+x.height);return x.y=T,x.height=S-T,0==v&&0==p||(y=a-p-v,b=v*(C=x.height/y),I=p*C,A=x.y-b,w=x.y+x.height+I,x.y=A,x.height=w-A),x},me.BingMapsAnimation=function(e){this.base=me.AnimationBase,this.base();var c=this,u=e,g=void 0,f=void 0,p=new Date,v=void 0,m=void 0,y=void 0,C=0,b=void 0,I=void 0,A=!1;Object.defineProperty(this,"previousEstimatedPlotRect",{get:function(){return m},configurable:!1});var w=function(){var e,t,i,r,o,n,a,s,l,d,h;c.currentObserver&&(t=(e=new Date).getTime()-p.getTime(),i=I*t,r=f.x-v.x,o=f.y-v.y,n=Math.max(f.width/1e3,Math.sqrt(r*r+o*o)),a=v.x+n*i*y.x,s=v.y+n*i*y.y,l=(f.width-v.width)*i+v.width,d=(f.height-v.height)*i+v.height,p=e,r=a-g.x,o=s-g.y,h=Math.sqrt(r*r+o*o),C<=h?(c.isInAnimation=!1,S(f),c.stop()):(v={x:a,y:s,width:l,height:d},c.currentPlotRect=v,S(v))),c.isInAnimation&&(b=setTimeout(function(){w()},1e3/60))};this.animate=function(e,t,i){var r;1.4!=me.Gestures.zoomLevelFactor&&(me.Gestures.zoomLevelFactor=1.4),void 0!==b&&(clearTimeout(b),b=void 0),m=t,c.isInAnimation=!0,i&&i.isFirstFrame&&P(!0),i&&"Pan"==i.gestureType?(A=!1,r=e(),g=void 0===v?r.plotRect:v,v=g,y={x:(f=t).x-g.x,y:f.y-g.y},C=Math.sqrt(y.x*y.x+y.y*y.y),y=1e-10<C?{x:y.x/C,y:y.y/C}:{x:0,y:0},I=.008,w()):(A=!0,S(t))};function x(e,t,i){var r=Math.max(1,Math.log(t.width/e.width*360/256)/Math.log(2)),o=me.mercatorTransform.plotToData(e.y),n=me.mercatorTransform.plotToData(e.y+e.height),a=Math.max(1,Math.log(t.height/(n-o)*180/256)/Math.log(2));return!0===i&&(r=Math.ceil(r)-1,a=Math.ceil(a)),Math.min(r,a)}this.setMapView=function(e,t){var i=t;void 0===t&&(i={width:u.getWidth(),height:u.getHeight()});var r=x(e,i,!0),o=(u.getZoom(),{x:e.x+e.width/2,y:me.mercatorTransform.plotToData(e.y+e.height/2)});u.setView({center:new Microsoft.Maps.Location(o.y,o.x),zoom:r,animate:!1})};var T=0,S=function(e){var t,i=u.getZoom()+T;T=0,t=A?x(e,{width:u.getWidth(),height:u.getHeight()}):i;var r,o,n,a,s,l,d,h,g={x:e.x+e.width/2,y:me.mercatorTransform.plotToData(e.y+e.height/2)};A?1<i||i<t?(r=Math.round(t),d=r,o={width:360*(h={width:u.getWidth(),height:u.getHeight()}).width/(256*Math.pow(2,d)),height:180*h.height/(256*Math.pow(2,d))},l=e.zoomOrigin?(n=e.zoomOrigin.x,s=(a=me.mercatorTransform.plotToData(e.zoomOrigin.y))-g.y,{x:n-(n-g.x)*(o.width/e.width),y:a-s*(o.height/e.height)}):g,u.setView({center:new Microsoft.Maps.Location(l.y,l.x),zoom:t,animate:!0})):(P(),m=c.getCurrentPlotRect(),c.stop()):u.setView({center:new Microsoft.Maps.Location(g.y,g.x),zoom:t,animate:!1})};this.getCurrentPlotRect=function(){return u.getBounds(),u.getCenter(),me.Utils.getPlotRectForMap(u)};var P=function(e){var t,i=c.currentObserver;void 0!==i&&(t={plotRect:c.getCurrentPlotRect(),isLast:!1},void 0!==e&&(t.syncUpdate=e),i.onNext(t))};Microsoft.Maps.Events.addHandler(u,"viewchange",function(e){P()}),Microsoft.Maps.Events.addHandler(u,"viewchangeend",function(e){m=c.getCurrentPlotRect(),A||!c.isInAnimation?c.stop():P()}),this.additionalStopRutines=function(){void 0!==b&&(clearTimeout(b),b=void 0),c.isInAnimation=!1,m=f=g=void 0,p=new Date,y=v=void 0,b=void(C=0),0}},me.BingMapsAnimation.prototype=new me.AnimationBase,me.Event=me.Event||{},me.Event.widthScaleChanged=jQuery.Event("widthScaleChanged"),me.Navigation=function(e,i){var l=e,d=this;l.master.host.on("visibleRectChanged",function(e){var t=l.screenSize.width,i=l.screenSize.width;ct=l.coordinateTransform,vis=ct.getPlotRect({x:0,y:0,width:t,height:i});var r=t/vis.width;l.master.host.trigger(me.Event.widthScaleChanged,{widthScale:r})});function h(){var e=l.screenSize,t=l.coordinateTransform;return{plotRect:t.getPlotRect({x:0,y:0,width:e.width,height:e.height}),screenSize:e,cs:t}}function g(e,t){i(e,t)}var t=void 0,r=void 0,o=void 0,c=void 0;Object.defineProperty(this,"animation",{get:function(){return o},set:function(e){d.stop(),o=e},configurable:!1});var u=me.NavigationUtils.calcPannedRect,f=me.NavigationUtils.calcZoomedRect;Object.defineProperty(this,"widthScale",{get:function(){return l.coordinateTransform.getScale().x},set:function(e){d.stop();var t=l.visibleRect,i=l.screenSize.width/e,r=i/(t.width/t.height),o={x:t.x+.5*t.width-.5*i,y:t.y+.5*t.height-.5*r,width:i,height:r};d.setVisibleRect(o,!1,{suppressScaleChangeNotification:!0})},configurable:!1});function p(){return o&&o.currentObservable.subscribe(function(e){e.isLast&&(l.isInAnimation=!1);var t={syncUpdate:e.syncUpdate};g(e.plotRect,t)},function(e){},function(){})}this.setVisibleRect=function(e,t,i){var r;d.stop(),c=e,t?(d.animation.isInAnimation||p(),l.isInAnimation=!0,d.animation.animate(h,e)):(r=e,d.animation&&d.animation.constraint&&(r=d.animation.constraint(r)),g(r,i))};this.stop=function(){l.isInAnimation=!1,c=void 0,d.animation&&d.animation.stop()},Object.defineProperty(this,"gestureSource",{get:function(){return t},set:function(e){t!=e&&(r&&r.dispose(),void 0!==(t=e)&&(r=t.subscribe(function(e){var t,i,r,o,n,a,s;t=e,n=l.screenSize,a=void 0!==d.animation?d.animation.previousEstimatedPlotRect:c,s=void 0!==a?(i=me.Utils.calcCSWithPadding(a,{width:n.width,height:n.height},{left:0,top:0,bottom:0,right:0},l.aspectRatio),a):(i=l.coordinateTransform).getPlotRect({x:0,y:0,width:n.width,height:n.height}),"Pin"!=t.Type?(r=void 0,"Pan"==t.Type?(r=u(s,n,t),c=r):"Zoom"==t.Type&&((r=f(s,i,t)).width<1e-9&&(r.width=s.width,r.x=s.x),r.height<1e-9&&(r.height=s.height,r.y=s.y),c=r),r&&(d.animation?((o=!d.animation.isInAnimation)&&p(),l.isInAnimation=!0,d.animation.animate(h,r,{gestureType:t.Type,isFirstFrame:o})):g(r))):d.animation&&d.animation.isInAnimation&&d.stop()})))},configurable:!1}),d.animation=new me.PanZoomAnimation},me.NavigationUtils={},me.NavigationUtils.SuppressDefaultMultitouch=function(){navigator.userAgent.match(/(iPhone|iPod|iPad)/)&&document.addEventListener("touchmove",function(e){e.preventDefault()},!1),-1!=navigator.userAgent.indexOf("Mac")&&(document.getElementsByTagName("body")[0].style.overflow="hidden")},me.NavigationUtils.calcPannedRect=function(e,t,i){var r=e.width/t.width,o=e.height/t.height,n=i.xOffset*r,a=-i.yOffset*o;return{x:e.x-n,y:e.y-a,width:e.width,height:e.height}},me.NavigationUtils.calcZoomedRect=function(e,t,i){var r=t.getScale(),o=t.plotToScreenX(e.x+e.width/2),n=t.plotToScreenY(e.y+e.height/2),a=i.preventHorizontal?0:i.xOrigin-o,s=i.preventVertical?0:i.yOrigin-n,l=e.x+a/r.x,d=e.y-s/r.y,h=e.width,g=e.height,c=e.width*(i.preventHorizontal?1:i.scaleFactor),u=e.height*(i.preventVertical?1:i.scaleFactor),f=d+g/2-u/2;return{x:l+h/2-c/2-i.scaleFactor*a/r.x,y:f+i.scaleFactor*s/r.y,width:c,height:u,zoomOrigin:{x:t.screenToPlotX(i.xOrigin),y:t.screenToPlotY(i.yOrigin)}}},me.SharedRenderWorker=function(t,o){var e=!!$.Worker;!e&&$.console&&console.log("Web workers are not available");var n=null;try{n=e?new Worker(t):null}catch(e){console.error("Error creating Web worker from "+t+": "+e.message)}function r(e,t){for(var i=s.length,r=0;r<i;r++)if(s[r].source==e)return s[r];if(!t){var o={source:e,pendingTask:void 0,index:i};return s.push(o),o}}var a=!1,s=[];n&&(n.onmessage=function(e){var t=e.data,i=s[t.sourceIndex],r=function(e){var t=s.length,i=0;if(e){for(var r=(i=e.index)+1;r<t;r++)if(s[r].pendingTask)return s[r];for(r=0;r<i;r++)if(s[r].pendingTask)return s[r];if(s[i].pendingTask)return s[i]}else for(r=0;r<t;r++)if(s[r].pendingTask)return s[r]}(i);r?(a=!0,n.postMessage(r.pendingTask),r.pendingTask=void 0):a=!1,o&&o(i.source,t)},n.onerror=function(e){var t=e.message+" ("+e.filename+":"+e.lineno+")";"object"==typeof console&&console.log(t)}),this.enqueue=function(e,t){var i=r(t);e.sourceIndex=i.index,a?i.pendingTask=e:(a=!0,i.pendingTask=void 0,n.postMessage(e))},this.cancelPending=function(e){var t=r(e,!0);t&&(t.pendingTask=void 0)},e||(this.enqueue=function(e,t){},this.cancelPending=function(e){})},me.heatmapBackgroundRendererCodeBase64="SW50ZXJhY3RpdmVEYXRhRGlzcGxheSA9IHR5cGVvZiBJbnRlcmFjdGl2ZURhdGFEaXNwbGF5ID09ICd1bmRlZmluZWQnID8ge30gOiBJbnRlcmFjdGl2ZURhdGFEaXNwbGF5Ow0KIA0KSW50ZXJhY3RpdmVEYXRhRGlzcGxheS5EYXRhVHJhbnNmb3JtID0gZnVuY3Rpb24gKGRhdGFUb1Bsb3QsIHBsb3RUb0RhdGEsIGRvbWFpbiwgdHlwZSkgew0KICAgIHRoaXMuZGF0YVRvUGxvdCA9IGRhdGFUb1Bsb3Q7DQogICAgdGhpcy5wbG90VG9EYXRhID0gcGxvdFRvRGF0YTsNCg0KICAgIHRoaXMuZG9tYWluID0gZG9tYWluIHx8IHsNCiAgICAgICAgaXNJbkRvbWFpbjogZnVuY3Rpb24gKHZhbHVlKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICB0aGlzLnR5cGUgPSB0eXBlOw0KfTsNCg0KdmFyIG1lcmNhdG9yX21heFBoaSA9IDg1LjA1MTEyODc4OyAvLzg3LjExNDc1NzYzNjMzODQ7IC8vIGRlZw0KdmFyIG1lcmNhdG9yX1IgPSBtZXJjYXRvcl9tYXhQaGkgLyBNYXRoLmxvZyhNYXRoLnRhbihtZXJjYXRvcl9tYXhQaGkgKiBNYXRoLlBJIC8gMzYwLjAgKyBNYXRoLlBJIC8gNCkpOw0KSW50ZXJhY3RpdmVEYXRhRGlzcGxheS5tZXJjYXRvclRyYW5zZm9ybSA9IG5ldyBJbnRlcmFjdGl2ZURhdGFEaXNwbGF5LkRhdGFUcmFuc2Zvcm0oDQogICAgZnVuY3Rpb24gKHBoaV9kZWcpIHsNCiAgICAgICAgaWYgKHBoaV9kZWcgPj0gLW1lcmNhdG9yX21heFBoaSAmJiBwaGlfZGVnIDw9IG1lcmNhdG9yX21heFBoaSkNCiAgICAgICAgICAgIHJldHVybiBtZXJjYXRvcl9SICogTWF0aC5sb2coTWF0aC50YW4oTWF0aC5QSSAqIChwaGlfZGVnICsgOTApIC8gMzYwKSk7DQogICAgICAgIGVsc2UgcmV0dXJuIHBoaV9kZWc7DQogICAgfSwNCiAgICBmdW5jdGlvbiAoeSkgew0KICAgICAgICBpZiAoLW1lcmNhdG9yX21heFBoaSA8PSB5ICYmIHkgPD0gbWVyY2F0b3JfbWF4UGhpKSB7DQogICAgICAgICAgICByZXR1cm4gMzYwICogTWF0aC5hdGFuKE1hdGguZXhwKHkgLyBtZXJjYXRvcl9SKSkgLyBNYXRoLlBJIC0gOTA7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHk7DQogICAgfSwNCiAgICB1bmRlZmluZWQsDQogICAgIm1lcmNhdG9yIg0KKTsNCg0KDQpNYXRoLkxPR0UxMCA9IE1hdGgubG9nKDEwKTsNCg0KSW50ZXJhY3RpdmVEYXRhRGlzcGxheS5sb2dUcmFuc2Zvcm0gPSBuZXcgSW50ZXJhY3RpdmVEYXRhRGlzcGxheS5EYXRhVHJhbnNmb3JtKA0KICAgIGZ1bmN0aW9uICh4X2QpIHsNCiAgICAgICAgcmV0dXJuIE1hdGgubG9nKHhfZCkgLyBNYXRoLkxPR0UxMDsNCiAgICB9LA0KICAgIGZ1bmN0aW9uICh4X3ApIHsNCiAgICAgICAgcmV0dXJuIE1hdGgucG93KDEwLCB4X3ApOw0KICAgIH0sDQogICAgeyBpc0luRG9tYWluOiBmdW5jdGlvbiAoeCkgeyByZXR1cm4geCA+IDAuMDAwMDAwMDE7IH0gfSwNCiAgICAibG9nMTAiDQopOw0KDQpJbnRlcmFjdGl2ZURhdGFEaXNwbGF5LmlkZW50aXR5VHJhbnNmb3JtID0gbmV3IEludGVyYWN0aXZlRGF0YURpc3BsYXkuRGF0YVRyYW5zZm9ybSgNCiAgICBmdW5jdGlvbiAoeF9kKSB7IHJldHVybiB4X2Q7IH0sDQogICAgZnVuY3Rpb24gKHhfcCkgeyByZXR1cm4geF9wOyB9LA0KICAgIHsgaXNJbkRvbWFpbjogZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHRydWUgfSB9LA0KICAgICJpZGVudGl0eSINCik7O3NlbGYub25tZXNzYWdlID0gZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgdmFyIHhzY2FsZSA9IGV2ZW50LmRhdGEuc2NhbGVYLCB4b2Zmc2V0ID0gZXZlbnQuZGF0YS5vZmZzZXRYLCB5c2NhbGUgPSBldmVudC5kYXRhLnNjYWxlWSwgeW9mZnNldCA9IGV2ZW50LmRhdGEub2Zmc2V0WTsNCiAgICB2YXIgZGF0YVRvU2NyZWVuWCwgZGF0YVRvU2NyZWVuWTsNCiAgICB2YXIgaGFzZHRYLCBoYXNkdFk7DQoNCiAgICBpZiAodHlwZW9mIGV2ZW50LmRhdGEueERhdGFUcmFuc2Zvcm0gPT0gJ3N0cmluZycpIHsNCiAgICAgICAgdmFyIGR0ID0gZ2V0RGF0YVRyYW5zZm9ybShldmVudC5kYXRhLnhEYXRhVHJhbnNmb3JtKTsNCiAgICAgICAgdmFyIGYgPSBkdC5kYXRhVG9QbG90Ow0KICAgICAgICBoYXNkdFggPSB0cnVlOw0KICAgICAgICBkYXRhVG9TY3JlZW5YID0gZnVuY3Rpb24gKHgpIHsNCiAgICAgICAgICAgIHJldHVybiBmKHgpICogeHNjYWxlICsgeG9mZnNldDsNCiAgICAgICAgfTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBoYXNkdFggPSBmYWxzZTsNCiAgICAgICAgZGF0YVRvU2NyZWVuWCA9IGZ1bmN0aW9uICh4KSB7DQogICAgICAgICAgICByZXR1cm4geHNjYWxlICogeCArIHhvZmZzZXQ7DQogICAgICAgIH07DQogICAgfQ0KICAgIGlmICh0eXBlb2YgZXZlbnQuZGF0YS55RGF0YVRyYW5zZm9ybSA9PSAnc3RyaW5nJykgew0KICAgICAgICB2YXIgZHQgPSBnZXREYXRhVHJhbnNmb3JtKGV2ZW50LmRhdGEueURhdGFUcmFuc2Zvcm0pOw0KICAgICAgICB2YXIgZiA9IGR0LmRhdGFUb1Bsb3Q7DQogICAgICAgIGhhc2R0WSA9IHRydWU7DQogICAgICAgIGRhdGFUb1NjcmVlblkgPSBmdW5jdGlvbiAoeSkgew0KICAgICAgICAgICAgcmV0dXJuIHlvZmZzZXQgLSBmKHkpICogeXNjYWxlOw0KICAgICAgICB9Ow0KICAgIH0gZWxzZSB7DQogICAgICAgIGhhc2R0WSA9IGZhbHNlOw0KICAgICAgICBkYXRhVG9TY3JlZW5ZID0gZnVuY3Rpb24gKHkpIHsNCiAgICAgICAgICAgIHJldHVybiB5b2Zmc2V0IC0geSAqIHlzY2FsZTsNCiAgICAgICAgfTsNCiAgICB9DQoNCiAgICB2YXIgd2lkdGggPSBldmVudC5kYXRhLndpZHRoOw0KICAgIHZhciBoZWlnaHQgPSBldmVudC5kYXRhLmhlaWdodDsNCg0KICAgIGlmIChldmVudC5kYXRhLngubGVuZ3RoICE9IGV2ZW50LmRhdGEuZi5sZW5ndGgpIHsNCiAgICAgICAgcmVuZGVyTWF0cml4KGV2ZW50LmRhdGEuaW1hZ2UsIHdpZHRoLCBoZWlnaHQsIGV2ZW50LmRhdGEueCwgZXZlbnQuZGF0YS55LCBldmVudC5kYXRhLmYsIGV2ZW50LmRhdGEuZm1pbiwgZXZlbnQuZGF0YS5mbWF4LCBldmVudC5kYXRhLnBhbGV0dGUsIGV2ZW50LmRhdGEucGxvdFJlY3QsIGRhdGFUb1NjcmVlblgsIGRhdGFUb1NjcmVlblksIGhhc2R0WCwgaGFzZHRZKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICB2YXIgc2NyZWVuVG9EYXRhWCwgc2NyZWVuVG9EYXRhWTsNCiAgICAgICAgeHNjYWxlX3IgPSAxIC8geHNjYWxlOw0KICAgICAgICB5c2NhbGVfciA9IDEgLyB5c2NhbGU7DQogICAgICAgIGlmIChoYXNkdFgpIHsNCiAgICAgICAgICAgIHZhciBwbG90VG9EYXRhID0gZHQucGxvdFRvRGF0YTsNCiAgICAgICAgICAgIHNjcmVlblRvRGF0YVggPSBmdW5jdGlvbiAoeHMpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gcGxvdFRvRGF0YSgoeHMgLSB4b2Zmc2V0KSAqIHhzY2FsZV9yKTsNCiAgICAgICAgICAgIH07DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBzY3JlZW5Ub0RhdGFYID0gZnVuY3Rpb24gKHhzKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICh4cyAtIHhvZmZzZXQpICogeHNjYWxlX3I7DQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQogICAgICAgIGlmIChoYXNkdFkpIHsNCiAgICAgICAgICAgIHZhciBwbG90VG9EYXRhID0gZHQucGxvdFRvRGF0YTsNCiAgICAgICAgICAgIHNjcmVlblRvRGF0YVkgPSBmdW5jdGlvbiAoeXMpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gcGxvdFRvRGF0YSgoeW9mZnNldCAtIHlzKSAqIHlzY2FsZV9yKTsNCiAgICAgICAgICAgIH07DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBzY3JlZW5Ub0RhdGFZID0gZnVuY3Rpb24gKHlzKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICh5b2Zmc2V0IC0geXMpICogeXNjYWxlX3I7DQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQogICAgICAgIHJlbmRlckdyYWRpZW50KGV2ZW50LmRhdGEuaW1hZ2UsIHdpZHRoLCBoZWlnaHQsIGV2ZW50LmRhdGEueCwgZXZlbnQuZGF0YS55LCBldmVudC5kYXRhLmYsIGV2ZW50LmRhdGEuZm1pbiwgZXZlbnQuZGF0YS5mbWF4LCBldmVudC5kYXRhLnBhbGV0dGUsIGV2ZW50LmRhdGEucGxvdFJlY3QsIGRhdGFUb1NjcmVlblgsIHNjcmVlblRvRGF0YVgsIGRhdGFUb1NjcmVlblksIHNjcmVlblRvRGF0YVksIGhhc2R0WCwgaGFzZHRZKTsNCiAgICB9DQogICAgZXZlbnQuZGF0YS54ID0gdW5kZWZpbmVkOw0KICAgIGV2ZW50LmRhdGEueSA9IHVuZGVmaW5lZDsNCiAgICBldmVudC5kYXRhLmYgPSB1bmRlZmluZWQ7DQogICAgZXZlbnQuZGF0YS5wYWxldHRlID0gdW5kZWZpbmVkOw0KICAgIHNlbGYucG9zdE1lc3NhZ2UoZXZlbnQuZGF0YSk7DQp9Ow0KDQp2YXIgZ2V0RGF0YVRyYW5zZm9ybSA9IGZ1bmN0aW9uICh0eXBlKSB7DQogICAgaWYgKHR5cGUgPT0gJ21lcmNhdG9yJykNCiAgICAgICAgcmV0dXJuIEludGVyYWN0aXZlRGF0YURpc3BsYXkubWVyY2F0b3JUcmFuc2Zvcm07DQogICAgdGhyb3cgJ1Vua25vd24gZGF0YSB0cmFuc2Zvcm0nOw0KfTsNCg0KDQp2YXIgcmVuZGVyTWF0cml4ID0gZnVuY3Rpb24gKGltYWdlLCB3aWR0aCwgaGVpZ2h0LCB4LCB5LCBmLCBmbWluLCBmbWF4LCBwYWxldHRlLCBwbG90UmVjdCwgZGF0YVRvU2NyZWVuWCwgZGF0YVRvU2NyZWVuWSwgaGFzRGF0YVRyYW5zZm9ybVgsIGhhc0RhdGFUcmFuc2Zvcm1ZKSB7DQogICAgdmFyIG4gPSB4Lmxlbmd0aDsNCiAgICB2YXIgbSA9IHkubGVuZ3RoOw0KICAgIHZhciBpbWFnZURhdGEgPSBpbWFnZS5kYXRhOw0KICAgIHZhciB3ID0gd2lkdGg7DQogICAgdmFyIGggPSBoZWlnaHQ7DQoNCiAgICB2YXIgaTAsIGowOw0KICAgIHZhciB4MCwgeTA7IC8vIGluIGRhdGEgc3BhY2UNCg0KDQogICAgLy8gcHJlY29tcHV0aW5nIHkgaW4gc2NyZWVuIGNvb3JkaW5hdGVzOg0KICAgIHZhciB5c2NyID0gbmV3IEZsb2F0MzJBcnJheShtKTsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG07IGkrKykNCiAgICAgICAgeXNjcltpXSA9IGRhdGFUb1NjcmVlblkoeVtpXSkgfCAwOyAvLyBmbG9vcjsNCg0KICAgIC8vIHN0YXJ0IGNlbGwNCiAgICB2YXIgbGVmdHAgPSBwbG90UmVjdC54Ow0KICAgIHZhciByaWdodHAgPSBsZWZ0cCArIHBsb3RSZWN0LndpZHRoOw0KICAgIGlmIChoYXNEYXRhVHJhbnNmb3JtWCkgew0KICAgICAgICBmb3IgKGkwID0gMDsgaTAgPCBuOyBpMCsrKSB7DQogICAgICAgICAgICBpZiAoZGF0YVRvU2NyZWVuWCh4W2kwXSkgPj0gMCkgew0KICAgICAgICAgICAgICAgIGlmIChpMCA9PSAwKSBpMCsrOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgICAgZm9yIChpMCA9IDA7IGkwIDwgbjsgaTArKykgew0KICAgICAgICAgICAgaWYgKHhbaTBdID49IGxlZnRwKSB7DQogICAgICAgICAgICAgICAgaWYgKGkwID09IDApIGkwKys7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKGkwID09IG4pIHJldHVybjsNCg0KICAgIHZhciBib3R0b21wID0gcGxvdFJlY3QueTsNCiAgICB2YXIgdG9wcCA9IGJvdHRvbXAgKyBwbG90UmVjdC5oZWlnaHQ7DQogICAgZm9yIChqMCA9IDA7IGowIDwgbTsgajArKykgew0KICAgICAgICBpZiAoeXNjcltqMF0gPCBoKSB7DQogICAgICAgICAgICBpZiAoajAgPT0gMCkgajArKzsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChqMCA9PSBtKSByZXR1cm47DQoNCiAgICAvLyByZW5kZXJpbmcgZnJvbSBsZWZ0IHRvIHJpZ2h0LCBib3R0b20gdG8gdG9wDQogICAgdmFyIGNlbGxMZWZ0X3MgPSAwLCBjZWxsUmlnaHRfcyA9IDA7DQoNCiAgICB2YXIgaXNOb3JtYWxpemVkID0gcGFsZXR0ZS5pc05vcm1hbGl6ZWQ7DQogICAgdmFyIGNvbG9ycyA9IHBhbGV0dGUuY29sb3JzOw0KICAgIHZhciBjb2xOID0gKGNvbG9ycy5sZW5ndGggPj4gMikgLSAxOw0KICAgIGlmICghaXNOb3JtYWxpemVkKSB7DQogICAgICAgIGZtYXggPSBwYWxldHRlLnJhbmdlLm1heDsNCiAgICAgICAgZm1pbiA9IHBhbGV0dGUucmFuZ2UubWluOw0KICAgIH0NCiAgICB2YXIgcGFsZXR0ZUsgPSBmbWF4ICE9PSBmbWluID8gMS4wIC8gKGZtYXggLSBmbWluKSA6IDA7DQoNCiAgICBmb3IgKHZhciBpID0gaTA7IGkgPCBuICYmIGNlbGxSaWdodF9zIDwgdzsgaSsrKSB7DQogICAgICAgIC8vIGkwIGlzIHRoZSByaWdodCB2aXNpYmxlIGVkZ2Ugb2YgdGhlIGNlbGwNCiAgICAgICAgeDAgPSB4W2kgLSAxXTsNCiAgICAgICAgdmFyIHgxID0geFtpXTsNCg0KICAgICAgICBpZiAoeDAgIT0geDAgfHwgeDEgIT0geDEpIHsNCiAgICAgICAgICAgIGNlbGxSaWdodF9zID0gdW5kZWZpbmVkOw0KICAgICAgICAgICAgY29udGludWU7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoY2VsbFJpZ2h0X3MpDQogICAgICAgICAgICBjZWxsTGVmdF9zID0gY2VsbFJpZ2h0X3M7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIGNlbGxMZWZ0X3MgPSBNYXRoLmNlaWwoZGF0YVRvU2NyZWVuWCh4MCkpOw0KDQogICAgICAgIGNlbGxSaWdodF9zID0gTWF0aC5jZWlsKGRhdGFUb1NjcmVlblgoeDEpKTsNCiAgICAgICAgaWYgKGNlbGxMZWZ0X3MgPCAwKSBjZWxsTGVmdF9zID0gMDsNCiAgICAgICAgaWYgKGNlbGxSaWdodF9zID49IHcpIGNlbGxSaWdodF9zID0gdzsNCg0KICAgICAgICAvL2lmIChpID09IG4gLSAxKSBjZWxsUmlnaHRfcysrOw0KICAgICAgICBpZiAoY2VsbFJpZ2h0X3MgLSBjZWxsTGVmdF9zID09IDApIGNvbnRpbnVlOw0KDQogICAgICAgIHkwID0geVtqMCAtIDFdOw0KICAgICAgICB2YXIgY2VsbEJvdHRvbV9zID0gMCwNCiAgICAgICAgICAgIGNlbGxUb3BfcyA9IHlzY3JbajAgLSAxXTsNCiAgICAgICAgZm9yICh2YXIgaiA9IGowOyBqIDwgbSAmJiBjZWxsQm90dG9tX3MgPj0gMDsgaisrKSB7DQogICAgICAgICAgICB5MCA9IHlbaiAtIDFdOw0KICAgICAgICAgICAgdmFyIHkxID0geVtqXTsNCg0KICAgICAgICAgICAgaWYgKHkwICE9IHkwIHx8IHkxICE9IHkxKSB7DQogICAgICAgICAgICAgICAgY2VsbFRvcF9zID0gdW5kZWZpbmVkOw0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoY2VsbFRvcF9zKQ0KICAgICAgICAgICAgICAgIGNlbGxCb3R0b21fcyA9IGNlbGxUb3BfczsNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBjZWxsQm90dG9tX3MgPSB5c2NyW2ogLSAxXTsNCiAgICAgICAgICAgIGNlbGxUb3BfcyA9IHlzY3Jbal07DQogICAgICAgICAgICBpZiAoY2VsbFRvcF9zIDwgMCkgY2VsbFRvcF9zID0gLTE7DQogICAgICAgICAgICBpZiAoY2VsbEJvdHRvbV9zID49IGgpIGNlbGxCb3R0b21fcyA9IGggLSAxOw0KDQogICAgICAgICAgICBpZiAoY2VsbFRvcF9zIC0gY2VsbEJvdHRvbV9zID09IDApIGNvbnRpbnVlOw0KDQogICAgICAgICAgICB2YXIgX2YgPSBmW2kgLSAxXVtqIC0gMV07DQogICAgICAgICAgICBpZiAoX2YgIT0gX2YpIGNvbnRpbnVlOw0KICAgICAgICAgICAgdmFyIHBhbGV0dGVWYWwgPSBwYWxldHRlSyAqIChfZiAtIGZtaW4pOw0KICAgICAgICAgICAgdmFyIGsgPSAocGFsZXR0ZVZhbCAqIGNvbE4pIHwgMDsNCiAgICAgICAgICAgIGlmIChrIDwgMCkgayA9IDA7DQogICAgICAgICAgICBlbHNlIGlmIChrID4gY29sTikgayA9IGNvbE47DQogICAgICAgICAgICBrID0gayA8PCAyOw0KDQogICAgICAgICAgICAvLyBmaWxscyB0aGUgY2VsbCB3aXRoIHNhbWUgY29sb3INCiAgICAgICAgICAgIGZvciAodmFyIHlzID0gY2VsbFRvcF9zICsgMTsgeXMgPD0gY2VsbEJvdHRvbV9zOyB5cysrKSB7DQogICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gKHcgKiB5cyArIGNlbGxMZWZ0X3MpIDw8IDI7DQogICAgICAgICAgICAgICAgZm9yICh2YXIgeHMgPSBjZWxsTGVmdF9zOyB4cyA8IGNlbGxSaWdodF9zOyB4cysrKSB7DQogICAgICAgICAgICAgICAgICAgIGltYWdlRGF0YVtpbmRleCsrXSA9IGNvbG9yc1trXTsNCiAgICAgICAgICAgICAgICAgICAgaW1hZ2VEYXRhW2luZGV4KytdID0gY29sb3JzW2sgKyAxXTsNCiAgICAgICAgICAgICAgICAgICAgaW1hZ2VEYXRhW2luZGV4KytdID0gY29sb3JzW2sgKyAyXTsNCiAgICAgICAgICAgICAgICAgICAgaW1hZ2VEYXRhW2luZGV4KytdID0gY29sb3JzW2sgKyAzXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoY2VsbFRvcF9zIDw9IDApIGJyZWFrOw0KICAgICAgICB9DQogICAgICAgIGlmIChjZWxsUmlnaHRfcyA+PSB3KSBicmVhazsNCiAgICB9DQp9Ow0KDQoNCnZhciByZW5kZXJHcmFkaWVudCA9IGZ1bmN0aW9uIChpbWFnZSwgd2lkdGgsIGhlaWdodCwgeCwgeSwgZiwgZm1pbiwgZm1heCwgcGFsZXR0ZSwgcGxvdFJlY3QsIGRhdGFUb1NjcmVlblgsIHNjcmVlblRvRGF0YVgsIGRhdGFUb1NjcmVlblksIHNjcmVlblRvRGF0YVksIGhhc0RhdGFUcmFuc2Zvcm1YLCBoYXNEYXRhVHJhbnNmb3JtWSkgew0KICAgIHZhciBuID0geC5sZW5ndGg7DQogICAgdmFyIG0gPSB5Lmxlbmd0aDsNCiAgICB2YXIgaW1hZ2VEYXRhID0gaW1hZ2UuZGF0YTsNCiAgICB2YXIgdyA9IHdpZHRoOw0KICAgIHZhciBoID0gaGVpZ2h0Ow0KDQogICAgLy8gcHJlY29tcHV0aW5nIHkgaW4gc2NyZWVuIGNvb3JkaW5hdGVzOg0KICAgIHZhciB5c2NyID0gbmV3IEZsb2F0MzJBcnJheShtKTsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG07IGkrKykNCiAgICAgICAgeXNjcltpXSA9IGRhdGFUb1NjcmVlblkoeVtpXSkgfCAwOyAvLyBmbG9vcjsNCg0KICAgIC8vIHByZXBhcmluZyBzY3JlZW4gdG8gZGF0YSBtYXBwaW5nDQogICAgdmFyIG1hcFNjcmVlblRvRGF0YVggPSBuZXcgRmxvYXQzMkFycmF5KHcpOw0KICAgIGZvciAodmFyIHhzID0gMDsgeHMgPCB3OyB4cysrKSB7DQogICAgICAgIG1hcFNjcmVlblRvRGF0YVhbeHNdID0gc2NyZWVuVG9EYXRhWCh4cyArIDAuNSk7IC8vIHRvZG86IG1ha2UgaW5saW5lIHRyYW5zZm9ybSBmb3IgbGluZWFyIGNhc2UNCiAgICB9DQogICAgdmFyIG1hcFNjcmVlblRvRGF0YVkgPSBuZXcgRmxvYXQzMkFycmF5KGgpOw0KICAgIGZvciAodmFyIHlzID0gMDsgeXMgPCBoOyB5cysrKSB7DQogICAgICAgIG1hcFNjcmVlblRvRGF0YVlbeXNdID0gc2NyZWVuVG9EYXRhWSh5cyArIDAuNSk7IC8vIHRvZG86IG1ha2UgaW5saW5lIHRyYW5zZm9ybSBmb3IgbGluZWFyIGNhc2UNCiAgICB9DQoNCiAgICB2YXIgaTAsIGowOw0KICAgIHZhciB4MCwgeTA7IC8vIGluIGRhdGEgc3BhY2UNCg0KICAgIC8vIHN0YXJ0IGNlbGwNCiAgICB2YXIgbGVmdHAgPSBwbG90UmVjdC54Ow0KICAgIHZhciByaWdodHAgPSBsZWZ0cCArIHBsb3RSZWN0LndpZHRoOw0KICAgIGlmIChoYXNEYXRhVHJhbnNmb3JtWCkgew0KICAgICAgICBmb3IgKGkwID0gMDsgaTAgPCBuOyBpMCsrKSB7DQogICAgICAgICAgICBpZiAoZGF0YVRvU2NyZWVuWCh4W2kwXSkgPj0gMCkgew0KICAgICAgICAgICAgICAgIGlmIChpMCA9PSAwKSBpMCsrOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgICAgZm9yIChpMCA9IDA7IGkwIDwgbjsgaTArKykgew0KICAgICAgICAgICAgaWYgKHhbaTBdID49IGxlZnRwKSB7DQogICAgICAgICAgICAgICAgaWYgKGkwID09IDApIGkwKys7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKGkwID09IG4pIHJldHVybjsNCg0KICAgIHZhciBib3R0b21wID0gcGxvdFJlY3QueTsNCiAgICB2YXIgdG9wcCA9IGJvdHRvbXAgKyBwbG90UmVjdC5oZWlnaHQ7DQogICAgZm9yIChqMCA9IDA7IGowIDwgbTsgajArKykgew0KICAgICAgICBpZiAoeXNjcltqMF0gPCBoKSB7DQogICAgICAgICAgICBpZiAoajAgPT0gMCkgajArKzsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChqMCA9PSBtKSByZXR1cm47DQoNCiAgICAvLyByZW5kZXJpbmcgZnJvbSBsZWZ0IHRvIHJpZ2h0LCBib3R0b20gdG8gdG9wDQogICAgdmFyIGNlbGxMZWZ0X3MgPSAwLCBjZWxsUmlnaHRfcyA9IDA7DQoNCiAgICB2YXIgaXNOb3JtYWxpemVkID0gcGFsZXR0ZS5pc05vcm1hbGl6ZWQ7DQogICAgdmFyIGNvbG9ycyA9IHBhbGV0dGUuY29sb3JzOw0KICAgIHZhciBjb2xOID0gKGNvbG9ycy5sZW5ndGggPj4gMikgLSAxOw0KICAgIGlmICghaXNOb3JtYWxpemVkKSB7DQogICAgICAgIGZtYXggPSBwYWxldHRlLnJhbmdlLm1heDsNCiAgICAgICAgZm1pbiA9IHBhbGV0dGUucmFuZ2UubWluOw0KICAgIH0NCiAgICB2YXIgcGFsZXR0ZUsgPSBmbWF4ICE9PSBmbWluID8gMS4wIC8gKGZtYXggLSBmbWluKSA6IDA7DQoNCiAgICB2YXIgZmxiLCBmbHQsIGZydCwgZnJiOw0KICAgIHZhciBmaSwgZmkxOw0KDQogICAgLy8gcmVuZGVyaW5nIHRoZSBpbWFnZQ0KICAgIGZvciAodmFyIGkgPSBpMDsgaSA8IG4gJiYgY2VsbFJpZ2h0X3MgPCB3OyBpKyspIHsNCiAgICAgICAgLy8gaTAgaXMgdGhlIHJpZ2h0IHZpc2libGUgZWRnZSBvZiB0aGUgY2VsbA0KICAgICAgICB4MCA9IHhbaSAtIDFdOw0KICAgICAgICB2YXIgeDEgPSB4W2ldOw0KICAgICAgICBpZiAoeDAgIT0geDAgfHwgeDEgIT0geDEpIHsgLy8gYSAhPSBhICBlcXVpdi4gaXNOYU4oYSkNCiAgICAgICAgICAgIGNlbGxSaWdodF9zID0gdW5kZWZpbmVkOw0KICAgICAgICAgICAgY29udGludWU7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoY2VsbFJpZ2h0X3MpDQogICAgICAgICAgICBjZWxsTGVmdF9zID0gY2VsbFJpZ2h0X3M7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIGNlbGxMZWZ0X3MgPSBNYXRoLmNlaWwoZGF0YVRvU2NyZWVuWCh4MCkpOw0KICAgICAgICBjZWxsUmlnaHRfcyA9IE1hdGguY2VpbChkYXRhVG9TY3JlZW5YKHgxKSk7DQogICAgICAgIGlmIChjZWxsTGVmdF9zIDwgMCkgY2VsbExlZnRfcyA9IDA7DQogICAgICAgIGlmIChjZWxsUmlnaHRfcyA+PSB3KSBjZWxsUmlnaHRfcyA9IHc7DQogICAgICAgIGlmIChjZWxsUmlnaHRfcyAtIGNlbGxMZWZ0X3MgPT0gMCkgY29udGludWU7DQoNCiAgICAgICAgdmFyIGNlbGxCb3R0b21fcyA9IDAsIGNlbGxUb3BfcyA9IDA7DQogICAgICAgIGZpID0gZltpXTsNCiAgICAgICAgZmkxID0gZltpIC0gMV07DQogICAgICAgIGZvciAodmFyIGogPSBqMDsgaiA8IG0gJiYgY2VsbEJvdHRvbV9zID49IDA7IGorKykgew0KICAgICAgICAgICAgeTAgPSB5W2ogLSAxXTsNCiAgICAgICAgICAgIHZhciB5MSA9IHlbal07DQogICAgICAgICAgICBpZiAoeTAgIT0geTAgfHwgeTEgIT0geTEpIHsNCiAgICAgICAgICAgICAgICBjZWxsVG9wX3MgPSB1bmRlZmluZWQ7DQogICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChjZWxsVG9wX3MpDQogICAgICAgICAgICAgICAgY2VsbEJvdHRvbV9zID0gY2VsbFRvcF9zOw0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIGNlbGxCb3R0b21fcyA9IHlzY3JbaiAtIDFdOw0KICAgICAgICAgICAgY2VsbFRvcF9zID0geXNjcltqXTsNCiAgICAgICAgICAgIGlmIChjZWxsVG9wX3MgPCAwKSBjZWxsVG9wX3MgPSAtMTsNCiAgICAgICAgICAgIGlmIChjZWxsQm90dG9tX3MgPj0gaCkgY2VsbEJvdHRvbV9zID0gaCAtIDE7DQogICAgICAgICAgICBpZiAoY2VsbEJvdHRvbV9zIC0gY2VsbFRvcF9zID09IDApIGNvbnRpbnVlOw0KDQogICAgICAgICAgICAvLyBmaWxscyB0aGUgY2VsbA0KICAgICAgICAgICAgZmx0ID0gZmkxW2pdOw0KICAgICAgICAgICAgZmxiID0gZmkxW2ogLSAxXTsNCiAgICAgICAgICAgIGZydCA9IGZpW2pdOw0KICAgICAgICAgICAgZnJiID0gZmlbaiAtIDFdOw0KDQogICAgICAgICAgICBpZiAoZmx0ICE9IGZsdCB8fCBmbGIgIT0gZmxiIHx8IGZydCAhPSBmcnQgfHwgZnJiICE9IGZyYikNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCg0KICAgICAgICAgICAgdmFyIGt5TGVmdCA9IChmbHQgLSBmbGIpIC8gKHkxIC0geTApOw0KICAgICAgICAgICAgdmFyIGt5UmlnaHQgPSAoZnJ0IC0gZnJiKSAvICh5MSAtIHkwKTsNCiAgICAgICAgICAgIGZvciAodmFyIHlzID0gY2VsbFRvcF9zICsgMTsgeXMgPD0gY2VsbEJvdHRvbV9zOyB5cysrKSB7DQogICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gKHcgKiB5cyArIGNlbGxMZWZ0X3MpIDw8IDI7DQogICAgICAgICAgICAgICAgdmFyIF95ID0gbWFwU2NyZWVuVG9EYXRhWVt5c107DQogICAgICAgICAgICAgICAgdmFyIGZsZWZ0ID0ga3lMZWZ0ICogKF95IC0geTApICsgZmxiOw0KICAgICAgICAgICAgICAgIHZhciBmcmlnaHQgPSBreVJpZ2h0ICogKF95IC0geTApICsgZnJiOw0KICAgICAgICAgICAgICAgIHZhciBreCA9IChmcmlnaHQgLSBmbGVmdCkgLyAoeDEgLSB4MCk7DQoNCiAgICAgICAgICAgICAgICBmb3IgKHZhciB4cyA9IGNlbGxMZWZ0X3M7IHhzIDwgY2VsbFJpZ2h0X3M7IHhzKyspIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIF94ID0gbWFwU2NyZWVuVG9EYXRhWFt4c107DQogICAgICAgICAgICAgICAgICAgIHZhciBfZiA9IGt4ICogKF94IC0geDApICsgZmxlZnQ7DQogICAgICAgICAgICAgICAgICAgIHZhciBwYWxldHRlVmFsID0gcGFsZXR0ZUsgKiAoX2YgLSBmbWluKTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGsgPSAocGFsZXR0ZVZhbCAqIGNvbE4pIHwgMDsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGsgPCAwKSBrID0gMDsNCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoayA+IGNvbE4pIGsgPSBjb2xOOw0KICAgICAgICAgICAgICAgICAgICBrID0gayA8PCAyOw0KDQogICAgICAgICAgICAgICAgICAgIC8vdmFyIGNvbG9yID0gZ2V0Q29sb3IocGFsZXR0ZVZhbCk7DQogICAgICAgICAgICAgICAgICAgIC8vaWYgKHhzID09IGNlbGxMZWZ0X3MgfHwgeHMgPT0gY2VsbFJpZ2h0X3MgLSAxIHx8ICAvKiB1bmNvbW1lbnQgdG8gZHJhdyB0aGUgYm9yZGVyIG9mIGNlbGxzICovDQogICAgICAgICAgICAgICAgICAgIC8vICAgIHlzID09IGNlbGxUb3BfcyArIDEgfHwgeXMgPT0gY2VsbEJvdHRvbV9zKQ0KICAgICAgICAgICAgICAgICAgICAvLyAgICBjb2xvciA9IHsgYTogMSwgcjogMCwgZzogMCwgYjogMjU1IH07DQoNCiAgICAgICAgICAgICAgICAgICAgaW1hZ2VEYXRhW2luZGV4KytdID0gY29sb3JzW2srK107DQogICAgICAgICAgICAgICAgICAgIGltYWdlRGF0YVtpbmRleCsrXSA9IGNvbG9yc1trKytdOw0KICAgICAgICAgICAgICAgICAgICBpbWFnZURhdGFbaW5kZXgrK10gPSBjb2xvcnNbaysrXTsNCiAgICAgICAgICAgICAgICAgICAgaW1hZ2VEYXRhW2luZGV4KytdID0gY29sb3JzW2tdOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChjZWxsVG9wX3MgPD0gMCkgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGNlbGxSaWdodF9zID49IHcpIGJyZWFrOw0KICAgIH0NCn07DQo=",me.Figure=function(e,t){if(void 0!==t)throw"Figure cannot be a dependent plot";var i,r,I,a,A,w,x,T,S,n,s,l,d,h,g,o,c,u,f,p;e&&(e&&(i=pe("<div data-idd-plot='plot' data-idd-placement='center'></div>")).css("z-index",me.ZIndexNavigationLayer).css("background-color","rgba(0,0,0,0)"),r=e.children().toArray(),i.appendTo(e),this.base=me.Plot,this.base(e,t,i),I=this,i.dblclick(function(){I.master.fitToView()}),a=function(e){var t=e.css("position");return"static"!=t&&"inherit"!=t||e.css("position","relative"),void 0!==t&&""!=t||e.css("position","relative"),"relative"==e.css("position")},A=[],w=[],x=[],T=[],S=[],n=function(e,t){var i;e.attr("data-idd-axis")&&(i=me.InitializeAxis(e,t),e.axis=i,e.dblclick(function(){var e=this.getAttribute("data-idd-placement");"bottom"==e||"top"==e?I.master.fitToViewX():I.master.fitToViewY()}))},s=function(e,t,i){var r=pe("<div></div>");r.appendTo(I.host).addClass("idd-figure-container"),(r.content=e).appendTo(r);function o(e){var t;i?(t=h(i,e),e.splice(t.index,0,r)):e.push(r)}var n=e.attr("data-idd-placement");"left"==n?o(A):"bottom"==n?o(w):"center"==n?o(x):"right"==n?o(S):"top"==n&&o(T),n&&r.attr("data-idd-placement",n)},this.getAxes=function(t){if(t){if("top"==t?e=jQuery.grep(T,function(e){if(e.content&&e.content.axis&&e.content.axis.mode==t)return e.content.axis}):"bottom"==t?e=jQuery.grep(w,function(e){if(e.content&&e.content.axis&&e.content.axis.mode==t)return e.content.axis}):"left"==t?e=jQuery.grep(A,function(e){if(e.content&&e.content.axis&&e.content.axis.mode==t)return e.content.axis}):"right"==t&&(e=jQuery.grep(S,function(e){if(e.content&&e.content.axis&&e.content.axis.mode==t)return e.content.axis})),e&&0<e.length){for(r=0;r<e.length;r++)e[r]=e[r].content.axis;return e}}else{var e,i=A.concat(w).concat(S).concat(T);if((e=jQuery.grep(i,function(e){if(e.content&&e.content.axis)return e.content.axis}))&&0<e.length){for(var r=0;r<e.length;r++)e[r]=e[r].content.axis;return e}}},this.get=function(e){var t=me.Figure.prototype.get.call(this,e);if(t)return t;var i=this.getAxes();if(i)for(var r=0;r<i.length;r++)if(i[r].host[0].id==e||i[r].host[0]==e)return i[r]},r.forEach(function(e){var t=pe(e);a(t)&&(s(t),n(t))}),l=function(e,t,i,r,o){var n=pe(e);if(!n.is("div"))throw"Only DIVs can be added to figure!";if(void 0!==t){if("top"!=t&&"bottom"!=t&&"center"!=t&&"left"!=t&&"right"!=t)throw"Placement is incorrect!";n.attr("data-idd-placement",t)}return a(n)&&void 0!==n.attr("data-idd-placement")?s(n,0,o):o?n.insertBefore(o):n.appendTo(I.host),void 0!==r&&r||I.requestUpdateLayout(),n},this.addDiv=function(e,t){return l(e,t)[0]},d=function(e){var t=[],i=[];return e.forEach(function(e){0==e.children().toArray().length?t.push(e):i.push(e)}),t.forEach(function(e){e.remove()}),i},h=function(e,t){for(var i=0;i<t.length;i++)if(t[i].content[0]==e)return{pack:e,index:i};throw"Pack not found"},g=function(t,e){var i=jQuery.grep(e,function(e){return e.content[0]==t});return i&&0<i.length},this.removeDiv=function(e){if(void 0===e)throw"Unable to remove undefined object!";var t,i,r,o=this.host.children().toArray();if(t=e,i=o,!((r=jQuery.grep(i,function(e){return e==t}))&&0<r.length||g(e,A)||g(e,w)||g(e,x)||g(e,S)||g(e,T)))throw"Specified div doesn't belong to figure!";var n=pe(e);n.remove(),n.attr("data-idd-placement")&&("left"==n.attr("data-idd-placement")?A=d(A):"bottom"==n.attr("data-idd-placement")?w=d(w):"center"==n.attr("data-idd-placement")?x=d(x):"right"==n.attr("data-idd-placement")?S=d(S):"top"==n.attr("data-idd-placement")&&(T=d(T))),I.requestUpdateLayout()},this.addAxis=function(e,t,i,r){var o=l('<div data-idd-axis="'+(void 0===t?"numeric":t)+'"></div>',e,0,!1,r);return n(o,i),o},this.getTooltip=function(e,t,i,r){var o=I.getAxes(),n=!1,a=new Array;if(o)for(var s,l,d=0;d<o.length;d++){o[d].getToolTip&&(n=!0,s="left"==o[d].mode||"right"==o[d].mode?t:e,(l=o[d].getToolTip(s))&&a.push(l))}if(n){var h=pe("<div></div>").addClass("idd-tooltip-compositevalue");return h.append(pe("<div>"+a.join(", ")+"</div>")),h}},this.measure=function(t){I.screenSize.width!==t.width||(I.screenSize.height,t.height);var e=this.fit(t);t.width,t.height;function i(e,t,i,r,o,n){for(var a=0,s=e.length-1;0<=s;s--){var l,d=e[s],h=d.content;d.width(t),n&&d.css("top",r(a)),d.css("left",o),void 0!==h.axis&&(h.width(t),h.axis.update(i),l=h.height(),d.height()!==l&&d.height(l)),a+=d.height(),n||d.css("top",r(a))}return a}function r(e,t,i,r,o,n){for(var a=0,s=e.length-1;0<=s;s--){var l,d=e[s],h=d.content;d.height(t),h.height(t),n&&d.css("left",r(a)),d.css("top",o),void 0!==h.axis&&(h.height(t),h.axis.update(i),l=h.width(),d.width()!==l&&d.width(l)),a+=d.width(),n||d.css("left",r(a))}return a}var o=i(T,t.width,{min:e.x,max:e.x+e.width},function(e){return e},0,!0),n=i(w,t.width,{min:e.x,max:e.x+e.width},function(e){return t.height-e},0,!1),a=o+n,s=r(A,t.height-a,{min:e.y,max:e.y+e.height},function(e){return e},o,!0),l=r(S,t.height-a,{min:e.y,max:e.y+e.height},function(e){return t.width-e},o,!1),d=s+l,h={width:t.width-d,height:t.height-a};h.width<0&&(h.width=0),h.height<0&&(h.height=0),void 0!==I.mapControl&&I.mapControl.setOptions({width:h.width,height:h.height}),e=this.fit(h,!0),x.forEach(function(e){e.width(h.width),e.height(h.height),e.css("top",o),e.css("left",s)}),this.children.forEach(function(e){var t=e.host;t.width(h.width),t.height(h.height),t.css("top",o),t.css("left",s)});var g=i(T,h.width,{min:e.x,max:e.x+e.width},function(e){return e},s,!0),c=i(w,h.width,{min:e.x,max:e.x+e.width},function(e){return t.height-e},s,!1);if(g!=o)for(var u=o/g,f=0,p=0;p<T.length;p++){var v="scaleY("+u+") translate(0px,"+f+"px)",m="0% 0%";(b=T[p]).css("-webkit-transform",v),b.css("-webkit-transform-origin",m),b.css("-moz-transform",v),b.css("-moz-transform-origin",m),b.css("-o-transform",v),b.css("-o-transform-origin",m),b.css("-ms-transform",v),b.css("-ms-transform-origin",m),b.css("transform",v),b.css("transform-origin",m),f+=b.height()*(u-1)}else T.forEach(function(e){e.css("-ms-transform",""),e.css("-webkit-transform",""),e.css("-moz-transform",""),e.css("-o-transform",""),e.css("transform","")});if(n!=c)for(u=n/c,f=0,p=0;p<w.length;p++){v="scaleY("+u+") translate(0px,"+-f+"px)",m="0% 0%";(b=w[p]).css("-webkit-transform",v),b.css("-webkit-transform-origin",m),b.css("-moz-transform",v),b.css("-moz-transform-origin",m),b.css("-o-transform",v),b.css("-o-transform-origin",m),b.css("-ms-transform",v),b.css("-ms-transform-origin",m),b.css("transform",v),b.css("transform-origin",m),f+=b.height()*(u-1)}else w.forEach(function(e){e.css("-ms-transform",""),e.css("-webkit-transform",""),e.css("-moz-transform",""),e.css("-o-transform",""),e.css("transform","")});var y,C;y=r(A,t.height-a,{min:e.y,max:e.y+e.height},function(e){return e},o,!0),C=r(S,t.height-a,{min:e.y,max:e.y+e.height},function(e){return t.width-e},o,!1);if(s!=y)for(u=s/y,f=0,p=0;p<A.length;p++){v="scaleX("+u+") translate("+f+"px, 0px)",m="0% 0%";(b=A[p]).css("-webkit-transform",v),b.css("-webkit-transform-origin",m),b.css("-moz-transform",v),b.css("-moz-transform-origin",m),b.css("-o-transform",v),b.css("-o-transform-origin",m),b.css("-ms-transform",v),b.css("-ms-transform-origin",m),b.css("transform",v),b.css("transform-origin",m),f+=b.width()*(u-1)}else A.forEach(function(e){e.css("-ms-transform",""),e.css("-webkit-transform",""),e.css("-moz-transform",""),e.css("-o-transform",""),e.css("transform","")});if(l!=C)for(u=l/C,f=0,p=0;p<S.length;p++){var b,v="scaleX("+u+") translate("+-f+"px, 0px)",m="100% 0%";(b=S[p]).css("-webkit-transform",v),b.css("-webkit-transform-origin",m),b.css("-moz-transform",v),b.css("-moz-transform-origin",m),b.css("-o-transform",v),b.css("-o-transform-origin",m),b.css("-ms-transform",v),b.css("-ms-transform-origin",m),b.css("transform",v),b.css("transform-origin",m),f+=b.width()*(u-1)}else S.forEach(function(e){e.css("-ms-transform",""),e.css("-webkit-transform",""),e.css("-moz-transform",""),e.css("-o-transform",""),e.css("transform","")});return h},this.arrange=function(e){me.Figure.prototype.arrange.call(this,e)},this.exportContentToSvg=function(e,t,i){function r(e,t){var i,r,o=e instanceof jQuery?$.getComputedStyle(e[0],null):$.getComputedStyle(e,null),n=o?o.getPropertyValue("transform"):void 0,a=o?o.getPropertyValue("padding-bottom"):void 0,s=o?parseFloat(o.getPropertyValue("font-size")):void 0,l=o?o.getPropertyValue("font-family"):void 0,d=o?o.getPropertyValue("font-weight"):void 0,h=o?o.getPropertyValue("text-align"):void 0;"center"==h&&(h="middle"),"left"==h&&(h="start"),"right"==h&&(h="end"),r=pe(e).hasClass("idd-verticalTitle-inner")?(i=pe(e).parent().width(),pe(e).parent().height()):(i=pe(e).width(),pe(e).height());var g=pe(e).text().trim(),c=t.text(g).font({family:l,size:s,weight:d,anchor:h});"middle"==h?c.translate(i/2,-r/2):"end"==h?c.translate(i,-r/2):c.translate(0,-r/2),"none"!=n&&null!=n&&(a=null!=a?parseFloat(a.substring(0,a.length-2)):0,c.attr({transform:n}),c.translate(-a,r/2))}for(var o=i.group(),n=0,a=A.length;0<=--a;){var s=A[a];(f=o.group()).translate(n,0),n+=s.width(),s.content&&(s.content.axis?s.content.axis.renderToSvg(f):(p=pe("div.idd-verticalTitle-inner",s.content),(v=1===p.length&&0===p[0].children.length)&&r(p,f)))}for(var l=i.group(),d=0,a=T.length;0<=--a;){s=T[a];(f=l.group()).translate(n,d),d+=s.height(),s.content&&(s.content.axis?s.content.axis.renderToSvg(f):(v=!0,pe(s.content).contents().each(function(){3!=this.nodeType&&(v=!1)}),v&&r(s.content,f)))}o.translate(0,d);for(var h=i.group(),g=d+t.height,a=0;a<w.length;a++){s=w[a];(f=h.group()).translate(n,g),g+=s.height(),s.content&&(s.content.axis?s.content.axis.renderToSvg(f):(v=!0,pe(s.content).contents().each(function(){3!=this.nodeType&&(v=!1)}),v&&r(s.content,f)))}for(var c=i.group(),u=n+t.width,a=0;a<S.length;a++){var f,p,v,s=S[a];(f=c.group()).translate(u,d),u+=s.width(),s.content&&(s.content.axis?s.content.axis.renderToSvg(f):(p=pe("div.idd-verticalTitle-inner",s.content),(v=1===p.length&&0===p[0].children.length)&&r(p,f)))}var m=i.group();m.viewbox(0,0,t.width,t.height).translate(n,d),me.Figure.prototype.exportContentToSvg.call(this,e,t,m)},this.requestUpdateLayout(),"true"===e.attr("data-idd-navigation-enabled")&&(o=me.Gestures.getGesturesStream(this.centralPart),this.navigation.gestureSource=o),c=pe("<div></div>").prependTo(this.centralPart),u=new me.Legend(this,c,!0),c.css("float","right"),Object.defineProperty(this,"legend",{get:function(){return u},configurable:!1}),me.Gestures.FullEventList.forEach(function(e){c[0].addEventListener(e,function(e){e.stopPropagation()},!1)}),f={},me.Utils.readStyle(e,f),(p=f.isLegendVisible)?"true"==p?u.isVisible=!0:"false"==p&&(u.isVisible=!1):u.isVisible=!1)},me.Figure.prototype=new me.Plot,me.Chart=function(s,e){if(s){if(void 0!==e)throw"Chart cannot be a dependent plot";var t=pe("<div data-idd-plot='grid' data-idd-placement='center'></div>").prependTo(s),r=pe('<div data-idd-axis="numeric" data-idd-placement="left"></div>').prependTo(s),o=pe('<div data-idd-axis="numeric" data-idd-placement="bottom"></div>').prependTo(s);this.base=me.Figure,this.base(s,e);var l=this,n=this.get(t[0]);o.axis=n.xAxis=this.get(o[0]),r.axis=n.yAxis=this.get(r[0]);this.changeXAxis=function(e,t){var i=o;o=l.addAxis("bottom",e,t,o[0]),l.removeDiv(i[0]),i.axis.destroy(),n.xAxis=this.get(o[0]),o.axis.dataTransform=l.xDataTransform},this.changeYAxis=function(e,t){var i=r;r=l.addAxis("left",e,t,r[0]),l.removeDiv(i[0]),i.axis.destroy(),n.yAxis=this.get(r[0]),r.axis.dataTransform=l.yDataTransform},this.onDataTranformChangedCore=function(e){var t,i;"y"==e?(t=me.TicksRenderer.getAxisType(l.yDataTransform),r.axis.host.attr("data-idd-axis")==t?"log"!=t&&(r.axis.dataTransform=l.yDataTransform):(i=r,r=l.addAxis("left",t,!0,r[0]),l.removeDiv(i[0]),i.axis.destroy(),n.yAxis=this.get(r[0])),l.enumAll(l,function(e){e!=l&&(e.yDataTransform=l.yDataTransform)})):"x"==e&&(t=me.TicksRenderer.getAxisType(l.xDataTransform),o.axis.host.attr("data-idd-axis")==t?"log"!=t&&(o.axis.dataTransform=l.xDataTransform):(i=o,o=l.addAxis("bottom",t,!0,o[0]),l.removeDiv(i[0]),i.axis.destroy(),n.xAxis=this.get(o[0])),l.enumAll(l,function(e){e!=l&&(e.xDataTransform=l.xDataTransform)}))},this.fireChildrenChanged=function(e){"add"==e.type&&(l.xDataTransform&&(e.plot.xDataTransform=l.xDataTransform),l.yDataTransform&&(e.plot.yDataTransform=l.yDataTransform)),this.host.trigger(me.Event.childrenChanged,e)},this.exportToSvg=function(e,t,i){if(!ve.supported)throw"SVG is not supported";var t=this.screenSize,e=this.coordinateTransform.getPlotRect({x:0,y:0,width:t.width,height:t.height}),r=document.createElementNS("http://www.w3.org/2000/svg","svg"),o=(i=ve(r).size(s.width(),s.height())).group();this.exportContentToSvg(e,t,o);var n=i.group(),a=s.width()+20;return l.legend.isVisible&&(n.add(this.exportLegendToSvg(l.legend.Host[0])).translate(a,20),i.size(200+a,s.height())),i};var i,a,d,h={};me.Utils.readStyle(s,h),h.isLegendVisible||(l.legend.isVisible=!0),i=me.Gestures.getGesturesStream(l.centralPart),a=me.Gestures.applyHorizontalBehavior(me.Gestures.getGesturesStream(o)),d=me.Gestures.applyVerticalBehavior(me.Gestures.getGesturesStream(r)),l.navigation.gestureSource=i.merge(a.merge(d))}},me.Chart.prototype=new me.Figure,me.LabelPlot=function(e,t){this.base=me.CanvasPlot,this.base(e,t);var A=[],w=[],x=[],T=[],S=120,P=25,k=[];this.getData=function(){for(var e=[],t=A.length,i=0;i<t;i++)e.push({text:A[i],position:{x:w[i],y:x[i]},placement:T[i]});return e},this.draw=function(e){if(e){for(var t=e.length,i=[],r=[],o=[],n=[],a=0;a<t;a++)i.push(e[a].text),r.push(e[a].position.x),o.push(e[a].position.y),e[a].placement?n.push(e[a].placement):n.push("center"),k.push(0);A=i,w=r,x=o,T=n}this.invalidateLocalBounds(),this.requestNextFrameOrUpdate(),this.fireAppearanceChanged()},this.computeLocalBounds=function(){var e=this.xDataTransform&&this.xDataTransform.dataToPlot,t=this.yDataTransform&&this.yDataTransform.dataToPlot;if(0<w.length&&0<x.length){var i=me.Utils.getMinMax(w),r=me.Utils.getMinMax(x),o=i.min-.2,n=i.max+.2,a=r.min,s=r.max;return e&&(o=e(o),n=e(n)),t&&(a=t(a),s=t(s)),{x:o,y:a,width:n-o,height:s-a}}},this.getLocalPadding=function(){return{left:0,right:0,top:0,bottom:0}},this.renderCore=function(e,t){me.LabelPlot.prototype.renderCore.call(this,e,t);var i=this.getContext(!0),r=A.length;if(0!=r)for(var o=this.getTransform(),n=o.dataToScreenX,a=o.dataToScreenY,s=0;s<r;s++){var l={x:n(w[s]),y:a(x[s])};"left"==T[s]?l={x:n(w[s])-S,y:a(x[s])}:"right"==T[s]?l={x:n(w[s])+S,y:a(x[s])}:"top"==T[s]?l={x:n(w[s]),y:a(x[s])-P}:"bottom"==T[s]&&(l={x:n(w[s]),y:a(x[s])+P});var d=$.getComputedStyle(document.body,null),h=d?parseFloat(d.getPropertyValue("font-size")):void 0,g=d?d.getPropertyValue("font-family"):void 0,c=d?d.getPropertyValue("font-weight"):void 0,u=l.x-.5*S,f=l.y;i.fillStyle="black",i.font=c+" "+h+"px "+g,i.textALign="center";for(var p=A[s],v=i.measureText(p).width;S<v;)p=p.substring(0,p.length-1),v=i.measureText(p).width;k[s]=(S-v)/2,i.fillText(p,u+k[s],f)}},this.renderCoreSvg=function(e,t,i){var r=A.length;if(0<r){for(var o=t.height,n=t.width,a=this.coordinateTransform.plotToScreenX,s=this.coordinateTransform.plotToScreenY,l=this.xDataTransform&&this.xDataTransform.dataToPlot,d=this.yDataTransform&&this.yDataTransform.dataToPlot,h=l?function(e){return a(l(e))}:a,g=d?function(e){return s(d(e))}:s,c=i.group(),u=0;u<r;u++){var f=$.getComputedStyle(document.body,null),p=f?parseFloat(f.getPropertyValue("font-size")):void 0,v=f?f.getPropertyValue("font-family"):void 0,m=f?f.getPropertyValue("font-weight"):void 0,y={x:h(w[u]),y:g(x[u])};"left"==T[u]?y={x:h(w[u])-S,y:g(x[u])}:"right"==T[u]?y={x:h(w[u])+S,y:g(x[u])}:"top"==T[u]?y={x:h(w[u]),y:g(x[u])-P}:"bottom"==T[u]&&(y={x:h(w[u]),y:g(x[u])+P});var C=y.x-.5*S,b=y.y-.9*P,I=c.group();I.size(S,P);I.text(A[u]).font({family:v,size:p,weight:m});I.translate(C+k[u],b),I.clipWith(I.rect(S,P))}c.clipWith(c.rect(n,o))}}},me.LabelPlot.prototype=new me.CanvasPlot,me.MaxMarkersPerAnimationFrame=3e3,me.Markers=function(e,t){var m,y,C,b,g,c,I,A,w,i;this.base=me.CanvasPlot,this.base(e,t),e&&(m={},C={},g=y=void 0,c=!(b={}),I={},w=function(e){var t={},i={},r=-1;for(var o in e){var n=e[o];me.Utils.isArray(n)?((n.length<r||-1===r)&&(r=n.length),t[o]=n):i[o]=n}return{arrays:t,scalars:i,length:-1===r?0:r}},(A=this).getDataCopy=function(){return m},this.draw=function(e,t){if(null==e||null==e)throw"The argument 'data' is undefined or null";var i;if(void 0===(m=e).shape||null==e.shape)i=me.Markers.shapes.box;else if("string"==typeof e.shape){if(null==(i=me.Markers.shapes[e.shape]))throw"The given marker shape is unknown"}else{if("object"!=typeof e.shape||null==e.shape||"function"!=typeof e.shape.draw)throw"The argument 'data' is incorrect: value of the property 'shape' must be a string, a MarkerShape object, undefined or null";i=e.shape}y=i;var r=pe.extend({},e);null!=i.prepare&&i.prepare(r),null!=A.mapControl&&null!=g&&(g.forEach(function(e){var t=A.mapControl.entities.indexOf(e);0<=t&&A.mapControl.entities.removeAt(t)}),g=void 0),C=r,b={},this.invalidateLocalBounds(),this.requestNextFrameOrUpdate(),this.setTitles(t,!0),this.fireAppearanceChanged()},this.computeLocalBounds=function(e,t){var i=this.xDataTransform&&this.xDataTransform.dataToPlot,r=this.yDataTransform&&this.yDataTransform.dataToPlot;if(y&&(void 0!==y.getBoundingBox||void 0!==y.getPlotBoundingBox)&&C){if(0==C.x.length)return;var o=w(C),n=o.length,a=o.arrays,s=o.scalars,l=void 0;if(y.hasOwnProperty("getBoundingBox")){for(var d,h,g,c,u=0;u<n;u++){for(var f in a)s[f]=a[f][u];var p=y.getBoundingBox(s),l=me.Utils.unionRects(l,p)}i&&(d=i(l.x),h=i(l.x+l.width),l.x=d,l.width=h-d),r&&(g=r(l.y),c=r(l.y+l.height),l.y=g,l.height=c-g)}else{if(!y.hasOwnProperty("getPlotBoundingBox"))throw"Shape does not have neither getBoundingBox nor getPlotBoundingBox";for(var v=A.getTransform(),u=0;u<n;u++){for(var f in a)s[f]=a[f][u];var m=y.getPlotBoundingBox(s,v);l=me.Utils.unionRects(l,m)}}return l}if(void 0!==C.x&&void 0!==C.y)return me.Utils.getBoundingBoxForArrays(C.x,C.y,i,r)},this.getLocalPadding=function(){if(y&&void 0!==y.getPadding)return y.getPadding(C);return{left:0,right:0,top:0,bottom:0}},this.renderCore=function(e,t){if(me.Markers.prototype.renderCore.call(this,e,t),null!=y){var i=this.getTransform(),r=!A.master.isInAnimation||void 0===A.master.mapControl;if(void 0!==A.mapControl&&(void 0===g&&function(){if(void 0!==C.x&&void 0!==C.y){var e=C.x,t=C.y;if(me.Utils.isArray(e)&&me.Utils.isArray(t)){var i=Math.min(e.length,t.length);if(i<=me.MaxMarkersPerAnimationFrame){g=new Array(i);for(var r=0;r<i;r++){var o=new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(t[r],e[r]),{visible:!1,htmlContent:'<div style="background-color: white; opacity: 0.5; width: 10px; height: 10px"></div>',anchor:new Microsoft.Maps.Point(5,5)});g[r]=o,A.mapControl.entities.push(o)}}}}}(),void 0!==g&&(A.master.isInAnimation&&!c?(g.forEach(function(e){e.setOptions({visible:!0})}),c=!0):!A.master.isInAnimation&&c&&(g.forEach(function(e){e.setOptions({visible:!1})}),c=!1))),r){var o=this.getContext(!0);b=C,void 0!==y.preRender&&(b=y.preRender(C,e,t,i,o));for(var n=w(b),a=n.length,s=n.arrays,l=n.scalars,d=0;d<a;d++){for(var h in s)l[h]=s[h][d];y.draw(l,e,t,i,o,d)}}}},this.renderCoreSvg=function(e,t,i){var r;null!=y&&null!=y.renderSvg&&(r=this.getTransform(),y.renderSvg(e,t,i,C,r))},this.findToolTipMarkers=function(e,t,i,r){if(null==y||void 0===y.hitTest||null==b)return[];for(var o=this.getTransform(),n={x:o.dataToScreenX(e),y:o.dataToScreenY(t)},a={x:e,y:t},s=w(b),l=s.length,d=s.arrays,h=s.scalars,g=[],c=0;c<l;c++){for(var u in d)h[u]=d[u][c];if(y.hitTest(h,o,n,a)&&"number"==typeof h.indices){var f=h.indices,p={};if(y.getTooltipData)p=y.getTooltipData(m,f);else{for(var u in m){var v=m[u];me.Utils.isArray(v)&&f<v.length&&(I[u]=new me.AdaptiveFormatter(v),p[u]=I[u].toString(v[f]))}p.index=f}g.push(p)}}return g},this.getTooltip=function(e,t,i,r){var n=this;if(this.isVisible&&!this.isErrorVisible){var o=n.findToolTipMarkers(e,t,i,r),a=function(e){var t,i,r=pe("<div></div>").addClass("idd-tooltip-compositevalue");for(var o in e){e.hasOwnProperty(o)&&(t=n.getTitle(o),i=void 0,"object"==typeof e[o]&&(i=a(e[o])),i?r.append(pe("<div>"+t+":</div>")).append(i):r.append(pe("<div>"+t+": "+e[o]+"</div>")))}return r};if(0<o.length){var s=pe("<div></div>");return pe("<div></div>").addClass("idd-tooltip-name").text(n.name||"markers").appendTo(s),o.forEach(function(e){a(e).addClass("idd-tooltip-itemvalues").appendTo(s)}),s}}},this.getLegend=function(){function e(){t.empty(),y&&void 0!==y.getLegend&&(i.content.empty(),y.getLegend(C,A.getTitle,i)),t.text(A.name)}var t=pe("<span></span>"),i={thumbnail:pe("<canvas></canvas>"),content:pe("<div></div>")};this.host.bind("appearanceChanged",e),e();return{name:t,legend:i,onLegendRemove:function(){A.host.unbind("appearanceChanged",e),t.empty()}}},this.buildSvgLegend=function(e,t){var i={thumbnail:t.group(),content:t.group()};e.height=30,y&&void 0!==y.buildSvgLegendElements&&(i=y.buildSvgLegendElements(e,t,C,this.getTitle)),t.rect(e.width,e.height).fill({color:"white",opacity:0}),t.add(i.thumbnail.translate(5,5));var r=$.getComputedStyle(e.legendDiv.children[0].children[1],null),o=parseFloat(r.getPropertyValue("font-size")),n=r.getPropertyValue("font-family");t.add(t.text(this.name).font({family:n,size:o}).translate(40,0)),t.add(i.content.translate(5,30))},this.onDataTransformChanged=function(e){this.invalidateLocalBounds(),me.Markers.prototype.onDataTransformChanged.call(this,e)},(i=me.Utils.getDataSourceFunction(e,me.readCsv)(e))&&void 0!==i.y&&("bars"==i.shape&&(barWidthFloat=parseFloat(i.barWidth),isNaN(barWidthFloat)?(void 0===i.barWidth?console.error("barWidth parameter of BarChart plot should be set"):console.error("barWidth parameter of BarChart plot should be a number"),i.barWidth=void 0):i.barWidth=barWidthFloat),this.draw(i)))},me.Markers.prototype=new me.CanvasPlot,me.Markers.defaults={color:"#4169ed",colorPalette:me.palettes.grayscale,border:"#000000",size:10},me.Markers.shapes=me.Markers.shapes||{},e={prepare:function(e){var t=e.shape?e.shape.toLowerCase():"box";if("box"==t)e.shape=1;else if("circle"==t)e.shape=2;else if("diamond"==t)e.shape=3;else if("cross"==t)e.shape=4;else{if("triangle"!=t)throw"Unexpected value of property 'shape'";e.shape=5}if(null==e.y||null==e.y)throw"The mandatory property 'y' is undefined or null";if(!me.Utils.isArray(e.y))throw"The property 'y' must be an array of numbers";var i=e.y.length,r=new Int8Array(i);if(me.Utils.maskNaN(r,e.y),null==e.x)e.x=me.Utils.range(0,i-1);else{if(!me.Utils.isArray(e.x))throw"The property 'x' must be an array of numbers";if(e.x.length!=i)throw"Length of the array which is a value of the property 'x' differs from lenght of 'y'";me.Utils.maskNaN(r,e.x)}if(null!=e.border&&"none"!=e.border||(e.border=null),null==e.color&&(e.color=me.Markers.defaults.color),me.Utils.isArray(e.color)){if(e.color.length!=i)throw"Length of the array 'color' is different than length of the array 'y'";if(0<i&&"string"!=typeof e.color[0]){null==(l=e.colorPalette)&&(l=me.Markers.defaults.colorPalette),"string"==typeof l&&(l=new me.ColorPalette.parse(l)),null!=l&&l.isNormalized&&(d=me.Utils.getMinMax(e.color),d=me.Utils.makeNonEqual(d),l=l.absolute(d.min,d.max)),e.colorPalette=l;for(var o=new Array(i),n=0;n<i;n++){var a,s=e.color[n];s!=s?r[n]=1:(a=l.getRgba(s),o[n]="rgba("+a.r+","+a.g+","+a.b+","+a.a+")")}e.color=o}e.individualColors=!0}else e.individualColors=!1;var l,d,h=new Array(i);if(null==e.size&&(e.size=me.Markers.defaults.size),me.Utils.isArray(e.size)){if(e.size.length!=i)throw"Length of the array 'size' is different than length of the array 'y'";if(null!=e.sizePalette){(l=me.SizePalette.Create(e.sizePalette)).isNormalized&&(d=me.Utils.getMinMax(e.size),d=me.Utils.makeNonEqual(d),l=new me.SizePalette(!1,l.sizeRange,d)),e.sizePalette=l;for(n=0;n<i;n++){var g=e.size[n];g!=g?r[n]=1:h[n]=l.getSize(g)}}else h=e.size,e.sizeMax=me.Utils.getMax(e.size)}else{for(n=0;n<i;n++)h[n]=e.size;e.sizeMax=e.size}e.size=h;for(var c=0,n=0;n<i;n++)1===r[n]&&c++;if(0<c){c=i-c,e.x=me.Utils.applyMask(r,e.x,c),e.y=me.Utils.applyMask(r,e.y,c),e.size=me.Utils.applyMask(r,e.size,c),e.individualColors&&(e.color=me.Utils.applyMask(r,e.color,c));for(var u=Array(c),n=0,f=0;n<i;n++)0===r[n]&&(u[f++]=n);e.indices=u}else e.indices=me.Utils.range(0,i-1)},preRender:function(e,t,i,r,o){return e.individualColors||(o.fillStyle=e.color),null!=e.border&&(o.strokeStyle=e.border),e},draw:function(e,t,i,r,o,n){e.individualColors&&(o.fillStyle=e.color);var a=null!=e.border,s=r.dataToScreenX(e.x),l=r.dataToScreenY(e.y),d=i.width,h=i.height,g=e.size,c=g/2;if(!(d<s-c||s+c<0||h<l-c||l+c<0))switch(e.shape){case 1:o.fillRect(s-c,l-c,g,g),a&&o.strokeRect(s-c,l-c,g,g);break;case 2:o.beginPath(),o.arc(s,l,c,0,2*Math.PI),o.fill(),a&&o.stroke();break;case 3:o.beginPath(),o.moveTo(s-c,l),o.lineTo(s,l-c),o.lineTo(s+c,l),o.lineTo(s,l+c),o.closePath(),o.fill(),a&&o.stroke();break;case 4:var u=g/3,f=u/2;a?(o.beginPath(),o.moveTo(s-c,l-f),o.lineTo(s-f,l-f),o.lineTo(s-f,l-c),o.lineTo(s+f,l-c),o.lineTo(s+f,l-f),o.lineTo(s+c,l-f),o.lineTo(s+c,l+f),o.lineTo(s+f,l+f),o.lineTo(s+f,l+c),o.lineTo(s-f,l+c),o.lineTo(s-f,l+f),o.lineTo(s-c,l+f),o.closePath(),o.fill(),o.stroke()):(o.fillRect(s-f,l-c,u,g),o.fillRect(s-c,l-f,g,u));break;case 5:o.beginPath(),o.moveTo(s-c,l+c),o.lineTo(s,l-c),o.lineTo(s+c,l+c),o.closePath(),o.fill(),a&&o.stroke()}},getPadding:function(e){var t=e.sizeMax/2;return{left:t,right:t,top:t,bottom:t}},hitTest:function(e,t,i,r){function o(e,t){for(var i,r,o,n,a,s,l,d=t.length,h=0;h<d;h++)if(1!=(i=e,r=t[h],o=t[(h+1)%d],s=a=n=void 0,n=o.x-r.x,a=o.y-r.y,s=i.x-r.x,0<(l=n*(i.y-r.y)-a*s)?1:l<0?2:0))return!1;return!0}var n=t.dataToScreenX(e.x),a=t.dataToScreenY(e.y),s=i.x,l=i.y,d=e.size,h=d/2;if(i.x>=n-h&&i.x<=n+h&&i.y>=a-h&&i.y<=a+h)switch(e.shape){case 1:return!0;case 2:return(n-s)*(n-s)+(a-l)*(a-l)<=h*h;case 3:return o({x:s,y:l},[{x:n-h,y:a},{x:n,y:a-h},{x:n+h,y:a},{x:n,y:a+h}]);case 4:var g=d/3/2;return o({x:s,y:l},[{x:n-g,y:a+h},{x:n-g,y:a-h},{x:n+g,y:a-h},{x:n+g,y:a+h}])||o({x:s,y:l},[{x:n-h,y:a+g},{x:n-h,y:a-g},{x:n+h,y:a-g},{x:n+h,y:a+g}]);case 5:return o({x:s,y:l},[{x:n-h,y:a+h},{x:n,y:a-h},{x:n+h,y:a+h}])}},getLegend:function(i,e,t){var r=t.content,o=14;document.defaultView&&document.defaultView.getComputedStyle&&(o=parseFloat(document.defaultView.getComputedStyle(r[0],null).getPropertyValue("font-size"))),!isNaN(o)&&0!=o||(o=14);var n=t.thumbnail,a=!0,s=1.5*o,l=s/2+1,d=l;n[0].width=n[0].height=2+s;var h=n[0].style,g=n.get(0).getContext("2d");g.clearRect(0,0,n[0].width,n[0].height);var c,u,f,p,v,m,y,C,b,I,A,w,x,T,S,P,k=0,M=0,D=0;f=!1,i.individualColors&&i.colorPalette?(x=e("color"),0==M?(p=pe("<div style='width: 170px; margin-top: 5px; margin-bottom: 5px'></div>").appendTo(r),w=pe("<div class='idd-legend-item-property'></div>").text(x).appendTo(p),v=p[0].style,T=pe("<div style='width: 170px; color: rgb(0,0,0); '></div>").appendTo(p),m=new me.ColorPaletteViewer(T),M=2):w.text(x),m.palette=i.colorPalette,1==M&&(v.display="block",M=2)):2==M&&(v.display="none",M=1),i.individualColors?(u="#000000",c="#ffffff",f=!0):(c=i.color,u=c,null!=i.border&&(f=!0,u=i.border)),y=s,i.sizePalette&&(S=e("size"),0==D?(b=pe("<div style='width: 170px; margin-top: 5px; margin-bottom: 5px'></div>").appendTo(r),A=pe("<div class='idd-legend-item-property'></div>").text(S).appendTo(b),b[0].style,P=pe("<div style='width: 170px; color: rgb(0,0,0)'></div>").appendTo(b),I=new me.SizePaletteViewer(P),D=2):A.text(S),I.palette=me.SizePalette.Create(i.sizePalette)),C=y/2,function(){switch(2==k&&((void 0).display="none",k=1),g.clearRect(0,0,2+s,2+s),g.strokeStyle=u,g.fillStyle=c,i.shape){case 1:g.fillRect(l-C,d-C,y,y),f&&g.strokeRect(l-C,d-C,y,y);break;case 2:g.beginPath(),g.arc(l,d,C,0,2*Math.PI),g.fill(),f&&g.stroke();break;case 3:g.beginPath(),g.moveTo(l-C,d),g.lineTo(l,d-C),g.lineTo(l+C,d),g.lineTo(l,d+C),g.closePath(),g.fill(),f&&g.stroke();break;case 4:var e=y/3,t=e/2;f?(g.beginPath(),g.moveTo(l-C,d-t),g.lineTo(l-t,d-t),g.lineTo(l-t,d-C),g.lineTo(l+t,d-C),g.lineTo(l+t,d-t),g.lineTo(l+C,d-t),g.lineTo(l+C,d+t),g.lineTo(l+t,d+t),g.lineTo(l+t,d+C),g.lineTo(l-t,d+C),g.lineTo(l-t,d+t),g.lineTo(l-C,d+t),g.closePath(),g.fill(),g.stroke()):(g.fillRect(l-t,d-C,e,y),g.fillRect(l-C,d-t,y,e));break;case 5:g.beginPath(),g.moveTo(l-C,d+C),g.lineTo(l,d-C),g.lineTo(l+C,d+C),g.closePath(),g.fill(),f&&g.stroke()}a||(h.display="inline-block",a=!0)}()},renderSvg:function(e,t,i,a,r){var s,l,d,h,g,c,u,f,p=a.y.length;0!=p&&(s=i.group(),l=r.dataToScreenX,d=r.dataToScreenY,h=t.width,g=t.height,f=0,function(){for(var e=null==a.border?"none":a.border;f<p;f++){c=l(a.x[f]),u=d(a.y[f]);var t=a.size[f],i=t/2;c1=h<c-i||c+i<0||g<u-i||u+i<0;var r,o,n=a.individualColors?a.color[f]:a.color;c1||(1==a.shape?s.rect(a.size[f],a.size[f]).translate(c-i,u-i).fill(n).style({stroke:e}):2==a.shape?s.circle(a.size[f]).translate(c-i,u-i).style({fill:n,stroke:e}):3==a.shape?s.rect(a.size[f]/Math.sqrt(2),a.size[f]/Math.sqrt(2)).translate(c,u-i).style({fill:n,stroke:e}).rotate(45):4==a.shape?(r=t/6,s.polyline([[-i,-r],[-r,-r],[-r,-i],[r,-i],[r,-r],[i,-r],[i,r],[r,r],[r,i],[-r,i],[-r,r],[-i,r],[-i,-r]]).translate(c,u).style({fill:n,stroke:e})):5==a.shape&&(o=Math.sqrt(3)/6*t,s.polyline([[c-i,u+o],[c,u-2*o],[c+i,u+o],[c-i,u+o]]).style({fill:n,stroke:e})))}s.clipWith(s.rect(h,g))}())},buildSvgLegendElements:function(e,t,i,r){var o=t.group(),n=t.group(),a=1.5*(v=12),s=a/2+1,l=s,d=a/2;switch(i.individualColors?(border="#000000",color="#ffffff"):(color=i.color,border="none",null!=i.border&&(border=i.border)),i.shape){case 1:o.rect(a,a).translate(s-d,l-d).fill({color:color,opacity:1}).stroke(border);break;case 2:o.circle(a).translate(s-d,l-d).fill(color).stroke(border);break;case 3:o.rect(a/Math.sqrt(2),a/Math.sqrt(2)).translate(s,l-d).fill(color).stroke(border).rotate(45);break;case 4:var h=a/6;o.polyline([[-d,-h],[-h,-h],[-h,-d],[h,-d],[h,-h],[d,-h],[d,h],[h,h],[h,d],[-h,d],[-h,h],[-d,h],[-d,-h]]).translate(s,l).fill(color).stroke(border);break;case 5:var g=Math.sqrt(3)/6*a;o.polyline([[s-d,l+g],[s,l-2*g],[s+d,l+g],[s-d,l+g]]).fill(color).stroke(border)}var c=0,u=e.legendDiv.children[1],f=i.individualColors&&i.colorPalette,p=(i.sizePalette,u&&e.legendDiv.children[1].children[0]&&e.legendDiv.children[1].children[0].children[0]?$.getComputedStyle(e.legendDiv.children[1].children[0].children[0],null):void 0),v=p?parseFloat(p.getPropertyValue("font-size")):void 0;fontFamily=p?p.getPropertyValue("font-family"):void 0;var m,y,C,b,I,A,w,x=p?p.getPropertyValue("font-weight"):void 0;return f&&(m=r("color"),n.text(m).font({family:fontFamily,size:v,weight:x}),y=t.group(),I=e.width,A=20,me.SvgColorPaletteViewer(y,i.colorPalette,e.legendDiv.children[1].children[0].children[1],{width:I,height:A}),y.translate(5,50),c=50+A,e.height+=50+A),i.sizePalette&&(C=r("size"),n.add(t.text(C).font({family:fontFamily,size:v,weight:x}).translate(0,c)),b=t.group(),I=e.width,A=35,w=f?e.legendDiv.children[1].children[1].children[1]:e.legendDiv.children[1].children[0].children[1],me.SvgSizePaletteViewer(b,i.sizePalette,w,{width:I,height:A}),b.translate(5,50+c),e.height+=50+A),t.front(),{thumbnail:o,content:n}}},me.Markers.shapes.box=e,me.Markers.shapes.circle=e,me.Markers.shapes.diamond=e,me.Markers.shapes.cross=e,me.Markers.shapes.triangle=e,me.Petal={prepare:function(e){if(!e.maxDelta){for(var t=0;isNaN(e.size.upper95[t])||isNaN(e.size.lower95[t]);)t++;var i=e.size.upper95[t]-e.size.lower95[t];for(t++;t<e.size.upper95.length;t++)isNaN(e.size.upper95[t])||isNaN(e.size.lower95[t])||(i=Math.max(i,e.size.upper95[t]-e.size.lower95[t]));e.maxDelta=i}if(null==e.y||null==e.y)throw"The mandatory property 'y' is undefined or null";if(!me.Utils.isArray(e.y))throw"The property 'y' must be an array of numbers";var r=e.y.length,o=new Int8Array(r);if(me.Utils.maskNaN(o,e.y),null==e.x)e.x=me.Utils.range(0,r-1);else{if(!me.Utils.isArray(e.x))throw"The property 'x' must be an array of numbers";if(e.x.length!=r)throw"Length of the array which is a value of the property 'x' differs from lenght of 'y'";me.Utils.maskNaN(o,e.x)}if(null!=e.border&&"none"!=e.border||(e.border=null),null==e.color&&(e.color=me.Markers.defaults.color),me.Utils.isArray(e.color)){if(e.color.length!=r)throw"Length of the array 'color' is different than length of the array 'y'";if(0<r&&"string"!=typeof e.color[0]){var n,a=e.colorPalette;null==a&&(a=me.Markers.defaults.colorPalette),"string"==typeof a&&(a=new me.ColorPalette.parse(a)),null!=a&&a.isNormalized&&(n=me.Utils.getMinMax(e.color),n=me.Utils.makeNonEqual(n),a=a.absolute(n.min,n.max)),e.colorPalette=a;for(var s=new Array(r),t=0;t<r;t++){var l,d=e.color[t];d!=d?o[t]=1:(l=a.getRgba(d),s[t]="rgba("+l.r+","+l.g+","+l.b+","+l.a+")")}e.color=s}e.individualColors=!0}else e.individualColors=!1;var h=new Array(r);if(me.Utils.isArray(e.size.lower95)&&me.Utils.isArray(e.size.upper95)){if(e.size.lower95.length!=r&&e.size.upper95.length!=r)throw"Length of the array 'size' is different than length of the array 'y'";if(0<r&&"number"==typeof e.size.lower95[0]&&"number"==typeof e.size.upper95[0]){for(var g=[],c=[],t=0;t<r;t++){var u=e.size.upper95[t],f=e.size.lower95[t];u!=u||f!=f?o[t]=1:(g[t]=e.size.upper95[t],c[t]=e.size.lower95[t])}e.upper95=g,e.lower95=c}}e.size="15.0";for(t=0;t<r;t++)h[t]=e.size;e.sizeMax=e.size,e.size=h;for(var p=0,t=0;t<r;t++)1===o[t]&&p++;if(0<p){p=r-p,e.x=me.Utils.applyMask(o,e.x,p),e.y=me.Utils.applyMask(o,e.y,p),e.size=me.Utils.applyMask(o,e.size,p),e.upper95=me.Utils.applyMask(o,e.upper95,p),e.lower95=me.Utils.applyMask(o,e.lower95,p),e.individualColors&&(e.color=me.Utils.applyMask(o,e.color,p));for(var v=Array(p),t=0,m=0;t<r;t++)0===o[t]&&(v[m++]=t);e.indices=v}else e.indices=me.Utils.range(0,r-1)},preRender:function(e,t,i,r,o){return e.individualColors||(o.fillStyle=e.color),null!=e.border&&(o.strokeStyle=e.border),e},draw:function(e,t,i,r,o){var n,a,s=r.dataToScreenX(e.x),l=r.dataToScreenY(e.y);s>i.width||s<0||l>i.height||l<0||(a=(n=e.size/2)*(1-(e.upper95-e.lower95)/e.maxDelta),e.maxDelta<=0&&(a=NaN),me.Petal.drawSample(o,s,l,a,n,e.color))},drawSample:function(e,t,i,r,o,n){var a,s,l=Math.random()*Math.PI*2;isNaN(r)?(a=0,s=o,e.fillStyle="rgba(0, 0, 0, 0.2)"):(a=(o-r)/2,s=(o+r)/2,e.fillStyle=n),e.strokeStyle="black",e.beginPath();for(var d=2*Math.PI/200,h=0;h<200;h++){var g=d*h,c=a*Math.sin(6*g+l)+s;0==h?e.moveTo(t+c*Math.cos(g),i+c*Math.sin(g)):e.lineTo(t+c*Math.cos(g),i+c*Math.sin(g))}e.stroke(),e.closePath(),e.fill(),e.strokeStyle="gray",e.beginPath(),e.arc(t,i,1,0,2*Math.PI),e.stroke(),e.closePath()},hitTest:function(e,t,i,r){var o=t.dataToScreenX(e.x),n=t.dataToScreenY(e.y),a=e.size/2;return!(i.x<o-a||i.x>o+a)&&!(i.y<n-a||i.y>n+a)},getLegend:function(e,i,t){var r=t.content,o=14;document.defaultView&&document.defaultView.getComputedStyle&&(o=parseFloat(document.defaultView.getComputedStyle(r[0],null).getPropertyValue("font-size"))),!isNaN(o)&&0!=o||(o=14);var n=t.thumbnail,a=1.5*o,s=a/2+1,l=a/2+1;n[0].width=n[0].height=2+a;n[0].style;var d,h,g,c=n.get(0).getContext("2d");c.clearRect(0,0,n[0].width,n[0].height);var u,f,p,v,m,y,C,b=0,I=0;e.individualColors&&e.colorPalette?(y=i("color"),0==b?(d=pe("<div style='width: 170px; margin-top: 5px; margin-bottom: 5px'></div>").appendTo(r),m=pe("<div class='idd-legend-item-property'></div>").text(y).appendTo(d),h=d[0].style,C=pe("<div style='width: 170px;'></div>").appendTo(d),g=new me.ColorPaletteViewer(C),b=2):m.text(y),g.palette=e.colorPalette,1==b&&(h.display="block",b=2)):2==b&&(h.display="none",b=1),e.individualColors||(e.color,null!=e.border&&e.border),function(){u=a;var e,t=i("size");0==I?(p=pe("<div style='width: 170px; margin-top: 5px; margin-bottom: 5px'></div>").appendTo(r),v=pe("<div class='idd-legend-item-property'></div>").text(t).appendTo(p),p[0].style,e=pe("<div style='width: 170px;'></div>").appendTo(p),new me.UncertaintySizePaletteViewer(e),I=2):v.text(t),f=u/2}(),me.Petal.drawSample(c,s,l,f/2,f,"gray")},getTooltipData:function(e,t){var i={},r={};return me.Utils.isArray(e.x)&&t<e.x.length&&(r.x=new me.AdaptiveFormatter(e.x),i.x=r.x.toString(e.x[t])),me.Utils.isArray(e.y)&&t<e.y.length&&(r.y=new me.AdaptiveFormatter(e.y),i.y=r.y.toString(e.y[t])),me.Utils.isArray(e.color)&&t<e.color.length&&(r.color=new me.AdaptiveFormatter(e.color),i.color=r.color.toString(e.color[t])),e.size&&(i.size={},me.Utils.isArray(e.size.lower95)&&t<e.size.lower95.length&&(r.lower95=new me.AdaptiveFormatter(e.size.lower95),i.size["lower 95%"]=r.lower95.toString(e.size.lower95[t])),me.Utils.isArray(e.size.upper95)&&t<e.size.upper95.length&&(r.upper95=new me.AdaptiveFormatter(e.size.upper95),i.size["upper 95%"]=r.upper95.toString(e.size.upper95[t]))),i.index=t,i},renderSvg:function(e,t,i,r,o){var n=r.y.length;if(0!=n){var a,s,l=i.group(),d=o.dataToScreenX,h=o.dataToScreenY,g=t.width,c=t.height,u=0,f=r.size[0];for(null==r.border||r.border;u<n;u++){a=d(r.x[u]),s=h(r.y[u]);var p=f/2,v=p*(1-(r.upper95[u]-r.lower95[u])/r.maxDelta),m=r.color[u];if(c1=g<a||a<0||c<s||s<0,!c1){for(var y=Math.random()*Math.PI*2,C=(p-v)/2,b=(p+v)/2,I=2*Math.PI/200,A=[],w=0;w<200;w++){var x=I*w,T=C*Math.sin(6*x+y)+b;A.push([a+T*Math.cos(x),s+T*Math.sin(x)])}l.polyline(A).fill(m).stroke("black"),l.circle(2).translate(a-1,s-1).fill("gray").stroke({width:2,color:"gray"})}}l.clipWith(l.rect(g,c))}}},me.BullEye={prepare:function(e){if(e.bullEyeShape=e.bullEyeShape?e.bullEyeShape.toLowerCase():"circle",null==e.y||null==e.y)throw"The mandatory property 'y' is undefined or null";if(!me.Utils.isArray(e.y))throw"The property 'y' must be an array of numbers";var t=e.y.length,i=new Int8Array(t);if(me.Utils.maskNaN(i,e.y),null==e.x)e.x=me.Utils.range(0,t-1);else{if(!me.Utils.isArray(e.x))throw"The property 'x' must be an array of numbers";if(e.x.length!=t)throw"Length of the array which is a value of the property 'x' differs from lenght of 'y'";me.Utils.maskNaN(i,e.x)}if(null!=e.border&&"none"!=e.border||(e.border=null),me.Utils.isArray(e.color.lower95)&&me.Utils.isArray(e.color.upper95)){if(e.color.lower95.length!=t&&e.color.upper95.length!=t)throw"Length of the array 'color' is different than length of the array 'y'";if(0<t&&void 0!==e.color.lower95[0]&&"string"!=typeof e.color.upper95[0]){null==(h=e.colorPalette)&&(h=me.Markers.defaults.colorPalette),"string"==typeof h&&(h=new me.ColorPalette.parse(h)),null!=h&&h.isNormalized&&(g={min:me.Utils.getMin(e.color.lower95),max:me.Utils.getMax(e.color.upper95)},g=me.Utils.makeNonEqual(g),h=h.absolute(g.min,g.max)),e.colorPalette=h;for(var r=[],o=[],n=0;n<t;n++){var a,s,l=e.color.upper95[n],d=e.color.lower95[n];l!=l||d!=d?i[n]=1:(a=h.getRgba(l),s=h.getRgba(d),r[n]="rgba("+a.r+","+a.g+","+a.b+","+a.a+")",o[n]="rgba("+s.r+","+s.g+","+s.b+","+s.a+")")}e.upper95=r,e.lower95=o}e.individualColors=!0}else e.individualColors=!1;var h,g,c=new Array(t);if(null==e.size&&(e.size=me.Markers.defaults.size),me.Utils.isArray(e.size)){if(e.size.length!=t)throw"Length of the array 'size' is different than length of the array 'y'";if(null!=e.sizePalette){(h=me.SizePalette.Create(e.sizePalette)).isNormalized&&(g=me.Utils.getMinMax(e.size),g=me.Utils.makeNonEqual(g),h=new me.SizePalette(!1,h.sizeRange,g)),e.sizePalette=h;for(n=0;n<t;n++){var u=e.size[n];u!=u?i[n]=1:c[n]=h.getSize(u)}}else e.sizeMax=me.Utils.getMax(e.size)}else{for(n=0;n<t;n++)c[n]=e.size;e.sizeMax=e.size}e.size=c;for(var f=0,n=0;n<t;n++)1===i[n]&&f++;if(0<f){f=t-f,e.x=me.Utils.applyMask(i,e.x,f),e.y=me.Utils.applyMask(i,e.y,f),e.size=me.Utils.applyMask(i,e.size,f),e.individualColors&&(e.upper95=me.Utils.applyMask(i,e.upper95,f),e.lower95=me.Utils.applyMask(i,e.lower95,f));for(var p=Array(f),n=0,v=0;n<t;n++)0===i[n]&&(p[v++]=n);e.indices=p}else e.indices=me.Utils.range(0,t-1)},preRender:function(e,t,i,r,o){return null!=e.border&&(o.strokeStyle=e.border),e},draw:function(e,t,i,r,o){e.y_mean;var n=e.upper95,a=e.lower95,s=e.size,l=s/2,d=r.dataToScreenX(e.x),h=r.dataToScreenY(e.y);d+l<0||d-l>i.width||h+l<0||h-l>i.height||(me.BullEye.drawBullEye(o,e.bullEyeShape,d,h,s,s,n),me.BullEye.drawBullEye(o,e.bullEyeShape,d,h,l,l,a))},drawBullEye:function(e,t,i,r,o,n,a,s){var l=o,d=n,h="none"!==s;e.strokeStyle=void 0!==s?s:"black",e.fillStyle=void 0!==a?a:"black";var g=i,c=r,u=Math.min(l,d),f=.5*u;switch(e.clearRect(0,0,l,d),t){case"box":h&&e.strokeRect(g-f,c-f,u,u),e.fillRect(g-f,c-f,u,u);break;case"circle":e.beginPath(),e.arc(g,c,f,0,2*Math.PI),h&&e.stroke(),e.fill();break;case"diamond":e.beginPath(),e.moveTo(g-f,c),e.lineTo(g,c-f),e.lineTo(g+f,c),e.lineTo(g,c+f),e.closePath(),h&&e.stroke(),e.fill();break;case"cross":var p=u/3/2;e.beginPath(),e.moveTo(g-f,c-p),e.lineTo(g-p,c-p),e.lineTo(g-p,c-f),e.lineTo(g+p,c-f),e.lineTo(g+p,c-p),e.lineTo(g+f,c-p),e.lineTo(g+f,c+p),e.lineTo(g+p,c+p),e.lineTo(g+p,c+f),e.lineTo(g-p,c+f),e.lineTo(g-p,c+p),e.lineTo(g-f,c+p),e.closePath(),h&&e.stroke(),e.fill();break;case"triangle":var v=Math.sqrt(3)/6*u;e.beginPath(),e.moveTo(g-f,c+v),e.lineTo(g,c-2*v),e.lineTo(g+f,c+v),e.closePath(),h&&e.stroke(),e.fill()}},hitTest:function(e,t,i,r){var o=t.dataToScreenX(e.x),n=t.dataToScreenY(e.y);return i.x>o-e.size/2&&i.x<o+e.size/2&&i.y>n-e.size/2&&i.y<n+e.size/2},getPadding:function(e){return{left:0,right:0,top:0,bottom:0}},getLegend:function(e,t,i){var r=i.content,o=14;document.defaultView&&document.defaultView.getComputedStyle&&(o=parseFloat(document.defaultView.getComputedStyle(r[0],null).getPropertyValue("font-size"))),!isNaN(o)&&0!=o||(o=14);var n=i.thumbnail,a=1.5*o,s=a/2+1,l=a/2+1;n[0].width=n[0].height=2+a;n[0].style;var d,h,g,c=n.get(0).getContext("2d");c.clearRect(0,0,n[0].width,n[0].height);var u,f,p,v,m,y,C,b,I,A=0,w=0;e.individualColors&&e.colorPalette?(y=t("color"),0==A?(d=pe("<div style='width: 170px; margin-top: 5px; margin-bottom: 5px'></div>").appendTo(r),m=pe("<div class='idd-legend-item-property'></div>").text(y).appendTo(d),h=d[0].style,C=pe("<div style='width: 170px;'></div>").appendTo(d),g=new me.ColorPaletteViewer(C),A=2):m.text(y),g.palette=e.colorPalette,1==A&&(h.display="block",A=2)):2==A&&(h.display="none",A=1),e.individualColors||(e.color,null!=e.border&&e.border),u=a,e.sizePalette&&(b=t("size"),0==w?(f=pe("<div style='width: 170px; margin-top: 5px; margin-bottom: 5px'></div>").appendTo(r),v=pe("<div class='idd-legend-item-property'></div>").text(b).appendTo(f),f[0].style,I=pe("<div style='width: 170px;'></div>").appendTo(f),p=new me.SizePaletteViewer(I),w=2):v.text(b),p.palette=me.SizePalette.Create(e.sizePalette)),me.BullEye.drawBullEye(c,e.bullEyeShape,s,l,u,u,"gray","gray")},getTooltipData:function(e,t){var i={},r={};return me.Utils.isArray(e.x)&&t<e.x.length&&(r.x=new me.AdaptiveFormatter(e.x),i.x=r.x.toString(e.x[t])),me.Utils.isArray(e.y)&&t<e.y.length&&(r.y=new me.AdaptiveFormatter(e.y),i.y=r.y.toString(e.y[t])),e.color&&(i.color={},me.Utils.isArray(e.color.lower95)&&t<e.color.lower95.length&&(r.lower95=new me.AdaptiveFormatter(e.color.lower95),i.color["lower 95%"]=r.lower95.toString(e.color.lower95[t])),me.Utils.isArray(e.color.upper95)&&t<e.color.upper95.length&&(r.upper95=new me.AdaptiveFormatter(e.color.upper95),i.color["upper 95%"]=r.upper95.toString(e.color.upper95[t]))),me.Utils.isArray(e.size)&&t<e.size.length&&(r.size=new me.AdaptiveFormatter(e.size),i.size=r.size.toString(e.size[t])),i.index=t,i},renderSvg:function(e,t,i,r,o){var n=r.y.length;if(0!=n){for(var a,s,l=i.group(),d=o.dataToScreenX,h=o.dataToScreenY,g=t.width,c=t.height,u=0,f=r.size[0],p=.5*f,v=.5*p;u<n;u++){a=d(r.x[u]),s=h(r.y[u]),c1=a+p<0||g<a-p||s+p<0||c<s-p;var m=r.individualColors?r.upper95[u]:r.upper95,y=r.individualColors?r.lower95[u]:r.lower95;if(!c1)switch(r.bullEyeShape){case"box":l.rect(f,f).translate(a-p,s-p).fill(m).stroke({width:.5,color:"black"}),l.rect(p,p).translate(a-v,s-v).fill(y).stroke({width:.5,color:"black"});break;case"circle":l.circle(f).translate(a-p,s-p).fill(m).stroke({width:.5,color:"black"}),l.circle(p).translate(a-v,s-v).fill(y).stroke({width:.5,color:"black"});break;case"diamond":l.rect(f/Math.sqrt(2),f/Math.sqrt(2)).translate(a,s-p).fill(m).stroke({width:.5,color:"black"}).rotate(45),l.rect(p/Math.sqrt(2),p/Math.sqrt(2)).translate(a,s-v).fill(y).stroke({width:.5,color:"black"}).rotate(45);break;case"cross":var C=f/6,b=p/6;l.polyline([[-p,-C],[-C,-C],[-C,-p],[C,-p],[C,-C],[p,-C],[p,C],[C,C],[C,p],[-C,p],[-C,C],[-p,C],[-p,-C]]).translate(a,s).fill(m).stroke({width:.5,color:"black"}),l.polyline([[-v,-b],[-b,-b],[-b,-v],[b,-v],[b,-b],[v,-b],[v,b],[b,b],[b,v],[-b,v],[-b,b],[-v,b],[-v,-b]]).translate(a,s).fill(y).stroke({width:.5,color:"black"});break;case"triangle":var I=Math.sqrt(3)/6*f,A=Math.sqrt(3)/6*p;l.polyline([[-p,I],[0,2*-I],[p,I],[-p,I]]).translate(a,s).fill(m).stroke({width:.5,color:"black"}),l.polyline([[-v,A],[0,2*-A],[v,A],[-v,A]]).translate(a,s).fill(y).stroke({width:.5,color:"black"})}}l.clipWith(l.rect(g,c))}}},me.BoxWhisker={prepare:function(e){if(null==e.y.median||null==e.y.median)throw"The mandatory property 'y' is undefined or null";if(!me.Utils.isArray(e.y.median))throw"The property 'y' must be an array of numbers";var t=e.y.median.length,i=new Int8Array(t);if(me.Utils.maskNaN(i,e.y.median),null==e.x)e.x=me.Utils.range(0,t-1);else{if(!me.Utils.isArray(e.x))throw"The property 'x' must be an array of numbers";if(e.x.length!=t)throw"Length of the array which is a value of the property 'x' differs from lenght of 'y'";me.Utils.maskNaN(i,e.x)}null!=e.border&&"none"!=e.border||(e.border=null),null!=e.thickness&&"none"!=e.thickness||(e.thickness=2),null==e.color&&(e.color=me.Markers.defaults.color);var r=new Array(t);if(null==e.size&&(e.size=me.Markers.defaults.size),me.Utils.isArray(e.y.lower95)&&me.Utils.isArray(e.y.upper95)){if(e.y.lower95.length!=t&&e.y.upper95.length!=t)throw"Length of the array 'y' is different than length of the array 'y'";if(0<t&&"number"==typeof e.y.lower95[0]&&"number"==typeof e.y.upper95[0]){for(var o=[],n=[],a=0;a<t;a++){var s=e.y.upper95[a],l=e.y.lower95[a];s!=s||l!=l?i[a]=1:(o[a]=e.y.upper95[a],n[a]=e.y.lower95[a])}e.upper95=o,e.lower95=n}}if(me.Utils.isArray(e.y.lower68)&&me.Utils.isArray(e.y.upper68)){if(e.y.lower68.length!=t&&e.y.upper68.length!=t)throw"Length of the array 'y' is different than length of the array 'y'";if(0<t&&"number"==typeof e.y.lower68[0]&&"number"==typeof e.y.upper68[0]){for(var d=[],h=[],a=0;a<t;a++){var g=e.y.upper68[a],c=e.y.lower68[a];g!=g||c!=c?i[a]=1:(d[a]=e.y.upper68[a],h[a]=e.y.lower68[a])}e.upper68=d,e.lower68=h}}for(a=0;a<t;a++)r[a]=e.size;e.sizeMax=e.size,e.size=r;for(var u=0,a=0;a<t;a++)1===i[a]&&u++;if(0<u){u=t-u,e.x=me.Utils.applyMask(i,e.x,u),e.y=me.Utils.applyMask(i,e.y.median,u),e.size=me.Utils.applyMask(i,e.size,u),e.upper95=me.Utils.applyMask(i,e.upper95,u),e.lower95=me.Utils.applyMask(i,e.lower95,u),e.upper68=me.Utils.applyMask(i,e.upper68,u),e.lower68=me.Utils.applyMask(i,e.lower68,u);for(var f=Array(u),a=0,p=0;a<t;a++)0===i[a]&&(f[p++]=a);e.indices=f}else e.y=e.y.median,e.indices=me.Utils.range(0,t-1)},preRender:function(e,t,i,r,o){return o.fillStyle=e.color,null!=e.border&&(o.strokeStyle=e.border),e},draw:function(e,t,i,r,o){var n=e.size,a=n/2,s=r.dataToScreenX(e.x),l=r.dataToScreenY(e.upper68),d=r.dataToScreenY(e.lower68),h=r.dataToScreenY(e.upper95),g=r.dataToScreenY(e.lower95),c=r.dataToScreenY(e.y);o.beginPath(),o.strokeStyle=void 0===e.border?"black":e.border,o.lineWidth=e.thickness,e.color&&o.fillRect(s-a,d,n,l-d),o.strokeRect(s-a,d,n,l-d),o.moveTo(s-a,h),o.lineTo(s+a,h),o.moveTo(s,h),o.lineTo(s,l),o.moveTo(s,d),o.lineTo(s,g),o.moveTo(s-a,g),o.lineTo(s+a,g),o.moveTo(s-a,c),o.lineTo(s+a,c),o.stroke(),void 0!==e.y_min&&(o.beginPath(),o.arc(s,r.dataToScreenY(e.y_min),a/2,0,2*Math.PI),o.stroke()),void 0!==e.y_max&&(o.beginPath(),o.arc(s,r.dataToScreenY(e.y_max),a/2,0,2*Math.PI),o.stroke())},hitTest:function(e,t,i,r){var o=t.dataToScreenX(e.x),n=t.dataToScreenY(void 0===e.y_min?e.lower95:e.y_min),a=t.dataToScreenY(void 0===e.y_max?e.upper95:e.y_max);return i.x>o-e.size/2&&i.x<o+e.size/2&&i.y>a&&i.y<n},getBoundingBox:function(e){e.size;var t=e.x,i=e.lower95?e.lower95:e.lower68?e.lower68:e.y,r=e.upper95?e.upper95:e.upper68?e.upper68:e.y;return{x:t,y:i,width:0,height:Math.abs(r-i)}},getPadding:function(e){return{left:0,right:0,top:0,bottom:0}},getLegend:function(n,e,t){var i=t.content,r=14;document.defaultView&&document.defaultView.getComputedStyle&&(r=parseFloat(document.defaultView.getComputedStyle(i[0],null).getPropertyValue("font-size"))),!isNaN(r)&&0!=r||(r=14);var o=t.thumbnail,a=1.5*r,s=a/2+1,l=a/2+1;o[0].width=o[0].height=2+a;o[0].style;var d,h,g,c,u,f,p,v,m,y,C,b,I=o.get(0).getContext("2d"),A=0,w=0;n.individualColors&&n.colorPalette?(m=e("color"),0==A?(d=pe("<div style='width: 170px; margin-top: 5px; margin-bottom: 5px'></div>").appendTo(i),v=pe("<div class='idd-legend-item-property'></div>").text(m).appendTo(d),h=d[0].style,y=pe("<div style='width: 170px;'></div>").appendTo(d),g=new me.ColorPaletteViewer(y),A=2):v.text(m),g.palette=n.colorPalette,1==A&&(h.display="block",A=2)):2==A&&(h.display="none",A=1),n.individualColors||(n.color,null!=n.border&&n.border),c=a,n.sizePalette&&(C=e("size"),0==w?(u=pe("<div style='width: 170px; margin-top: 5px; margin-bottom: 5px'></div>").appendTo(i),p=pe("<div class='idd-legend-item-property'></div>").text(C).appendTo(u),u[0].style,b=pe("<div style='width: 170px;'></div>").appendTo(u),f=new me.SizePaletteViewer(b),w=2):p.text(C),f.palette=me.SizePalette.Create(n.sizePalette)),function(){var e="string"==typeof n.color?n.color:"gray",t="string"==typeof n.border?n.border:"gray",i="none"!==t;I.strokeStyle=void 0!==t?t:"black",I.fillStyle=void 0!==e?e:"black";var r=.5*c,o=.5*r;I.clearRect(0,0,c,c),I.fillRect(s-r,l-o,c,r),i&&I.strokeRect(s-r,l-o,c,r),I.beginPath(),I.moveTo(s-r,l+r),I.lineTo(s+r,l+r),I.moveTo(s-r,l-r),I.lineTo(s+r,l-r),I.moveTo(s,l+r),I.lineTo(s,l+o),I.moveTo(s,l-r),I.lineTo(s,l-o),I.closePath(),i&&I.stroke(),i&&(I.beginPath(),I.moveTo(s-r,l),I.lineTo(s+r,l),I.stroke())}()},getTooltipData:function(e,t){var i={},r={};return me.Utils.isArray(e.x)&&t<e.x.length&&(r.x=new me.AdaptiveFormatter(e.x),i.x=r.x.toString(e.x[t])),e.y&&(i.y={},me.Utils.isArray(e.y.median)&&t<e.y.median.length&&(r.median=new me.AdaptiveFormatter(e.y.median),i.y.median=r.median.toString(e.y.median[t])),me.Utils.isArray(e.y.lower95)&&t<e.y.lower95.length&&(r.lower95=new me.AdaptiveFormatter(e.y.lower95),i.y["lower 95%"]=r.lower95.toString(e.y.lower95[t])),me.Utils.isArray(e.y.upper95)&&t<e.y.upper95.length&&(r.upper95=new me.AdaptiveFormatter(e.y.upper95),i.y["upper 95%"]=r.upper95.toString(e.y.upper95[t])),me.Utils.isArray(e.y.lower68)&&t<e.y.lower68.length&&(r.lower68=new me.AdaptiveFormatter(e.y.lower68),i.y["lower 68%"]=r.lower68.toString(e.y.lower68[t])),me.Utils.isArray(e.y.upper68)&&t<e.y.upper68.length&&(r.upper68=new me.AdaptiveFormatter(e.y.upper68),i.y["upper 68%"]=r.upper68.toString(e.y.upper68[t]))),me.Utils.isArray(e.size)&&t<e.size.length&&(r.size=new me.AdaptiveFormatter(e.size),i.size=r.size.toString(e.size[t])),i.index=t,i},renderSvg:function(e,t,i,r,o){var n=r.y.length;if(0!=n){for(var a,s,l,d,h,g,c,u=i.group(),f=o.dataToScreenX,p=o.dataToScreenY,v=t.width,m=t.height,y=0,C=r.size[0],b=C/2,I=r.color,A=null==r.border?"none":r.border,w=r.thickness;y<n;y++)a=f(r.x[y]),s=p(r.y[y]),l=r.upper68?p(r.upper68[y]):void 0,d=r.lower68?p(r.lower68[y]):void 0,h=r.upper95?p(r.upper95[y]):void 0,g=r.lower95?p(r.lower95[y]):void 0,c=p(r.y[y]),c1=a<0||v<a||s<0||m<s,c1||(null!=h&&null!=g&&(u.polyline([[a-b,h],[a+b,h]]).style({fill:"none",stroke:A,"stroke-width":w}),u.polyline([[a,h],[a,g]]).style({fill:"none",stroke:A,"stroke-width":w}),u.polyline([[a-b,g],[a+b,g]]).style({fill:"none",stroke:A,"stroke-width":w})),null!=l&&null!=d&&u.rect(C,Math.abs(l-d)).translate(a-b,l).fill(I).style({fill:I,stroke:A,"stroke-width":w}),u.polyline([[a-b,c],[a+b,c]]).style({fill:"none",stroke:A,"stroke-width":w}));u.clipWith(u.rect(v,m))}}},me.Bars={prepare:function(e){var t,i;if("h"==e.orientation){if(null==e.x||null==e.x)throw"The mandatory property 'x' is undefined or null";if(!me.Utils.isArray(e.x))throw"The property 'x' must be an array of numbers";if(t=e.x.length,i=new Int8Array(t),me.Utils.maskNaN(i,e.x),null==e.y)e.y=me.Utils.range(0,t-1);else{if(!me.Utils.isArray(e.y))throw"The property 'x' must be an array of numbers";if(e.y.length!=t)throw"Length of the array which is a value of the property 'x' differs from length of 'y'";me.Utils.maskNaN(i,e.y)}}else{if(null==e.y||null==e.y)throw"The mandatory property 'y' is undefined or null";if(!me.Utils.isArray(e.y))throw"The property 'y' must be an array of numbers";if(t=e.y.length,i=new Int8Array(t),me.Utils.maskNaN(i,e.y),null==e.x)e.x=me.Utils.range(0,t-1);else{if(!me.Utils.isArray(e.x))throw"The property 'x' must be an array of numbers";if(e.x.length!=t)throw"Length of the array which is a value of the property 'x' differs from length of 'y'";me.Utils.maskNaN(i,e.x)}}if(null!=e.border&&"none"!=e.border||(e.border=null),null!=e.shadow&&"none"!=e.shadow||(e.shadow=null),null==e.color&&(e.color=me.Markers.defaults.color),me.Utils.isArray(e.color)){if(e.color.length!=t)throw"Length of the array 'color' is different than length of the array 'y'";if(0<t&&"string"!=typeof e.color[0]){var r,o=e.colorPalette;null==o&&(o=me.Markers.defaults.colorPalette),"string"==typeof o&&(o=new me.ColorPalette.parse(o)),null!=o&&o.isNormalized&&(r=me.Utils.getMinMax(e.color),r=me.Utils.makeNonEqual(r),o=o.absolute(r.min,r.max)),e.colorPalette=o;for(var n=new Array(t),a=0;a<t;a++){var s,l=e.color[a];l!=l?i[a]=1:(s=o.getRgba(l),n[a]="rgba("+s.r+","+s.g+","+s.b+","+s.a+")")}e.color=n}e.individualColors=!0}else e.individualColors=!1;for(var d=0,a=0;a<t;a++)1===i[a]&&d++;if(0<d){d=t-d,e.x=me.Utils.applyMask(i,e.x,d),e.y=me.Utils.applyMask(i,e.y,d),e.individualColors&&(e.color=me.Utils.applyMask(i,e.color,d));for(var h=Array(d),a=0,g=0;a<t;a++)0===i[a]&&(h[g++]=a);e.indices=h}else e.indices=me.Utils.range(0,t-1)},draw:function(e,t,i,r,o){var n,a,s,l,d,h,g;if("h"==e.orientation){if(l=r.dataToScreenX(0),(s=r.dataToScreenX(e.x))<l&&(d=s,s=l,l=d),l>i.width||s<0)return;if(a=r.plotToScreenY(e.barWidth)-r.plotToScreenY(0),h=r.dataToScreenY(e.y)-a/2,(g=r.dataToScreenY(e.y)+a/2)>i.height||h<0)return}else{if(n=r.plotToScreenX(e.barWidth)-r.plotToScreenX(0),l=r.dataToScreenX(e.x)-n/2,s=r.dataToScreenX(e.x)+n/2,l>i.width||s<0)return;if((h=r.dataToScreenY(0))<(g=r.dataToScreenY(e.y))&&(d=h,h=g,g=d),g>i.height||h<0)return}e.shadow&&(o.fillStyle=e.shadow,o.fillRect(l+2,g+2,s-l,h-g)),o.fillStyle=e.color,o.fillRect(l,g,s-l,h-g),e.border&&(o.strokeStyle=e.border,o.strokeRect(l,g,s-l,h-g))},getPlotBoundingBox:function(e,t){var i,r,o,n,a=e.barWidth,s=t.dataToPlotX,l=t.dataToPlotY;return void 0===s&&(s=function(e){return e}),void 0===l&&(l=function(e){return e}),n="h"==e.orientation?(i=s(Math.min(0,e.x)),r=l(e.y)-a/2,o=s(Math.abs(e.x)),a):(i=s(e.x)-a/2,r=l(Math.min(0,e.y)),o=a,l(Math.abs(e.y))),{x:i,y:r,width:o,height:n}},hitTest:function(e,t,i,r){var o=e.barWidth,n="h"==e.orientation?Math.min(0,e.x):e.x-o/2,a="h"==e.orientation?e.y-o/2:Math.min(0,e.y);return"h"==e.orientation?!(r.x<n||r.x>n+Math.abs(e.x))&&!(r.y<a||r.y>a+o):!(r.x<n||r.x>n+o)&&!(r.y<a||r.y>a+Math.abs(e.y))},getLegend:function(e,t,i){var r=i.content,o=14;document.defaultView&&document.defaultView.getComputedStyle&&(o=parseFloat(document.defaultView.getComputedStyle(r[0],null).getPropertyValue("font-size"))),!isNaN(o)&&0!=o||(o=14);var n=i.thumbnail,a=1.5*o,s=a/3-.5,l=a/3*2,d=a,h=a/2,g=a/3;n[0].width=n[0].height=2+a;n[0].style;var c,u,f,p,v,m,y,C,b,I,A=n.get(0).getContext("2d"),w=0;e.individualColors&&e.colorPalette?(v=t("color"),0==w?(c=pe("<div style='width: 170px; margin-top: 5px; margin-bottom: 5px'></div>").appendTo(r),p=pe("<div class='idd-legend-item-property'></div>").text(v).appendTo(c),u=c[0].style,m=pe("<div style='width: 170px;'></div>").appendTo(c),f=new me.ColorPaletteViewer(m),w=2):p.text(v),f.palette=e.colorPalette,1==w&&(u.display="block",w=2)):2==w&&(u.display="none",w=1),e.individualColors||(e.color,null!=e.border&&e.border,null!=e.shadow&&e.shadow),y="string"==typeof e.color?e.color:"lightgray",C="string"==typeof e.border?e.border:"gray",b="string"==typeof e.shadow?e.shadow:"gray",I="none"!==C,A.clearRect(0,0,a,a),b&&(A.fillStyle=b,A.fillRect(1,1+h,s,a-h),s+=1,A.fillRect(s+1,1,l-s,a),l+=1,A.fillRect(l+1,1+g,d-l,a-g)),A.strokeStyle=void 0!==C?C:"black",A.fillStyle=void 0!==y?y:"black",A.fillStyle=y,A.fillRect(0,h,s,a-h),A.fillRect(s,0,l-s,a),A.fillRect(l,g,d-l,a-g),I&&(A.strokeStyle=C,A.strokeRect(0,h,s,a-h),A.strokeRect(s,0,l-s,a),A.strokeRect(l,g,d-l,a-g))},renderSvg:function(e,t,i,r,o){var n=r.y.length;if(0!=n){for(var a,s,l,d,h,g,c=i.group(),u=o.dataToScreenX,f=o.dataToScreenY,p=t.width,v=t.height,m=0,y=r.barWidth/2,C=null==r.border?"none":r.border,b=null==r.shadow?"none":r.shadow;m<n;m++){"h"==r.orientation?(l=u(0),s=u(r.x[m]),g=f(r.y[m]+y),h=f(r.y[m]-y),s<l&&(d=s,s=l,l=d)):(l=u(r.x[m]-y),s=u(r.x[m]+y),g=f(r.y[m]),(h=f(0))<g&&(d=h,h=g,g=d)),a=r.individualColors?r.color[m]:r.color,c1=s<0||p<l||h<0||v<g,c1||(c.polyline([[l+2,h+2],[l+2,g+2],[s+2,g+2],[s+2,h+2],[l+2,h+2]]).fill(b),c.polyline([[l,h],[l,g],[s,g],[s,h],[l,h]]).fill(a).stroke({width:1,color:C}))}c.clipWith(c.rect(p,v))}},buildSvgLegendElements:function(e,t,i,r){var o=t.group(),n=t.group(),a=1.5*(C=12),s=a/3-.5,l=a/3*2,d=a,h=a/2,g=a/3,c="none";i.individualColors?(border="#000000",color="lightgrey",c="grey"):(color=i.color,border="none",null!=i.border&&(border=i.border),null!=i.shadow&&(c=i.shadow)),o.polyline([[1,1+a],[1,1+h],[s+1,1+h],[s+1,1+a],[1,1+a]]).fill(c),o.polyline([[0,a],[0,h],[s,h],[s,a],[0,a]]).fill(color).stroke({width:.2,color:border}),s+=1,o.polyline([[s+1,1+a],[s+1,1],[l+1,1],[l+1,1+a],[s+1,1+a]]).fill(c),o.polyline([[s,a],[s,0],[l,0],[l,a],[s,a]]).fill(color).stroke({width:.2,color:border}),l+=1,o.polyline([[l+1,1+a],[l+1,1+g],[1+d,1+g],[1+d,1+a],[l+1,1+a]]).fill(c),o.polyline([[l,a],[l,g],[d,g],[d,a],[l,a]]).fill(color).stroke({width:.2,color:border});var u,f,p,v=e.legendDiv.children[1],m=i.individualColors&&i.colorPalette,y=v&&e.legendDiv.children[1].children[0]&&e.legendDiv.children[1].children[0].children[0]?$.getComputedStyle(e.legendDiv.children[1].children[0].children[0],null):void 0,C=y?parseFloat(y.getPropertyValue("font-size")):void 0,b=y?y.getPropertyValue("font-family"):void 0,I=y?y.getPropertyValue("font-weight"):void 0;return m&&(u=r("color"),n.text(u).font({family:b,size:C,weight:I}),f=t.group(),p=e.width,me.SvgColorPaletteViewer(f,i.colorPalette,e.legendDiv.children[1].children[0].children[1],{width:p,height:20}),f.translate(5,50),shiftsizePalette=70,e.height+=70),t.front(),{thumbnail:o,content:n}}},me.Markers.shapes.boxwhisker=me.BoxWhisker,me.Markers.shapes.petals=me.Petal,me.Markers.shapes.bulleye=me.BullEye,me.Markers.shapes.bars=me.Bars,me.Area=function(e,t){var c,u,f,n="rgba(65, 105, 237, 0.4)",i=me.Utils.getDataSourceFunction(e,me.readCsv)(e);this.base=me.CanvasPlot,this.base(e,t);var l=n;i&&(l=void 0!==i.fill?i.fill:n),this.draw=function(e){var t=e.y1;if(!t)throw"Data series y1 is undefined";var i=t.length,r=e.y2;if(!r)throw"Data series y2 is undefined";if(r.length!==i)throw"Data series y1 and y2 have different lengths";var o=e.x;if((o=o||me.Utils.range(0,i-1)).length!==i)throw"Data series x and y1, y2 have different lengths";u=t,f=r,c=o,l=void 0!==e.fill?e.fill:n,this.invalidateLocalBounds(),this.requestNextFrameOrUpdate(),this.fireAppearanceChanged()},this.computeLocalBounds=function(){var e=this.xDataTransform&&this.xDataTransform.dataToPlot,t=this.yDataTransform&&this.yDataTransform.dataToPlot,i=me.Utils.getBoundingBoxForArrays(c,u,e,t),r=me.Utils.getBoundingBoxForArrays(c,f,e,t);return me.Utils.unionRects(i,r)},this.getLocalPadding=function(){return{left:0,right:0,top:0,bottom:0}},this.getTooltip=function(e,t,i,r){if(void 0!==c&&null!=u&&null!=f&&(0!=u.length&&this.isVisible)){var o=this.getContext(!1);if(void 0!==o){for(var n=this.getTransform(),a=n.dataToScreenX(e),s=n.dataToScreenY(t),l=o.getImageData(a-1,s-1,3,3),d=0,h=0;h<l.data.length;h++)0===l.data[h]&&d++;if(d!==l.data.length){var g=pe("<div></div>");return pe("<div></div>").addClass("idd-tooltip-name").text(this.name||"area").appendTo(g),g}}}},this.renderCore=function(e,t){me.Area.prototype.renderCore.call(this,e,t);var i=this.getContext(!0);me.Area.render.call(this,c,u,f,l,e,t,i)},this.renderCoreSvg=function(e,t,i){me.Area.renderSvg.call(this,e,t,i,c,u,f,l)};this.onDataTransformChanged=function(e){this.invalidateLocalBounds(),me.Area.prototype.onDataTransformChanged.call(this,e)},Object.defineProperty(this,"fill",{get:function(){return l},set:function(e){e!=l&&(l=e,this.fireAppearanceChanged("fill"),this.requestNextFrameOrUpdate())},configurable:!1}),this.getLegend=function(){var e=this,i=pe("<canvas></canvas>");i[0].width=40,i[0].height=40;var r=i.get(0).getContext("2d");r.globalAlpha=1,r.strokeStyle=l,r.fillStyle=l,r.beginPath(),r.moveTo(0,0),r.lineTo(0,10),r.lineTo(30,40),r.lineTo(40,40),r.lineTo(40,30),r.lineTo(10,0),r.lineTo(0,0),r.fill(),r.stroke(),r.closePath();function o(){t.text(e.name)}var t=pe("<span></span>");o(),this.host.bind("appearanceChanged",function(e,t){t&&"name"!=t||o(),r.clearRect(0,0,i[0].width,i[0].height),r.strokeStyle=l,r.fillStyle=l,r.beginPath(),r.moveTo(0,0),r.lineTo(0,10),r.lineTo(30,40),r.lineTo(40,40),r.lineTo(40,30),r.lineTo(10,0),r.lineTo(0,0),r.fill(),r.stroke(),r.closePath()});e=this;return{name:t,legend:{thumbnail:i,content:void 0},onLegendRemove:function(){e.host.unbind("appearanceChanged")}}},this.buildSvgLegend=function(e,t){e.height=30,t.add(t.rect(e.width,e.height).fill("white").opacity(.5));var i=me.ColorPalette.colorFromString(l),r="rgb("+i.r+","+i.g+","+i.b+")";t.add(t.polyline([[0,0],[0,4.5],[13.5,18],[18,18],[18,13.5],[4.5,0],[0,0]]).fill(r).opacity(i.a).translate(5,5));var o=$.getComputedStyle(e.legendDiv.children[0].children[1],null),n=parseFloat(o.getPropertyValue("font-size")),a=o.getPropertyValue("font-family"),s=o?o.getPropertyValue("font-weight"):void 0;t.add(t.text(this.name).font({family:a,size:n,weight:s}).translate(40,0)),t.front()},i&&i.x&&i.y1&&i.y2&&this.draw(i)},me.Area.prototype=new me.CanvasPlot,me.Area.render=function(e,t,i,r,o,n,a){if(void 0!==e&&null!=t&&null!=i){var s=t.length;if(0!=s){var l=this.getTransform(),d=l.dataToScreenX,h=l.dataToScreenY;a.fillStyle=r;for(var g=[],c=void 0,u=0;u<s;u++)isNaN(e[u])||isNaN(t[u])||isNaN(i[u])?c=void 0===c?u:void g.push([c,u]):void 0===c?c=u:u===s-1&&(g.push([c,u]),c=void 0);for(var f=g.length,u=0;u<f;u++){a.beginPath();var p=g[u];a.moveTo(d(e[p[0]]),h(t[p[0]]));for(var v=p[0]+1;v<=p[1];v++)a.lineTo(d(e[v]),h(t[v]));for(v=p[1];v>=p[0];v--)a.lineTo(d(e[v]),h(i[v]));a.fill()}}}},me.Area.renderSvg=function(e,t,i,r,o,n,a){if(void 0!==r&&null!=o&&null!=n){var s=o.length;if(0!=s){for(var l=this.getTransform(),d=l.dataToScreenX,h=l.dataToScreenY,g=i.group(),c=t.width,u=t.height,f=[],p=void 0,v=0;v<s;v++)isNaN(r[v])||isNaN(o[v])||isNaN(n[v])?void 0!==p&&(f.push([p,v-1]),p=void 0):void 0===p?p=v:v===s-1&&(f.push([p,v]),p=void 0);for(var m=[],y=f.length,C=me.ColorPalette.colorFromString(a),b="rgb("+C.r+","+C.g+","+C.b+")",v=0;v<y;v++){var I=f[v];(m=[]).push([d(r[I[0]]),h(o[I[0]])]);for(var A=I[0]+1;A<=I[1];A++)m.push([d(r[A]),h(o[A])]);for(A=I[1];A>=I[0];A--)m.push([d(r[A]),h(n[A])]);m.push([d(r[I[0]]),h(o[I[0]])]),g.polyline(m).fill(b).opacity(C.a)}g.clipWith(g.rect(c,u))}}},me.heatmapBackgroundRenderer=void 0,me.Heatmap=function(e,A){var t,i=me.Utils.getDataSourceFunction(e,me.readCsv2d)(e);if(i&&void 0!==i.y&&void 0!==i.values){var r=i.y,o=i.values,n=r.length,a=o.length;if(1<n&&0<a&&r[0]>r[1]){r.reverse();for(var s=0;s<n;s++)o[s].reverse()}}if(this.base=me.CanvasPlot,this.base(e,A),e){null==me.heatmapBackgroundRenderer&&(me.heatmapBackgroundRenderer=new me.SharedRenderWorker(void 0===me.heatmapBackgroundRendererCodeBase64||/PhantomJS/.test($.navigator.userAgent)||0<me.Utils.getIEVersion()?me.HeatmapworkerPath?me.HeatmapworkerPath+"idd.heatmapworker.js":"idd.heatmapworker.js":(t=new Blob([$.atob(me.heatmapBackgroundRendererCodeBase64)],{type:"text/javascript"}),$.URL.createObjectURL(t)),function(e,t){e.onRenderTaskCompleted(t)}));function v(e){if(e)try{V="string"==typeof e?me.ColorPalette.parse(e):e,Z=me.ColorPalette.toArray(V,512)}catch(e){$.console&&console.error("Failed to initialize the palette")}}function m(e){R=Math.min(1,Math.max(0,e))}var w,x,T,S,y,C,b,P,k,M,I,D,G,N,R,B,V,F,Z,L,z,U,Y,O,W,X,f,E=document.createElement("canvas");m(i&&void 0!==i.opacity?parseFloat(i.opacity):1),v(i&&void 0!==i.colorPalette?i.colorPalette:me.palettes.grayscale);function H(e){var t=e.length;if(!(t<1)){var i=e[0].length;if(!(i<1)){for(var r,o=r=e[0][0],n=0;n<t;n++)for(var a=e[n],s=0;s<i;s++){var l=a[s];l==l&&((r<l||isNaN(r))&&(r=l),(l<o||isNaN(o))&&(o=l))}return{min:o,max:r}}}}function j(e,t,i,r){if(!e||!t||!i)return{};if(!e.length||!t.length||i.v&&!i.v.length||i.m&&(!i.m.length||!i.lb68.length||!i.ub68.length))return{};e=Array.prototype.slice.call(e),t=Array.prototype.slice.call(t),i.v?i.v=Array.prototype.slice.call(i.v):i.m&&(i.m=Array.prototype.slice.call(i.m),i.lb68=Array.prototype.slice.call(i.lb68),i.ub68=Array.prototype.slice.call(i.ub68)),!i.v||e.length===t.length&&e.length===i.v.length&&t.length===i.v.length?!i.m||e.length===t.length&&e.length===i.m.length&&t.length===i.m.length&&i.m.length===i.lb68.length&&i.m.length===i.ub68.length||(e.length=t.length=i.m.length=i.lb68.length=i.ub68.length=Math.min(e.length,t.length,i.m.length,i.lb68.length,i.ub68.length)):e.length=t.length=i.v.length=Math.min(e.length,t.length,i.v.length);var o,n,a,s=e.map(function(e,t){return{v:e,i:t}}),l=t.map(function(e,t){return{v:e,i:t}}),d=s.sort(function(e,t){return e.v<t.v?-1:e.v>t.v?1:0}),h=l.sort(function(e,t){return e.v<t.v?-1:e.v>t.v?1:0}),g=d.filter(function(e,t){return!t||e.v!=d[t-1].v}).map(function(e){return e.v}),c=h.filter(function(e,t){return!t||e.v!=h[t-1].v}).map(function(e){return e.v}),u=[],f=[],p=0;d.forEach(function(e,t){return u[e.i]=t?e.v!=d[t-1].v?++p:p:0}),p=0,h.forEach(function(e,t){return f[e.i]=t?e.v!=h[t-1].v?++p:p:0});function v(e,t){for(var i=[],r=0;r<e;++r){i[r]=[];for(var o=0;o<t;++o)i[r][o]=NaN}return i}if(i.v)for(o=v(g.length,c.length),p=0;p<i.v.length;++p)o[u[p]][f[p]]=i.v[p];else for(m=v(g.length,c.length),n=v(g.length,c.length),a=v(g.length,c.length),p=0;p<i.m.length;++p)m[u[p]][f[p]]=i.m[p],n[u[p]][f[p]]=i.lb68[p],a[u[p]][f[p]]=i.ub68[p];if(r){if(2<=g.length){var m,y=[];for(y.push(g[0]-(g[1]-g[0])/2),m=1;m<g.length;m++)y.push(g[m]-(g[m]-g[m-1])/2);y.push(g[g.length-1]+(g[g.length-1]-g[g.length-2])/2),g=y}if(2<=c.length){var C,b=[];for(b.push(c[0]-(c[1]-c[0])/2),C=1;C<c.length;C++)b.push(c[C]-(c[C]-c[C-1])/2);b.push(c[c.length-1]+(c[c.length-1]-c[c.length-2])/2),c=b}}return{x:g,y:c,values:o,m:m,l68:n,u68:a}}function K(){var e=H(S);P=e.min,k=e.max,M&&(P=Math.max(P,I),k=Math.max(k,I),G=me.Utils.log10(P),N=me.Utils.log10(k))}var Q,l=this;if(this.onRenderTaskCompleted=function(e){Q=e,E.width===Q.width&&E.height===Q.height||(E.width=Q.width,E.height=Q.height),E.getContext("2d").putImageData(Q.image,0,0),l.requestNextFrame()},this.draw=function(e,t){var i=e.values;if(!i)throw"Data series f is undefined";var r,o,n=void 0!==i.median&&!me.Utils.isArray(i.median[0])||!me.Utils.isArray(i[0]),a=e.x,s=e.y;if(null==z&&null==L&&(z=e.interval),L=e.interval,M=void 0!==e.logPalette&&e.logPalette,I=e.logTolerance?e.logTolerance:1e-12,i.median?(null==U&&(r=pe("<div></div>").attr("data-idd-name","heatmap__nav_").appendTo(this.host),(U=new me.Heatmap(r,this.master)).getLegend=function(){},this.addChild(U),U.getTooltip=function(e,t,i,r){}),n?(o=j(a,s,{v:void 0,m:i.median,lb68:i.lower68,ub68:i.upper68},"discrete"===e.treatAs),T=o.x,x=o.y,S=o.m,b=o.m,C=o.l68,y=o.u68,U.x=o.x,U.y=o.y,U.f_median=o.m,U.f_l68=o.l68,U.f_u68=o.u68):(T=a,x=s,S=i.median,b=i.median,C=i.lower68,y=i.upper68,U.x=o.x,U.y=o.y,U.f_median=i.median68,U.f_l68=i.lower68,U.f_u68=i.upper68),L&&_()):(U&&U.remove(),U=void 0,n?(o=j(a,s,{v:i},"discrete"===e.treatAs),T=o.x,x=o.y,S=o.values):(S=i,T=a,x=s)),M){D=new Array(S.length);for(var l=0;l<S.length;l++)for(var d=S[l],h=D[l]=new Float32Array(d.length),g=0;g<d.length;g++)h[g]=me.Utils.log10(d[g])}X=W=O=Y=void 0;var c=b?b.length:S.length,u=b?b[0].length:S[0].length;if(T){if(T.length!=c&&T.length!=c+1)throw"Data series x must have length equal or one more than length of data series f by first dimension"}else T=me.Utils.range(0,c);if(x){if(x.length!=u&&x.length!=u+1)throw"Data series y must have length equal or one more than length of data series f by second dimension"}else x=me.Utils.range(0,u);if(T.length==c){if(x.length!=u)throw"Data series y must have length equal to length of data series f by second dimension";B="gradient"}else{if(x.length!=u+1)throw"Data series y must have length equal to one more than length of data series f by second dimension";B="matrix"}if(T.length<2)throw"Data series x must have at least 2 elements by each dimension";if(x.length<2)throw"Data series y must have at least 2 elements by each dimension";e&&void 0!==e.opacity&&m(parseFloat(e.opacity)),e&&void 0!==e.colorPalette&&v(e.colorPalette),V.isNormalized&&K(),F=!0;var f=this.invalidateLocalBounds(),p=this.getLocalBounds();me.Utils.equalRect(f,p)?this.requestNextFrame():this.requestNextFrameOrUpdate(),this.setTitles(t,!0),this.fireAppearanceChanged()},this.computeLocalBounds=function(){var e;if(T&&x){for(var t,i,r,o,n=T.length,a=x.length,s=0;s<n&&(t=T[s])!=t;s++);for(s=n;0<=--s&&(i=T[s])!=i;);for(s=0;s<a&&(r=x[s])!=r;s++);for(s=a;0<=--s&&(o=x[s])!=o;);var l=this.xDataTransform&&this.xDataTransform.dataToPlot,d=this.yDataTransform&&this.yDataTransform.dataToPlot;l&&(t=l(t),i=l(i)),d&&(r=d(r),o=d(o)),e={x:Math.min(t,i),y:Math.min(r,o),width:Math.abs(i-t),height:Math.abs(o-r)}}return e},"undefined"==typeof Modernizr||!e||Modernizr.webworkers&&Modernizr.postmessage){var J=void 0,q=void 0;this.renderCore=function(e,t){me.Heatmap.prototype.renderCore.call(this,e,t);var i,r,o,n,a,s,l,d,h,g,c,u,f,p,v,m,y,C,b,I=this.getContext(!0);null!=T&&null!=x&&null!=S&&(r=(i=this.coordinateTransform).plotToScreenX,o=i.plotToScreenY,n=this.getLocalBounds(),(a=me.Utils.intersect(n,e))&&(s=!0,void 0!==A.mapControl&&(l=n.x,d=n.x+n.width/2,h=n.x+n.width,void 0===J&&(g={fillColor:new Microsoft.Maps.Color(120,120,120,120),strokeColor:new Microsoft.Maps.Color(120,120,120,120),strokeThickness:0},J=new Microsoft.Maps.Polygon([new Microsoft.Maps.Location(me.mercatorTransform.plotToData(n.y),l),new Microsoft.Maps.Location(me.mercatorTransform.plotToData(n.y),d),new Microsoft.Maps.Location(me.mercatorTransform.plotToData(n.y+n.height),d),new Microsoft.Maps.Location(me.mercatorTransform.plotToData(n.y+n.height),l)],g),q=new Microsoft.Maps.Polygon([new Microsoft.Maps.Location(me.mercatorTransform.plotToData(n.y),d),new Microsoft.Maps.Location(me.mercatorTransform.plotToData(n.y),h),new Microsoft.Maps.Location(me.mercatorTransform.plotToData(n.y+n.height),h),new Microsoft.Maps.Location(me.mercatorTransform.plotToData(n.y+n.height),d)],g),A.mapControl.entities.push(J),A.mapControl.entities.push(q)),F&&(J.setLocations([new Microsoft.Maps.Location(me.mercatorTransform.plotToData(n.y),l),new Microsoft.Maps.Location(me.mercatorTransform.plotToData(n.y),d),new Microsoft.Maps.Location(me.mercatorTransform.plotToData(n.y+n.height),d),new Microsoft.Maps.Location(me.mercatorTransform.plotToData(n.y+n.height),l)]),q.setLocations([new Microsoft.Maps.Location(me.mercatorTransform.plotToData(n.y),d),new Microsoft.Maps.Location(me.mercatorTransform.plotToData(n.y),h),new Microsoft.Maps.Location(me.mercatorTransform.plotToData(n.y+n.height),h),new Microsoft.Maps.Location(me.mercatorTransform.plotToData(n.y+n.height),d)])),s=!A.isInAnimation,J.setOptions({visible:A.isInAnimation}),q.setOptions({visible:A.isInAnimation})),s&&(c={left:Math.floor(r(a.x)),width:Math.ceil(i.plotToScreenWidth(a.width)),top:Math.floor(o(a.y+a.height)),height:Math.ceil(i.plotToScreenHeight(a.height))},u=i.getScale(),f=i.getOffset(),I.fillStyle="rgba(200,200,200,0.3)",I.fillRect(c.left,c.top,c.width,c.height),Q&&me.Utils.intersect(Q.plotRect,e)&&(p=r(Q.plotRect.x),v=o(Q.plotRect.y+Q.plotRect.height),1!=R&&(m=I.globalAlpha,I.globalAlpha=R),u.x!=Q.scaleX||u.y!=Q.scaleY?(y=u.x/Q.scaleX,C=u.y/Q.scaleY,I.drawImage(E,0,0,Q.image.width,Q.image.height,p,v,y*Q.image.width,C*Q.image.height)):I.drawImage(E,p,v),1!=R&&(I.globalAlpha=m)),!F&&(this.master.isInAnimation||Q&&Q.scaleX==u.x&&Q.scaleY==u.y&&me.Utils.includes(Q.plotRect,a))||(w&&w.width===c.width&&w.height===c.height||(w=I.createImageData(c.width,c.height)),b={image:w,width:w.width,height:w.height,x:T,y:x,f:M?D:S,fmin:M?G:P,fmax:M?N:k,plotRect:a,scaleX:u.x,scaleY:u.y,offsetX:f.x-c.left,offsetY:f.y-c.top,palette:{isNormalized:V.isNormalized,range:V.range,points:V.points,colors:Z},xDataTransform:this.xDataTransform&&this.xDataTransform.type,yDataTransform:this.yDataTransform&&this.yDataTransform.type},me.heatmapBackgroundRenderer.enqueue(b,this),F=!1))))},this.renderCoreSvg=function(e,t,i){var r,o,n,a,s,l,d,h=i.group();null!=T&&null!=x&&null!=S&&(t.width,t.height,o=(r=this.coordinateTransform).plotToScreenX,n=r.plotToScreenY,a=this.getLocalBounds(),(s=me.Utils.intersect(a,e))&&(l={left:Math.floor(o(s.x)),width:Math.ceil(r.plotToScreenWidth(s.width)),top:Math.floor(n(s.y+s.height)),height:Math.ceil(r.plotToScreenHeight(s.height))},d=E.toDataURL("image/png"),h.image(d,w.width,w.height).opacity(R).clipWith(h.rect(l.width,l.height)),h.translate(l.left,l.top)))},this.onIsRenderedChanged=function(){this.isRendered||me.heatmapBackgroundRenderer.cancelPending(this)},this.onDataTransformChanged=function(e){this.invalidateLocalBounds(),me.Heatmap.prototype.onDataTransformChanged.call(this,e)};this.getValue=function(e,t,i){var r=T.length,o=x.length;if(0==r||0==o)return null;var n,a,s,l,d,h,g,c,u,f=function(e,t){var i=T.length,r=x.length;if(0!=i&&0!=r&&!(e<T[0]||t<x[0]||e>T[i-1]||t>x[r-1])){for(var o,n=1;n<i;n++)if(e<=T[n]){if(isNaN(T[n-1]))return NaN;break}for(o=1;o<r;o++)if(t<=x[o]){if(isNaN(x[o-1]))return NaN;break}return i<=n||r<=o?NaN:{iLeft:n-1,jBottom:o-1}}}(e,t);return null==f?null:f!=f?"<div>"+(this.name||"heatmap")+": (unknown value)</div>":"gradient"===B?(h=i[f.iLeft][f.jBottom+1],g=i[f.iLeft][f.jBottom],c=i[f.iLeft+1][f.jBottom+1],u=i[f.iLeft+1][f.jBottom],isNaN(h)||isNaN(g)||isNaN(c)||isNaN(u)?NaN:(n=x[f.jBottom],s=(h-g)/((a=x[f.jBottom+1])-n)*(t-n)+g,l=(c-u)/(a-n)*(t-n)+u,d=T[f.iLeft],(l-s)/(T[f.iLeft+1]-d)*(e-d)+s)):i[f.iLeft][f.jBottom]};var _=function(){for(var e=U.f_median,t=new Array(e.length),i=0;i<e.length;i++){var r=e[i];t[i]=new Array(r.length);for(var o=0;o<r.length;o++)t[i][o]=U.f_l68[i][o]<L.max&&U.f_u68[i][o]>L.min?0:1}U.draw({x:U.x,y:U.y,values:t,opacity:.5,colorPalette:me.ColorPalette.parse("0=#00000000=#00000080=1")}),U.isVisible=!0};this.getTooltip=function(e,t,i,r,o){if(void 0!==S){var n=this;if(this.isVisible&&!this.IsErrorVisible){var a={x:e,y:t};if(void 0===y||void 0===C||void 0===b){var s=H(S);Y=me.AdaptiveFormatter(s.min,s.max);var l=pe("<div></div>");pe("<div></div>").addClass("idd-tooltip-name").text(this.name||"heatmap").appendTo(l);var d=this.getValue(a.x,a.y,S,B);if(null==d)return;var h=this.getTitle("values");return pe("<div>"+h+": "+Y.toString(d)+"</div>").appendTo(l),l}s=H(b);O=me.AdaptiveFormatter(s.min,s.max),s=H(C),W=me.AdaptiveFormatter(s.min,s.max),s=H(y),X=me.AdaptiveFormatter(s.min,s.max);l=pe("<div></div>");pe("<div></div>").addClass("idd-tooltip-name").text(this.name||"heatmap").appendTo(l);var g=this.getValue(a.x,a.y,C),c=this.getValue(a.x,a.y,y),u=this.getValue(a.x,a.y,b);if(null!=g&&null!=c&&null!=u){var h=this.getTitle("values"),f=pe("<div></div>").addClass("idd-tooltip-compositevalue");f.append(pe("<div>median: "+O.toString(u)+"</div>")),f.append(pe("<div>lower 68%: "+W.toString(g)+"</div>")),f.append(pe("<div>upper 68%: "+X.toString(c)+"</div>"));var p=pe("<div></div>");p.append(pe("<div>"+h+":</div>")).append(f),p.appendTo(l);var v=pe("<div></div>").css("display","inline-block").appendTo(l),m=pe("<div></div>").addClass("checkButton").appendTo(v);return L&&(o?L!=z?(L={min:g,max:c},pe(".checkButton").removeClass("checkButton-checked"),m.addClass("checkButton-checked"),this.fireAppearanceChanged("interval")):pe(".checkButton").removeClass("checkButton-checked"):(pe(".checkButton").removeClass("checkButton-checked"),m.addClass("checkButton-checked")),_()),m.click(function(){m.hasClass("checkButton-checked")?(m.removeClass("checkButton-checked"),z?(L=z,_()):(L=void 0,U.isVisible=!1)):(pe(".checkButton").removeClass("checkButton-checked"),m.addClass("checkButton-checked"),L={min:g,max:c},_()),n.fireAppearanceChanged("interval")}),pe(pe("<span style='margin-left:3px;'>highlight similar</span>")).appendTo(v),l}}}},Object.defineProperty(this,"palette",{get:function(){return V},set:function(e){if(e!=V){if(!e)throw"Heatmap palette is undefined";V&&e.isNormalized&&!V.isNormalized&&S&&K(),v(e),Q=void 0,this.fireAppearanceChanged("palette"),this.requestNextFrame()}},configurable:!1}),Object.defineProperty(this,"opacity",{get:function(){return R},set:function(e){if(!e)throw"Heatmap opacity is undefined";e!=R&&(m(e),this.fireAppearanceChanged("opacity"),this.requestNextFrame())},configurable:!1}),Object.defineProperty(this,"mode",{get:function(){return B},configurable:!1}),this.getLegend=function(){function r(){o.text(i.name)}var e=pe("<canvas></canvas>"),t=pe("<div></div>"),i=this,o=pe("<span></span>");r();function n(){l=i.getTitle("values"),0==g?(c.empty(),d=pe("<div class='idd-legend-item-property'></div>").text(l).appendTo(c),s=pe("<div style='width: 170px; margin-top: 5px; margin-bottom: 5px;'></div>").appendTo(c),a=new me.ColorPaletteViewer(s,V,{logAxis:M}),g=2):d.text(l),V&&V.isNormalized&&(a.dataRange={min:P,max:k})}var a,s,l,d,h,g=0,c=pe("<div class='idd-legend-item-palette'></div>").appendTo(t);n();function u(){null==L&&h?h.empty():L&&(f=me.AdaptiveFormatter(L.min,L.max),h?h.text("highlighted interval: "+f.toString(L.min)+", "+f.toString(L.max)):h=pe("<div style='font-size:14px;'>highlighted interval: "+f.toString(L.min)+", "+f.toString(L.max)+"</div>").appendTo(t))}u(),this.host.bind("appearanceChanged",function(e,t){t&&"name"!=t||r(),t&&"interval"!=t||u(),t&&"values"!=t&&"colorPalette"!=t||(g=0,n()),t&&"palette"!=t||(a.palette=V);var i=a.dataRange;V&&V.isNormalized&&(null==i||i.min!=P||i.max!=k)&&(a.dataRange={min:P,max:k})});return{name:o,legend:{thumbnail:e,content:t},onLegendRemove:function(){i.host.unbind("appearanceChanged")}}},this.buildSvgLegend=function(e,t){e.height=30,t.add(t.rect(e.width,e.height).fill("white").opacity(.5));var i=$.getComputedStyle(e.legendDiv.children[0].children[1],null),r=parseFloat(i.getPropertyValue("font-size")),o=i.getPropertyValue("font-family"),n=i?i.getPropertyValue("font-weight"):void 0;t.add(t.text(this.name).font({family:o,size:r,weight:n}).translate(40,0));var a=e.legendDiv.children[1],r=(i=a&&e.legendDiv.children[1].children[0]&&e.legendDiv.children[1].children[0].children[0]?$.getComputedStyle(e.legendDiv.children[1].children[0].children[0],null):void 0)?parseFloat(i.getPropertyValue("font-size")):void 0,o=i?i.getPropertyValue("font-family"):void 0,n=i?i.getPropertyValue("font-weight"):void 0,s=t.group(),l=this.getTitle("values");s.text(l).font({family:o,size:r,weight:n}),s.translate(5,30);var d,h,g=t.group(),c=e.width,u=20;me.SvgColorPaletteViewer(g,V,e.legendDiv.children[1].children[0].children[1],{width:c,height:u}),g.translate(5,50),e.height+=50+u,L&&(r=(i=a&&e.legendDiv.children[1].children[1]&&e.legendDiv.children[1].children[1]?$.getComputedStyle(e.legendDiv.children[1].children[1],null):void 0)?parseFloat(i.getPropertyValue("font-size")):void 0,o=i?i.getPropertyValue("font-family"):void 0,n=i?i.getPropertyValue("font-weight"):void 0,d=t.group(),h=pe(e.legendDiv.children[1].children[1]).text(),d.add(d.text(h).font({family:o,size:r,weight:n})),c=e.width,u=25,d.translate(5,100),e.height+=50+u),t.front()},i&&void 0!==i.values&&this.draw(i)}else{var d=e[0].parentElement;if(d){for(var h=!1,s=0;s<d.childNodes.length;s++)if(pe(d.childNodes[s]).hasClass("nowebworkers")){h=!0;break}e[0].removeAttribute("data-idd-plot"),e[0].innerText="",h?e[0].innerText="":(e[0].innerText=" Heatmap cannot be rendered: browser does not support web workers.",e.addClass("nowebworkers"))}}}},me.Heatmap.prototype=new me.CanvasPlot,me.register("heatmap",function(e,t){return new me.Heatmap(e,t)}),me.NavigationPanel=function(r,e,t){var i;e.attr("tabindex","0"),e.addClass("idd-navigation-container"),r.legend&&(i=pe("<div></div>").appendTo(e),r.legend.isVisible?i.addClass("idd-onscreennavigation-showlegend"):i.addClass("idd-onscreennavigation-hidelegend"),i.click(function(){r.legend.isVisible?(r.legend.isVisible=!1,i.removeClass("idd-onscreennavigation-showlegend").addClass("idd-onscreennavigation-hidelegend")):(r.legend.isVisible=!0,i.removeClass("idd-onscreennavigation-hidelegend").addClass("idd-onscreennavigation-showlegend"))})),t?pe('<a style="display:block" target="_blank"></div>').addClass("idd-onscreennavigation-help").appendTo(e).attr("href",t):pe('<a href="https://github.com/predictionmachines/InteractiveDataDisplay/wiki/UI-Guidelines" style="display:block" target="_blank"></div>').addClass("idd-onscreennavigation-help").appendTo(e);var o=pe("<div></div>").addClass("idd-onscreennavigation-exportsvg").appendTo(e),n=pe("<div></div>").addClass("idd-onscreennavigation-navigationlockpressed").appendTo(e),a=pe("<div style='overflow: hidden; height: 0px'></div>").appendTo(e),s=pe("<div></div>").addClass("idd-onscreennavigation-panner").appendTo(a),l=pe("<div></div>").addClass("idd-onscreennavigation-zoomin").appendTo(a),d=pe("<div></div>").addClass("idd-onscreennavigation-zoomout").appendTo(a),h=pe("<div></div>").addClass("idd-onscreennavigation-fit").appendTo(a),g=pe("<div></div>").addClass("idd-onscreennavigation-logscale").appendTo(a),c=void 0,u=w.Observable.create(function(e){return c=e,function(){c=void 0}});o.click(function(){try{new Blob;var e=r.exportToSvg(),t=new Blob([e.svg()]);x(t,"chart.svg")}catch(e){throw e.message}});var f=new function(t){var i=void 0;this.switch=function(){if(!t.mapControl){var e=(1+((t.xDataTransform?1:0)|(t.yDataTransform?2:0)))%4;return function(e){if(e!==i){switch(e){case 0:t.xDataTransform=void 0,t.yDataTransform=void 0;break;case 1:t.xDataTransform=me.logTransform,t.yDataTransform=void 0;break;case 2:t.xDataTransform=void 0,t.yDataTransform=me.logTransform;break;case 3:t.xDataTransform=me.logTransform,t.yDataTransform=me.logTransform}i=e}}(e),t.isAutoFitEnabled=!0,e}}}(r);g.click(function(e){var t=f.switch(),i=r.navigation.gestureSource;r.navigation.gestureSource=i?u.merge(i):u,pe(this).trigger("axisChanged",[t])});var p=void 0,p=void 0!==r.navigation.gestureSource?u.merge(r.navigation.gestureSource):u;r.navigation.gestureSource=p;function v(){return void 0===r.mapControl?me.Gestures.zoomLevelFactor:3}function m(){c&&c.onNext(new me.Gestures.ZoomGesture(r.centralPart.width()/2,r.centralPart.height()/2,1/v(),"Mouse"))}function y(){c&&c.onNext(new me.Gestures.ZoomGesture(r.centralPart.width()/2,r.centralPart.height()/2,v(),"Mouse"))}var C,b=r.navigation.gestureSource;r.navigation.gestureSource=void 0,n.click(function(){void 0!==r.navigation.gestureSource?(r.navigation.gestureSource=void 0,n.removeClass("idd-onscreennavigation-navigationlock").addClass("idd-onscreennavigation-navigationlockpressed"),a.animate({height:0},200)):(r.navigation.gestureSource=b,n.removeClass("idd-onscreennavigation-navigationlockpressed").addClass("idd-onscreennavigation-navigationlock"),a.animate({height:225},200)),pe(this).trigger("classChanged")}),d.dblclick(function(e){e.stopPropagation()}),d.click(function(e){e.stopPropagation(),y()}),l.dblclick(function(e){e.stopPropagation()}),l.click(function(e){e.stopPropagation(),m()}),r.isAutoFitEnabled&&h.attr("class","idd-onscreennavigation-fit-pressed"),h.click(function(){r.isAutoFitEnabled=!r.isAutoFitEnabled}),r.host.on("isAutoFitEnabledChanged",function(){r.isAutoFitEnabled?h.attr("class","idd-onscreennavigation-fit-pressed"):h.attr("class","idd-onscreennavigation-fit")}),e.keydown(function(e){var t=e.which;37==t?(c&&c.onNext(new me.Gestures.PanGesture(10,0,"Mouse")),e.preventDefault()):38==t?(c&&c.onNext(new me.Gestures.PanGesture(0,10,"Mouse")),e.preventDefault()):39==t?(c&&c.onNext(new me.Gestures.PanGesture(-10,0,"Mouse")),e.preventDefault()):40==t?(c&&c.onNext(new me.Gestures.PanGesture(0,-10,"Mouse")),e.preventDefault()):107==t||187==t?(m(),e.preventDefault()):109!=t&&189!=t||(y(),e.preventDefault())});var I={x:0,y:0};s.mousedown(function(e){var t=s.offset(),i=s.outerWidth()/2;I.x=(e.pageX-t.left-i)/i,I.y=(e.pageY-t.top-i)/i,1<I.x*I.x+I.y*I.y||(pe(document).on("mousemove",A),s.removeClass("idd-onscreennavigation-panner").addClass("idd-onscreennavigation-panner-moved"),C=setInterval(function(){c.onNext(new me.Gestures.PanGesture(-10*I.x,-10*I.y,"Mouse"))},25))}),pe(document).mouseup(function(){pe(document).off("mousemove",A),C&&clearInterval(C),s.removeClass("idd-onscreennavigation-panner-moved").addClass("idd-onscreennavigation-panner")});var A=function(e){var t=s.offset(),i=s.outerWidth()/2;I.x=(e.pageX-t.left-i)/i,I.y=(e.pageY-t.top-i)/i};this.remove=function(){r.navigation.gestureSource=b,e.removeClass("idd-navigation-container"),e[0].innerHTML=""}},me.BingMaps=me.BingMaps||{},me.BingMaps.ESRI=me.BingMaps.ESRI||{},me.BingMaps.ESRI.GetWorldTopo=function(){return new Microsoft.Maps.TileSource({uriConstructor:function(e){return"http://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/"+e.levelOfDetail+"/"+e.y+"/"+e.x}})},me.BingMaps.ESRI.GetDeLorme=function(){return new Microsoft.Maps.TileSource({uriConstructor:function(e){return"http://server.arcgisonline.com/ArcGIS/rest/services/Specialty/DeLorme_World_Base_Map/MapServer/tile/"+e.levelOfDetail+"/"+e.y+"/"+e.x}})},me.BingMaps.ESRI.GetWorldImagery=function(){return new Microsoft.Maps.TileSource({uriConstructor:function(e){return"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/"+e.levelOfDetail+"/"+e.y+"/"+e.x}})},me.BingMaps.ESRI.GetOceanBasemap=function(){return new Microsoft.Maps.TileSource({uriConstructor:function(e){return"http://services.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer/tile/"+e.levelOfDetail+"/"+e.y+"/"+e.x}})},me.BingMaps.ESRI.GetNationalGeographicMap=function(){return new Microsoft.Maps.TileSource({uriConstructor:function(e){return"http://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/"+e.levelOfDetail+"/"+e.y+"/"+e.x}})},me.BingMaps.ESRI.GetWorldShadedRelief=function(){return new Microsoft.Maps.TileSource({uriConstructor:function(e){return"http://services.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/"+e.levelOfDetail+"/"+e.y+"/"+e.x}})},me.BingMaps.ESRI.GetWorldTerrainBase=function(){return new Microsoft.Maps.TileSource({uriConstructor:function(e){return"http://services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/"+e.levelOfDetail+"/"+e.y+"/"+e.x}})},me.BingMaps.OpenStreetMap=me.BingMaps.OpenStreet||{},me.BingMaps.OpenStreetMap.GetTileSource=function(){return new Microsoft.Maps.TileSource({uriConstructor:function(e){return"http://tile.openstreetmap.org/"+e.levelOfDetail+"/"+e.x+"/"+e.y+".png"}})},me.BingMapsPlot=function(e,t){var i,r,o,n,a;e&&(i=pe('<div style="position: absolute"></div>').prependTo(e),this.base=me.Plot,this.base(e,t),"undefined"==typeof Microsoft?pe("<p></p>").css("margin",15).css("word-wrap","break-word").text("BingMaps script is unavailable. Check your internet connection.").appendTo(e):(o=r=void 0,0===this.children.length&&((r=pe('<div style="position: absolute;"></div>').appendTo(e)).css("z-index",me.ZIndexNavigationLayer),o=pe("<canvas></canvas>").appendTo(r)),this.mapKey=e.attr("data-idd-mapKey"),n=new Microsoft.Maps.Map(i[0],{credentials:this.mapKey,mapTypeId:Microsoft.Maps.MapTypeId.aerial,enableClickableLogo:!1,enableSearchLogo:!1,showCopyright:!1,showDashboard:!1,showLogo:!1,disablePanning:!0,disableZooming:!0,width:e.width(),height:e.height()}),Object.defineProperty(this,"map",{get:function(){return n},configurable:!1}),a=new me.BingMapsAnimation(n),this.arrange=function(e){me.BingMapsPlot.prototype.arrange.call(this,e),n.width=e.width,n.height=e.height},this.setMap=function(e){var t;n.setMapType(Microsoft.Maps.MapTypeId.mercator),n.entities.clear(),e&&(e instanceof Microsoft.Maps.TileSource?(t=new Microsoft.Maps.TileLayer({mercator:e,opacity:1}),n.entities.push(t)):n.setMapType(e))},this.constraint=function(e,t,i){if(!0!==i)return e;var r=n.getWidth(),o=n.getHeight();return r<=1||o<=1?e:(a.setMapView(e,t),mapRect=me.Utils.getPlotRectForMap(n),mapRect)},this.arrange=function(e){me.CanvasPlot.prototype.arrange.call(this,e),void 0!==r&&(r.width(e.width),r.height(e.height),o[0].width=e.width,o[0].height=e.height)},a.constraint=this.constraint,this.navigation.animation=a,this.selfMapRefresh()))},me.BingMapsPlot.prototype=new me.Plot,(T=me=me||{}).PersistentViewState=function(){var r=this,o=[];function t(e,t){for(var i=0;i<o.length;++i)o[i](r,e,t)}function e(e){return null!=e&&null!=e&&"undefined"!=e}this.subscribe=function(t){return o.push(t),function(){var e=o.indexOf(t);0<=e&&o.splice(e,1)}};var i=sessionStorage.getItem("plotRect"),n=e(i)?JSON.parse(i):void 0;Object.defineProperty(this,"plotRect",{get:function(){return n},set:function(e){e!=n&&(n=e,sessionStorage.setItem("plotRect",JSON.stringify(n)),t("plotRect"))},configurable:!1,enumerable:!0});var a=sessionStorage.getItem("isAutoFit"),s=!e(a)||JSON.parse(a);Object.defineProperty(this,"isAutoFit",{get:function(){return s},set:function(e){e!=s&&(s=e,sessionStorage.setItem("isAutoFit",JSON.stringify(s)),t("isAutoFit"))},configurable:!1,enumerable:!0});var l=sessionStorage.getItem("selectedPlots"),d=e(l)?JSON.parse(l):[];Object.defineProperty(this,"selectedPlots",{get:function(){return d},set:function(e){e!=d&&(d=e,sessionStorage.setItem("selectedPlots",JSON.stringify(d)),t("selectedPlots"))},configurable:!1,enumerable:!0});var h=sessionStorage.getItem("probes"),g=e(h)?new T.ProbesVM(JSON.parse(h)):new T.ProbesVM(void 0);g.subscribe(function(e){sessionStorage.setItem("probes",JSON.stringify(g.getProbes())),t("probes")}),Object.defineProperty(this,"probesViewModel",{get:function(){return g},configurable:!1,enumerable:!0});var c=sessionStorage.getItem("isLegendShown"),u=!!e(c)&&JSON.parse(c);Object.defineProperty(this,"isLegendShown",{get:function(){return u},set:function(e){e!=u&&(u=e,sessionStorage.setItem("isLegendShown",JSON.stringify(u)),t("isLegendShown"))},configurable:!1,enumerable:!0});var f=sessionStorage.getItem("isNavigationPanelOpen"),p=!!e(f)&&JSON.parse(f);Object.defineProperty(this,"isNavigationPanelOpen",{get:function(){return p},set:function(e){e!=p&&(p=e,sessionStorage.setItem("isNavigationPanelOpen",JSON.stringify(p)),t("isNavigationPanelOpen"))},configurable:!1,enumerable:!0});var v=sessionStorage.getItem("isLogAxis"),m=e(v)?JSON.parse(v):0;Object.defineProperty(this,"isLogAxis",{get:function(){return m},set:function(e){e!=m&&(m=e,sessionStorage.setItem("isLogAxis",JSON.stringify(m)),t("isLogAxis"))},configurable:!1,enumerable:!0});var y=sessionStorage.getItem("mapType"),C=e(y)?JSON.parse(y):void 0;Object.defineProperty(this,"mapType",{get:function(){return C},set:function(e){e!=C&&(C=e,sessionStorage.setItem("mapType",JSON.stringify(C)),t("mapType"))},configurable:!1,enumerable:!0});var b=sessionStorage.getItem("xDataTransform"),I=e(b)?JSON.parse(b):void 0;Object.defineProperty(this,"xDataTransform",{get:function(){return I},set:function(e){e!=I&&(I=e,sessionStorage.setItem("xDataTransform",JSON.stringify(I)),t("xDataTransform"))},configurable:!1,enumerable:!0});var A=sessionStorage.getItem("yDataTransform"),w=e(A)?JSON.parse(A):void 0;Object.defineProperty(this,"yDataTransform",{get:function(){return w},set:function(e){e!=w&&(w=e,sessionStorage.setItem("yDataTransform",JSON.stringify(w)),t("yDataTransform"))},configurable:!1,enumerable:!0});var x={};Object.defineProperty(this,"uncertaintyRange",{get:function(){return x},set:function(e){e!=x&&(x=e,t("uncertaintyRange"))},configurable:!1,enumerable:!0})},T.TransientViewState=function(){var r=this,o=[];function i(e,t){for(var i=0;i<o.length;++i)o[i](r,e,t)}this.subscribe=function(e){o.push(e)},this.unsubscribe=function(t){o=o.filter(function(e){return e!==t})};var n={};Object.defineProperty(this,"ranges",{get:function(){return n},configurable:!1,enumerable:!0});var t=new T.AdaptiveFormatter(0,1);Object.defineProperty(this,"plotXFormatter",{get:function(){return t},set:function(e){e!=t&&(t=e,i("plotXFormatter"))},configurable:!1,enumerable:!0});var a=new T.AdaptiveFormatter(0,1);Object.defineProperty(this,"plotYFormatter",{get:function(){return a},set:function(e){e!=a&&(a=e,i("plotYFormatter"))},configurable:!1,enumerable:!0}),this.setRangesForPlot=function(e,t){n[e]=t,i("ranges",{id:e})}},(me=me||{}).PlotRegistry={},(l=me=me||{}).createSmallProbe=G,l.ProbePull=function(e,t){var i=e,r=pe("<div></div>").addClass("dragPoint").addClass("probe").appendTo(i);r.draggable({containment:"document",scroll:!1,zIndex:2500,helper:function(){var e=pe("<div></div>").addClass("dragPoint");return G(e),e},appendTo:t}),r.mousedown(function(e){e.stopPropagation()})},l.OnScreenNavigation=function(e,t,i){l.NavigationPanel(t,e,"https://github.com/predictionmachines/InteractiveDataDisplay/wiki/UI-Guidelines#chartviewer");var r=e.find(".idd-onscreennavigation-showlegend");r.remove(),(r=e.find(".idd-onscreennavigation-hidelegend")).remove(),pe("<div></div>").addClass("idd-onscreennavigation-hidelegend").prependTo(e);var o=e.find(".idd-onscreennavigation-navigationlockpressed");i.isNavigationPanelOpen&&pe(o).click(),pe(o).bind("classChanged",function(){i.isNavigationPanelOpen=pe(this).hasClass("idd-onscreennavigation-navigationlock")});for(var n=e.find(".idd-onscreennavigation-logscale"),a=0;a<i.isLogAxis;a++)pe(n).click();pe(n).on("axisChanged",function(e,t){i.isLogAxis=t})},v=me=me||{},N.prototype.setupPlotsVisibility=function(){for(var e in this.currentPlots){var t=this.currentPlots[e],i=t.Plots;if(i)for(var r=-1==this.initiallySelectedPlots.indexOf(t.Id),o=0;o<i.length;++o)i[o].isVisible=r}},N.prototype.checkLatLon=function(e){var t,i,r,o;return void 0!==e.x&&(r=v.getTitle(e,"x"),"lon"===(o=r.toLowerCase())||"longitude"===o)&&void 0!==e.y&&(t=v.getTitle(e,"y"),"lat"===(i=t.toLowerCase())||"latitude"===i)},N.prototype.addPlot=function(t){var i=v.PlotRegistry[t.Definition.kind]?v.PlotRegistry[t.Definition.kind]:v.PlotRegistry.fallback;t.Plots=i.initialize(t.Definition,this.persistentViewState,this.iddChart);try{i.draw(t.Plots,t.Definition)}catch(e){void 0!==t.Plots&&t.Plots.forEach(function(e){e.remove()}),i=v.PlotRegistry.fallback,t.Definition.error=e.message,t.Plots=i.initialize(t.Definition,this.persistentViewState,this.iddChart),i.draw(t.Plots,t.Definition)}},N.prototype.updateAxes=function(){var e="",t="",i=[],r=[];for(var o in this.currentPlots){var n=this.currentPlots[o].Definition;if(n.x){for(var a=v.getTitle(n,"x"),s=!1,l=0;l<i.length;l++)if(i[l]===a){s=!0;break}s||(i.push(a),""!==e&&(e+=", "),e+=a)}if(n.y){for(var d=v.getTitle(n,"y"),s=!1,l=0;l<r.length;l++)if(r[l]===d){s=!0;break}s||(r.push(d),""!==t&&(t+=", "),t+=d)}}""!==e?(void 0===this.xAxisTitle&&(this.xAxisTitle=pe(this.iddChart.addDiv('<div style="font-size: larger; text-align: center"></div>',"bottom"))),this.xAxisTitle.text(e)):void 0!==this.xAxisTitle&&(this.iddChart.removeDiv(this.xAxisTitle[0]),this.xAxisTitle.remove(),this.xAxisTitle=void 0),""!==t?(void 0===this.yAxisTitle&&(this.yAxisTitle=pe(this.iddChart.addDiv('<div class="idd-verticalTitle" style="font-size: larger;"></div>',"left"))),this.yAxisTitle.text(t)):void 0!==this.yAxisTitle&&(this.iddChart.removeDiv(this.yAxisTitle[0]),this.yAxisTitle.remove(),this.yAxisTitle=void 0)},N.prototype.createMap=function(){var e=pe("<div></div>").attr("data-idd-name","bingMaps").css("z-index",0).prependTo(this.iddChart.host),t=new v.BingMapsPlot(e,this.iddChart);return t.order=9007199254740991,this.iddChart.addChild(t),t},N.prototype.updateMap=function(){var e=!1,t=!0;for(var i in this.currentPlots)var r=this.currentPlots[i],e=(t||e)&&this.checkLatLon(r.Definition),t=!1;e&&"undefined"!=typeof Microsoft?(void 0===this.bingMapsPlot?(this.bingMapsPlot=this.createMap(),this.persistentViewState.mapType?this.bingMapsPlot.setMap(this.persistentViewState.mapType):this.bingMapsPlot.setMap(Microsoft.Maps.MapTypeId.road)):this.persistentViewState.mapType&&this.bingMapsPlot.setMap(this.persistentViewState.mapType),this.iddChart.yDataTransform=v.mercatorTransform,this.iddChart.xDataTransform=void 0,this.bingMapsPlot.navigation.animation.setMapView(this.persistentViewState.plotRect,this.iddChart.screenSize)):void 0!==this.bingMapsPlot&&(this.bingMapsPlot.remove(),this.bingMapsPlot=void 0,this.iddChart.yDataTransform=void 0)},N.prototype.draw=function(e){var r=this;this.currentPlots=v.updateBag(this.currentPlots,e,function(e,t,i){return t.Definition.kind==i.Definition.kind?(v.syncProps(t.Definition,i.Definition)&&v.PlotRegistry[t.Definition.kind].draw(t.Plots,t.Definition),t):(void 0!==t.Plots&&t.Plots.forEach(function(e){e.remove()}),r.addPlot(i),i)},function(e,t){return r.addPlot(t),t},function(e,t){void 0!==t.Plots&&t.Plots.forEach(function(e){e.remove()})}),this.updateAxes(),this.updateMap(),this.persistentViewState.probesViewModel.refresh();var t,i=0;for(var o in this.currentPlots)(t=this.currentPlots[o]).ZIndex&&(i=Math.max(t.ZIndex,i));for(var o in this.currentPlots)if((t=this.currentPlots[o]).ZIndex||(t.ZIndex=++i),t.Plots)for(var n=0;n<t.Plots.length;++n){var a=t.Plots[n];a.host.css("z-index",t.ZIndex),a.requestNextFrameOrUpdate()}return this.persistentViewState.selectedPlots&&(this.initiallySelectedPlots=this.persistentViewState.selectedPlots,this.setupPlotsVisibility()),this.currentPlots},N.prototype.updateLayout=function(){this.iddDiv.width(this.div.width()),this.iddDiv.height(this.div.height()),this.iddChart.updateLayout(),void 0!==this.bingMapsPlot&&this.iddChart.navigation.setVisibleRect(this.iddChart.visibleRect,!1)},t=N,v.PlotViewer=t,(m=me=me||{}).PlotList=function(e,t,i,r){e.addClass("dsv-plotlist");var o=pe("<div></div>").appendTo(e),n=new m.Legend(t.iddChart,o,!1,!0);t.iddChart.host.bind("visibleChanged",function(){i.probesViewModel.refresh(i.probesViewModel.getProbes())}),i.probesViewModel.refresh(i.probesViewModel.getProbes());var a=pe("<div></div>").addClass("probes").appendTo(e),s=pe("<div style='width:240px; margin-bottom: 16px'></div>").appendTo(a),l=pe("<div></div>").addClass("dsv-onscreennavigation-probepull").appendTo(s),d=(new m.ProbePull(l,t.iddChart.centralPart),pe("<div style='width: 195px; display:inline-block'></div>").appendTo(s));pe("<div style='width:180px; height:1px; margin-bottom:6px; float:right; margin-top: 8px; background-color:lightgrey'></div>").appendTo(d),pe("<div style='float:left; margin-left:15px;font-family: Segoe UI;font-size: 12px;color:grey; margin-bottom:16px'>Probes</div>").appendTo(d);var h=pe("<div></div>").addClass("probes-list").appendTo(a);h[0].style.display="none",new m.ProbesControl(a,h,i,r),this.remove=function(){t.iddChart.host.bind("visibleChanged"),n.remove()}},y=me=me||{},R.prototype.update=function(e){var t={};for(var i in e){var r=e[i];null!=r?(t[i]={Id:i,Definition:r},null!==r.displayName&&void 0!==r.displayName||(t[(r=pe.extend(!1,{},r)).displayName=i].Definition=r)):t[i]=null}t=this.plotViewer.draw(t)},R.prototype.updateLayout=function(){var e=0;this.controlDiv.width()<this.minWidthToShowLeftPanel&&void 0!==this.leftPanelContainer?this.leftPanelContainer.hide():void 0!==this.leftPanelContainer&&(this.leftPanelContainer.show(),e=this.leftPanelContainer.width()),this.rightpanel.width(this.controlDiv.width()-e-this.rightPanelExtraShift-this.navigationPanelShift),this.plotViewer.updateLayout(),this.persistentViewState.probesViewModel.refresh()},R.prototype.dispose=function(){this.plotList.remove(),this.controlDiv.children().remove()},i=R,y.ChartViewerControl=i,(C=me=me||{}).ProbesVM=function(e){function n(e,t){if(0<o.length)for(var i=0;i<o.length;i++)o[i]({probe:e,status:t})}var i=this,r=0,o=[],a=[];if(this.subscribe=function(e){o.push(e)},this.clear=function(){for(var e=a.slice(0),t=0;t<e.length;t++)i.removeProbe(e[t].id)},this.addProbe=function(e){var t={id:++r,location:e,selected:!1};return a.push(t),n(t,"add"),t.id},this.removeProbe=function(e){for(var t=void 0,i=0;i<a.length;i++){var r=a[i];if(r.id==e){t=r;break}}void 0!==t&&(a=a.filter(function(e){return e!==t}),n(t,"remove"))},this.updateProbe=function(e,t){for(var i=void 0,r=0;r<a.length;r++){var o=a[r];if(o.id==e){i=o;break}}void 0!==i&&(i.location=t,n(i,"update"))},this.selectProbe=function(e){if(-1!==e){for(var t=void 0,i=0;i<a.length;i++){(r=a[i]).id==e?(t=r).selected=!0:r.selected=!1}void 0!==t&&n(t,"selected")}else{for(var r,i=0;i<a.length;i++){(r=a[i]).selected=!1}n(void 0,"unselected")}},this.fitToProbe=function(e){for(var t=0;t<a.length;t++){var i=a[t];i.id==e&&n(i,"fit")}},this.getProbes=function(){return a.slice(0)},this.getProbeContent=function(e){},this.refresh=function(){void 0!==i.onRefresh&&i.onRefresh(a.slice(0))},void 0!==e)for(var t=0;t<e.length;t++){var s={id:e[t].id,location:{x:e[t].location.x,y:e[t].location.y},selected:e[t].selected};a.push(s),r<s.id&&(r=s.id)}},C.ProbesControl=function(l,d,h,g){function a(e){l[0].style.display="block";var t=pe("<div></div>").addClass("probeCard");!0===e.selected&&t.addClass("probeCard-selected");var i=pe("<div></div>").addClass("probeHeader").appendTo(t).height(24),r=pe("<div></div>").addClass("probe").css("float","left").css("margin-right",3).width(24).height(24).appendTo(i);e.selected?C.createSmallProbe(r,e.id,"#365C95",.6):C.createSmallProbe(r,e.id,void 0,.6),pe("<div></div>").addClass("probeHeader-name").text(g.plotXFormatter.toString(e.location.x)+", "+g.plotYFormatter.toString(e.location.y)).appendTo(i);var o=pe("<div></div>").addClass("probeActionPanel").appendTo(t);pe("<div></div>").addClass("probeCard-remove").appendTo(o).click(function(){c.removeProbe(e.id),void 0!==h.uncertaintyRange&&h.uncertaintyRange.probeid===e.id&&(h.uncertaintyRange=void 0),0==d[0].childNodes.length&&(d[0].style.display="none")}),pe("<div></div>").addClass("probeCard-fit").appendTo(o).click(function(){c.fitToProbe(e.id)});var n=c.getProbeContent(e);if(void 0!==n)for(var a=0;a<n.length;a++){var s=pe(n[a]);s.addClass("probecard-record"),s.appendTo(t)}return t}function s(e){u.empty(),f=[];for(var t=0;t<e.length;t++){var i=e[t],r=a(i),o=pe("<div></div>").css("display","inline").appendTo(u);r.appendTo(o),f.push({id:i.id,div:r,host:o})}0<e.length&&(d[0].style.display="block")}var c=h.probesViewModel,u=d,f=[];s(c.getProbes()),c.subscribe(function(e){var t=e.probe;switch(e.status){case"add":d[0].style.display="block";var i=a(e.probe),r=pe("<div></div>").css("display","inline").appendTo(u);i.appendTo(r),f.push({id:t.id,div:i,host:r});break;case"remove":for(var o=0;o<f.length;o++){if((n=f[o]).id===t.id){n.host.remove(),f=f.filter(function(e){return e.id!==t.id}),0==d[0].childNodes.length&&(d[0].style.display="none");break}}break;case"update":for(var n,o=0;o<f.length;o++){if((n=f[o]).id===t.id){n.host.empty(),(i=a(e.probe)).appendTo(n.host),n.div=i;break}}break;case"selected":case"unselected":s(c.getProbes())}}),c.onRefresh=function(e){s(e)}},C.show=function(e,t,i){if(i)throw"viewState argument is not supported";var r=new C.ChartViewerControl(e);return r.update(t),r},(n=me=me||{}).updateBag=function(e,t,i,r,o){var n={};for(var a in t){var s=e[a];void 0!==(l=t[a])&&(n[a]=void 0!==s?null==l?s:i(a,s,l):r(a,l))}for(var a in e){var s=e[a],l=t[a];void 0!==s&&void 0===l&&o(a,s)}return n},n.getTitle=function(e,t){return e.titles&&void 0!==e.titles[t]?e.titles[t]:t},n.updateProp=B,n.isNumber=V,n.isString=F,n.isStringOrNumber=Z,n.deepCopyJS=L,n.syncProps=function e(t,i){var r,o=!1;for(var n in i)o=void 0===t[n]||Z(t[n])&&!Z(i[n])?(t[n]=L(i[n]),o||!0):(r=Z(i[n])?!B(n,t,i):e(t[n],i[n]),o||r);var a=[];for(var s in t)if("d3Graphs"!==s&&"isPresented"!==s){var l=!1;for(var n in i)if(n===s){l=!0;break}l||(a.push(s),o=o||!0)}a.forEach(function(e){delete t[e]});for(var d=0;d<t.length;d++)null==t[d]&&"function"!=typeof t&&(t.splice(d,1),d--);return o},(a=me=me||{}).PlotRegistry.area={initialize:function(e,t,i){var r=pe("<div></div>").attr("data-idd-name",e.displayName).appendTo(i.host),o=new a.Area(r,i.master);return i.addChild(o),i.assignChildOrder(o),[o]},draw:function(e,t){e[0].draw(t)}},(r=me=me||{}).PlotRegistry.fallback={initialize:function(e,t,i){var r=new z(pe("<div></div>").attr("data-idd-name",e.displayName).appendTo(i.host),i.master);return i.addChild(r),i.assignChildOrder(r),[r]},draw:function(e,t){var i={kind:t.kind,error:t.error};e[0].draw(i)}},(r.FallbackPlot=z).prototype=new r.CanvasPlot,(d=me=me||{}).PlotRegistry.heatmap={initialize:function(e,t,i){var r=pe("<div></div>").attr("data-idd-name",e.displayName).appendTo(i.host),o=new d.Heatmap(r,i.master);return i.addChild(o),i.assignChildOrder(o),[o]},draw:function(e,t){e[0].draw(t,t.titles)}},(b=me=me||{}).PlotRegistry.line={initialize:function(e,t,i){var r=pe("<div></div>").attr("data-idd-name",e.displayName).appendTo(i.host),o=new b.Polyline(r,i.master);return i.addChild(o),i.assignChildOrder(o),[o]},draw:function(e,t){e[0].draw(t)}},(I=me=me||{}).PlotRegistry.markers={initialize:function(e,t,i){var r=pe("<div></div>").attr("data-idd-name",e.displayName).appendTo(i.host),o=new I.Markers(r,i.master);return i.addChild(o),i.assignChildOrder(o),[o]},draw:function(e,t){e[0].draw(t,t.titles)}},A=o=o||{},(S=A.MarkerShape||(A.MarkerShape={})).Box="box",S.Circle="circle",S.Diamond="diamond",S.Cross="cross",S.Triangle="triangle",(P=A.HeatmapRenderType||(A.HeatmapRenderType={})).Gradient="gradient",P.Discrete="discrete",(k=A.LineTreatAs||(A.LineTreatAs={})).Function="function",k.Trajectory="trajectory",A.line=function(e){var t=e;return t.kind="line",t},A.area=function(e){var t=e;return t.kind="area",t},A.boxplot=function(e){var t=e;return t.kind="markers",t.shape="boxwhisker",t},A.markers=function(e){var t=e;return t.kind="markers",t},A.heatmap=function(e){var t=e;return t.kind="heatmap",t},{InteractiveDataDisplay:me,Plot:o}});