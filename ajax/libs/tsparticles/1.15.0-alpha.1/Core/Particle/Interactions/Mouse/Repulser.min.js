"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Repulser=void 0;var ClickMode_1=require("../../../../Enums/Modes/ClickMode"),HoverMode_1=require("../../../../Enums/Modes/HoverMode"),OutMode_1=require("../../../../Enums/OutMode"),Utils_1=require("../../../../Utils/Utils"),DivMode_1=require("../../../../Enums/Modes/DivMode"),Constants_1=require("../../../../Utils/Constants"),Circle_1=require("../../../../Utils/Circle"),Repulser=function(){function e(){}return e.repulse=function(e,i){var t=e.options.interactivity,o=t.events.onHover.enable,s=t.events.onClick.enable,n=e.interactivity.status===Constants_1.Constants.mouseMoveEvent,r=t.events.onHover.mode,l=t.events.onClick.mode,u=t.events.onDiv.mode;n&&o&&Utils_1.Utils.isInArray(HoverMode_1.HoverMode.repulse,r)?this.hoverRepulse(e):s&&Utils_1.Utils.isInArray(ClickMode_1.ClickMode.repulse,l)?this.clickRepulse(e):t.events.onDiv.enable&&Utils_1.Utils.isInArray(DivMode_1.DivMode.repulse,u)&&this.divRepulse(e)},e.divRepulse=function(e){var i,t,o=e.options,s=document.getElementById(o.interactivity.events.onDiv.elementId);s&&(i={x:s.offsetLeft+s.offsetWidth/2,y:s.offsetTop+s.offsetHeight/2},t=s.offsetWidth/2,e.retina.isRetina&&(i.x*=e.retina.pixelRatio,i.y*=e.retina.pixelRatio,t*=e.retina.pixelRatio),this.processRepulse(e,i,t))},e.hoverRepulse=function(e){var i,t=e.interactivity.mouse.position;t&&(i=e.retina.repulseModeDistance,this.processRepulse(e,t,i))},e.processRepulse=function(e,i,t){for(var o=0,s=e.particles.quadTree.query(new Circle_1.Circle(i.x,i.y,t));o<s.length;o++){var n,r,l=s[o],u=l.position.x-i.x,c=l.position.y-i.y,a=Math.sqrt(u*u+c*c),p=u/a,v=c/a,d=100*e.options.interactivity.modes.repulse.speed,M=Utils_1.Utils.clamp((1-Math.pow(a/t,2))*d,0,50),y=l.particlesOptions.move.outMode,h=l.size.value,_={x:l.position.x+p*M,y:l.position.y+v*M};y===OutMode_1.OutMode.bounce||y===OutMode_1.OutMode.bounceVertical||y===OutMode_1.OutMode.bounceHorizontal?(n=0<_.x-h&&_.x+h<e.canvas.size.width,r=0<_.y-h&&_.y+h<e.canvas.size.height,y!==OutMode_1.OutMode.bounceVertical&&!n||(l.position.x=_.x),y!==OutMode_1.OutMode.bounceHorizontal&&!r||(l.position.y=_.y)):(l.position.x=_.x,l.position.y=_.y)}},e.clickRepulse=function(e){if(e.repulse.finish||(e.repulse.count||(e.repulse.count=0),e.repulse.count++,e.repulse.count===e.particles.count&&(e.repulse.finish=!0)),e.repulse.clicking){var i=e.retina.repulseModeDistance,t=Math.pow(i/6,3),o=e.interactivity.mouse.clickPosition;if(void 0===o)return;for(var s,n,r,l,u=new Circle_1.Circle(o.x,o.y,t),c=0,a=e.particles.quadTree.query(u);c<a.length;c++){void 0!==(null==(p=a[c])?void 0:p.position)&&(r=(s=o.x-p.position.x)*s+(n=o.y-p.position.y)*n,l=-t*e.options.interactivity.modes.repulse.speed/r,r<=t&&(e.repulse.particles.push(p),this.processClickRepulse(e,p,s,n,l)))}}else if(!1===e.repulse.clicking){for(var p,v=0,d=e.repulse.particles;v<d.length;v++){(p=d[v]).velocity.horizontal=p.initialVelocity.horizontal,p.velocity.vertical=p.initialVelocity.vertical}e.repulse.particles=[]}},e.processClickRepulse=function(e,i,t,o,s){var n=e.options,r=Math.atan2(o,t);i.velocity.horizontal=s*Math.cos(r),i.velocity.vertical=s*Math.sin(r);var l,u,c=n.particles.move.outMode;c!==OutMode_1.OutMode.bounce&&c!==OutMode_1.OutMode.bounceHorizontal&&c!==OutMode_1.OutMode.bounceVertical||(l=i.position.x+i.velocity.horizontal,u=i.position.y+i.velocity.vertical,c!==OutMode_1.OutMode.bounceVertical&&(l+i.size.value>e.canvas.size.width||l-i.size.value<0)&&(i.velocity.horizontal=-i.velocity.horizontal),c!==OutMode_1.OutMode.bounceHorizontal&&(u+i.size.value>e.canvas.size.height||u-i.size.value<0)&&(i.velocity.vertical=-i.velocity.vertical))},e}();exports.Repulser=Repulser;