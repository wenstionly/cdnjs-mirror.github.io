"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Emitter=void 0;var Particle_1=require("../../Core/Particle"),Utils_1=require("../../Utils/Utils"),SizeMode_1=require("../../Enums/SizeMode"),EmitterSize_1=require("../../Options/Classes/Emitters/EmitterSize"),Emitter=function(){function t(t,i,e){var o,s,n;this.emitters=t,this.container=t.container,this.initialPosition=e,this.emitterOptions=Utils_1.Utils.deepExtend({},i),this.position=null!==(o=this.initialPosition)&&void 0!==o?o:this.calcPosition();var r,a=Utils_1.Utils.deepExtend({},this.emitterOptions.particles);void 0===a&&(a={}),void 0===a.move&&(a.move={}),void 0===a.move.direction&&(a.move.direction=this.emitterOptions.direction),this.particlesOptions=a,this.size=null!==(s=this.emitterOptions.size)&&void 0!==s?s:((r=new EmitterSize_1.EmitterSize).load({height:0,width:0,mode:SizeMode_1.SizeMode.percent}),r),this.lifeCount=null!==(n=this.emitterOptions.life.count)&&void 0!==n?n:-1,this.play()}return t.prototype.play=function(){var t=this;(0<this.lifeCount||!this.emitterOptions.life.count)&&(void 0===this.startInterval&&(this.startInterval=window.setInterval(function(){t.emit()},1e3*this.emitterOptions.rate.delay)),0<this.lifeCount&&this.prepareToDie())},t.prototype.pause=function(){var t=this.startInterval;void 0!==t&&(clearInterval(t),delete this.startInterval)},t.prototype.resize=function(){var t=this.initialPosition;this.position=t&&Utils_1.Utils.isPointInside(t,this.container.canvas.size)?t:this.calcPosition()},t.prototype.prepareToDie=function(){var t,i=this;0<this.lifeCount&&void 0!==(null===(t=this.emitterOptions.life)||void 0===t?void 0:t.duration)&&window.setTimeout(function(){var t;i.pause(),i.lifeCount--,0<i.lifeCount?(i.position=i.calcPosition(),window.setTimeout(function(){i.play()},null!==(t=i.emitterOptions.life.delay)&&void 0!==t?t:0)):i.destroy()},1e3*this.emitterOptions.life.duration)},t.prototype.destroy=function(){this.emitters.removeEmitter(this)},t.prototype.calcPosition=function(){var t,i=this.container,e=null!==(t=this.emitterOptions.position)&&void 0!==t?t:{x:100*Math.random(),y:100*Math.random()};return{x:e.x/100*i.canvas.size.width,y:e.y/100*i.canvas.size.height}},t.prototype.emit=function(){for(var t=this.container,i=this.position,e=this.size.mode===SizeMode_1.SizeMode.percent?t.canvas.size.width*this.size.width/100:this.size.width,o=this.size.mode===SizeMode_1.SizeMode.percent?t.canvas.size.height*this.size.height/100:this.size.height,s=0;s<this.emitterOptions.rate.quantity;s++){var n=new Particle_1.Particle(t,{x:i.x+e*(Math.random()-.5),y:i.y+o*(Math.random()-.5)},this.particlesOptions);t.particles.addParticle(n)}},t}();exports.Emitter=Emitter;