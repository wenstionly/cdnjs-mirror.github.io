import e from"prop-types";import t,{createContext as r,Component as n,Children as i,cloneElement as o}from"react";import{getFlippedElementPositionsBeforeUpdate as p,onFlipKeyUpdate as l,utilities as s,constants as a,spring as c}from"flip-toolkit";var d=r({}),h=r("portal"),f=function(e){function r(){e.apply(this,arguments),this.inProgressAnimations={},this.flipCallbacks={},this.el=void 0}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getSnapshotBeforeUpdate=function(e){return e.flipKey!==this.props.flipKey&&this.el?p({element:this.el,flipCallbacks:this.flipCallbacks,inProgressAnimations:this.inProgressAnimations,portalKey:this.props.portalKey}):null},r.prototype.componentDidUpdate=function(e,t,r){this.props.flipKey!==e.flipKey&&this.el&&l({flippedElementPositionsBeforeUpdate:r.flippedElementPositions,cachedOrderedFlipIds:r.cachedOrderedFlipIds,containerEl:this.el,inProgressAnimations:this.inProgressAnimations,flipCallbacks:this.flipCallbacks,applyTransformOrigin:this.props.applyTransformOrigin,spring:this.props.spring,debug:this.props.debug,portalKey:this.props.portalKey,staggerConfig:this.props.staggerConfig,handleEnterUpdateDelete:this.props.handleEnterUpdateDelete,decisionData:{previous:e.decisionData,current:this.props.decisionData},onComplete:this.props.onComplete,onStart:this.props.onStart})},r.prototype.render=function(){var e=this,r=this.props,n=r.portalKey,i=t.createElement(d.Provider,{value:this.flipCallbacks},t.createElement(r.element,{className:r.className,ref:function(t){return e.el=t}},this.props.children));return n&&(i=t.createElement(h.Provider,{value:n},i)),i},r}(n);function u(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&-1===t.indexOf(n)&&(r[n]=e[n]);return r}f.defaultProps={applyTransformOrigin:!0,element:"div"};var m=function(e){var t=e.children,r=e.flipId,n=e.inverseFlipId,p=e.portalKey,l=u(e,["children","flipId","inverseFlipId","portalKey"]),c=t,d="function"==typeof c;if(!d)try{c=i.only(t)}catch(e){throw new Error("Each Flipped component must wrap a single child")}l.scale||l.translate||l.opacity||s.assign(l,{translate:!0,scale:!0,opacity:!0});var h={};return h[a.DATA_FLIP_CONFIG]=JSON.stringify(l),r?h[a.DATA_FLIP_ID]=String(r):n&&(h[a.DATA_INVERSE_FLIP_ID]=String(n)),p&&(h[a.DATA_PORTAL_KEY]=p),d?c(h):o(c,h)},y=function(e){var r=e.children,n=e.flipId,i=e.shouldFlip,o=e.shouldInvert,p=e.onAppear,a=e.onStart,l=e.onStartImmediate,c=e.onComplete,f=e.onExit,y=e.onSpringUpdate,g=u(e,["children","flipId","shouldFlip","shouldInvert","onAppear","onStart","onStartImmediate","onComplete","onExit","onSpringUpdate"]);return r?g.inverseFlipId?t.createElement(m,Object.assign({},g),r):t.createElement(h.Consumer,null,function(e){return t.createElement(d.Consumer,null,function(d){return s.isObject(d)&&n&&(d[n]={shouldFlip:i,shouldInvert:o,onAppear:p,onStart:a,onStartImmediate:l,onComplete:c,onExit:f,onSpringUpdate:y}),t.createElement(m,Object.assign({flipId:n},g,{portalKey:e}),r)})}):null};y.displayName="Flipped";var g=function(e){var t;return o(e.children,((t={})[a.DATA_EXIT_CONTAINER]=!0,t))};export{f as Flipper,y as Flipped,g as ExitContainer,c as spring};