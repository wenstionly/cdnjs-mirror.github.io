"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function isPushStateAvailable(){return!("undefined"==typeof window||!window.history||!window.history.pushState)}function Navigo(e,t,o){this.root=null,this._routes=[],this._useHash=t,this._hash=void 0===o?"#":o,this._paused=!1,this._destroyed=!1,this._lastRouteResolved=null,this._notFoundHandler=null,this._defaultHandler=null,this._usePushState=!t&&isPushStateAvailable(),this._onLocationChange=this._onLocationChange.bind(this),this._genericHooks=null,this._historyAPIUpdateMethod="pushState",e?this.root=t?e.replace(/\/$/,"/"+this._hash):e.replace(/\/$/,""):t&&(this.root=this._cLoc().split(this._hash)[0].replace(/\/$/,"/"+this._hash)),this._listen(),this.updatePageLinks()}function clean(e){return e instanceof RegExp?e:e.replace(/\/+$/,"").replace(/^\/+/,"^/")}function regExpResultToParams(e,n){return 0!==n.length&&e?e.slice(1,e.length).reduce(function(e,t,o){return null===e&&(e={}),e[n[o]]=decodeURIComponent(t),e},null):null}function replaceDynamicURLParts(e){var n=[],t=e instanceof RegExp?e:new RegExp(e.replace(Navigo.PARAMETER_REGEXP,function(e,t,o){return n.push(o),Navigo.REPLACE_VARIABLE_REGEXP}).replace(Navigo.WILDCARD_REGEXP,Navigo.REPLACE_WILDCARD)+Navigo.FOLLOWED_BY_SLASH_REGEXP,Navigo.MATCH_REGEXP_FLAGS);return{regexp:t,paramNames:n}}function getUrlDepth(e){return e.replace(/\/$/,"").split("/").length}function compareUrlDepth(e,t){return getUrlDepth(t)-getUrlDepth(e)}function findMatchedRoutes(s){return(1<arguments.length&&void 0!==arguments[1]?arguments[1]:[]).map(function(e){var t=replaceDynamicURLParts(clean(e.route)),o=t.regexp,n=t.paramNames,i=s.replace(/^\/+/,"/").match(o),a=regExpResultToParams(i,n);return!!i&&{match:i,route:e,params:a}}).filter(function(e){return e})}function match(e,t){return findMatchedRoutes(e,t)[0]||!1}function root(t,e){var o=e.map(function(e){return""===e.route||"*"===e.route?t:t.split(new RegExp(e.route+"($|/)"))[0]}),n=clean(t);return 1<o.length?o.reduce(function(e,t){return e.length>t.length&&(e=t),e},o[0]):1===o.length?o[0]:n}function isHashChangeAPIAvailable(){return"undefined"!=typeof window&&"onhashchange"in window}function extractGETParameters(e){return e.split(/\?(.*)?$/).slice(1).join("")}function getOnlyURL(e,t,o){function n(e){return e.split(/\?(.*)?$/)[0]}var i;return void 0===o&&(o="#"),isPushStateAvailable()&&!t?n(e).split(o)[0]:1<(i=e.split(o)).length?n(i[1]):n(i[0])}function manageHooks(e,t,o){if(t&&"object"===(void 0===t?"undefined":_typeof(t))){if(t.before)return void t.before(function(){0<arguments.length&&void 0!==arguments[0]&&!arguments[0]||(e(),t.after&&t.after(o))},o);if(t.after)return e(),void(t.after&&t.after(o))}e()}function isHashedRoot(e,t,o){if(isPushStateAvailable()&&!t)return!1;if(!e.match(o))return!1;var n=e.split(o);return n.length<2||""===n[1]}Navigo.prototype={helpers:{match:match,root:root,clean:clean,getOnlyURL:getOnlyURL},navigate:function(e,t){var o;return e=e||"",this._usePushState?(o=(o=(t?"":this._getRoot()+"/")+e.replace(/^\/+/,"/")).replace(/([^:])(\/{2,})/g,"$1/"),history[this._historyAPIUpdateMethod]({},"",o),this.resolve()):"undefined"!=typeof window&&(e=e.replace(new RegExp("^"+this._hash),""),window.location.href=window.location.href.replace(/#$/,"").replace(new RegExp(this._hash+".*$"),"")+this._hash+e),this},on:function(){for(var e,t=this,o=arguments.length,n=Array(o),i=0;i<o;i++)n[i]=arguments[i];return"function"==typeof n[0]?this._defaultHandler={handler:n[0],hooks:n[1]}:2<=n.length?"/"===n[0]?(e=n[1],"object"===_typeof(n[1])&&(e=n[1].uses),this._defaultHandler={handler:e,hooks:n[2]}):this._add(n[0],n[1],n[2]):"object"===_typeof(n[0])&&Object.keys(n[0]).sort(compareUrlDepth).forEach(function(e){t.on(e,n[0][e])}),this},off:function(o){return null!==this._defaultHandler&&o===this._defaultHandler.handler?this._defaultHandler=null:null!==this._notFoundHandler&&o===this._notFoundHandler.handler&&(this._notFoundHandler=null),this._routes=this._routes.reduce(function(e,t){return t.handler!==o&&e.push(t),e},[]),this},notFound:function(e,t){return this._notFoundHandler={handler:e,hooks:t},this},resolve:function(e){var t,o,n=this,i=(e||this._cLoc()).replace(this._getRoot(),"");this._useHash&&(i=i.replace(new RegExp("^/"+this._hash),"/"));var a=extractGETParameters(e||this._cLoc()),s=getOnlyURL(i,this._useHash,this._hash);return!this._paused&&(this._lastRouteResolved&&s===this._lastRouteResolved.url&&a===this._lastRouteResolved.query?(this._lastRouteResolved.hooks&&this._lastRouteResolved.hooks.already&&this._lastRouteResolved.hooks.already(this._lastRouteResolved.params),!1):(o=match(s,this._routes))?(this._callLeave(),this._lastRouteResolved={url:s,query:a,hooks:o.route.hooks,params:o.params,name:o.route.name},t=o.route.handler,manageHooks(function(){manageHooks(function(){o.route.route instanceof RegExp?t.apply(void 0,o.match.slice(1,o.match.length)):t(o.params,a)},o.route.hooks,o.params,n._genericHooks)},this._genericHooks,o.params),o):this._defaultHandler&&(""===s||"/"===s||s===this._hash||isHashedRoot(s,this._useHash,this._hash))?(manageHooks(function(){manageHooks(function(){n._callLeave(),n._lastRouteResolved={url:s,query:a,hooks:n._defaultHandler.hooks},n._defaultHandler.handler(a)},n._defaultHandler.hooks)},this._genericHooks),!0):(this._notFoundHandler&&manageHooks(function(){manageHooks(function(){n._callLeave(),n._lastRouteResolved={url:s,query:a,hooks:n._notFoundHandler.hooks},n._notFoundHandler.handler(a)},n._notFoundHandler.hooks)},this._genericHooks),!1))},destroy:function(){this._routes=[],this._destroyed=!0,this._lastRouteResolved=null,this._genericHooks=null,clearTimeout(this._listeningInterval),"undefined"!=typeof window&&(window.removeEventListener("popstate",this._onLocationChange),window.removeEventListener("hashchange",this._onLocationChange))},updatePageLinks:function(){var n=this;"undefined"!=typeof document&&this._findLinks().forEach(function(o){o.hasListenerAttached||(o.addEventListener("click",function(e){if((e.ctrlKey||e.metaKey)&&"a"==e.target.tagName.toLowerCase())return!1;var t=n.getLinkPath(o);n._destroyed||(e.preventDefault(),n.navigate(t.replace(/\/+$/,"").replace(/^\/+/,"/")))}),o.hasListenerAttached=!0)})},generate:function(n,e){var i=1<arguments.length&&void 0!==e?e:{},t=this._routes.reduce(function(e,t){var o;if(t.name===n)for(o in e=t.route,i)e=e.toString().replace(":"+o,i[o]);return e},"");return this._useHash?this._hash+t:t},link:function(e){return this._getRoot()+e},pause:function(e){var t=!(0<arguments.length&&void 0!==e)||e;this._paused=t,this._historyAPIUpdateMethod=t?"replaceState":"pushState"},resume:function(){this.pause(!1)},historyAPIUpdateMethod:function(e){return void 0===e?this._historyAPIUpdateMethod:this._historyAPIUpdateMethod=e},disableIfAPINotAvailable:function(){isPushStateAvailable()||this.destroy()},lastRouteResolved:function(){return this._lastRouteResolved},getLinkPath:function(e){return e.getAttribute("href")},hooks:function(e){this._genericHooks=e},_add:function(e,t,o){var n=1<arguments.length&&void 0!==t?t:null,i=2<arguments.length&&void 0!==o?o:null;return"string"==typeof e&&(e=encodeURI(e)),this._routes.push("object"===(void 0===n?"undefined":_typeof(n))?{route:e,handler:n.uses,name:n.as,hooks:i||n.hooks}:{route:e,handler:n,hooks:i}),this._add},_getRoot:function(){return null!==this.root||(this.root=root(this._cLoc().split("?")[0],this._routes)),this.root},_listen:function(){var e,t,o,n=this;this._usePushState?window.addEventListener("popstate",this._onLocationChange):isHashChangeAPIAvailable()?window.addEventListener("hashchange",this._onLocationChange):(e=this._cLoc(),o=t=void 0,(o=function(){t=n._cLoc(),e!==t&&(e=t,n.resolve()),n._listeningInterval=setTimeout(o,200)})())},_cLoc:function(){return"undefined"!=typeof window?void 0!==window.__NAVIGO_WINDOW_LOCATION_MOCK__?window.__NAVIGO_WINDOW_LOCATION_MOCK__:clean(window.location.href):""},_findLinks:function(){return[].slice.call(document.querySelectorAll("[data-navigo]"))},_onLocationChange:function(){this.resolve()},_callLeave:function(){var e=this._lastRouteResolved;e&&e.hooks&&e.hooks.leave&&e.hooks.leave(e.params)}},Navigo.PARAMETER_REGEXP=/([:*])(\w+)/g,Navigo.WILDCARD_REGEXP=/\*/g,Navigo.REPLACE_VARIABLE_REGEXP="([^/]+)",Navigo.REPLACE_WILDCARD="(?:.*)",Navigo.FOLLOWED_BY_SLASH_REGEXP="(?:/$|$)",Navigo.MATCH_REGEXP_FLAGS="",module.exports=Navigo;