"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ColorPicker=void 0;var _react=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_DomHandler=_interopRequireDefault(require("../utils/DomHandler")),_classnames=_interopRequireDefault(require("classnames")),_ColorPickerPanel=require("./ColorPickerPanel"),_Tooltip=_interopRequireDefault(require("../tooltip/Tooltip"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var n={};if(null!=e){var o,i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e){Object.prototype.hasOwnProperty.call(e,r)&&((o=i?Object.getOwnPropertyDescriptor(e,r):null)&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r])}}return n.default=e,t&&t.set(e,n),n}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ColorPicker=function(){function n(e){var t;return _classCallCheck(this,n),(t=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,e))).onPanelClick=t.onPanelClick.bind(_assertThisInitialized(t)),t.onInputClick=t.onInputClick.bind(_assertThisInitialized(t)),t.onInputKeydown=t.onInputKeydown.bind(_assertThisInitialized(t)),t}return _inherits(n,_react.Component),_createClass(n,[{key:"onHueMousedown",value:function(e){this.props.disabled||(this.hueDragging=!0,this.bindDocumentMouseMoveListener(),this.bindDocumentMouseUpListener(),this.pickHue(e),_DomHandler.default.addClass(this.container,"p-colorpicker-dragging"))}},{key:"pickHue",value:function(e){var t=this.hueView.getBoundingClientRect().top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0);this.hsbValue=this.validateHSB({h:Math.floor(360*(150-Math.max(0,Math.min(150,e.pageY-t)))/150),s:100,b:100}),this.updateColorSelector(),this.updateHue(),this.updateModel()}},{key:"onColorMousedown",value:function(e){this.props.disabled||(this.colorDragging=!0,this.bindDocumentMouseMoveListener(),this.bindDocumentMouseUpListener(),this.pickColor(e),_DomHandler.default.addClass(this.container,"p-colorpicker-dragging"))}},{key:"pickColor",value:function(e){var t=this.colorSelector.getBoundingClientRect(),n=t.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),o=t.left+document.body.scrollLeft,i=Math.floor(100*Math.max(0,Math.min(150,e.pageX-o))/150),r=Math.floor(100*(150-Math.max(0,Math.min(150,e.pageY-n)))/150);this.hsbValue=this.validateHSB({h:this.hsbValue.h,s:i,b:r}),this.updateColorHandle(),this.updateInput(),this.updateModel()}},{key:"updateModel",value:function(){switch(this.props.format){case"hex":this.onChange(this.HSBtoHEX(this.hsbValue));break;case"rgb":this.onChange(this.HSBtoRGB(this.hsbValue));break;case"hsb":this.onChange(this.hsbValue)}}},{key:"toHSB",value:function(e){var t;if(e)switch(this.props.format){case"hex":t=this.HEXtoHSB(e);break;case"rgb":t=this.RGBtoHSB(e);break;case"hsb":t=e}else t=this.HEXtoHSB(this.props.defaultColor);return t}},{key:"updateHSBValue",value:function(e){this.hsbValue=this.toHSB(e)}},{key:"areHSBEqual",value:function(e,t){return e.h===t.h&&e.s===t.s&&e.b===t.b}},{key:"onChange",value:function(e){this.props.onChange&&this.props.onChange({value:e,stopPropagation:function(){},preventDefault:function(){},target:{name:this.props.name,id:this.props.id,value:e}})}},{key:"updateColorSelector",value:function(){var e=this.validateHSB({h:this.hsbValue.h,s:100,b:100});this.colorSelector.style.backgroundColor="#"+this.HSBtoHEX(e)}},{key:"updateColorHandle",value:function(){this.colorHandle.style.left=Math.floor(150*this.hsbValue.s/100)+"px",this.colorHandle.style.top=Math.floor(150*(100-this.hsbValue.b)/100)+"px"}},{key:"updateHue",value:function(){this.hueHandle.style.top=Math.floor(150-150*this.hsbValue.h/360)+"px"}},{key:"updateInput",value:function(){this.input&&(this.input.style.backgroundColor="#"+this.HSBtoHEX(this.hsbValue))}},{key:"show",value:function(){var e=this;this.panel.element.style.zIndex=String(_DomHandler.default.generateZIndex()),this.panel.element.style.display="block",setTimeout(function(){_DomHandler.default.addClass(e.panel.element,"p-input-overlay-visible"),_DomHandler.default.removeClass(e.panel.element,"p-input-overlay-hidden")},1),this.alignPanel(),this.bindDocumentClickListener()}},{key:"hide",value:function(){var e=this;_DomHandler.default.addClass(this.panel.element,"p-input-overlay-hidden"),_DomHandler.default.removeClass(this.panel.element,"p-input-overlay-visible"),this.unbindDocumentClickListener(),setTimeout(function(){e.panel.element.style.display="none",_DomHandler.default.removeClass(e.panel.element,"p-input-overlay-hidden")},150)}},{key:"onInputClick",value:function(){this.documentClickListener&&(this.selfClick=!0),this.togglePanel()}},{key:"togglePanel",value:function(){this.panel.element.offsetParent?this.hide():this.show()}},{key:"onInputKeydown",value:function(e){switch(e.which){case 32:this.togglePanel(),e.preventDefault();break;case 27:case 9:this.hide()}}},{key:"onPanelClick",value:function(){this.selfClick=!0}},{key:"bindDocumentClickListener",value:function(){this.documentClickListener||(this.documentClickListener=this.onDocumentClick.bind(this),document.addEventListener("click",this.documentClickListener))}},{key:"onDocumentClick",value:function(){this.selfClick||(this.hide(),this.unbindDocumentClickListener()),this.selfClick=!1}},{key:"unbindDocumentClickListener",value:function(){this.documentClickListener&&(document.removeEventListener("click",this.documentClickListener),this.documentClickListener=null)}},{key:"bindDocumentMouseMoveListener",value:function(){this.documentMouseMoveListener||(this.documentMouseMoveListener=this.onDocumentMouseMove.bind(this),document.addEventListener("mousemove",this.documentMouseMoveListener))}},{key:"onDocumentMouseMove",value:function(e){this.colorDragging&&this.pickColor(e),this.hueDragging&&this.pickHue(e)}},{key:"unbindDocumentMouseMoveListener",value:function(){this.documentMouseMoveListener&&(document.removeEventListener("mousemove",this.documentMouseMoveListener),this.documentMouseMoveListener=null)}},{key:"bindDocumentMouseUpListener",value:function(){this.documentMouseUpListener||(this.documentMouseUpListener=this.onDocumentMouseUp.bind(this),document.addEventListener("mouseup",this.documentMouseUpListener))}},{key:"onDocumentMouseUp",value:function(){this.colorDragging=!1,this.hueDragging=!1,_DomHandler.default.removeClass(this.container,"p-colorpicker-dragging"),this.unbindDocumentMouseMoveListener(),this.unbindDocumentMouseUpListener()}},{key:"unbindDocumentMouseUpListener",value:function(){this.documentMouseUpListener&&(document.removeEventListener("mouseup",this.documentMouseUpListener),this.documentMouseUpListener=null)}},{key:"validateHSB",value:function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}}},{key:"validateRGB",value:function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b))}}},{key:"validateHEX",value:function(e){var t=6-e.length;if(0<t){for(var n=[],o=0;o<t;o++)n.push("0");n.push(e),e=n.join("")}return e}},{key:"HEXtoRGB",value:function(e){var t=parseInt(-1<e.indexOf("#")?e.substring(1):e,16);return{r:t>>16,g:(65280&t)>>8,b:255&t}}},{key:"HEXtoHSB",value:function(e){return this.RGBtoHSB(this.HEXtoRGB(e))}},{key:"RGBtoHSB",value:function(e){var t={h:0,s:0,b:0},n=Math.min(e.r,e.g,e.b),o=Math.max(e.r,e.g,e.b),i=o-n;return t.b=o,t.s=0!==o?255*i/o:0,0!==t.s?e.r===o?t.h=(e.g-e.b)/i:e.g===o?t.h=2+(e.b-e.r)/i:t.h=4+(e.r-e.g)/i:t.h=-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t}},{key:"HSBtoRGB",value:function(e){var t,n,o,i={r:null,g:null,b:null},r=Math.round(e.h),s=Math.round(255*e.s/100),l=Math.round(255*e.b/100);return 0===s?i={r:l,g:l,b:l}:(o=r%60*((t=l)-(n=(255-s)*l/255))/60,360===r&&(r=0),r<60?(i.r=t,i.b=n,i.g=n+o):r<120?(i.g=t,i.b=n,i.r=t-o):r<180?(i.g=t,i.r=n,i.b=n+o):r<240?(i.b=t,i.r=n,i.g=t-o):r<300?(i.b=t,i.g=n,i.r=n+o):r<360?(i.r=t,i.g=n,i.b=t-o):(i.r=0,i.g=0,i.b=0)),{r:Math.round(i.r),g:Math.round(i.g),b:Math.round(i.b)}}},{key:"RGBtoHEX",value:function(e){var t=[e.r.toString(16),e.g.toString(16),e.b.toString(16)];for(var n in t)1===t[n].length&&(t[n]="0"+t[n]);return t.join("")}},{key:"HSBtoHEX",value:function(e){return this.RGBtoHEX(this.HSBtoRGB(e))}},{key:"componentDidMount",value:function(){this.updateHSBValue(this.props.value),this.updateUI(),this.props.tooltip&&this.renderTooltip()}},{key:"componentDidUpdate",value:function(e){this.updateUI(),e.tooltip!==this.props.tooltip&&(this.tooltip?this.tooltip.updateContent(this.props.tooltip):this.renderTooltip())}},{key:"componentWillUnmount",value:function(){this.unbindDocumentClickListener(),this.unbindDocumentMouseMoveListener(),this.unbindDocumentMouseUpListener(),this.tooltip&&(this.tooltip.destroy(),this.tooltip=null)}},{key:"shouldComponentUpdate",value:function(e){if(this.colorDragging)return!1;var t=this.hsbValue;this.updateHSBValue(e.value);var n=this.toHSB(e.value);return!(n.h===t.h&&n.s===t.s&&n.b===t.b)}},{key:"updateUI",value:function(){this.updateHue(),this.updateColorHandle(),this.updateInput(),this.updateColorSelector()}},{key:"alignPanel",value:function(){this.props.appendTo?(this.panel.element.style.minWidth=_DomHandler.default.getWidth(this.container)+"px",_DomHandler.default.absolutePosition(this.panel.element,this.container)):_DomHandler.default.relativePosition(this.panel.element,this.container)}},{key:"renderTooltip",value:function(){this.tooltip=new _Tooltip.default({target:this.container,content:this.props.tooltip,options:this.props.tooltipOptions})}},{key:"renderColorSelector",value:function(){var t=this;return _react.default.createElement("div",{ref:function(e){return t.colorSelector=e},className:"p-colorpicker-color-selector",onMouseDown:this.onColorMousedown.bind(this)},_react.default.createElement("div",{className:"p-colorpicker-color"},_react.default.createElement("div",{ref:function(e){return t.colorHandle=e},className:"p-colorpicker-color-handle"})))}},{key:"renderHue",value:function(){var t=this;return _react.default.createElement("div",{ref:function(e){return t.hueView=e},className:"p-colorpicker-hue",onMouseDown:this.onHueMousedown.bind(this)},_react.default.createElement("div",{ref:function(e){return t.hueHandle=e},className:"p-colorpicker-hue-handle"}))}},{key:"renderContent",value:function(){var e=this.renderColorSelector(),t=this.renderHue();return _react.default.createElement("div",{className:"p-colorpicker-content"},e,t)}},{key:"renderInput",value:function(){var t=this;if(this.props.inline)return null;var e=(0,_classnames.default)("p-colorpicker-preview p-inputtext",{"p-disabled":this.props.disabled});return _react.default.createElement("input",{ref:function(e){return t.input=e},type:"text",className:e,readOnly:"readonly",id:this.props.inputId,tabIndex:this.props.tabIndex,disabled:this.props.disabled,onClick:this.onInputClick,onKeyDown:this.onInputKeydown})}},{key:"render",value:function(){var t=this,e=(0,_classnames.default)("p-colorpicker p-component",this.props.className,{"p-colorpicker-overlay":!this.props.inline}),n=this.renderContent(),o=this.renderInput();return _react.default.createElement("div",{ref:function(e){return t.container=e},id:this.props.id,style:this.props.style,className:e},o,_react.default.createElement(_ColorPickerPanel.ColorPickerPanel,{ref:function(e){return t.panel=e},appendTo:this.props.appendTo,onClick:this.onPanelClick,inline:this.props.inline,disabled:this.props.disabled},n))}}]),n}();_defineProperty(exports.ColorPicker=ColorPicker,"defaultProps",{id:null,value:null,style:null,className:null,defaultColor:"ff0000",inline:!1,format:"hex",appendTo:null,disabled:!1,tabIndex:null,inputId:null,tooltip:null,tooltipOptions:null,onChange:null}),_defineProperty(ColorPicker,"propTypes",{id:_propTypes.default.string,value:_propTypes.default.any,style:_propTypes.default.object,className:_propTypes.default.string,defaultColor:_propTypes.default.string,inline:_propTypes.default.bool,format:_propTypes.default.string,appendTo:_propTypes.default.any,disabled:_propTypes.default.bool,tabIndex:_propTypes.default.string,inputId:_propTypes.default.string,tooltip:_propTypes.default.string,tooltipOptions:_propTypes.default.object,onChange:_propTypes.default.func});