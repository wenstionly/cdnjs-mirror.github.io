"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Dialog=void 0;var _react=_interopRequireWildcard(require("react")),_reactDom=_interopRequireDefault(require("react-dom")),_propTypes=_interopRequireDefault(require("prop-types")),_DomHandler=_interopRequireDefault(require("../utils/DomHandler")),_classnames=_interopRequireDefault(require("classnames")),_UniqueComponentId=_interopRequireDefault(require("../utils/UniqueComponentId")),_reactTransitionGroup=require("react-transition-group");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var o,i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e){Object.prototype.hasOwnProperty.call(e,r)&&((o=n?Object.getOwnPropertyDescriptor(e,r):null)&&(o.get||o.set)?Object.defineProperty(i,r,o):i[r]=e[r])}return i.default=e,t&&t.set(e,i),i}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(o):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,i=new Array(t);o<t;o++)i[o]=e[o];return i}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(o){return function(){var e,t=_getPrototypeOf(o);return _possibleConstructorReturn(this,_isNativeReflectConstruct()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var Dialog=function(){_inherits(i,_react.Component);var o=_createSuper(i);function i(e){var t;return _classCallCheck(this,i),(t=o.call(this,e)).state={maskVisible:e.visible},t.props.onMaximize||(t.state.maximized=e.maximized),t.onClose=t.onClose.bind(_assertThisInitialized(t)),t.toggleMaximize=t.toggleMaximize.bind(_assertThisInitialized(t)),t.onMaskClick=t.onMaskClick.bind(_assertThisInitialized(t)),t.onDialogClick=t.onDialogClick.bind(_assertThisInitialized(t)),t.onEntered=t.onEntered.bind(_assertThisInitialized(t)),t.onExit=t.onExit.bind(_assertThisInitialized(t)),t.onExited=t.onExited.bind(_assertThisInitialized(t)),t.id=t.props.id||(0,_UniqueComponentId.default)(),t}return _createClass(i,[{key:"onClose",value:function(e){this.props.onHide(),e.preventDefault()}},{key:"focus",value:function(){var e=_DomHandler.default.findSingle(this.dialog,"button");e&&e.focus()}},{key:"onMaskClick",value:function(e){this.props.modal&&this.props.closable&&this.props.dismissableMask&&this.onClose(e)}},{key:"onDialogClick",value:function(e){e.stopPropagation()}},{key:"toggleMaximize",value:function(e){var t=!this.maximized;this.props.onMaximize?this.props.onMaximize({originalEvent:e,maximized:t}):this.setState({maximized:t},this.changeScrollOnMaximizable),e.preventDefault()}},{key:"getPositionClass",value:function(){var t=this,e=["center","left","right","top","topleft","topright","bottom","bottomleft","bottomright"].find(function(e){return e===t.props.position});return e?"p-dialog-".concat(e):""}},{key:"onEntered",value:function(){this.props.onShow&&this.props.onShow(),this.props.focusOnShow&&this.focus(),this.enableDocumentSettings()}},{key:"onExit",value:function(){this.props.onHide()}},{key:"onExited",value:function(){this.setState({maskVisible:!1}),this.disableDocumentSettings()}},{key:"enableDocumentSettings",value:function(){this.props.modal&&this.bindGlobalListeners(),(this.props.blockScroll||this.props.maximizable&&this.maximized)&&_DomHandler.default.addClass(document.body,"p-overflow-hidden")}},{key:"disableDocumentSettings",value:function(){this.props.modal?(this.unbindGlobalListeners(),document.primeDialogParams&&document.primeDialogParams.some(function(e){return e.hasBlockScroll})||_DomHandler.default.removeClass(document.body,"p-overflow-hidden")):(this.props.blockScroll||this.props.maximizable&&this.maximized)&&_DomHandler.default.removeClass(document.body,"p-overflow-hidden")}},{key:"bindGlobalListeners",value:function(){this.props.closeOnEscape&&this.props.closable&&this.bindDocumentKeyDownListener()}},{key:"unbindGlobalListeners",value:function(){this.unbindDocumentKeyDownListener()}},{key:"bindDocumentKeyDownListener",value:function(){var l=this;this.documentKeyDownListener=function(e){var t,o,i,n,r,a,s=e.currentTarget;s&&s.primeDialogParams&&((i=(t=s.primeDialogParams)[(o=t.length)-1].id)===l.id&&(n=document.getElementById(i),27===e.which?(l.onClose(e),e.stopImmediatePropagation(),t.splice(o-1,1)):9===e.which&&(e.preventDefault(),(r=_DomHandler.default.getFocusableElements(n))&&0<r.length&&(document.activeElement?(a=r.indexOf(document.activeElement),e.shiftKey?-1===a||0===a?r[r.length-1].focus():r[a-1].focus():-1===a||a===r.length-1?r[0].focus():r[a+1].focus()):r[0].focus()))))};var e={id:this.id,hasBlockScroll:this.props.blockScroll};document.primeDialogParams=document.primeDialogParams?[].concat(_toConsumableArray(document.primeDialogParams),[e]):[e],document.addEventListener("keydown",this.documentKeyDownListener)}},{key:"unbindDocumentKeyDownListener",value:function(){var t=this;this.documentKeyDownListener&&(document.removeEventListener("keydown",this.documentKeyDownListener),document.primeDialogParams=document.primeDialogParams&&document.primeDialogParams.filter(function(e){return e.id!==t.id}),this.documentKeyDownListener=null)}},{key:"componentDidMount",value:function(){this.props.visible&&(this.mask.style.zIndex=String(this.zIndex),this.onEntered())}},{key:"componentDidUpdate",value:function(e){var t=this;this.props.visible&&!this.state.maskVisible&&this.setState({maskVisible:!0},function(){t.mask.style.zIndex=String(t.zIndex)}),e.maximized!==this.props.maximized&&this.props.onMaximize&&this.changeScrollOnMaximizable()}},{key:"changeScrollOnMaximizable",value:function(){var e;this.props.blockScroll||(e=this.maximized?"addClass":"removeClass",_DomHandler.default[e](document.body,"p-overflow-hidden"))}},{key:"componentWillUnmount",value:function(){this.disableDocumentSettings()}},{key:"renderCloseIcon",value:function(){return this.props.closable?_react.default.createElement("button",{type:"button",className:"p-dialog-titlebar-icon p-dialog-titlebar-close p-link","aria-label":this.props.ariaCloseIconLabel,onClick:this.onClose},_react.default.createElement("span",{className:"p-dialog-titlebar-close-icon pi pi-times"})):null}},{key:"renderMaximizeIcon",value:function(){var e=(0,_classnames.default)("p-dialog-titlebar-maximize-icon pi",{"pi-window-maximize":!this.maximized,"pi-window-minimize":this.maximized});return this.props.maximizable?_react.default.createElement("button",{type:"button",className:"p-dialog-titlebar-icon p-dialog-titlebar-maximize p-link",onClick:this.toggleMaximize},_react.default.createElement("span",{className:e})):null}},{key:"renderIconsTemplate",value:function(){return this.props.iconsTemplate?this.props.iconsTemplate(this):null}},{key:"renderHeader",value:function(){var t=this;if(this.props.showHeader){var e=this.renderCloseIcon(),o=this.renderMaximizeIcon(),i=this.renderIconsTemplate();return _react.default.createElement("div",{ref:function(e){return t.headerElement=e},className:"p-dialog-titlebar"},_react.default.createElement("span",{id:this.id+"_header",className:"p-dialog-title"},this.props.header),_react.default.createElement("div",{className:"p-dialog-titlebar-icons"},i,o,e))}return null}},{key:"renderContent",value:function(){var t=this;return _react.default.createElement("div",{ref:function(e){return t.contentElement=e},className:"p-dialog-content",style:this.props.contentStyle},this.props.children)}},{key:"renderFooter",value:function(){var t=this;return this.props.footer?_react.default.createElement("div",{ref:function(e){return t.footerElement=e},className:"p-dialog-footer"},this.props.footer):null}},{key:"renderElement",value:function(){var t=this,e=(0,_classnames.default)("p-dialog p-component",this.props.className,{"p-dialog-rtl":this.props.rtl,"p-dialog-maximized":this.maximized}),o=(0,_classnames.default)("p-dialog-mask",{"p-component-overlay":this.props.modal,"p-dialog-visible":this.state.maskVisible},this.props.maskClassName,this.getPositionClass()),i=this.renderHeader(),n=this.renderContent(),r=this.renderFooter(),a={enter:"center"===this.props.position?150:300,exit:"center"===this.props.position?150:300};return _react.default.createElement("div",{ref:function(e){return t.mask=e},className:o,onClick:this.onMaskClick},_react.default.createElement(_reactTransitionGroup.CSSTransition,{classNames:"p-dialog",timeout:a,in:this.props.visible,unmountOnExit:!0,onEntered:this.onEntered,onExit:this.onExit,onExited:this.onExited},_react.default.createElement("div",{ref:function(e){return t.dialog=e},id:this.id,className:e,style:this.props.style,onClick:this.onDialogClick,"aria-labelledby":this.id+"_label",role:"dialog","aria-modal":this.props.model},i,n,r)))}},{key:"render",value:function(){var e=this.renderElement();return this.props.appendTo?_reactDom.default.createPortal(e,this.props.appendTo):e}},{key:"zIndex",get:function(){return this.props.baseZIndex+_DomHandler.default.generateZIndex()}},{key:"maximized",get:function(){return this.props.onMaximize?this.props.maximized:this.state.maximized}}]),i}();_defineProperty(exports.Dialog=Dialog,"defaultProps",{id:null,header:null,footer:null,visible:!1,position:"center",modal:!0,onHide:null,onShow:null,contentStyle:null,closeOnEscape:!0,dismissableMask:!1,rtl:!1,closable:!0,style:null,className:null,maskClassName:null,showHeader:!0,appendTo:null,baseZIndex:0,maximizable:!1,blockScroll:!1,iconsTemplate:null,ariaCloseIconLabel:"Close",focusOnShow:!0,maximized:!1,onMaximize:null}),_defineProperty(Dialog,"propTypes",{id:_propTypes.default.string,header:_propTypes.default.any,footer:_propTypes.default.any,visible:_propTypes.default.bool,position:_propTypes.default.string,modal:_propTypes.default.bool,onHide:_propTypes.default.func.isRequired,onShow:_propTypes.default.func,contentStyle:_propTypes.default.object,closeOnEscape:_propTypes.default.bool,dismissableMask:_propTypes.default.bool,rtl:_propTypes.default.bool,closable:_propTypes.default.bool,style:_propTypes.default.object,className:_propTypes.default.string,maskClassName:_propTypes.default.string,showHeader:_propTypes.default.bool,appendTo:_propTypes.default.object,baseZIndex:_propTypes.default.number,maximizable:_propTypes.default.bool,blockScroll:_propTypes.default.bool,iconsTemplate:_propTypes.default.func,ariaCloseIconLabel:_propTypes.default.string,focusOnShow:_propTypes.default.bool,maximized:_propTypes.default.bool,onMaximize:_propTypes.default.func});