"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TreeTableBodyCell=void 0;var _react=_interopRequireWildcard(require("react")),_classnames=_interopRequireDefault(require("classnames")),_ObjectUtils=_interopRequireDefault(require("../utils/ObjectUtils")),_DomHandler=_interopRequireDefault(require("../utils/DomHandler"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var i,r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e){Object.prototype.hasOwnProperty.call(e,o)&&((i=n?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(r,o,i):r[o]=e[o])}return r.default=e,t&&t.set(e,r),r}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(i){return function(){var e,t=_getPrototypeOf(i);return _possibleConstructorReturn(this,_isNativeReflectConstruct()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var TreeTableBodyCell=function(){_inherits(r,_react.Component);var i=_createSuper(r);function r(e){var t;return _classCallCheck(this,r),(t=i.call(this,e)).props.editor&&(t.state={}),t.onClick=t.onClick.bind(_assertThisInitialized(t)),t.onKeyDown=t.onKeyDown.bind(_assertThisInitialized(t)),t.onEditorFocus=t.onEditorFocus.bind(_assertThisInitialized(t)),t}return _createClass(r,[{key:"onClick",value:function(){this.props.editor&&(this.setState({editing:!0}),this.documentEditListener?this.cellClick=!0:this.bindDocumentEditListener())}},{key:"onKeyDown",value:function(e){13!==e.which&&9!==e.which||this.switchCellToViewMode()}},{key:"bindDocumentEditListener",value:function(){var t=this;this.documentEditListener||(this.documentEditListener=function(e){t.cellClick||t.switchCellToViewMode(),t.cellClick=!1},document.addEventListener("click",this.documentEditListener))}},{key:"unbindDocumentEditListener",value:function(){this.documentEditListener&&(document.removeEventListener("click",this.documentEditListener),this.documentEditListener=null)}},{key:"closeCell",value:function(){this.setState({editing:!1}),this.unbindDocumentEditListener()}},{key:"onEditorFocus",value:function(e){this.onClick(e)}},{key:"switchCellToViewMode",value:function(){this.props.editorValidator&&!this.props.editorValidator(this.props)||this.closeCell()}},{key:"componentDidUpdate",value:function(){var e,t=this;this.container&&this.props.editor&&(this.state&&this.state.editing?((e=_DomHandler.default.findSingle(this.container,"input"))&&(e.setAttribute("data-isCellEditing",!0),e.focus()),this.keyHelper.tabIndex=-1):setTimeout(function(){t.keyHelper&&t.keyHelper.removeAttribute("tabindex")},50))}},{key:"render",value:function(){var e,t=this,i=(0,_classnames.default)(this.props.bodyClassName||this.props.className,{"p-editable-column":this.props.editor,"p-cell-editing":!!this.props.editor&&this.state.editing}),r=this.props.bodyStyle||this.props.style;if(this.state&&this.state.editing){if(!this.props.editor)throw new Error("Editor is not found on column.");e=this.props.editor(this.props)}else e=this.props.body?this.props.body(this.props.node,this.props.column):_ObjectUtils.default.resolveFieldData(this.props.node.data,this.props.field);var n=this.props.editor&&_react.default.createElement("a",{tabIndex:"0",ref:function(e){t.keyHelper=e},className:"p-cell-editor-key-helper p-hidden-accessible",onFocus:this.onEditorFocus},_react.default.createElement("span",null));return _react.default.createElement("td",{ref:function(e){return t.container=e},className:i,style:r,onClick:this.onClick,onKeyDown:this.onKeyDown},this.props.children,n,e)}}]),r}();exports.TreeTableBodyCell=TreeTableBodyCell;