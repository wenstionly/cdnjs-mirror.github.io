"use strict";import Axis from"./Axis.js";import H from"./Globals.js";import ScrollbarAxis from"./ScrollbarAxis.js";import U from"./Utilities.js";var addEvent=U.addEvent,correctFloat=U.correctFloat,defined=U.defined,destroyObjectProperties=U.destroyObjectProperties,fireEvent=U.fireEvent,merge=U.merge,pick=U.pick,removeEvent=U.removeEvent;import"./Options.js";var defaultOptions=H.defaultOptions,hasTouch=H.hasTouch,isTouchDevice=H.isTouchDevice,swapXY=H.swapXY=function(t,r){return r&&t.forEach(function(t){for(var r,i=t.length,o=0;o<i;o+=2)"number"==typeof(r=t[o+1])&&(t[o+1]=t[o+2],t[o+2]=r)}),t},Scrollbar=function(){function t(t,r,i){this._events=[],this.chartX=0,this.chartY=0,this.from=0,this.group=void 0,this.scrollbar=void 0,this.scrollbarButtons=[],this.scrollbarGroup=void 0,this.scrollbarLeft=0,this.scrollbarRifles=void 0,this.scrollbarStrokeWidth=1,this.scrollbarTop=0,this.size=0,this.to=0,this.track=void 0,this.trackBorderWidth=1,this.userOptions={},this.x=0,this.y=0,this.chart=i,this.options=r,this.renderer=i.renderer,this.init(t,r,i)}return t.prototype.addEvents=function(){var t,r=this.options.inverted?[1,0]:[0,1],i=this.scrollbarButtons,o=this.scrollbarGroup.element,s=this.track.element,e=this.mouseDownHandler.bind(this),h=this.mouseMoveHandler.bind(this),a=this.mouseUpHandler.bind(this);t=[[i[r[0]].element,"click",this.buttonToMinClick.bind(this)],[i[r[1]].element,"click",this.buttonToMaxClick.bind(this)],[s,"click",this.trackClick.bind(this)],[o,"mousedown",e],[o.ownerDocument,"mousemove",h],[o.ownerDocument,"mouseup",a]],hasTouch&&t.push([o,"touchstart",e],[o.ownerDocument,"touchmove",h],[o.ownerDocument,"touchend",a]),t.forEach(function(t){addEvent.apply(null,t)}),this._events=t},t.prototype.buttonToMaxClick=function(t){var r=(this.to-this.from)*pick(this.options.step,.2);this.updatePosition(this.from+r,this.to+r),fireEvent(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMEvent:t})},t.prototype.buttonToMinClick=function(t){var r=correctFloat(this.to-this.from)*pick(this.options.step,.2);this.updatePosition(correctFloat(this.from-r),correctFloat(this.to-r)),fireEvent(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMEvent:t})},t.prototype.cursorToScrollbarPosition=function(t){var r=this.options,i=r.minWidth>this.calculatedWidth?r.minWidth:0;return{chartX:(t.chartX-this.x-this.xOffset)/(this.barWidth-i),chartY:(t.chartY-this.y-this.yOffset)/(this.barWidth-i)}},t.prototype.destroy=function(){var t=this.chart.scroller;this.removeEvents(),["track","scrollbarRifles","scrollbar","scrollbarGroup","group"].forEach(function(t){this[t]&&this[t].destroy&&(this[t]=this[t].destroy())},this),t&&this===t.scrollbar&&(t.scrollbar=null,destroyObjectProperties(t.scrollbarButtons))},t.prototype.drawScrollbarButton=function(t){var r,i,o=this.renderer,s=this.scrollbarButtons,e=this.options,h=this.size;r=o.g().add(this.group),s.push(r),i=o.rect().addClass("highcharts-scrollbar-button").add(r),this.chart.styledMode||i.attr({stroke:e.buttonBorderColor,"stroke-width":e.buttonBorderWidth,fill:e.buttonBackgroundColor}),i.attr(i.crisp({x:-.5,y:-.5,width:h+1,height:h+1,r:e.buttonBorderRadius},i.strokeWidth())),i=o.path(swapXY([["M",h/2+(t?-1:1),h/2-3],["L",h/2+(t?-1:1),h/2+3],["L",h/2+(t?2:-2),h/2]],e.vertical)).addClass("highcharts-scrollbar-arrow").add(s[t]),this.chart.styledMode||i.attr({fill:e.buttonArrowColor})},t.prototype.init=function(r,i,o){this.scrollbarButtons=[],this.renderer=r,this.userOptions=i,this.options=merge(t.defaultOptions,i),this.chart=o,this.size=pick(this.options.size,this.options.height),i.enabled&&(this.render(),this.addEvents())},t.prototype.mouseDownHandler=function(t){var r=this.chart.pointer.normalize(t),i=this.cursorToScrollbarPosition(r);this.chartX=i.chartX,this.chartY=i.chartY,this.initPositions=[this.from,this.to],this.grabbedCenter=!0},t.prototype.mouseMoveHandler=function(t){var r,i=this.chart.pointer.normalize(t),o=this.options.vertical?"chartY":"chartX",s=this.initPositions||[];!this.grabbedCenter||t.touches&&0===t.touches[0][o]||(r=this.cursorToScrollbarPosition(i)[o]-this[o],this.hasDragged=!0,this.updatePosition(s[0]+r,s[1]+r),this.hasDragged&&fireEvent(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMType:t.type,DOMEvent:t}))},t.prototype.mouseUpHandler=function(t){this.hasDragged&&fireEvent(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMType:t.type,DOMEvent:t}),this.grabbedCenter=this.hasDragged=this.chartX=this.chartY=null},t.prototype.position=function(t,r,i,o){var s=this.options.vertical,e=o,h=0,a=this.rendered?"animate":"attr";this.x=t,this.y=r+this.trackBorderWidth,this.width=i,this.height=o,this.xOffset=e,this.yOffset=h,s?(this.width=this.yOffset=i=h=this.size,this.xOffset=e=0,this.barWidth=o-2*i,this.x=t+=this.options.margin):(this.height=this.xOffset=o=e=this.size,this.barWidth=i-2*o,this.y=this.y+this.options.margin),this.group[a]({translateX:t,translateY:this.y}),this.track[a]({width:i,height:o}),this.scrollbarButtons[1][a]({translateX:s?0:i-e,translateY:s?o-h:0})},t.prototype.removeEvents=function(){this._events.forEach(function(t){removeEvent.apply(null,t)}),this._events.length=0},t.prototype.render=function(){var t,r=this.renderer,i=this.options,o=this.size,s=this.chart.styledMode;this.group=t=r.g("scrollbar").attr({zIndex:i.zIndex,translateY:-99999}).add(),this.track=r.rect().addClass("highcharts-scrollbar-track").attr({x:0,r:i.trackBorderRadius||0,height:o,width:o}).add(t),s||this.track.attr({fill:i.trackBackgroundColor,stroke:i.trackBorderColor,"stroke-width":i.trackBorderWidth}),this.trackBorderWidth=this.track.strokeWidth(),this.track.attr({y:-this.trackBorderWidth%2/2}),this.scrollbarGroup=r.g().add(t),this.scrollbar=r.rect().addClass("highcharts-scrollbar-thumb").attr({height:o,width:o,r:i.barBorderRadius||0}).add(this.scrollbarGroup),this.scrollbarRifles=r.path(swapXY([["M",-3,o/4],["L",-3,2*o/3],["M",0,o/4],["L",0,2*o/3],["M",3,o/4],["L",3,2*o/3]],i.vertical)).addClass("highcharts-scrollbar-rifles").add(this.scrollbarGroup),s||(this.scrollbar.attr({fill:i.barBackgroundColor,stroke:i.barBorderColor,"stroke-width":i.barBorderWidth}),this.scrollbarRifles.attr({stroke:i.rifleColor,"stroke-width":1})),this.scrollbarStrokeWidth=this.scrollbar.strokeWidth(),this.scrollbarGroup.translate(-this.scrollbarStrokeWidth%2/2,-this.scrollbarStrokeWidth%2/2),this.drawScrollbarButton(0),this.drawScrollbarButton(1)},t.prototype.setRange=function(t,r){var i,o,s,e,h,a=this.options,l=a.vertical,c=a.minWidth,n=this.barWidth,d=!this.rendered||this.hasDragged||this.chart.navigator&&this.chart.navigator.hasDragged?"attr":"animate";defined(n)&&(t=Math.max(t,0),i=Math.ceil(n*t),o=n*Math.min(r,1),this.calculatedWidth=e=correctFloat(o-i),e<c&&(i=(n-c+e)*t,e=c),s=Math.floor(i+this.xOffset+this.yOffset),h=e/2-.5,this.from=t,this.to=r,l?(this.scrollbarGroup[d]({translateY:s}),this.scrollbar[d]({height:e}),this.scrollbarRifles[d]({translateY:h}),this.scrollbarTop=s,this.scrollbarLeft=0):(this.scrollbarGroup[d]({translateX:s}),this.scrollbar[d]({width:e}),this.scrollbarRifles[d]({translateX:h}),this.scrollbarLeft=s,this.scrollbarTop=0),e<=12?this.scrollbarRifles.hide():this.scrollbarRifles.show(!0),!1===a.showFull&&(t<=0&&r>=1?this.group.hide():this.group.show()),this.rendered=!0)},t.prototype.trackClick=function(t){var r=this.chart.pointer.normalize(t),i=this.to-this.from,o=this.y+this.scrollbarTop,s=this.x+this.scrollbarLeft;this.options.vertical&&r.chartY>o||!this.options.vertical&&r.chartX>s?this.updatePosition(this.from+i,this.to+i):this.updatePosition(this.from-i,this.to-i),fireEvent(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMEvent:t})},t.prototype.update=function(t){this.destroy(),this.init(this.chart.renderer,merge(!0,this.options,t),this.chart)},t.prototype.updatePosition=function(t,r){r>1&&(t=correctFloat(1-correctFloat(r-t)),r=1),t<0&&(r=correctFloat(r-t),t=0),this.from=t,this.to=r},t.defaultOptions={height:isTouchDevice?20:14,barBorderRadius:0,buttonBorderRadius:0,liveRedraw:void 0,margin:10,minWidth:6,step:.2,zIndex:3,barBackgroundColor:"#cccccc",barBorderWidth:1,barBorderColor:"#cccccc",buttonArrowColor:"#333333",buttonBackgroundColor:"#e6e6e6",buttonBorderColor:"#cccccc",buttonBorderWidth:1,rifleColor:"#333333",trackBackgroundColor:"#f2f2f2",trackBorderColor:"#f2f2f2",trackBorderWidth:1},t}();H.Scrollbar||(defaultOptions.scrollbar=merge(!0,Scrollbar.defaultOptions,defaultOptions.scrollbar),H.Scrollbar=Scrollbar,ScrollbarAxis.compose(Axis,Scrollbar));export default H.Scrollbar;