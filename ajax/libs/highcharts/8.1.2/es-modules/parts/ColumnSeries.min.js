"use strict";import H from"./Globals.js";import Color from"./Color.js";var color=Color.parse;import LegendSymbolMixin from"../mixins/legend-symbol.js";import U from"./Utilities.js";var animObject=U.animObject,clamp=U.clamp,defined=U.defined,extend=U.extend,isNumber=U.isNumber,merge=U.merge,pick=U.pick,seriesType=U.seriesType;import"./Series.js";import"./Options.js";var noop=H.noop,Series=H.Series,svg=H.svg;seriesType("column","line",{borderRadius:0,centerInCategory:!1,groupPadding:.2,marker:null,pointPadding:.1,minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{halo:!1,brightness:.1},select:{color:"#cccccc",borderColor:"#000000"}},dataLabels:{align:void 0,verticalAlign:void 0,y:void 0},softThreshold:!1,startFromThreshold:!0,stickyTracking:!1,tooltip:{distance:6},threshold:0,borderColor:"#ffffff"},{cropShoulder:0,directTouch:!0,trackerGroups:["group","dataLabelsGroup"],negStacks:!0,init:function(){Series.prototype.init.apply(this,arguments);var t=this,e=t.chart;e.hasRendered&&e.series.forEach(function(e){e.type===t.type&&(e.isDirty=!0)})},getColumnMetrics:function(){var t,e=this,o=e.options,i=e.xAxis,r=e.yAxis,s=i.options.reversedStacks,n=i.reversed&&!s||!i.reversed&&s,a={},d=0;!1===o.grouping?d=1:e.chart.series.forEach(function(o){var i,s=o.yAxis,n=o.options;o.type!==e.type||!o.visible&&e.chart.options.chart.ignoreHiddenSeries||r.len!==s.len||r.pos!==s.pos||(n.stacking&&"group"!==n.stacking?(t=o.stackKey,void 0===a[t]&&(a[t]=d++),i=a[t]):!1!==n.grouping&&(i=d++),o.columnIndex=i)});var p=Math.min(Math.abs(i.transA)*(i.ordinal&&i.ordinal.slope||o.pointRange||i.closestPointRange||i.tickInterval||1),i.len),l=p*o.groupPadding,h=(p-2*l)/(d||1),c=Math.min(o.maxPointWidth||i.len,pick(o.pointWidth,h*(1-2*o.pointPadding))),g=(h-c)/2+(l+((e.columnIndex||0)+(n?1:0))*h-p/2)*(n?-1:1);return e.columnMetrics={width:c,offset:g,paddedWidth:h,columnCount:d},e.columnMetrics},crispCol:function(t,e,o,i){var r,s,n=this.chart,a=this.borderWidth,d=-(a%2?.5:0),p=a%2?.5:1;return n.inverted&&n.renderer.isVML&&(p+=1),this.options.crisp&&(o=Math.round(t+o)+d-(t=Math.round(t)+d)),r=Math.round(e+i)+p,s=Math.abs(e)<=.5&&r>.5,i=r-(e=Math.round(e)+p),s&&i&&(e-=1,i+=1),{x:t,y:e,width:o,height:i}},adjustForMissingColumns:function(t,e,o,i){var r=this,s=this.options.stacking;if(!o.isNull&&i.columnCount>1){var n=0,a=0;Highcharts.objectEach(this.yAxis.stacking&&this.yAxis.stacking.stacks,function(t){if("number"==typeof o.x){var e=t[o.x.toString()];if(e){var i=e.points[r.index],d=e.total;s?(i&&(n=a),e.hasValidPoints&&a++):H.isArray(i)&&(n=i[1],a=d||0)}}});var d=(a-1)*i.paddedWidth+e;t=(o.plotX||0)+d/2-e-n*i.paddedWidth}return t},translate:function(){var t=this,e=t.chart,o=t.options,i=t.dense=t.closestPointRange*t.xAxis.transA<2,r=t.borderWidth=pick(o.borderWidth,i?0:1),s=t.xAxis,n=t.yAxis,a=o.threshold,d=t.translatedThreshold=n.getThreshold(a),p=pick(o.minPointLength,5),l=t.getColumnMetrics(),h=l.width,c=t.barW=Math.max(h,1+2*r),g=t.pointXOffset=l.offset,u=t.dataMin,m=t.dataMax;e.inverted&&(d-=.5),o.pointPadding&&(c=Math.ceil(c)),Series.prototype.translate.apply(t),t.points.forEach(function(i){var r,y=pick(i.yBottom,d),f=999+Math.abs(y),b=h,v=i.plotX||0,x=clamp(i.plotY,-f,n.len+f),M=v+g,k=c,C=Math.min(x,y),S=Math.max(x,y)-C;p&&Math.abs(S)<p&&(S=p,r=!n.reversed&&!i.negative||n.reversed&&i.negative,isNumber(a)&&isNumber(m)&&i.y===a&&m<=a&&(n.min||0)<a&&u!==m&&(r=!r),C=Math.abs(C-d)>p?y-p:d-(r?p:0)),defined(i.options.pointWidth)&&(b=k=Math.ceil(i.options.pointWidth),M-=Math.round((b-h)/2)),o.centerInCategory&&(M=t.adjustForMissingColumns(M,b,i,l)),i.barX=M,i.pointWidth=b,i.tooltipPos=e.inverted?[n.len+n.pos-e.plotLeft-x,s.len+s.pos-e.plotTop-(v||0)-g-k/2,S]:[M+k/2,x+n.pos-e.plotTop,S],i.shapeType=t.pointClass.prototype.shapeType||"rect",i.shapeArgs=t.crispCol.apply(t,i.isNull?[M,d,k,0]:[M,C,k,S])})},getSymbol:noop,drawLegendSymbol:LegendSymbolMixin.drawRectangle,drawGraph:function(){this.group[this.dense?"addClass":"removeClass"]("highcharts-dense-data")},pointAttribs:function(t,e){var o,i,r,s,n=this.options,a=this.pointAttrToOptions||{},d=a.stroke||"borderColor",p=a["stroke-width"]||"borderWidth",l=t&&t.color||this.color,h=t&&t[d]||n[d]||this.color||l,c=t&&t[p]||n[p]||this[p]||0,g=t&&t.options.dashStyle||n.dashStyle,u=pick(t&&t.opacity,n.opacity,1);return t&&this.zones.length&&(r=t.getZone(),l=t.options.color||r&&(r.color||t.nonZonedColor)||this.color,r&&(h=r.borderColor||h,g=r.dashStyle||g,c=r.borderWidth||c)),e&&t&&(s=(o=merge(n.states[e],t.options.states&&t.options.states[e]||{})).brightness,l=o.color||void 0!==s&&color(l).brighten(o.brightness).get()||l,h=o[d]||h,c=o[p]||c,g=o.dashStyle||g,u=pick(o.opacity,u)),i={fill:l,stroke:h,"stroke-width":c,opacity:u},g&&(i.dashstyle=g),i},drawPoints:function(){var t,e=this,o=this.chart,i=e.options,r=o.renderer,s=i.animationLimit||250;e.points.forEach(function(n){var a=n.plotY,d=n.graphic,p=!!d,l=d&&o.pointCount<s?"animate":"attr";isNumber(a)&&null!==n.y?(t=n.shapeArgs,d&&n.hasNewShapeType()&&(d=d.destroy()),e.enabledDataSorting&&(n.startXPos=e.xAxis.reversed?-(t?t.width:0):e.xAxis.width),d||(n.graphic=d=r[n.shapeType](t).add(n.group||e.group),d&&e.enabledDataSorting&&o.hasRendered&&o.pointCount<s&&(d.attr({x:n.startXPos}),p=!0,l="animate")),d&&p&&d[l](merge(t)),i.borderRadius&&d[l]({r:i.borderRadius}),o.styledMode||d[l](e.pointAttribs(n,n.selected&&"select")).shadow(!1!==n.allowShadow&&i.shadow,null,i.stacking&&!i.borderRadius),d.addClass(n.getClassName(),!0)):d&&(n.graphic=d.destroy())})},animate:function(t){var e,o,i=this,r=this.yAxis,s=i.options,n=this.chart.inverted,a={},d=n?"translateX":"translateY";t?(a.scaleY=.001,o=clamp(r.toPixels(s.threshold),r.pos,r.pos+r.len),n?a.translateX=o-r.len:a.translateY=o,i.clipBox&&i.setClip(),i.group.attr(a)):(e=i.group.attr(d),i.group.animate({scaleY:1},extend(animObject(i.options.animation),{step:function(t,o){i.group&&(a[d]=e+o.pos*(r.pos-e),i.group.attr(a))}})))},remove:function(){var t=this,e=t.chart;e.hasRendered&&e.series.forEach(function(e){e.type===t.type&&(e.isDirty=!0)}),Series.prototype.remove.apply(t,arguments)}});