"use strict";var __extends=this&&this.__extends||function(){var t=function(o,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])})(o,n)};return function(o,n){function i(){this.constructor=o}t(o,n),o.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();import Annotation from"../annotations.src.js";import ControlPoint from"../ControlPoint.js";import CrookedLine from"./CrookedLine.js";import MockPoint from"../MockPoint.js";import U from"../../parts/Utilities.js";var merge=U.merge;function getSecondCoordinate(t,o,n){return(o.y-t.y)/(o.x-t.x)*(n-t.x)+t.y}var Tunnel=function(t){function o(o,n){return t.call(this,o,n)||this}return __extends(o,t),o.prototype.getPointsOptions=function(){var t=CrookedLine.prototype.getPointsOptions.call(this);return t[2]=this.heightPointOptions(t[1]),t[3]=this.heightPointOptions(t[0]),t},o.prototype.getControlPointsOptions=function(){return this.getPointsOptions().slice(0,2)},o.prototype.heightPointOptions=function(t){var o=merge(t),n=this.options.typeOptions;return o.y+=n.height,o},o.prototype.addControlPoints=function(){CrookedLine.prototype.addControlPoints.call(this);var t=this.options,o=t.typeOptions,n=new ControlPoint(this.chart,this,merge(t.controlPointOptions,o.heightControlPoint),2);this.controlPoints.push(n),o.heightControlPoint=n.options},o.prototype.addShapes=function(){this.addLine(),this.addBackground()},o.prototype.addLine=function(){var t=this.initShape(merge(this.options.typeOptions.line,{type:"path",points:[this.points[0],this.points[1],function(t){var o=MockPoint.pointToOptions(t.annotation.points[2]);return o.command="M",o},this.points[3]]}),!1);this.options.typeOptions.line=t.options},o.prototype.addBackground=function(){var t=this.initShape(merge(this.options.typeOptions.background,{type:"path",points:this.points.slice()}));this.options.typeOptions.background=t.options},o.prototype.translateSide=function(t,o,n){var i=Number(n),e=0===i?3:2;this.translatePoint(t,o,i),this.translatePoint(t,o,e)},o.prototype.translateHeight=function(t){this.translatePoint(0,t,2),this.translatePoint(0,t,3),this.options.typeOptions.height=this.points[3].y-this.points[0].y},o}(CrookedLine);Tunnel.prototype.defaultOptions=merge(CrookedLine.prototype.defaultOptions,{typeOptions:{xAxis:0,yAxis:0,background:{fill:"rgba(130, 170, 255, 0.4)",strokeWidth:0},line:{strokeWidth:1},height:-2,heightControlPoint:{positioner:function(t){var o=MockPoint.pointToPixels(t.points[2]),n=MockPoint.pointToPixels(t.points[3]),i=(o.x+n.x)/2;return{x:i-this.graphic.width/2,y:getSecondCoordinate(o,n,i)-this.graphic.height/2}},events:{drag:function(t,o){o.chart.isInsidePlot(t.chartX-o.chart.plotLeft,t.chartY-o.chart.plotTop)&&(o.translateHeight(this.mouseMoveToTranslation(t).y),o.redraw(!1))}}}},controlPointOptions:{events:{drag:function(t,o){if(o.chart.isInsidePlot(t.chartX-o.chart.plotLeft,t.chartY-o.chart.plotTop)){var n=this.mouseMoveToTranslation(t);o.translateSide(n.x,n.y,this.index),o.redraw(!1)}}}}}),Annotation.types.tunnel=Tunnel;export default Tunnel;